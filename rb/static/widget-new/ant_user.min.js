function getWindowProps(a){a=a||{};var b=a.width||400,c=a.height||350,d=window.screen.width/2-b/2,e=window.screen.height/2-c/2;return"menubar=1,resizable=1,scrollbars=yes,width="+b+",height="+c+",top="+e+",left="+d}function stringify(a){var b=Array.prototype.toJSON;delete Array.prototype.toJSON;var c=JSON.stringify(a);return b&&(Array.prototype.toJSON=b),c}var qs=(window.location.search+window.location.hash).substr(1).split("&"),qs_args=[];for(var i in qs){var this_arg=qs[i].split("=");qs_args[this_arg[0]]=this_arg[1]}"undefined"==typeof qs_args.group_id&&(qs_args.group_id="");var trackingUrl="local.antenna.is"!=document.domain?"http://events.antenna.is/insert":"http://nodebq.docker/insert";window.ANTAuth={isOffline:"local.antenna.is"==document.domain,ant_user:{},popups:{},openGenericLoginWindow:function(a){var b=getWindowProps(a);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/login/","ant_login",b),ANTAuth.popups.loginWindow.focus(),!1},openFBLoginWindowFromPopup:function(a){return ANTAuth.closeWindowOnSuccess=!0,ANTAuth.doFBLogin(),!1},openAntLoginWindow:function(a){var b=getWindowProps(a);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/ant_login/","ant_login",b),ANTAuth.popups.loginWindow.focus(),!1},openAntCreateNewAccountWindow:function(a,b){var c=getWindowProps(a);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/user_create/","ant_create_user",c),ANTAuth.popups.loginWindow.focus(),b&&window.close(),!1},openAntForgotPasswordWindow:function(a){var b=getWindowProps(a);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/request_password/","ant_forgot_pw",b),ANTAuth.popups.loginWindow.focus(),!1},openAntAvatarUploadWindow:function(a){var b=getWindowProps(a);return ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/user_modify/","ant_avatar_upload",b),ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow.focus(),!1},openChangePasswordWindow:function(a){var b=getWindowProps(a);return ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/change_password/","ant_change_password",b),ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow.focus(),!1},events:{track:function(a){var b="";ANTAuth.ant_user&&ANTAuth.ant_user.user_id&&(b+="||uid::"+ANTAuth.ant_user.user_id),qs_args&&qs_args.group_id&&(b+="||gid::"+qs_args.group_id);var c=a+b,d=$('<img src="'+ANT_baseUrl+"/static/widget/images/event.png?"+c+'" />');$("#ant_event_pixels").append(d),ANTAuth.isOffline},trackEventToCloud:function(a){$.ajax({url:trackingUrl,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:stringify(a)},success:function(a){}})},helpers:{trackFBLoginAttempt:function(){var a="FBLogin attempted";ANTAuth.events.track(a),ANTAuth.events.trackEventToCloud({event_type:"login attempt facebook",event_value:"start"})},trackFBLoginFail:function(){var a="FBLogin failed or was canceled";ANTAuth.events.track(a),ANTAuth.events.trackEventToCloud({event_type:"login attempt facebook",event_value:"fail"})},trackAntLoginAttempt:function(){var a="AntLogin attempted";ANTAuth.events.track(a),ANTAuth.events.trackEventToCloud({event_type:"login attempt antenna",event_value:"start"})},trackAntLoginFail:function(){return}}},notifyParent:function(a,b){var c={key:a,detail:b};window.parent.postMessage(c,qs_args.parentUrl)},sendUser:function(){var a=ANTAuth.ant_user||{},b={first_name:a.first_name,full_name:a.full_name,img_url:a.img_url,user_id:a.user_id,ant_token:a.ant_token,user_type:a.user_type};ANTAuth.notifyParent("sendUser",b)},getUser:function(){ANTAuth.readUserCookie(),ANTAuth.ant_user.ant_token?ANTAuth.sendUser():ANTAuth.createTempUser()},getAntToken:function(a,b){if(a){var c=a.authResponse?a.authResponse:a,d={fb:c,group_id:qs_args.group_id?qs_args.group_id:1,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token};$.ajax({url:"/api/fb/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:stringify(d)},success:function(a){"fail"==a.status?ANTAuth.createTempUser():(ANTAuth.setUser(a),ANTAuth.returnUser(),ANTAuth.notifyParent("close login panel"),b&&b())},error:function(a){ANTAuth.createTempUser()}})}else ANTAuth.doFBLogin()},createTempUser:function(){if(parent.location!=window.location)if(ANTAuth.ant_user.user_id&&ANTAuth.ant_user.ant_token&&ANTAuth.ant_user.temp_user)ANTAuth.sendUser();else{var a={group_id:qs_args.group_id};$.ajax({url:"/api/tempuser/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:stringify(a)},success:function(a){ANTAuth.ant_user.user_id&&ANTAuth.ant_user.ant_token&&ANTAuth.ant_user.temp_user||ANTAuth.setUser(a),ANTAuth.sendUser()}})}},reauthUser:function(a){$.cookie("user_type")&&"facebook"==$.cookie("user_type")||!$.cookie("user_type")?(ANTAuth.readUserCookie(),FB.getAuthResponse()?ANTAuth.killUser(function(){ANTAuth.getAntToken()}):FB.getLoginStatus(function(a){a&&"connected"==a.status?ANTAuth.killUser(function(){ANTAuth.getAntToken(a)}):ANTAuth.returnUser()})):ANTAuth.returnUser()},quickFixAjaxLogout:function(){$("#group_settings_menu").hide(),$("#logged-in").hide(),$("#logged-out").css({display:"block",visibility:"visible"})},checkFBStatus:function(a){FB.getLoginStatus(function(a){if(a.status&&"connected"==a.status){if(ANTAuth.checkIfWordpressRefresh())return;if(ANTAuth.closeWindowOnSuccess&&window.close(),top==self)if($.cookie("user_id")||ANTAuth.ant_user&&ANTAuth.ant_user.user_id){var b=($.cookie("user_id")?$.cookie("user_id"):ANTAuth.ant_user.user_id,ANTAuth.ant_user.img_url);$("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden"),FB.api("/me",function(a){if($("#fb-login-button a").hasClass("logging-in"))return void window.location.reload();if(!$(".userSettingsMenu").length){var c=$("<a/>"),d=$("<img/>");$("<strong/>");c.attr("href","/user/"+e),d.attr("src",b+"?type=square"),c.append(d);var e=$.cookie("user_id"),f=$('<div id="log-out-link" />');f.append('<a href="/user/'+e+'">My Activity</a><a href="/follows/'+e+'">Activity I Follow</a><a href="javascript:void(0);" onclick="ANTAuth.logout();">Log Out</a><h5>Settings</h5><label for="private_profile">(Reload the page to edit your setttings.)</label>'),$("#logged-in").html(c).append(f)}})}else ANTAuth.getAntToken(a.authResponse,function(){});else $("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden"),ANTAuth.returnUser()}else top==self&&($("#logged-in").hide().css("visibility","hidden"),$("#logged-out").show().css("visibility","visible"))})},FBLoginCallback:function(a){a.authResponse?ANTAuth.getAntToken(FB.getAuthResponse(),function(){ANTAuth.checkFBStatus()}):ANTAuth.events.helpers.trackFBLoginFail()},checkIfWordpressRefresh:function(){var a=function(){var a=window.location.search;return a.search(/hostplatform=wordpress/i)>0}();if(a){var b="/wordpress_edit/",c=window.location.search||"?";c+="&refresh=true";var d=b+c;return window.location=d,!0}return!1},checkAntLoginWindow:function(){ANTAuth.checkingAntLoginWindow||(ANTAuth.checkingAntLoginWindow=setInterval(function(a){if(ANTAuth.popups.loginWindow&&ANTAuth.popups.loginWindow.closed){if(ANTAuth.readUserCookie(),ANTAuth.returnUser(),ANTAuth.notifyParent("close login panel"),ANTAuth.popups.loginWindow.close(),clearInterval(ANTAuth.checkingAntLoginWindow),ANTAuth.checkIfWordpressRefresh())return;top==self&&window.location.reload()}},250))},setUser:function(a){ANTAuth.ant_user={},a.data=a.data||{},a.data.first_name||a.data.full_name?ANTAuth.ant_user.temp_user=!1:ANTAuth.ant_user.temp_user=!0,ANTAuth.ant_user.ant_token=a.data.ant_token,ANTAuth.ant_user.user_id=a.data.user_id,ANTAuth.ant_user.full_name=a.data.full_name,ANTAuth.ant_user.first_name=a.data.full_name,ANTAuth.ant_user.img_url=a.data.img_url,ANTAuth.ant_user.user_type=a.data.user_type,ANTAuth.ant_user.user_boards=stringify(a.data.user_boards);var b=new Date;b.setMinutes(b.getMinutes()+60);var c=90;$.cookie("temp_user",ANTAuth.ant_user.temp_user,{expires:c,path:"/"}),$.cookie("ant_token",ANTAuth.ant_user.ant_token,{expires:c,path:"/"}),$.cookie("user_id",ANTAuth.ant_user.user_id,{expires:c,path:"/"}),$.cookie("user_type",ANTAuth.ant_user.user_type,{expires:c,path:"/"})},readUserCookie:function(){ANTAuth.ant_user.temp_user=$.cookie("temp_user"),ANTAuth.ant_user.ant_token=$.cookie("ant_token"),$.cookie("ant_token")||(ANTAuth.ant_user.ant_token=$.cookie("readr_token")),ANTAuth.ant_user.user_id=$.cookie("user_id"),ANTAuth.ant_user.user_type=$.cookie("user_type")},returnUser:function(){if(ANTAuth.readUserCookie(),top==self){if($.cookie("user_type")&&"facebook"==$.cookie("user_type"))ANTAuth.checkFBStatus();else if($.cookie("user_id")){$("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden");var a=$("<a/>"),b=$("<strong/>");a.attr("href","/user/"+$.cookie("user_id"));var c="friend";b.text(c),a.append(b)}}else ANTAuth.sendUser()},killUser:function(a){if(ANTAuth.ant_user&&!ANTAuth.ant_user.temp_user){var b={user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token};$.ajax({url:"/api/deauthorize/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:stringify(b)},success:function(b){ANTAuth.clearSessionCookies(),ANTAuth.ant_user={},a()}})}else ANTAuth.clearSessionCookies(),a()},clearSessionCookies:function(){$.cookie("temp_user",null,{path:"/"}),$.cookie("ant_token",null,{path:"/"}),$.cookie("user_id",null,{path:"/"}),$.cookie("user_type",null,{path:"/"}),$.cookie("ant_session",null,{path:"/"}),$.cookie("ant_user",null,{path:"/"})},doFBLogin:function(a){ANTAuth.events.helpers.trackFBLoginAttempt(),FB.login(function(a){ANTAuth.FBLoginCallback(a)},{scope:"email"})},doAntLogin:function(a){ANTAuth.events.helpers.trackAntLoginAttempt(),ANTAuth.openAntLoginWindow()},doAntlogout:function(){ANTAuth.killUser(function(){window.location.reload()})},logout:function(){$.cookie("user_type")&&"facebook"==$.cookie("user_type")?FB.getLoginStatus(function(a){a?FB.logout(function(a){ANTAuth.killUser(function(){window.location.reload()})}):ANTAuth.killUser(function(){window.location.reload()})}):ANTAuth.killUser(function(){window.location.reload()})},init:function(){ANTAuth.notifyParent("xdm loaded"),$.cookie("user_type")&&"facebook"==$.cookie("user_type")?FB.getLoginStatus(function(a){a.status&&"connected"==a.status?ANTAuth.getAntToken(a.authResponse,function(){}):ANTAuth.killUser(function(){})}):ANTAuth.returnUser()},decodeDjangoCookie:function(a){return a?a.replace(/"/g,"").replace(/\\054/g,",").replace(/\\073/g,";"):void 0}},$(document).ready(function(){window.fb_loader.done(function(){ANTAuth.init()}),window.fb_loader.done(function(){function a(a){if(a.origin===qs_args.parentHost&&"string"==typeof a.data){var b,c,d={registerEvent:"register-event::"};"getUser"==a.data?ANTAuth.getUser():"reloadXDMframe"==a.data?window.location.reload():"reauthUser"==a.data?ANTAuth.reauthUser():"returnUser"==a.data?ANTAuth.returnUser():"killUser"==a.data?ANTAuth.killUser():"TESTIT"==a.data?ANTAuth.testMessage():-1!=a.data.indexOf("page_hash")?$.cookie("page_hash",a.data.split("|")[1],{expires:365,path:"/"}):-1!=a.data.indexOf(d.registerEvent)&&(b=a.data.split(d.registerEvent)[1],c=JSON.parse(b),ANTAuth.events.trackEventToCloud(c))}}window.addEventListener("message",a,!1)})});