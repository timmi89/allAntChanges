/* Copyright (c) 2015 Antenna (ReadrBoard, Inc.) */
function getWindowProps(options){options=options||{};var w=options.width||400,h=options.height||350,l=window.screen.width/2-w/2,t=window.screen.height/2-h/2;return"menubar=1,resizable=1,scrollbars=yes,width="+w+",height="+h+",top="+t+",left="+l}window.ANT_offline=-1!=window.location.href.indexOf("local.antenna.is")?!0:!1,window.ANT_baseUrl=ANT_offline?"http://local.antenna.is:8081":"http://www.antenna.is",window.ANT_staticUrl=ANT_offline?"http://local.antenna.is:8081/static/":"http://s3.amazonaws.com/readrboard/",window.ANT_widgetCssStaticUrl=ANT_offline?"http://local.antenna.is:8081/static/":"http://s3.amazonaws.com/readrboard/";var ANTsite=ANTsite?ANTsite:{};ANTsite={ANT_offline:ANT_offline,group:{},querystring:function(key){var qs=(window.location.search+window.location.hash).substr(1).split("&"),qs_args=[];for(var i in qs){var this_arg=qs[i].split("=");qs_args[this_arg[0]]=this_arg[1]}return qs_args[key]},anonUserImg:ANT_staticUrl+"site/images/anonymous-user.png",admin:{requestAccess:function(fb_response,group_id){if(fb_response){var fb_session=fb_response.session?fb_response.session:fb_response,sendData={fb:fb_session,group_id:group_id};$.ajax({url:"/api/admin_request/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:JSON.stringify(sendData)},success:function(response){},error:function(response){}})}},blockContent:function(int_id){var sendData={int_id:int_id,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token};$.ajax({url:"/api/moderate/toggle/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:JSON.stringify(sendData)},success:function(response){if("success"==response.status){var $blockLink=$("#moderate_"+int_id);$blockLink.closest(".card").hide()}},error:function(response){}})}},util:{getHashValue:function(key){var hash=window.location.hash;if(hash.length>0){var pairs=hash.split("#");for(var i in pairs)if(key==pairs[i].split("=")[0]){var value=pairs[i].split("=");return value.length>1?(value[1]=value[1].split("?")[0].split("&")[0],value[1]):""}return!1}},setHashValue:function(key,value){var hash=window.location.hash,newHash="",foundKey=!1;if(hash.length>0){var pairs=hash.split("#");for(var i in pairs)key==pairs[i].split("=")[0]?(newHash+="#"+key+"="+value,foundKey=!0):pairs[i].length>0&&(newHash+="#"+pairs[i]);foundKey||(newHash+="#"+key+"="+value),window.location.hash=newHash}else newHash="#"+key+"="+value,window.location.hash=newHash},loadScript:function(attributes,callbackfunction){var oHead=document.getElementsByTagName("head")[0];if(oHead){var oScript=document.createElement("script");oScript.setAttribute("src",attributes.src),oScript.setAttribute("type","text/javascript"),oScript.readyState?oScript.onreadystatechange=function(){("loaded"==oScript.readyState||"complete"==oScript.readyState)&&(oScript.onreadystatechange=null,callbackfunction())}:oScript.onload=function(){callbackfunction()},oHead.appendChild(oScript)}}},fixUrlParams:function(urlOrNull,newQParams,replaceNotMerge){function _getQueryParams(optQueryString){for(var e,queryString=optQueryString||window.location.search,urlParams={},a=/\+/g,r=/([^&=]+)=?([^&]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=queryString.substring(1);e=r.exec(q);)urlParams[d(e[1])]=d(e[2]);return urlParams}var hrefBase,hrefQuery,qParams,_newQParams,url=urlOrNull||window.location,qIndex=url.indexOf("?");-1==qIndex?(hrefBase=url,hrefQuery=""):(hrefBase=url.slice(0,qIndex),hrefQuery=url.slice(qIndex)),qParams=replaceNotMerge?{}:_getQueryParams(hrefQuery),_newQParams=newQParams||{},$.extend(qParams,_newQParams),hrefQuery=$.param(qParams);var finalUrl=hrefQuery?hrefBase+"?"+hrefQuery:hrefBase;return finalUrl},follow:{add:function(id,type){var data={follow_id:parseInt(id),type:type};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/follow/",type:"post",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{json:$.toJSON(data)},success:function(response){if("brd"==data.type){var follower_count=parseInt($("#board_follower_count").text())+1;$("#board_follower_count").text(follower_count+" Followers"),$("#board_follow_button").unbind().html('<i class="fa fa-minus"></i>').click(function(){ANTsite.follow.remove(data.follow_id,"brd")})}else{"usr"==data.type?"person":"group";$("#follow_action").html('<i class="fa fa-minus"></i>').unbind().click(function(){var id="usr"==type?ANTsite.profile_user.id:ANTsite.group.id;ANTsite.follow.remove(id,type)}),$("#follower_count").html("<strong>"+(parseInt($("#follower_count").text())+1)+"</strong> followers")}}})},remove:function(id,type){var data={follow_id:parseInt(id),type:type};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/unfollow/",type:"post",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{json:$.toJSON(data)},success:function(response){if("brd"==data.type){var follower_count=parseInt($("#board_follower_count").text())-1;$("#board_follower_count").text(follower_count+" Followers"),$("#board_follow_button").unbind().html('<i class="fa fa-plus"></i>').click(function(){ANTsite.follow.add(data.follow_id,"brd")})}else{"usr"==data.type?"person":"group";$("#follow_action").html('<i class="fa fa-plus"></i>').unbind().click(function(){var id="usr"==type?ANTsite.profile_user.id:ANTsite.group.id;ANTsite.follow.add(id,type)}),$("#follower_count").html("<strong>"+(parseInt($("#follower_count").text())-1)+"</strong> followers")}}})},following:function(id,page_num,types){if("undefined"==typeof types)var types=["usr","grp","pag","brd"];var data={user_id:parseInt(id),page_num:page_num?page_num:1,types:types};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/follow/",type:"get",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{json:$.toJSON(data)},success:function(response){if(1==data.types.length&&-1!=$.inArray("brd",data.types));else{"undefined"!=typeof response.data.follows_count&&$("#following_count").html("<strong>"+response.data.follows_count+"</strong> following");var $following_html=$("<div><h2>"+$("#avatar h2").text().trim()+" is following:</h2></div>"),$ul=$("<ul/>"),followerList=response.data.paginated_follows;$.each(followerList,function(idx,following){if("undefined"!=typeof following.social_usr){var userImg=following.social_usr.img_url||ANTsite.anonUserImg;$ul.append('<li><a href="/user/'+following.social_usr.user+'/" class="clearfix"><img src="'+userImg+'" /><span>'+following.social_usr.full_name+"</span></a></li>")}else"undefined"!=typeof following.grp&&$ul.append('<li><a href="/group/'+following.grp.short_name+'/" class="clearfix">'+following.grp.short_name+"</a></li>")}),$("#following_list").html($following_html.append($ul)),followerList.length||$("#following_list").append("No follows yet")}}})},followers:function(id,type){var data={entity_id:parseInt(id),entity_type:type,page_num:"undefined"!=typeof page_num?page_num:1};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/entity/follow/",type:"get",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{json:$.toJSON(data)},success:function(response){if("brd"==data.entity_type)$("#board_follower_count").text(response.data.followed_by_count+" Followers"),1==response.data.user_is_follower&&$("#board_follow_button").unbind().text("Stop following this board").click(function(){ANTsite.follow.remove(data.entity_id,"brd")});else{"undefined"!=typeof response.data.followed_by_count&&$("#follower_count").html("<strong>"+response.data.followed_by_count+"</strong> followers");var id="usr"==data.entity_type?ANTsite.profile_user.id:ANTsite.group.id;"usr"==data.entity_type?"person":"group";response.data.user_is_follower?$("#follow_action").html('<i class="fa fa-minus"></i>').unbind().click(function(){ANTsite.follow.remove(id,type)}):$("#follow_action").html('<i class="fa fa-plus"></i>').unbind().click(function(){ANTsite.follow.add(id,type)});var followerList=response.data.paginated_follows,$follower_html=$("<div><h2>Following "+$("#avatar h2").text().trim()+":</h2></div>"),$ul=$("<ul/>");$.each(followerList,function(idx,following){var userImg=following.social_usr.img_url||ANTsite.anonUserImg;$ul.append('<li><a href="/user/'+following.social_usr.user+'/"><img src="'+userImg+'" /><span>'+following.social_usr.full_name+"</span></a></li>")}),$("#follower_list").html($follower_html.append($ul)),followerList.length||$("#follower_list").append("<span>no followers yet</span>")}}})},agreed:function(parent_id){var data={parent_id:parseInt(parent_id)};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/plusones/",type:"get",contentType:"application/x-www-form-urlencoded",dataType:"json",data:{json:$.toJSON(data)},success:function(response){var $agreeing_users=$("<div><h2>These readers had this reaction:</h2></div>"),$ul=$('<ul class="fancy_user_list"/>');$.each(response.data,function(idx,user){if("undefined"!=user.social_user.full_name){var userImg=user.social_user.img_url||ANTsite.anonUserImg;$ul.append('<li><a href="/user/'+user.id+'/"><img src="'+userImg+'" /> '+user.social_user.full_name+"</a></li>")}}),$agreeing_users.append($ul),$.fancybox($agreeing_users,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}}})}})}},interactions:{displayUserBoards:function(user_id){},searchBoards:function(search_term){return},me_too:function(parent_id){var sendData={parent_id:parent_id};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/metoo/",type:"post",data:{json:$.toJSON(sendData)},success:function(response){if("success"==response.status){var $message,$card=$(".interaction_"+parent_id),needToLogin=($card.find("div.me_too_outcome"),response.data.message&&"not_logged_in"==response.data.message);needToLogin?(ANTAuth.killUser(function(){ANTAuth.quickFixAjaxLogout()}),$message=$("<div><em>Your login has expired.  Please Log in.</em></div>")):$message=1==response.data.existing?$("<div><em>You have already added this to your profile.</em></div>"):$('<div><em>Success! You have added this to <a href="/user/'+$.cookie("user_id")+'">your profile</a>.</em></div>');var $shareLinks=$('<div style="overflow:auto;"><strong style="display:block;float:left;margin:5px 5px 0 0;">Share It:</strong> <ul class="shareLinks"></ul>'),socialNetworks=["facebook","twitter","tumblr"],cardData=$card.data(),kind=cardData.kind,interaction_body=(cardData.interactionId,cardData.interactionBody),groupName=cardData.groupName,content="";"txt"==kind?content=$card.find(".contentBody").text():"img"==kind?content=$card.find("img.contentBody").attr("src"):"med"==kind&&(content=$card.find("img.contentBody").attr("src")),$.each(socialNetworks,function(idx,val){var $li=$('<li><a href="http://'+val+'.com" ><img class="no-ant" src="'+ANT_staticUrl+"widget/images/social-icons-loose/social-icon-"+val+'.png" /></a></li>');$li.find("a").click(function(e){return e.preventDefault(),ANTsite.shareWindow=window.open(ANT_staticUrl+"share.html","readr_share","menubar=1,resizable=1,width=626,height=436"),ANTsite.interactions.share(val,kind,parent_id,interaction_body,groupName,content),!1}),$shareLinks.find("ul").append($li)}),$message.append($shareLinks),$.fancybox($message,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}}})}}})},delete_reaction:function(interaction_id){var sendData={interaction_id:interaction_id};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/tagremove/",type:"post",data:{json:$.toJSON(sendData)},success:function(response){if("success"==response.status){var $message,needToLogin=response.data.message&&"not_logged_in"==response.data.message,deleteWasSuccessful=response.data==interaction_id,$card=$(".interaction_"+interaction_id);$card.find("div.me_too_outcome");needToLogin?(ANTAuth.killUser(function(){ANTAuth.quickFixAjaxLogout()}),$message=$("<div><em>Your login has expired.  Please Log in.</em></div>")):$message=deleteWasSuccessful?$('<div><em>This reaction was removed from <a href="/user/'+$.cookie("user_id")+'">your profile</a>.</em></div>'):$("<div><em>This reaction is already removed.</em></div>"),$.fancybox($message,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}},afterClose:function(){window.location.reload()}})}}})},add_to_board:function(interaction_id,board_id,board_title){var sendData={board_id:board_id,int_id:interaction_id};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/boardadd/",type:"get",data:{json:$.toJSON(sendData)},success:function(response){if("success"==response.status){var $message=($("#add_to_board_form"),$('<h2 style="margin-bottom:15px;border-bottom:1px solid #999;padding-bottom:7px;">Add to Board</h2><div><em>Success! You have added this to your board, <a href="/board/'+board_id+"/"+board_title+'">'+board_title+"</a>.</em></div>"));$.fancybox($message,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}}})}}})},remove_from_board:function(interaction_id,board_id,board_title){var sendData={board_id:board_id,int_id:interaction_id};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/boarddelete/",type:"get",data:{json:$.toJSON(sendData)},success:function(response){"success"==response.status&&$(".interaction_"+interaction_id).hide(333,function(){$(this).remove()})}})},add_new_reaction:function(parent_id,tag_body){var sendData={parent_id:parent_id,tag:{body:tag_body}};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/stream/response/",type:"post",data:{json:$.toJSON(sendData)},success:function(response){if("success"==response.status){var $message,$card=$(".interaction_"+parent_id),needToLogin=($("#add_new_reaction_form"),response.data.message&&"not_logged_in"==response.data.message);if(needToLogin)ANTAuth.killUser(function(){ANTAuth.quickFixAjaxLogout()}),$message=$("<div><em>Your login has expired.  Please Log in.</em></div>");else if(1==response.data.existing)var $message=$("<div><em>You have already added this to your profile.</em></div>");else var $message=$('<div><em>Success! You have added this to <a href="/user/'+$.cookie("user_id")+'">your profile</a>.</em></div>');var cardData=$card.data(),kind=cardData.kind,interaction_body=(cardData.interactionId,cardData.interactionBody),groupName=cardData.groupName,content="",$shareLinks=$('<div style="overflow:auto;"><strong style="display:block;float:left;margin:5px 5px 0 0;">Share It:</strong> <ul class="shareLinks"></ul>'),socialNetworks=["facebook","twitter","tumblr"],kind=cardData.kind,groupName=cardData.groupName,content="";"txt"==kind?content=$card.find(".contentBody").text():"img"==kind?content=$card.find("img.contentBody").attr("src"):"med"==kind&&(content=$card.find("img.contentBody").attr("src")),$.each(socialNetworks,function(idx,val){var $li=$('<li><a href="http://'+val+'.com" ><img class="no-ant" src="'+ANT_staticUrl+"widget/images/social-icons-loose/social-icon-"+val+'.png" /></a></li>');$li.find("a").click(function(e){return e.preventDefault(),ANTsite.shareWindow=window.open(ANT_staticUrl+"share.html","readr_share","menubar=1,resizable=1,width=626,height=436"),ANTsite.interactions.share(val,kind,parent_id,interaction_body,groupName,content),!1}),$shareLinks.find("ul").append($li)}),$message.append($shareLinks),$.fancybox($message,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}}})}}})},add_new_comment:function(parent_id,comment_body){var sendData={parent_id:parent_id,comment:comment_body};$.ajax({beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},url:"/api/stream/comment/",type:"post",data:{json:$.toJSON(sendData)},success:function(response){if("success"==response.status){$(".interaction_"+parent_id),$("#add_new_comment_form");if(1==response.data.existing)var $message=$("<div><em>You have already added this to your profile.</em></div>");else var $message=$('<div><em>Success! You have added this comment.<br/><br/>Reload the page or check it out on <a href="/user/'+$.cookie("user_id")+'">your profile</a>.</em></div>');$.fancybox($message,{wrapCSS:"fancybox-custom",helpers:{overlay:{css:{background:"rgba(100,100,100,0.8)"}}}})}}})},share:function(sns,kind,interaction_id,interaction_body,groupName,content){function _wrapTag(tag,doHTMLEscape,isActionNotContent){var connectorSign=isActionNotContent?doHTMLEscape?"&#124;":"|":doHTMLEscape?"&raquo;":"»";return doHTMLEscape?tag+"&nbsp;"+connectorSign:tag+" "+connectorSign}function _shortenContentIfNeeded(content,content_length,addQuotes){var ext="...",safeLength=content_length-ext.length,str=content.length<=content_length?content:content.substr(0,safeLength)+ext;return str=addQuotes?'"'+str+'"':str}var content=content,share_url="",contentStr="",content_length=300,short_url=ANT_baseUrl+"/interaction/"+interaction_id;switch(sns){case"facebook":var imageQueryP="",videoQueryP="",mainShareText="",footerShareText="Antenna Reaction on "+groupName;switch(kind){case"txt":case"text":content_length=300,contentStr=_shortenContentIfNeeded(content,content_length,!0),mainShareText=_wrapTag(interaction_body)+" "+contentStr;break;case"img":case"image":contentStr="[a picture on "+groupName+"] Check it out: ",ANT_offline&&(content=content.replace("local.antenna.is:8081","www.antenna.is"),content=content.replace("localhost:8081","www.antenna.is")),imageQueryP="&p[images][0]="+encodeURI(content),mainShareText=_wrapTag(interaction_body)+" "+contentStr;break;case"media":case"med":case"video":contentStr="[a video on "+groupName+"] Check it out: ",mainShareText=_wrapTag(interaction_body)+" "+contentStr}share_url="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURI(mainShareText)+"&p[url]="+short_url+"&p[summary]="+encodeURI(footerShareText)+imageQueryP+videoQueryP;break;case"twitter":var mainShareText="",footerShareText="Antenna Reaction on "+groupName;switch(kind){case"txt":case"text":content_length=110-interaction_body.length,contentStr=_shortenContentIfNeeded(content,content_length,!0),mainShareText=_wrapTag(interaction_body)+" "+contentStr;break;case"img":case"image":contentStr="[a picture on "+groupName+"] Check it out: ",mainShareText=_wrapTag(interaction_body)+" "+contentStr;break;case"media":case"med":case"video":contentStr="[a video on "+groupName+"] Check it out: ",mainShareText=_wrapTag(interaction_body)+" "+contentStr}share_url="http://twitter.com/intent/tweet?url="+short_url+"&text="+encodeURI(mainShareText);break;case"tumblr":var mainShareText="";switch(kind){case"txt":case"text":var footerShareText=_wrapTag(interaction_body,!0)+'&nbsp;[a <a href="'+short_url+'">quote</a> on '+groupName+" via Antenna]";content_length=300,contentStr=_shortenContentIfNeeded(content,content_length),share_url="http://www.tumblr.com/share/quote?quote="+encodeURIComponent(contentStr)+"&source="+encodeURIComponent(footerShareText);break;case"img":case"image":ANT_offline&&(content=content.replace("local.antenna.is:8081","www.antenna.is"),content=content.replace("localhost:8081","www.antenna.is")),mainShareText=_wrapTag(interaction_body,!0);var footerShareText='&nbsp;[a <a href="'+short_url+'">picture</a> on '+groupName+" via Antenna]";share_url="http://www.tumblr.com/share/photo?source="+encodeURIComponent(content)+"&caption="+encodeURIComponent(mainShareText+footerShareText)+"&click_thru="+encodeURIComponent(short_url);break;case"media":case"med":case"video":var iframeString='<iframe src=" '+interaction_body+' "></iframe>';mainShareText=_wrapTag(interaction_body,!0);var footerShareText='&nbsp;[a <a href="'+short_url+'">video</a> on '+groupName+" via Antenna]",readrLink=mainShareText+footerShareText;share_url="http://www.tumblr.com/share/video?&embed="+encodeURIComponent(iframeString)+"&caption="+encodeURIComponent(readrLink)}}""!==share_url&&ANTsite.shareWindow&&(ANTsite.shareWindow.location=share_url)}}},window.log=function(){if(log.history=log.history||[],log.history.push(arguments),this.console){arguments.callee=arguments.callee.caller;var newarr=[].slice.call(arguments);"object"==typeof console.log?log.apply.call(console.log,console,newarr):console.log.apply(console,newarr)}},function(b){function c(){}for(var a,d="assert,clear,count,debug,dir,dirxml,error,exception,firebug,group,groupCollapsed,groupEnd,info,log,memoryProfile,memoryProfileEnd,profile,profileEnd,table,time,timeEnd,timeStamp,trace,warn".split(",");a=d.pop();)b[a]=b[a]||c}(function(){try{return console.log(),window.console}catch(err){return window.console={}}}()),function($,sr){var debounce=function(func,threshold,execAsap){var timeout;return function(){function delayed(){execAsap||func.apply(obj,args),timeout=null}var obj=this,args=arguments;timeout?clearTimeout(timeout):execAsap&&func.apply(obj,args),timeout=setTimeout(delayed,threshold||100)}};jQuery.fn[sr]=function(fn){return fn?this.bind("resize",debounce(fn)):this.trigger(sr)}}(jQuery,"smartresize");var qs=(window.location.search+window.location.hash).substr(1).split("&"),qs_args=[];for(var i in qs){var this_arg=qs[i].split("=");qs_args[this_arg[0]]=this_arg[1]}"undefined"==typeof qs_args.group_id&&(qs_args.group_id="");var trackingUrl="local.antenna.is"!=document.domain?"http://events.antenna.is/insert":"http://localnode.com:3000/insert";window.ANTAuth={isOffline:"local.antenna.is"==document.domain,ant_user:{},popups:{},openGenericLoginWindow:function(options){var windowProps=getWindowProps(options);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/login/","ant_login",windowProps),ANTAuth.popups.loginWindow.focus(),!1},openFBLoginWindowFromPopup:function(options){return ANTAuth.closeWindowOnSuccess=!0,ANTAuth.doFBLogin(),!1},openAntLoginWindow:function(options){var windowProps=getWindowProps(options);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/ant_login/","ant_login",windowProps),ANTAuth.popups.loginWindow.focus(),!1},openAntCreateNewAccountWindow:function(options,replaceCurrentWindow){var windowProps=getWindowProps(options);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/user_create/","ant_create_user",windowProps),ANTAuth.popups.loginWindow.focus(),replaceCurrentWindow&&window.close(),!1},openAntForgotPasswordWindow:function(options){var windowProps=getWindowProps(options);return ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/request_password/","ant_forgot_pw",windowProps),ANTAuth.popups.loginWindow.focus(),!1},openAntAvatarUploadWindow:function(options){var windowProps=getWindowProps(options);return ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/user_modify/","ant_avatar_upload",windowProps),ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow.focus(),!1},openChangePasswordWindow:function(options){var windowProps=getWindowProps(options);return ANTAuth.popups.loginWindow=window.open(ANT_baseUrl+"/change_password/","ant_change_password",windowProps),ANTAuth.checkAntLoginWindow(),ANTAuth.popups.loginWindow.focus(),!1},events:{track:function(data){var standardData="";ANTAuth.ant_user&&ANTAuth.ant_user.user_id&&(standardData+="||uid::"+ANTAuth.ant_user.user_id),qs_args&&qs_args.group_id&&(standardData+="||gid::"+qs_args.group_id);var eventSrc=data+standardData,$event=$('<img src="'+ANT_baseUrl+"/static/widget/images/event.png?"+eventSrc+'" />');$("#ant_event_pixels").append($event),ANTAuth.isOffline},trackEventToCloud:function(params){$.ajax({url:trackingUrl,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(params)},success:function(response){}})},helpers:{trackFBLoginAttempt:function(){var eventStr="FBLogin attempted";ANTAuth.events.track(eventStr),ANTAuth.events.trackEventToCloud({event_type:"login attempt facebook",event_value:"start"})},trackFBLoginFail:function(){var eventStr="FBLogin failed or was canceled";ANTAuth.events.track(eventStr),ANTAuth.events.trackEventToCloud({event_type:"login attempt facebook",event_value:"fail"})},trackAntLoginAttempt:function(){var eventStr="AntLogin attempted";ANTAuth.events.track(eventStr),ANTAuth.events.trackEventToCloud({event_type:"login attempt antenna",event_value:"start"})},trackAntLoginFail:function(){return}}},postMessage:function(params){"function"==typeof $.postMessage&&$.postMessage(params.message,qs_args.parentUrl,parent)},notifyParent:function(response,status){response.status=status,ANTAuth.postMessage({message:JSON.stringify(response)})},getUser:function(){if(ANTAuth.readUserCookie(),ANTAuth.ant_user.ant_token){if(ANTAuth.ant_user.ant_token){var sendData={data:{first_name:ANTAuth.ant_user.first_name,full_name:ANTAuth.ant_user.full_name,img_url:ANTAuth.ant_user.img_url,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token,user_boards:ANTAuth.ant_user.user_boards}};ANTAuth.notifyParent(sendData,"returning_user")}}else ANTAuth.createTempUser()},getAntToken:function(fb_response,callback){if(fb_response){var fb_session=fb_response.authResponse?fb_response.authResponse:fb_response,sendData={fb:fb_session,group_id:qs_args.group_id?qs_args.group_id:1,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token};$.ajax({url:"/api/fb/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:JSON.stringify(sendData)},success:function(response){"fail"==response.status?ANTAuth.createTempUser():(ANTAuth.setUser(response),ANTAuth.returnUser(),ANTAuth.notifyParent({},"close login panel"),callback&&callback())},error:function(response){ANTAuth.createTempUser()}})}else ANTAuth.doFBLogin()},createTempUser:function(){if(parent.location!=window.location)if(!ANTAuth.ant_user.user_id&&!ANTAuth.ant_user.ant_token||ANTAuth.ant_user.user_id&&ANTAuth.ant_user.ant_token&&!ANTAuth.ant_user.temp_user){var sendData={group_id:qs_args.group_id};$.ajax({url:"/api/tempuser/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:JSON.stringify(sendData)},success:function(response){ANTAuth.setUser(response);var sendData={data:{first_name:ANTAuth.ant_user.first_name,full_name:ANTAuth.ant_user.full_name,img_url:ANTAuth.ant_user.img_url,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token,user_boards:ANTAuth.ant_user.user_boards}};ANTAuth.notifyParent(sendData,"got_temp_user")}})}else{var sendData={data:{first_name:ANTAuth.ant_user.first_name,full_name:ANTAuth.ant_user.full_name,img_url:ANTAuth.ant_user.img_url,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token,user_boards:ANTAuth.ant_user.user_boards}};ANTAuth.notifyParent(sendData,"got_temp_user")}},reauthUser:function(args){($.cookie("user_type")&&"facebook"==$.cookie("user_type")||!$.cookie("user_type"))&&(ANTAuth.readUserCookie(),FB.getAuthResponse()?ANTAuth.killUser(function(response){ANTAuth.getAntToken(response)}):FB.getLoginStatus(function(response){response&&"connected"==response.status?ANTAuth.killUser(function(response){ANTAuth.getAntToken(response)},response):ANTAuth.notifyParent({},"fb_user_needs_to_login")}))},quickFixAjaxLogout:function(){$("#group_settings_menu").hide(),$("#logged-in").hide(),$("#logged-out").css({display:"block",visibility:"visible"})},checkFBStatus:function(args){FB.getLoginStatus(function(response){if(response.status&&"connected"==response.status){if(ANTAuth.checkIfWordpressRefresh())return;if(ANTAuth.closeWindowOnSuccess&&window.close(),top==self)if($.cookie("user_id")||ANTAuth.ant_user&&ANTAuth.ant_user.user_id){var img_url=($.cookie("user_id")?$.cookie("user_id"):ANTAuth.ant_user.user_id,ANTAuth.ant_user.img_url);$("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden"),FB.api("/me",function(response){if($("#fb-login-button a").hasClass("logging-in"))return void window.location.reload();if(!$(".userSettingsMenu").length){var $user=$("<a/>"),$avatar=$("<img/>");$("<strong/>");$user.attr("href","/user/"+user_id),$avatar.attr("src",img_url+"?type=square"),$user.append($avatar);var user_id=$.cookie("user_id"),$user_menu=$('<div id="log-out-link" />');$user_menu.append('<a href="/user/'+user_id+'">My Activity</a><a href="/follows/'+user_id+'">Activity I Follow</a><a href="javascript:void(0);" onclick="ANTAuth.logout();">Log Out</a><h5>Settings</h5><label for="private_profile">(Reload the page to edit your setttings.)</label>'),$("#logged-in").html($user).append($user_menu)}})}else ANTAuth.getAntToken(response.authResponse,function(){});else $("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden"),ANTAuth.returnUser()}else top==self&&($("#logged-in").hide().css("visibility","hidden"),$("#logged-out").show().css("visibility","visible"))})},FBLoginCallback:function(response){response.authResponse?ANTAuth.getAntToken(FB.getAuthResponse(),function(){ANTAuth.checkFBStatus()}):ANTAuth.events.helpers.trackFBLoginFail()},checkIfWordpressRefresh:function(){var isWordpress=function(){var searchStr=window.location.search;return searchStr.search(/hostplatform=wordpress/i)>0}();if(isWordpress){var wordpressEditUrl="/wordpress_edit/",query=window.location.search||"?";query+="&refresh=true";var wordpressRefreshUrl=wordpressEditUrl+query;return window.location=wordpressRefreshUrl,!0}return!1},checkAntLoginWindow:function(){ANTAuth.checkingAntLoginWindow||(ANTAuth.checkingAntLoginWindow=setInterval(function(popup){if(ANTAuth.popups.loginWindow&&ANTAuth.popups.loginWindow.closed){if(ANTAuth.readUserCookie(),ANTAuth.returnUser(),ANTAuth.notifyParent({},"close login panel"),ANTAuth.popups.loginWindow.close(),clearInterval(ANTAuth.checkingAntLoginWindow),ANTAuth.checkIfWordpressRefresh())return;top==self&&window.location.reload()}},250))},setUser:function(response){ANTAuth.ant_user={},response.data=response.data||{},response.data.first_name||response.data.full_name?ANTAuth.ant_user.temp_user=!1:ANTAuth.ant_user.temp_user=!0,ANTAuth.ant_user.ant_token=response.data.ant_token,ANTAuth.ant_user.user_id=response.data.user_id,ANTAuth.ant_user.full_name=response.data.full_name,ANTAuth.ant_user.first_name=response.data.full_name,ANTAuth.ant_user.img_url=response.data.img_url,ANTAuth.ant_user.user_type=response.data.user_type,ANTAuth.ant_user.user_boards=JSON.stringify(response.data.user_boards);var session_expiry=new Date;session_expiry.setMinutes(session_expiry.getMinutes()+60);var expTime=90;$.cookie("temp_user",ANTAuth.ant_user.temp_user,{expires:expTime,path:"/"}),$.cookie("ant_token",ANTAuth.ant_user.ant_token,{expires:expTime,path:"/"}),$.cookie("user_id",ANTAuth.ant_user.user_id,{expires:expTime,path:"/"}),$.cookie("user_type",ANTAuth.ant_user.user_type,{expires:expTime,path:"/"})},readUserCookie:function(){ANTAuth.ant_user.temp_user=$.cookie("temp_user"),ANTAuth.ant_user.ant_token=$.cookie("ant_token"),$.cookie("ant_token")||(ANTAuth.ant_user.ant_token=$.cookie("readr_token")),ANTAuth.ant_user.user_id=$.cookie("user_id"),ANTAuth.ant_user.user_type=$.cookie("user_type")},returnUser:function(){if(ANTAuth.readUserCookie(),top==self){if($.cookie("user_type")&&"facebook"==$.cookie("user_type"))ANTAuth.checkFBStatus();else if($.cookie("user_id")){$("#logged-in").show().css("visibility","visible"),$("#logged-out").hide().css("visibility","hidden");var $user=$("<a/>"),$name=$("<strong/>");$user.attr("href","/user/"+$.cookie("user_id"));var username="friend";$name.text(username),$user.append($name)}}else{var sendData={data:{first_name:ANTAuth.ant_user.first_name,full_name:ANTAuth.ant_user.full_name,img_url:ANTAuth.ant_user.img_url,user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token,user_type:ANTAuth.ant_user.user_type}};ANTAuth.notifyParent(sendData,"returning_user")}},killUser:function(callback,callback_args){
if(ANTAuth.ant_user&&"false"==ANTAuth.ant_user.temp_user){var sendData={user_id:ANTAuth.ant_user.user_id,ant_token:ANTAuth.ant_user.ant_token};$.ajax({url:"/api/deauthorize/",type:"get",contentType:"application/json",context:{callback_args:callback_args},dataType:"jsonp",data:{json:JSON.stringify(sendData)},success:function(response){ANTAuth.clearSessionCookies(),ANTAuth.ant_user={},callback&&this.callback_args?callback(this.callback_args):callback&&callback()}})}else ANTAuth.clearSessionCookies(),callback&&callback_args?callback(callback_args):callback&&callback()},clearSessionCookies:function(){$.cookie("temp_user",null,{path:"/"}),$.cookie("ant_token",null,{path:"/"}),$.cookie("user_id",null,{path:"/"}),$.cookie("user_type",null,{path:"/"}),$.cookie("ant_session",null,{path:"/"}),$.cookie("ant_user",null,{path:"/"})},doFBLogin:function(requesting_action){ANTAuth.events.helpers.trackFBLoginAttempt(),FB.login(function(response){ANTAuth.FBLoginCallback(response)},{scope:"email"})},doAntLogin:function(requesting_action){ANTAuth.events.helpers.trackAntLoginAttempt(),ANTAuth.openAntLoginWindow()},doAntlogout:function(){ANTAuth.killUser(function(){window.location.reload()})},logout:function(){$.cookie("user_type")&&"facebook"==$.cookie("user_type")?FB.getLoginStatus(function(response){response?FB.logout(function(response){ANTAuth.killUser(function(){window.location.reload()})}):ANTAuth.killUser(function(){window.location.reload()})}):ANTAuth.killUser(function(){window.location.reload()})},init:function(){ANTAuth.notifyParent({},"xdm loaded"),$.cookie("user_type")&&"facebook"==$.cookie("user_type")?FB.getLoginStatus(function(response){response.status&&"connected"==response.status?ANTAuth.getAntToken(response.authResponse,function(){}):ANTAuth.killUser(function(){})}):ANTAuth.returnUser()},decodeDjangoCookie:function(value){return value?value.replace(/"/g,"").replace(/\\054/g,",").replace(/\\073/g,";"):void 0}},$(document).ready(function(){window.fb_loader.done(function(){ANTAuth.init()}),window.fb_loader.done(function(){"function"==typeof $.receiveMessage&&$.receiveMessage(function(e){var jsonData,data,keys={registerEvent:"register-event::"};"getUser"==e.data?ANTAuth.getUser():"reloadXDMframe"==e.data?window.location.reload():"reauthUser"==e.data?ANTAuth.reauthUser():"returnUser"==e.data?ANTAuth.returnUser():"killUser"==e.data?ANTAuth.killUser():"TESTIT"==e.data?ANTAuth.testMessage():-1!=e.data.indexOf("page_hash")?$.cookie("page_hash",e.data.split("|")[1],{expires:365,path:"/"}):-1!=e.data.indexOf(keys.registerEvent)&&(jsonData=e.data.split(keys.registerEvent)[1],data=$.parseJSON(jsonData),ANTAuth.events.trackEventToCloud(data))},qs_args.parentHost)})});