/*!
 * jQuery postMessage - v0.5 - 9/11/2009
 * http://benalman.com/projects/jquery-postmessage-plugin/
 * 
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
// NOTE: there is a slight Urtak alteration to the location hash-based string
// and Urtak's version of jQuery on the page.
// Script: jQuery postMessage: Cross-domain scripting goodness
//
// *Version: 0.5, Last updated: 9/11/2009*
// 
// Project Home - http://benalman.com/projects/jquery-postmessage-plugin/
// GitHub       - http://github.com/cowboy/jquery-postmessage/
// Source       - http://github.com/cowboy/jquery-postmessage/raw/master/jquery.ba-postmessage.js
// (Minified)   - http://github.com/cowboy/jquery-postmessage/raw/master/jquery.ba-postmessage.min.js (0.9kb)
// 
// About: License
// 
// Copyright (c) 2009 "Cowboy" Ben Alman,
// Dual licensed under the MIT and GPL licenses.
// http://benalman.com/about/license/
// 
// About: Examples
// 
// This working example, complete with fully commented code, illustrates one
// way in which this plugin can be used.
// 
// Iframe resizing - http://benalman.com/code/projects/jquery-postmessage/examples/iframe/
// 
// About: Support and Testing
// 
// Information about what version or versions of jQuery this plugin has been
// tested with and what browsers it has been tested in.
// 
// jQuery Versions - 1.3.2
// Browsers Tested - Internet Explorer 6-8, Firefox 3, Safari 3-4, Chrome, Opera 9.
// 
// About: Release History
// 
// 0.5 - (9/11/2009) Improved cache-busting
// 0.4 - (8/25/2009) Initial release
window.urtakSetupPostMessage=function(e){var t,n,r=1,i,s=this,o=!1,u="postMessage",a="addEventListener",f,l=s[u];e[u]=function(t,n,i){var s;if(!n)return;t=typeof t=="string"?t:e.param(t),i=i||parent,l?i[u](t,n.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):n&&(s=(new Date).getTime(),r+=1,i.location=n.replace(/#.*$/,"")+"#urtakpm-"+s+r+"&"+t)},e.receiveMessage=f=function(r,u,c){l?(r&&(i&&f(),i=function(t){if(typeof u=="string"&&t.origin!==u||e.isFunction(u)&&u(t.origin)===o)return o;r(t)}),s[a]?s[r?a:"removeEventListener"]("message",i,o):s[r?"attachEvent":"detachEvent"]("onmessage",i)):(t&&clearInterval(t),t=null,r&&(c=typeof u=="number"?u:typeof c=="number"?c:100,t=setInterval(function(){var e=document.location.hash,t=/^#?urtakpm-\d+&/;e!==n&&t.test(e)&&(n=e,document.location.hash="",r({data:e.replace(t,"")}))},c)))}},function(){Urtak2.louverture=function(e,t,n){function v(e){return p&&p.Widget&&p.Widget.widgets&&p.Widget.widgets[e]?!0:!1}function m(i){function j(){var e,t,n;e=w.parent(),t=parseFloat(i.data("urtak-height"))||r.height,n=parseFloat(i.data("urtak-width"))||e.width(),t>r.max_height?t=r.max_height:t<r.min_height&&(t=r.min_height),n>r.max_width?n=r.max_width:n<r.min_width&&(n=r.min_width),w.height(t).width(n),E.height(t).width(n)}function F(){w.isInView()&&(clearInterval(L),j(),E.addClass("urtak-load-started"),E.bind("load",function(){E.css({top:0,left:0}).addClass("urtak-load-complete"),S.remove(),p.afterLoad&&p.afterLoad(e,u,E)}),S.submit())}var s,u,f,l,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;l=i.data("publication-key")||i.data("auto-urtak-key"),m=i.data("post-title")||e("title").text(),g=i.data("post-permalink"),y=i.data("post-created"),b=i.data("post-id"),B=i.data("url"),/^https?:\/\//.test(B)||(B=null),P=i.data("pixel-load"),H=i.data("pixel-first-response"),D=i.data("urtak-widget-key"),l&&m&&g?(u=l+"-"+Urtak2.Crypto.SHA1(g),f=t.protocol+"://"+t.host,f+="/embed/"+l):D?(u=D,f=t.protocol+"://"+t.host,f+="/clr/"+u):(s=o.exec(i.attr("href")),u=s&&s.length>1&&s[1],f=i.attr("href")),u&&!d[u]&&!v(u)&&(d[u]=i,w=e("<div>",{id:"urtak-container-"+u,"class":"urtak-container",css:e.extend({overflow:"hidden"},r.css_reset)}),O="urtak-iframe-"+u,M=e.map({name:O,src:c===7?"javascript:''":null,allowTransparency:"true"},function(e,t){return e?t+'="'+e+'"':""}).join(" "),_="<iframe "+M+">",E=e(_).attr({id:O,frameborder:0,marginheight:0,marginwidth:0,tabindex:0,scrolling:"no",allowTransparency:"true"}).css(r.css_reset).css({position:"absolute",left:-1e4,top:-1e4}),x='id="urtak-form-'+u+'"',T='target="'+E.attr("name")+'"',N='action="'+f+'"',C='method="POST"',k="<"+["form",x,T,N,C].join(" ")+"></form>",S=e(k).append(e('<input type="submit" name="amifullydressed" value="yes">').hide()),e.each({url:B||a,page_widget_key:u,post_title:m,post_id:b,post_permalink:g,post_created_at:y,urtak_rhash:h.urtak_rhash,pixel_load:P,pixel_first_response:H},function(t,n){var r;n&&(n=String(n),n=n.replace(/"/g,""),r='name="'+t+'" value="'+n+'"',S.append(e('<input type="hidden" '+r+">")))}),i.fadeOut(50,function(){var t;i.wrap(w),w=i.parent(),i.after(E).after(S),L=setInterval(F,500),F(),h.urtak===u&&!n&&(t=w.offset().top-50,t>0&&e("html, body").animate({scrollTop:t},500))}))}window.urtakSetupPostMessage(e),window.Urtak||(window.Urtak={});var r,i,s,o,u,a,f,l,c,h={},p=window.Urtak,d={};c=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");for(;;){t+=1,n.innerHTML="<!--[if gt IE "+t+"]><i></i><![endif]-->";if(!r[0])break}return t>4?t:e}(),window.embedly?a=window.embedly.location.href:window.urtak_iframe_back_url?a=window.urtak_iframe_back_url:a=window.location.href||String(window.location),/^https?:\/\/wpcomwidgets.com\//.test(a)&&(a=document.referrer);if(!a)return;o=new RegExp("^(?:https?://"+t.host+")?/clr/(\\w+)$","i"),r={max_height:2e3,max_width:2e3,min_height:230,min_width:280,height:250,css_reset:{margin:0,padding:0,border:0,position:"relative","float":"none",display:"block"}},this.location_hash&&this.location_hash.indexOf("#")===0&&/urtak/.test(this.location_hash)&&e.each(this.location_hash.substring(1).split("&"),function(e,t){var n,r,i;n=t.split("="),n.length===2&&(r=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]),h[r]=i)}),e.fn.extend({isInView:function(){var t,n,r,i,s,o,u,a,f,l,c;return t=e(this),t.parent().is(":hidden")?!1:(s=e(window),o={tl:{top:s.scrollTop(),left:s.scrollLeft()},br:{top:s.scrollTop()+s.height(),left:s.scrollLeft()+s.width()}},n=t.offset(),r=t.outerHeight(),i=t.outerWidth(),u={tl:{top:n.top,left:n.left},tr:{top:n.top,left:n.left+i},bl:{top:n.top+r,left:n.left},br:{top:n.top+r,left:n.left+i}},a=u.tl.top>=o.tl.top&&u.tl.left>=o.tl.left&&u.tl.top<=o.br.top&&u.tl.left<=o.br.left,f=u.tr.top>=o.tl.top&&u.tr.left>=o.tl.left&&u.tr.top<=o.br.top&&u.tr.left<=o.br.left,l=u.bl.top>=o.tl.top&&u.bl.left>=o.tl.left&&u.bl.top<=o.br.top&&u.bl.left<=o.br.left,c=u.br.top>=o.tl.top&&u.br.left>=o.tl.left&&u.br.top<=o.br.top&&u.br.left<=o.br.left,a||f||l||c)}}),e.extend(p,{launchAll:function(){if(Urtak2.pong){clearInterval(f),f=null;var n=["a[href^='http://"+t.host+"/clr/']","a[href^='https://"+t.host+"/clr/']","a[href^='/clr/']","a[data-urtak-widget-key]","*[data-auto-urtak-key]","*[data-publication-key]"].join(", ");e(n).each(function(){m(e(this))})}}}),t.ping?e.getScript(t.ping,p.launchAll):Urtak2.pong=!0,f=setInterval(function(){p.launchAll()},50),setTimeout(function(){!p.pong&&f&&clearInterval(f)},1e4),e(function(){p.launchAll()}),t.host&&(l=t.protocol+"://"+t.host),e.receiveMessage(function(t){var n=Urtak2.JSON.parse(decodeURIComponent(t.data));e.isArray(window.__urtak_hooks__)&&e.each(window.__urtak_hooks__,function(t,r){e.isFunction(r)&&r(n)})},l)}}(),Urtak2.previous_Crypto=window.Crypto,window.Crypto={},(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=window.Crypto={},n=t.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return n.rotl(e,8)&16711935|n.rotl(e,24)&4278255360;for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(t){if(typeof btoa=="function")return btoa(s.bytesToString(t));for(var n=[],r=0;r<t.length;r+=3){var i=t[r]<<16|t[r+1]<<8|t[r+2];for(var o=0;o<4;o++)r*8+o*6<=t.length*8?n.push(e.charAt(i>>>6*(3-o)&63)):n.push("=")}return n.join("")},base64ToBytes:function(t){if(typeof atob=="function")return s.stringToBytes(atob(t));t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4){if(i==0)continue;n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|e.indexOf(t.charAt(r))>>>6-i*2)}return n}},r=t.charenc={},i=r.UTF8={stringToBytes:function(e){return s.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(s.bytesToString(e)))}},s=r.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}(),function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,s=[],o=1732584193,u=-271733879,a=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+15]=i;for(var c=0;c<n.length;c+=16){var h=o,p=u,d=a,v=f,m=l;for(var g=0;g<80;g++){if(g<16)s[g]=n[c+g];else{var y=s[g-3]^s[g-8]^s[g-14]^s[g-16];s[g]=y<<1|y>>>31}var b=(o<<5|o>>>27)+l+(s[g]>>>0)+(g<20?(u&a|~u&f)+1518500249:g<40?(u^a^f)+1859775393:g<60?(u&a|u&f|a&f)-1894007588:(u^a^f)-899497514);l=f,f=a,a=u<<30|u>>>2,u=o,o=b}o+=h,u+=p,a+=d,f+=v,l+=m}return[o,u,a,f,l]},s._blocksize=16,s._digestsize=20}(),Urtak2.Crypto=window.Crypto,window.Crypto=Urtak2.previous_Crypto,window.JSON&&(Urtak2.previous_JSON=window.JSON);var JSON;JSON||(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Urtak2.JSON=window.JSON,Urtak2.previous_JSON&&(window.JSON=Urtak2.previous_JSON);