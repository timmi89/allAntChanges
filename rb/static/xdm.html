<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xmlns:x2="http://www.w3.org/2002/06/xhtml2" xmlns:fb="http://www.facebook.com/2008/fbml">
   <head>
   	<script type="text/javascript">
   	// querystring stuff
	// used to create an array called qs_args which holds key/value paris from the querystring of the iframe
	var qs = ( window.location.search + window.location.hash ).substr(1).split('&');
	var qs_args = [];
	for ( var i in qs ) {
		var this_arg = qs[i].split('=');
		qs_args[this_arg[0]] = this_arg[1];
	}
   	var RDR_offline = ( window.location.href.indexOf('local.readrboard.com') != -1 ) ? true:false,
		RDR_baseUrl = ( RDR_offline ) ? "http://local.readrboard.com:8080":"http://www.readrboard.com";
		RDR_staticUrl = ( RDR_offline ) ? "http://local.readrboard.com:8080/static/":"http://s3.amazonaws.com/readrboard/";
    
    document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'global/js/jquery-1.7.1.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.ba-postmessage.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.json-2.2.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.cookie.js" type="text/javascript"%3E%3C/script%3E' ) );
    document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/readr_user.js" type="text/javascript"%3E%3C/script%3E' ) );

   	</script>
    <script type="text/javascript">
    if(!RDR_offline){
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24372992-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    }else{
        //just a dummy array for testing
        window._gaq = _gaq || [];
    }
    </script>
    <script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>

   </head>
   <body style="padding:0;margin:0;color:#fff;background:transparent;">
	   <div id="fb-root"></div>
     <script src="http://connect.facebook.net/en_US/all.js" type="text/javascript"></script>
     <script type="text/javascript">
        //don't depend on Facebook
        (function(FB){
            if(typeof FB === "undefined") return;
            FB.init({ 
                appId:'163759626987948', cookie:true, status:true, xfbml:true, oauth:true
            });
        })(FB);
	</script>
    <script type="text/javascript">
        //don't depend on Firebase
        (function(Firebase){
            if(typeof Firebase === "undefined") return;
            window._firebaseDB = new Firebase(
                'https://readrboard.firebaseio.com/'
            );
        })(Firebase);
    </script>
    
	 <script type="text/javascript">
        
		$(document).ready( function() {			
			
			if ( $.cookie('location') && $.cookie('container_hash') ) {
				RDRAuth.notifyParent({message:false}, "sharedLink|" + $.cookie('container_hash') + "|" + RDRAuth.decodeDjangoCookie( $.cookie('location') ) + "|" + RDRAuth.decodeDjangoCookie( $.cookie('reaction') ) + "|" + RDRAuth.decodeDjangoCookie( $.cookie('content') ) + "|" + $.cookie('referring_int_id') + "|" + RDRAuth.decodeDjangoCookie( $.cookie('page_hash') ) );
				$.cookie('container_hash', null, { path: '/' });
				$.cookie('location', null, { path: '/' });
				$.cookie('content', null, { path: '/' });
				$.cookie('reaction', null, { path: '/' });
				$.cookie('referring_int_id', null, { path: '/' });
				$.cookie('page_hash', null, { path: '/' });
			} else if ( !$.cookie('educatedUser') ) {
				RDRAuth.notifyParent({message:false}, "educate user");
			}

		});

        //from http://www.aaronpeters.nl/blog/prevent-double-callback-execution-in-IE9#comment-175618750
        function rdr_loadScript(attributes, callbackfunction) {
            var oHead = document.getElementsByTagName('head')[0];
            if(oHead) {
                var oScript = document.createElement('script');

                oScript.setAttribute('src', attributes.src);
                oScript.setAttribute('type','text/javascript');



                if (oScript.readyState) { // IE, incl. IE9
                    oScript.onreadystatechange = function() {
                        if (oScript.readyState == "loaded" || oScript.readyState == "complete") {
                            oScript.onreadystatechange = null;
                            callbackfunction();
                        }
                    };
                } else {
                    oScript.onload = function() { // Other browsers
                        callbackfunction();
                    };
                }

                oHead.appendChild(oScript);
            }
        }


		var _sf_async_config={uid:26845,domain:"readrboard.com"};
		var chartbeat_script = (("https:" == document.location.protocol) ? "https://a248.e.akamai.net/chartbeat.download.akamai.com/102508/" : "http://static.chartbeat.com/") + "js/chartbeat.js";

        if(!RDR_offline){
            rdr_loadScript( {src:chartbeat_script}, function() {
                pSUPERFLY.virtualPage(qs_args.parentUrl, decodeURIComponent(qs_args.group_name) );
            });
        }		
	</script>
   </body>
</html>