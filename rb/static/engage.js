!function(){function test_readrboard_extend(){RDR_offline&&(window.readrboard_extend={blessed_tags:["Love It","Hate It","Heeeeeey"]},window.readrboard_extend_per_container={question1:{blessed_tags:["tag1","tag2","tag3"]},question2:{blessed_tags:["tag3","tag4","tag5","tag6"]}})}function findEngageScript(){for(var a=document.getElementsByTagName("script"),b=0;b<a.length;b++){var c=a[b],d=c.src,e=-1!=d.indexOf("readrboard")&&-1!=d.indexOf("engage");if(e)return c}}function readrBoard(a){var b=a;b.extend(RDR,{summaries:{},current:{},assetLoaders:{content_nodes:{}},content_nodes:{},containers:{},pages:{},group:{defaults:{img_selector:"img",img_container_selectors:"#primary-photo",active_sections:"body",anno_whitelist:"body p",active_sections_with_anno_whitelist:"",media_selector:"embed, video, object, iframe",comment_length:300,initial_pin_limit:300,no_readr:"",img_blacklist:"",custom_css:"",call_to_action:"What do you think?",inline_selector:"img, embed, video, object, iframe",paragraph_helper:!0,media_url_ignore_query:!0,summary_widget_method:"after",br_replace_scope_selector:null}},user:{img_url:"",readr_token:"",user_id:""},known_users:{},errors:{actionbar:{rating:"",commenting:""}},styles:{},events:{track:function(a,c){var d="",e=(new Date).getTime();RDR.user=RDR.user||{},RDR.user&&RDR.user.user_id&&(d+="||uid::"+RDR.user.user_id),c&&RDR.util.getPageProperty("id",c)&&(d+="||pid::"+RDR.util.getPageProperty("id",c)),RDR.group&&RDR.group.id&&(d+="||gid::"+RDR.group.id),RDR.engageScriptParams.bookmarklet&&(d+="||bookmarklet");var f=a+d,g=b('<img src="'+RDR_baseUrl+"/static/widget/images/event.png?"+e+"&"+f+'" />');b("#rdr_event_pixels").append(g)},trackEventToCloud:function(a){RDR.user=RDR.user||{};var c=b.toJSON({category:a.category,action:a.action,opt_label:a.opt_label||null,opt_value:a.opt_value||null,opt_noninteraction:a.opt_noninteraction||null,shareNetwork:a.shareNetwork||null,container_hash:a.container_hash||null,container_kind:a.container_kind||null,page_id:a.page_id||null,tag_body:a.tag_body||null,user_id:RDR.user.user_id||null,group_id:RDR.group.id||null});b.postMessage("register-event::"+c,RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"])}},groupSettings:{getCustomSettings:function(){var a=window.readrboard_extend||{},c=RDR.util.getQueryParams(),d={};return b.each(c,function(a,b){0===a.indexOf("rdr_")&&(a=a.substr(4),d[a]=b)}),a=b.extend({},a,d),RDR.groupSettings._translate(a)},translators:{blessed_tags:function(a){return b.map(a,function(a){return{body:a}})}},_translate:function(a){var c={},d=RDR.groupSettings.translators;return b.each(a,function(a,b){c[a]=d[a]?d[a](b):b}),c},getBlessedTags:function(a){function g(a){var c=b('[rdr-hash="'+a+'"]'),d=c.attr("rdr-custom-display");return d}var c=window.readrboard_extend_per_container;if(a&&c){var d=g(a),e=c[d];if(e&&e.blessed_tags){var f=RDR.groupSettings._translate(e);return f.blessed_tags}}return RDR.group.blessed_tags}},rindow:{defaults:{coords:{left:100,top:100},animTime:100,defaultHeight:260,minHeight:10,maxHeight:300,minWidth:100,maxWidth:600,forceHeight:!1,rewritable:!0},makeHeader:function(a,c){function j(){var a=b('<div class="rdr_linkWrap"><ul><li class="rdr_link"><a href="javascript:void(0);" class="rdr_undo_link">Remove reaction</a></li><li class="rdr_link"><a target="_blank" href="'+RDR_baseUrl+"/interaction/"+c+'" class="rdr_seeit_link">View at ReadrBoard</a>'+"</li>"+"</ul>"+"</div>");return a}var d=a||"",e=b.mustache('<div class="rdr rdr_header"><div class="rdr_header_arrow"><img src="{{RDR_staticUrl}}widget/images/header_up_arrow.png" /></div><div class="rdr_loader"></div><div class="rdr_about"><a href="http://www.readrboard.com/" target="_blank">&nbsp;</a></div><div class="rdr_indicator_stats"><img class="no-rdr rdr_pin" src="{{RDR_staticUrl}}widget/images/blank.png"><span class="rdr_count"></span></div><h1>{{headerText}}</h1></div>',{RDR_staticUrl:RDR_staticUrl,headerText:d}),f=b(e);if(!c)return f;var g=b('<div class="rdr_menuDropDown rdr_menu_actions"><span class="rdr_icon-chevron-down rdr_menuTrigger"></span></div>'),h=j();g.append(h);var i=b('<div class="rdr_rindowMenu"></div>').append(g);return isTouchBrowser&&i.on("tap",".rdr_menuDropDown",function(){b(this).toggleClass("rdr_hover")}),f.append(i),f},makeDefaultPanelMessage:function(a,c){var g,d=a.data("hash"),e=RDR.summaries[d],f=c||(a.hasClass("rdr_indicator_details")?"media":"text");if("text"==f)g="writeMode"==a.data("mode")?"What do you think?":"text"==f?"Reactions":e.counts.tags>0?e.counts.tags+" Reactions":"Reactions";else{var h=b.browser.msie&&parseInt(b.browser.version,10)<9?20:0;g=e.counts.tags>0?e.counts.tags+" Reactions":a.width()>=175+h?"What do you think?":"React:"}return g},updateFooter:function(a,b){var c=a.find("div.rdr_footer");c.show(0),"undefined"!=typeof b&&c.html(b)},hideFooter:function(a){a.find("div.rdr_footer").hide(0)},panelCreate:function(a,c){if(a){var d=a.find("div.rdr_body_wrap");d.find("div.rdr_body").eq(0);var f=d.find("div."+c);f.remove();var g=b('<div class="rdr_body '+c+'"/>');return d.find("div.rdr_body").length+1,g}},panelUpdate:function(a,b,c,d){if(a){var e=a.find("div.rdr_body_wrap"),f=e.find("div."+b);return d?f.append(c):f.replaceWith(c),c}},panelShow:function(a,b,c){var d=a.find(".rdr_body_wrap"),e=a.find(".rdr_visiblePanel");e.length||(e=a.find(".rdr_body").eq(0));var f=e.width();b.show().addClass("rdr-visible").css({position:"relative",top:0,left:f}),a.data("panelState",2),b.addClass("rdr_visiblePanel").removeClass("rdr_hiddenPanel"),e.addClass("rdr_hiddenPanel").removeClass("rdr_visiblePanel"),RDR.rindow.updateSizes(a),d.animate({left:-f},RDR.C.rindowAnimationSpeed,function(){if(c&&c(),a.data("jsp")){var b=a.data("jsp");b.reinitialise()}else a.jScrollPane({showArrows:!0})})},panelHide:function(a,b){var c=a.find(".rdr_body_wrap"),d=a.hasClass("rdr_writemode"),e=RDR.actions.indicators.utils.makeTagsListForInline(a,d),g=a.find(".rdr_visiblePanel");g.removeClass("rdr_visiblePanel").addClass("rdr_hiddenPanel"),e.addClass("rdr_visiblePanel").removeClass("rdr_hiddenPanel");var h=e.width();g.css("left",h),c.css("left",-h),RDR.rindow.updateSizes(a),c.animate({left:0},RDR.C.rindowAnimationSpeed,function(){if(b&&b(),a.data("panelState",1),a.data("jsp")){var c=a.data("jsp");c.reinitialise()}else a.jScrollPane({showArrows:!0})})},panelEnsureFloatWidths:function(a){return},updateTagPanel:function(a){a.data("hash"),RDR.rindow.panelHide(a),RDR.rindow.tagBox.setWidth(a,a.data("initialWidth")),RDR.rindow.tagBox.setHeight(a,a.data("initialHeight"))},mediaRindowShow:function(a){var c=a.data("hash"),d=b("#rdr_indicator_details_"+c);RDR.util.cssSuperImportant(d,{display:"block"}),!a.data("hover")||d.data("hover")||d.is(":animated")||d.closest("div.rdr_media_details").length||(d.data("hover",!0),RDR.rindow.updateSizes(d)),d.addClass("rdr_engaged")},mediaRindowHide:function(a){var c=a.data("hash"),d=b("#rdr_indicator_details_"+c);a.data("hover")||d.is(":animated")||d.closest("div.rdr_media_details").length||d.data("hover",!1).animate({height:"0px"},RDR.C.rindowAnimationSpeed,function(){RDR.util.cssSuperImportant(d,{display:"none"})}),d.removeClass("rdr_engaged"),b("#rdr_indicator_"+c).hide()},updateSizes:function(a,b){a.hasClass("rdr_indicator_details")?"media":"text";var d=b||{},e=a.find(".rdr_visiblePanel");a.data("initialWidth"),a.data("initialHeight");var h,i,k={h:200,w:200,duration:RDR.C.rindowAnimationSpeed};k.w=e.width(),k.h=e.height()+32,h=d.setWidth||k.w,i=d.setHeight||k.h,d.noAnimate&&a.css({width:h,height:i}),a.animate({width:h,height:i},{duration:k.duration,queue:!1}),RDR.rindow.jspUpdate(a)},updatePageTagMessage:function(a,c){if("tagDeleted"==c){var d=b("div.rdr_window:eq(0)");RDR.rindow.hideFooter(d),d.find(".rdr_header h1").text("Reaction Undone"),d.find(".rdr_body").css("height","auto").html('<div class="rdr_reactionMessage rdr_reactUndoSuccess"><div class="rdr_label_icon"></div><em><span>Your Reaction: </span><strong> '+a.tag.body+" </strong>"+"<span>has been undone.</span>"+"</em>"+"</div>")}},updateTagMessage:function(a){function s(a){var b=a.data.args.args?a.data.args.args:a.data.args,c=b.sendData.content_node_data,d=b.hash,e=b.page_id,f=b.rindow,g=b.tag,h=r.val();if(h.length>RDR.group.comment_length&&(h=h.substr(0,RDR.group.comment_length),r.val(h)),"Add a comment or #hashtag"!=h){var i=RDR.summaries[d];c.kind=i.kind;var j={hash:d,page_id:e,content_node_data:c,comment:h,content:c.body,tag:g,rindow:f};RDR.actions.interactions.ajax(j,"comment","create")}else r.focus()}function t(){var e=b('<div class="rdr_shareLinks">Share your reaction: <ul></ul></div>'),g=["facebook","twitter"];return b.each(g,function(g,i){var j=b('<li><a href="http://'+i+'.com" ><i class="rdr_icon-'+i+'"></i></a></li>');e.find("ul").append(j),j.click(function(){var b=a.tag.tag_body||a.tag.body;a.hash.jquery&&(h.hash="page",c=a.hash="page"),RDR.events.trackEventToCloud({category:"share",action:"share_open_attempt",opt_label:"which: "+i+", kind: "+a.kind+", hash: "+c+", tag: "+b,container_hash:c,container_kind:a.kind,page_id:a.page_id,tag_body:b});var e=RDR.summaries[c],g=a.kind||e.kind;return RDR.shareWindow=window.open(RDR_staticUrl+"share.html","readr_share","menubar=1,resizable=1,width=626,height=436"),RDR.actions.share_getLink({referring_int_id:a.response.data.interaction.id,hash:a.hash,kind:g,sns:i,rindow:d,tag:f,content_node:h}),!1})}),e}if(a.scenario&&a.rindow){a.args&&b.each(a.args,function(c,d){a[c]="object"==typeof d?b.extend(!0,{},d):d});var c=a.hash,d=a.rindow,f=(a.kind,a.tag),g=RDR.summaries[c],h=a.sendData?a.sendData.content_node_data:{};if(RDR.rindow.tagBox.setWidth(d,320),"tagDeleted"!=a.scenario){if("reactionSuccess"==a.scenario||"reactionExists"==a.scenario){var i=b('<div class="rdr_view_success"></div>'),j=b('<div class="rdr_subheader rdr_clearfix"></div>').appendTo(i),k=f.body?f.body:f.tag_body,m=(b("<h1>"+k+"</h1>").appendTo(j),b('<div class="rdr_nextActions"></div>').appendTo(i));"page"!=a.kind&&RDR.actions.comments.makeCommentBox({content_node:h,summary:g,hash:c,tag:f,$rindow:d,selState:h.selState||null}).appendTo(m);var o=b('<div class="rdr_back">Close X</div>');i.prepend(o),o.click(function(){var a=RDR.rindow.safeClose(d);a&&RDR.rindow.updateTagPanel(d)});var p=!0;RDR.rindow.panelUpdate(d,"rdr_view_more",i,p),RDR.user=RDR.user||{};var q=function(a){var b=a.data.args,c={hash:b.hash,int_id:b.response.data.interaction.id,tag:b.tag,rindow:d};RDR.actions.interactions.ajax(c,"react","remove")};isTouchBrowser?d.find("a.rdr_undo_link").on("tap.rdr",{args:a},q):d.find("a.rdr_undo_link").on("click.rdr",{args:a},q),i.find(".rdr_comment_input").append('<div class="rdr_commentBox rdr_inlineCommentBox"><div class="rdr_label_icon"></div><textarea class="rdr_add_comment_field rdr_inlineComment">Add a comment or #hashtag</textarea><div class="rdr_clear"></div></div>');var r=i.find(".rdr_add_comment_field");r.focus(function(){b(this).addClass("rdr_adding_comment"),"Add a comment or #hashtag"==b(this).val()&&b(this).val("")}).blur(function(){""===b(this).val()&&(b(this).val("Add a comment or #hashtag"),b(this).removeClass("rdr_adding_comment"))}).on("keyup",{args:a},function(a){var b=r.val();"27"==a.keyCode||("13"==a.keyCode?s(a):b.length>RDR.group.comment_length&&(b=b.substr(0,RDR.group.comment_length),r.val(b)))}),i.find("button.rdr_add_comment").on("click",{args:a},function(a){s(a)});var u=b(".rdr_nextActions");u.append(t())}RDR.actions.containers.media.onEngage(c)}else{var v=RDR.rindow.makeDefaultPanelMessage(d),w=RDR.rindow.makeHeader(v);d.find(".rdr_header").replaceWith(w),d.removeClass("rdr_viewing_more").find("div.rdr_indicator_details_body").show(),RDR.rindow.panelHide(d)}RDR.rindow.updateSizes(d)}},jspUpdate:function(a){a.closest(".jspContainer").length||a.hasClass("jspScrollable")||a.find("div.rdr_body").each(function(){var a=b(this);if(a.hasClass("jspScrollable")){var c=b(this).data("jsp");c.reinitialise()}else b(this).jScrollPane({showArrows:!0})})},tagBox:{setWidth:function(a,b){var c=RDR.group.max_rindow_width?RDR.group.max_rindow_width:b;a.removeClass("w160 w320 w480 w640").addClass("w"+c)},setHeight:function(a,b){a.find(".rdr_body, .jspContainer").height(b)},make:function(a){function F(a,b){if(e.find(".rdr_view_more").length&&e.find(".rdr_view_more").hasClass("rdr_visiblePanel"))e.find(".rdr_body").html(a),RDR.rindow.jspUpdate(e);else{var c=RDR.rindow.panelCreate(e,"rdr_view_more"),d=e.find("div.rdr_body_wrap");d.append(c),c.append(a).addClass("rdr_page_reactions_summary"),RDR.rindow.tagBox.setWidth(e,320),RDR.rindow.panelShow(e,c,function(){RDR.rindow.hideFooter(e)})}var f=b.tag_count<=0?"no reactions":1==b.tag_count?"1 reaction":b.tag_count+" reactions",g=RDR.rindow.makeHeader(f);e.find(".rdr_header").replaceWith(g)}function G(){var a=b('<div class="rdr_back">Close X</div>');return a.click(function(){var a=!!e.attr("rdr-grid-for");return a?void 0:(RDR.rindow.close(e),void 0)}),a}function H(a,d,e){b().selog("hilite",!0,"off"),b(".rdr_twtooltip").remove();var f=G(),g=b('<table cellpadding="0" cellspacing="0" border="0" class="reaction_summary_table"></table>').append('<tbody><tr class="rdr_page_reactions"></tr></tbody>');if(d&&d.page&&d.page>0){var h=1==d.page?"1 reaction":d.page+" reactions";g.find(".rdr_page_reactions").append('<td colspan="2"><strong>'+h+"</strong> to this <strong>page</strong></td>")}return(d.img>0||d.text>0||d.media>0)&&(g.find(".rdr_page_reactions").addClass("has_other_reactions"),b.each(RDR.interaction_data[c.id],function(a,d){var f=d.hash,h=RDR.summaries[f];b('[rdr-hash="'+f+'"]');var j=h.pageId;if(j&&e&&j==e&&!g.find("tr.rdr_int_summary_"+a).length){var k=b('<tr valign="middle" class="rdr_content_reaction rdr_int_summary_'+a+'"/>'),l=RDR.interaction_data[c.id][a];if("undefined"!=typeof l.interaction&&"undefined"!=typeof l.content_node){var m=l.interaction.count>1?"reactions":"reaction";if(k.append('<td class="rdr_count"><h4>'+l.interaction.count+"</h4><h5>"+m+"</h5></td>").data("count",l.interaction.count).data("tag",c).data("int_id",a),"text"==l.kind?k.append('<td class="rdr_content">'+l.content_node.body+"</td>"):"img"==l.kind?k.append('<td class="rdr_content"><img src="'+l.content_node.body+'" height="50"/></td>'):"media"==l.kind&&k.append('<td class="rdr_content"><img src="'+RDR_baseUrl+'/static/widget/images/video_icon.png" height="33" style="margin-bottom:-10px;"/> <div style="display:inline-block;margin-left:10px;">Video</div></td>'),k.click(function(a){a.preventDefault();var b={container_hash:l.hash,location:l.content_node.location};RDR.session.revealSharedContent(b)}),g.find("tr.rdr_content_reaction").length){var n=0;b.each(g.find("tr.rdr_content_reaction"),function(a,c){return parseInt(l.interaction.count)>parseInt(b(c).data("count"))?(n=a,!1):void 0}),g.find("tr.rdr_content_reaction:eq("+n+")").before(k)}else g.find("tbody").append(k)}}})),b("<div/>").append(f,g)}var c=a.tag,d=a.boxSize?a.boxSize:"medium",e=a.$rindow?a.$rindow:null,f=a.$tagContainer?a.$tagContainer:a.$rindow?a.$rindow.find("div.rdr_body.rdr_tags_list"):null,g=c.tag_count?c.tag_count:"",h=a.colorInt?a.colorInt:1,i=a.isWriteMode?a.isWriteMode:!1,j=e.data("kind"),k=e.data("hash")?e.data("hash"):e.data("container"),l=RDR.summaries[k],m=c.content_node_id?c.content_node_id:!1,n=m?l.content_nodes[m]:"",o="";m&&(n.id=m);var d="big"==d?"rdr_box_big":"medium"==d?"rdr_box_medium":"rdr_box_small",p="",q=i?"rdr_writeMode":"",r=c.body?c.body:c.tag_body,s="",t="";if("page"==j)o=i?"+1 "+r:"";else if(""==g)o="";else if(-101==g)o="+1 "+r;else var o="+1 "+r;var u="";if(r.length<16)u="rdr_charCount"+r.length,s='<div class="rdr_tag_body rdr_tag_lineone">'+r+"</div>";else if(t="rdr_tag_split",-1==r.indexOf(" "))u="rdr_charCount15",s='<div class="rdr_tag_body rdr_tag_lineone">'+r.substr(0,15)+"-<br/>"+r.substr(15)+"</div>";else{var v="",w="",x=!0;for(tagBodyRawSplit=r.split(" ");x;)v+=tagBodyRawSplit.shift()+" ",v.length+tagBodyRawSplit[0].length>=16&&(x=!1);w=tagBodyRawSplit.join(" "),u="rdr_charCount"+v.length,s='<div class="rdr_tag_body rdr_tag_lineone">'+v+"<br>"+w+"</div>"}var y=c.id,z=c.parent_id,A=m?"rdr_content_node_"+m:"",g=g||0,B=i||"page"!=j?'<span class="rdr_plusOne">+1</span>':"",C=i?"":'<span class="rdr_count">'+g+"</span>"+'<i class="rdr_icon-search rdr_tag_read_icon"></i>',D='<div class="rdr_color'+h+" "+d+" rdr_box "+p+" "+q+'">'+"<div "+'class="rdr_tag '+t+" "+A+" "+u+'" '+'data-tag_id="'+y+'" '+'data-tag_count="'+g+'" '+'data-parent_id="'+z+'" '+'data-content_node_id="'+m+'" '+">"+s+C+B+"</div>"+"</div>",E=b(D);if(f.append(E),"page"==j)if(0==i){var I=function(){RDR.rindow.hideFooter(e),e.removeClass("rdr_rewritable");var a=RDR.pages[RDR.util.getPageProperty("id",k)],d=c.tag_count,f={img:0,text:0,media:0,page:"+"==d?0:d};b.each(a.containers,function(a,b){RDR.summaries&&RDR.summaries[b.hash]&&RDR.summaries[b.hash].top_interactions&&RDR.summaries[b.hash].top_interactions.tags&&RDR.summaries[b.hash].top_interactions.tags[c.id]&&(f[RDR.summaries[b.hash].kind]+=RDR.summaries[b.hash].top_interactions.tags[c.id].count,f.page-=RDR.summaries[b.hash].top_interactions.tags[c.id].count)});var g=b(this),h=H(g,f,a.id);F(h,c),g.addClass("rdr_live_hover")};E.click(function(){I()})}else E.click(function(){b(this).addClass("rdr_tagged"),e.removeClass("rdr_rewritable");var a=e.data("container");args={tag:c,hash:a,uiMode:"writeMode",kind:e.data("kind"),rindow:e,content_node:n},RDR.actions.interactions.ajax(args,"react","create")});else isTouchBrowser?E.bind("tap",function(){b(this).addClass("rdr_tagged"),e.removeClass("rdr_rewritable");var a=e.data("container");args={tag:c,hash:a,uiMode:"writeMode",kind:e.data("kind"),rindow:e,content_node:n},RDR.actions.interactions.ajax(args,"react","create")}):E.click(function(){b(this).addClass("rdr_tagged"),e.removeClass("rdr_rewritable");var a=e.data("container");args={tag:c,hash:a,uiMode:"writeMode",kind:e.data("kind"),rindow:e,content_node:n},RDR.actions.interactions.ajax(args,"react","create")});isTouchBrowser||E.hover(function(){var a=b(this);if(!a.hasClass("rdr_tagged")){var c=a.find("span.rdr_tag_count");c.width(c.width()),c.text("+")}},function(){var a=b(this);a.find("span.rdr_tag_count").text(a.find(".rdr_tag").data("tag_count"))});var J={},K=0;b.isEmptyObject(n)||b.isEmptyObject(n.top_interactions)||b.isEmptyObject(n.top_interactions.coms)||b.each(n.top_interactions.coms,function(a,d){d.tag_id==parseInt(c.tag_id)&&(K++,b.isEmptyObject(J)&&(J=n.top_interactions.coms))});var L=b.isEmptyObject(J)&&"undefined"!=typeof l&&("img"==l.kind||"media"==l.kind||"med"==l.kind)&&!b.isEmptyObject(l.top_interactions)&&!b.isEmptyObject(l.top_interactions.coms);if(c.id||(c.id=c.tag_id),L&&(J=l.top_interactions.coms[c.id],b.isEmptyObject(J)||(K=J.length)),!b.isEmptyObject(J)&&!i){var M=b('<span class="rdr_comment_hover rdr_tooltip_this" title="view comments"></span>');M.append('<i class="rdr_icon-comment"></i> '+K),isTouchBrowser?M.bind("tap",function(){return b(this).tooltip("hide"),RDR.actions.viewCommentContent({tag:c,hash:k,rindow:e,content_node:n,selState:n.selState}),!1}):M.click(function(){return b(this).tooltip("hide"),RDR.actions.viewCommentContent({tag:c,hash:k,rindow:e,content_node:n,selState:n.selState}),!1}),E.append(M),M.tooltip()}return E}},writeCustomTag:function(a,c,d){function j(a,b){var e={},f=c.data("container"),g=b.val();""!==g&&(e.body=g,a.parent().addClass("rdr_tagged"),args={tag:e,hash:f,uiMode:"writeMode",kind:c.data("kind"),rindow:c},RDR.actions.interactions.ajax(args,d,"create"),b.blur())}var a=c.find(".rdr_footer");if(a.append('<div class="rdr_box"></div> '),0==a.find("div.rdr_custom_tag").not("div.rdr_custom_tag.rdr_tagged").length){var d=d?d:"react",e="react"==d?"+ Add your own":"+ Add tag...",f=b('<div class="rdr_click_overlay"></div>').appendTo(a),g=b('<div class="rdr_tag rdr_custom_tag"></div>'),h=b('<input value="'+e+'" />').appendTo(g),i=b('<button class="rdr_custom_tag_submit" name="rdr_custom_tag_submit">ok</button>').appendTo(g);i.click(function(){j(g,h)}),f.click(function(){h.focus()}),h.focus(function(){var a=b(this);a.removeClass("rdr_default"),a.val()==e&&a.val(""),f.hide(),i.show()}).blur(function(){var a=b(this);""===a.val()&&(a.val(e),i.hide(),f.show()),a.val()==e&&(a.addClass("rdr_default"),i.hide(),f.show()),a.closest("div.rdr_tag").removeClass("rdr_hover")}).keyup(function(a){var b=h;if("13"==a.keyCode)j(g,h);else{if("27"==a.keyCode)return b.blur(),!1;if(b.val().length>25){var c=b.val();b.val(c.substr(0,25))}}}),a.find(".rdr_box").append(g," "),b(document).on("keydown.rdr",function(c){keyCodes=[16,81,87,69,82,84,89,85,73,79,80,65,83,68,70,71,72,74,75,76,90,88,67,86,66,78,77,49,50,51,52,53,54,55,56,57,48,189,187,219,221,220,186,222,188,190,191,192],-1!=b.inArray(c.keyCode,keyCodes)&&a.find("input").focus()})}},_rindowTypes:{tagMode:{make:function(a){if(1==a.is_page){var c=a.page,d=b(".rdr-summary-"+c.id),e={top:d.offset().top,left:d.offset().left};if(b("div.rdr_page_key_"+d.data("page_key")).length)return;var f=RDR.rindow.draw({coords:e,container:d,content:"page",kind:"page",mode:a.mode})}else{var g=a.hash,h=RDR.util.getPageProperty("id",g),i=RDR.summaries[g],j=i.$container,k=i.kind,l=0==a.rewritable?!1:!0,e={};if(a.actionType?a.actionType:"react","writeMode"==a.mode){RDR.events.trackEventToCloud({category:"engage",action:"rindow_shown_writemode",opt_label:"kind: text, hash: "+g,container_hash:g,container_kind:k,page_id:h});var n;if("text"==k){if(n=j.selog("helpers","smartHilite"),!n)return!1;if(a.content=n.text,e.left=e.left+40,e.top=e.top+35,n){var o=n.hiliter,p=o.get$end();if(p){var q=b("<span />");q.insertAfter(p);var r=q.offset().right,s=q.offset().bottom;q.remove(),e.left=r-14,e.top=s+23}}}else var t=j.parents(RDR.group.img_container_selectors).length?j.parents(RDR.group.img_container_selectors).first().offset().bottom+5:j.offset().bottom-5,e={top:t,left:j.offset().left}}else{var w=(b("#rdr_indicator_"+g),b("#rdr_indicator_body_"+g)),j=b('[rdr-hash="'+g+'"]');if("text"==k)e={top:w.offset().top+22,left:w.offset().left-5};else{var e={top:j.offset().bottom+5,left:j.offset().left};RDR.events.trackEventToCloud({category:"engage",action:"rindow_shown_readmode",opt_label:"kind: "+k+", hash: "+g,container_hash:g,container_kind:k,page_id:h})}}"undefined"!=typeof a.$custom_cta&&(e.top=a.$custom_cta.offset().top+parseInt(a.$custom_cta.attr("rdr-offset-y")),e.left=a.$custom_cta.offset().left+parseInt(a.$custom_cta.attr("rdr-offset-x")));var f=RDR.rindow.draw({coords:e,container:g,content:a.content,kind:k,selState:n,rewritable:l,mode:a.mode});f.data("hash",g),i["$rindow_"+a.mode.toLowerCase()]=f}f.addClass("rdr_"+a.mode.toLowerCase());var x=RDR.rindow.makeDefaultPanelMessage(f),y=RDR.rindow.makeHeader(x);f.find(".rdr_header").replaceWith(y),f.addClass("rdr_reactions");var z=f.find("div.rdr_body_wrap"),A=f.find("div.rdr_body");if(A.length&&A.remove(),1==a.is_page)var B=RDR.actions.indicators.utils.makeTagsListForInline(f,"writeMode"==a.mode,c);else var B=RDR.actions.indicators.utils.makeTagsListForInline(f,"writeMode"==a.mode);z.append(B);var C=z.width(),D=z.height(),E=RDR.util.stayInWindow({coords:e,width:C,ignoreWindowEdges:a.ignoreWindowEdges});return f.css("left",E.left+"px").css("top",E.top+"px"),f.animate({width:C},333,"swing"),f.data("initialWidth",C).data("initialHeight",D),f.find("div.rdr_cell_wrapper div.rdr_tag").css({width:"100%"}),f},customOptions:{},setup:function(){}}},make:function(a,c){var d=c.hash,e=RDR.summaries[d],g=(c.kind,c.is_page);if(!g&&!e){var e=RDR.util.makeEmptySummary(d);RDR.actions.containers.setup(e)}a||(a="readMode");var h=RDR.rindow.defaults,i=RDR.rindow._rindowTypes.customOptions,j=b.extend({},h,i,c,{mode:a}),k=RDR.rindow._rindowTypes.tagMode.make(j);return k},draw:function(a){RDR.rindow.closeAll(),a.selector&&!a.container&&(a.container=a.selector.substr(5));var c=b.extend({},this.defaults,a);c.minHeight<60?60:c.minHeight,c.maxHeight,minWidth=c.minWidth,maxWidth=c.maxWidth,rdr_for="string"==typeof c.container?"rdr_for_"+c.container:"rdr_for_page",$new_rindow=b('<div class="rdr rdr_window rdr_rewritable rdr_widget w160 '+rdr_for+'"></div>'),c.id&&(b("#"+c.id).remove(),$new_rindow.attr("id",c.id)),b("#rdr_sandbox").append($new_rindow),"page"==c.kind&&$new_rindow.addClass("rdr_page_key_"+a.container.data("page_key")).addClass("rdr_page_summary"),$new_rindow.data(c),0===$new_rindow.find("div.rdr_header").length&&($new_rindow.html(""),$new_rindow.append('<div class="rdr rdr_header"><div class="rdr_header_arrow"><img src="'+RDR_staticUrl+'widget/images/header_up_arrow.png" /></div>'+'<div class="rdr_loader"></div>'+'<div class="rdr_about"><a href="http://www.readrboard.com/" target="_blank">&nbsp;</a></div>'+"</div>"+'<div class="rdr rdr_body_wrap rdr_clearfix"></div>'+'<div class="rdr rdr_footer"></div>'),c.noHeader&&$new_rindow.find("div.rdr_header").remove(),$new_rindow.drags({handle:".rdr_header"}));var f=c.coords;return $new_rindow.css("left",f.left+"px"),$new_rindow.css("top",f.top+"px"),c.height&&$new_rindow.height(c.height),RDR.actionbar.closeAll(),$new_rindow.settings=c,$new_rindow.on("resizestop",function(){b(this)}),$new_rindow},safeClose:function(a){var b=!!a.attr("rdr-grid-for");if(b){var c=RDR.rindow.makeHeader("Reactions");a.find(".rdr_header").replaceWith(c),RDR.rindow.updateFooter(a);var d=a.find(".rdr_body_wrap"),e=d.find(".rdr_visiblePanel"),f=d.find(".rdr_hiddenPanel");return d.animate({left:0}),e.removeClass("rdr_visiblePanel").addClass("rdr_hiddenPanel"),f.removeClass("rdr_hiddenPanel").addClass("rdr_visiblePanel"),!0}return RDR.rindow.close(a),!0},close:function(a){RDR.rindow.clearHilites(a),a.each(function(a,c){b(c).remove()}),b("#rdr_indicator_details_wrapper").find(".rdr_body_wrap").css({visibility:"visible"})},closeAll:function(){var a=b("div.rdr.rdr_window").not(".rdr_no_clear");RDR.rindow.close(a),b(".rdr_shared").removeClass("rdr_shared"),b(document).unbind("keydown.rdr")},clearHilites:function(a){var c=[];a.each(function(a,d){var e=b(d).data("container");if("undefined"!=typeof e){var f=RDR.summaries[e],g=b(d).data("selState");"undefined"!=typeof g&&""!==g&&c.push(g);var h=[];f&&f.hasOwnProperty("content_nodes")&&(h=f.content_nodes),b.each(h,function(a,b){var d=b.selState;"undefined"!=typeof d&&c.push(d)})}}),b.each(c,function(a,c){try{b().selog("hilite",c,"off")}catch(d){}})},update:function(a,c){function i(a,c){var d,e;d=a.find(".rdr_tags"),e=d.find(".rdr_tag_"+c.parent_interaction_node.id).filter(function(){return b(this).hasClass("rdr_content_node_"+c.content_id)}),e.addClass("rdr_comment_indicator"),k(c,e,a),j(a),l(c,e,a)}function j(a){var c=a.find("table.rdr_tags");1==c.find("tr:eq(0)").find("td").length&&(c.addClass("rdr-one-column"),isTouchBrowser||c.find("td.rdr_has_pillHover").on("mouseenter, mousemove",function(){var a=b(this),c=a.closest("div.rdr_window");thisWidth=c.data("initialWidth")}).on("mouseleave",function(){var a=b(this),c=a.closest("div.rdr_window");thisWidth=c.width()}))}function k(c,e,f){var g=d.content_nodes,h=g[c.content_id];if(h)var i=h.top_interactions.coms;else{var j=b.mustache('contentNode not found by id: {{id}}.  Figure out why nodeId was saved as "undefined".',{id:c.content_id});RDR.safeThrow(j)}var k=b.map(i,function(a){return a.tag_id===c.tag_id?a:null}),l=k.length,m=e,n=c.parent_interaction_node,o=c.content_node;m.find(".rdr_comment_hover").remove(),m.find(".rdr_comment_indicator").remove();var p=b('<span class="rdr_comment_hover"/>');p.append('<span class="rdr_icon"></span> '+l),p.click(function(){RDR.actions.viewCommentContent({tag:n,hash:a,rindow:f,content_node:o,selState:o.selState})}),m.append(p),m.closest("td").addClass("rdr_has_pillHover")}function l(a,c,d){a.parent_interaction_node,a.content_node;var g=b('<span class="rdr_comment_feedback"/>');g.append('<span class="linkToComment">Thanks for your comment! <a href="javascript:void(0);">Close</a></span> '),g.click(function(a){a.preventDefault(),RDR.rindow.safeClose(d)}),d.find("div.rdr_commentBox").empty().append(g).show(),d.find("button.rdr_add_comment").hide()}var d=RDR.summaries[a],e=d.$rindow_readmode,f=d.$rindow_writemode;if(c){if("coms"==c.int_type)if(f&&f.length&&($tags=f.find(".rdr_tags").find(".rdr_tag"),$tags.addClass("rdr_content_node_"+c.content_id),i(f,c)),e&&e.length)i(e,c);else{var g=b("#rdr_indicator_details_"+a);$tags=g.find(".rdr_tags").find(".rdr_tag"),$tags.addClass("rdr_content_node_"+c.content_id),i(g,c)}}else{var h=d.kind&&("img"==d.kind||"media"==d.kind||"med"==d.kind);if(!h)return;RDR.actions.indicators.utils.makeDetailsContent(a)}}},actionbar:{draw:function(a){function n(){var d=b("#rdr_container_tracker_"+c),e=d.find(".rdr_mediaHilite_top"),f={top:e.offset().top,left:e.offset().right};return f}var c=a.hash,d=a.coords,e=a.kind,f=a.content,g=a.src_with_path||void 0,h=RDR.util.getPageProperty("id",c),i="rdr_actionbar_"+c;if(b("div.rdr_actionbar"),b("#"+i).length>0)return b("#"+i);var k={IE:{top:"add this here",left:"add this here"},img:n,text:{top:d.top+8,left:d.left+3}};d="text"==e?k.text:k.img(d),"text"==e&&(d=RDR.util.stayInWindow({coords:d,width:45,height:30,paddingY:40,paddingX:40,ignoreWindowEdges:a.ignoreWindowEdges}));var l=b('<div class="rdr rdr_actionbar rdr_widget rdr_widget_bar" id="'+i+'" ></div>');if(l.css({top:d.top,left:d.left}),!c)return RDR.safeThrow("There should always be a hash from hashNodes after hover on an unhashed image."),void 0;l.data("hash",c),l.append("<ul/>");var m=[{item:"reaction",tipText:"What do you think?",onclick:function(){RDR.rindow.make("writeMode",{hash:c,kind:e,content:f,src_with_path:g})}}];return RDR.events.trackEventToCloud({category:"actonbar",action:"actionbar_shown",opt_label:"kind: "+e+", hash: "+c+", content: "+f,container_hash:c,container_kind:e,page_id:h}),b.each(m,function(a,c){var d=b('<li class="rdr_icon_'+c.item+'" />'),e=b('<a href="javascript:void(0);" class="rdr_tooltip_this" title="'+c.tipText+'">'+'<span class="rdr rdr_react_icon">'+c.item+"</span>"+'<span class="rdr rdr_react_label">What do you think?</span>'+'<div class="rdr_clear"></div>'+"</a>");e.click(function(){return c.onclick(),!1}),d.addClass("rdr_actionbar_first").append(e).appendTo(l.children("ul"))}),b("#rdr_sandbox").append(l),("img"==e||"media"==e||"med"==e)&&(l.addClass("rdr_actionbar_for_media"),l.append('<div style="clear:both;" />').removeClass("rdr_widget rdr_widget_bar")),l},close:function(a,c){function d(a,c){var d=a.data("timeoutCloseEvt"),e=a.data("timeoutCollapseEvt");clearTimeout(d),clearTimeout(e);var f=b('[rdr-hash="'+c+'"]');b("#rdr_indicator_"+c),f.removeClass("rdr_engage_media"),a.remove()}a.each(function(){var a=b(this),e=a.data("hash");b("#rdr_container_tracker_"+e),"undefined"!=typeof c?a.fadeOut(200):(d(a,e),b("#rdr_indicator_"+e))})},closeSuggest:function(a){var c=b();if(a)if("string"==typeof a){var d=a;c=b("#rdr_actionbar_"+d),c.data("hash",d)}else b.each(a,function(a,b){c=c.add("#rdr_actionbar_"+b),c.data("hash",b)});else c=b("div.rdr_actionbar");var e=this;c.each(function(){var a=b(this),d=c.data("hash"),f=b("#rdr_indicator_details_"+d),g=b('[rdr-hash="'+d+'"]'),h=b(this).data("timeoutCloseEvt");clearTimeout(h),h=setTimeout(function(){a.data("hover")||g.data("hover")||f.data("hover")||e.close(a,"fade")},300),b(this).data("timeoutCloseEvt",h)})},closeAll:function(){var a=b("div.rdr_actionbar");this.close(a)}},util:{checkForSelectedTextAndLaunchRindow:function(){var a=b("document").selog("save");if(a){var c=a.range.commonAncestorContainer,d=3===c.nodeType?b(c).parent():b(c);RDR.actions.startSelect(d,null,function(a,b,c){RDR.rindow.make("writeMode",{hash:a,kind:b,content:c})})}},initTouchBrowserSettings:function(){isTouchBrowser&&(b("body").addClass("rdr_touch_browser"),b(window).on("scrollend",function(){RDR.util.mobileHelperToggle()})),$RDR.dequeue("initAjax")},mobileHelperToggle:function(){b(RDR.group.active_sections).find("embed[rdr-node], video[rdr-node], object[rdr-node], iframe[rdr-node], img[rdr-node]").each(function(){var a=b(this),c=a.data("hash");RDR.actions.indicators.init(c),a.addClass("rdr_live_hover")})},initPublicEvents:function(){window.readrboard.public_events=b("#rdr_sandbox"),$RDR.dequeue("initAjax")
},triggerPublicEvent:function(a,b){window.readrboard.public_events.trigger("event",b),window.readrboard.public_events.trigger(a,b)},makeEmptySummary:function(a,b){var c={};return c={},c.hash=a,c.kind=b,c.top_interactions={},c.top_interactions.coms={},c.top_interactions.tags={},c.top_interactions.shr={},c.counts={},c.counts.tags=0,c.counts.interactions=0,c.counts.coms=0,c},getPageProperty:function(a,c){a||(a="id");var d;if("page"==c)return d=b(".rdr_window").data("container").attr("rdr-page-id"),parseInt(d,10);if("object"==typeof c){if(b(c).closest("[rdr-page-container]").length&&b(c).closest("[rdr-page-container]").data("page_id"))return parseInt(b(c).closest("[rdr-page-container]").data("page_id"))}else if(!c)return b("[rdr-page-container]").eq(0).data("page_id");if("string"==typeof c)var e=c;var d=b('[rdr-hash="'+e+'"]').data("page_id")?b('[rdr-hash="'+e+'"]').data("page_id"):b('[rdr-hash="'+e+'"]').closest("[rdr-page-container]").data("page_id")?b('[rdr-hash="'+e+'"]').closest("[rdr-page-container]").data("page_id"):b("body").data("page_id");return b('[rdr-hash="'+e+'"]').hasAttr("rdr-page-container")&&!b('[rdr-hash="'+e+'"]').data("page_id")&&b('[rdr-hash="'+e+'"]').data("page_id",d),parseInt(d)},buildInteractionData:function(){b.each(RDR.summaries,function(a,c){b.each(c.top_interactions.tags,function(d){"undefined"!=typeof RDR.summaries[a].content_nodes&&b.each(RDR.summaries[a].content_nodes,function(b,e){if("undefined"!=typeof e.top_interactions.tags&&"undefined"!=typeof e.top_interactions.tags[d]){var f=e.top_interactions.tags[d];"undefined"==typeof RDR.interaction_data[d]&&(RDR.interaction_data[d]={}),"undefined"==typeof RDR.interaction_data[d][f.parent_id]&&(RDR.interaction_data[d][f.parent_id]={}),RDR.interaction_data[d][f.parent_id].hash=a,RDR.interaction_data[d][f.parent_id].container_id=c.id,RDR.interaction_data[d][f.parent_id].tag={body:f.body,id:d},RDR.interaction_data[d][f.parent_id].kind=c.kind,RDR.interaction_data[d][f.parent_id].interaction={id:f.parent_id,count:f.count,body:f.body},RDR.interaction_data[d][f.parent_id].content_node={body:e.body,location:e.location,selState:e.selState}}})})})},stayInWindow:function(a){var c=b(window),d=c.width(),e=c.height(),f=c.scrollTop(),g=a.width,h=a.height,i=a.coords,j=a.paddingY||10,k=a.paddingX||10,l=a.ignoreWindowEdges?a.ignoreWindowEdges:"";return-1==l.indexOf("r")&&i.left+g+16>=d-k&&(i.left=d-g-k),-1==l.indexOf("b")&&i.top+h>e+f-j&&(i.top=e+f-h-j),-1==l.indexOf("l")&&i.left<k&&(i.left=k),-1==l.indexOf("t")&&i.top<f+j&&(i.top=f+j),i},md5:{hexcase:0,b64pad:"",chrsz:8,hex_md5:function(a){return RDR.util.md5.binl2hex(RDR.util.md5.core_md5(RDR.util.md5.str2binl(a),a.length*RDR.util.md5.chrsz))},core_md5:function(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=RDR.util.md5.md5_ff(c,d,e,f,a[g+0],7,-680876936),f=RDR.util.md5.md5_ff(f,c,d,e,a[g+1],12,-389564586),e=RDR.util.md5.md5_ff(e,f,c,d,a[g+2],17,606105819),d=RDR.util.md5.md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=RDR.util.md5.md5_ff(c,d,e,f,a[g+4],7,-176418897),f=RDR.util.md5.md5_ff(f,c,d,e,a[g+5],12,1200080426),e=RDR.util.md5.md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=RDR.util.md5.md5_ff(d,e,f,c,a[g+7],22,-45705983),c=RDR.util.md5.md5_ff(c,d,e,f,a[g+8],7,1770035416),f=RDR.util.md5.md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=RDR.util.md5.md5_ff(e,f,c,d,a[g+10],17,-42063),d=RDR.util.md5.md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=RDR.util.md5.md5_ff(c,d,e,f,a[g+12],7,1804603682),f=RDR.util.md5.md5_ff(f,c,d,e,a[g+13],12,-40341101),e=RDR.util.md5.md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=RDR.util.md5.md5_ff(d,e,f,c,a[g+15],22,1236535329),c=RDR.util.md5.md5_gg(c,d,e,f,a[g+1],5,-165796510),f=RDR.util.md5.md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=RDR.util.md5.md5_gg(e,f,c,d,a[g+11],14,643717713),d=RDR.util.md5.md5_gg(d,e,f,c,a[g+0],20,-373897302),c=RDR.util.md5.md5_gg(c,d,e,f,a[g+5],5,-701558691),f=RDR.util.md5.md5_gg(f,c,d,e,a[g+10],9,38016083),e=RDR.util.md5.md5_gg(e,f,c,d,a[g+15],14,-660478335),d=RDR.util.md5.md5_gg(d,e,f,c,a[g+4],20,-405537848),c=RDR.util.md5.md5_gg(c,d,e,f,a[g+9],5,568446438),f=RDR.util.md5.md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=RDR.util.md5.md5_gg(e,f,c,d,a[g+3],14,-187363961),d=RDR.util.md5.md5_gg(d,e,f,c,a[g+8],20,1163531501),c=RDR.util.md5.md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=RDR.util.md5.md5_gg(f,c,d,e,a[g+2],9,-51403784),e=RDR.util.md5.md5_gg(e,f,c,d,a[g+7],14,1735328473),d=RDR.util.md5.md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=RDR.util.md5.md5_hh(c,d,e,f,a[g+5],4,-378558),f=RDR.util.md5.md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=RDR.util.md5.md5_hh(e,f,c,d,a[g+11],16,1839030562),d=RDR.util.md5.md5_hh(d,e,f,c,a[g+14],23,-35309556),c=RDR.util.md5.md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=RDR.util.md5.md5_hh(f,c,d,e,a[g+4],11,1272893353),e=RDR.util.md5.md5_hh(e,f,c,d,a[g+7],16,-155497632),d=RDR.util.md5.md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=RDR.util.md5.md5_hh(c,d,e,f,a[g+13],4,681279174),f=RDR.util.md5.md5_hh(f,c,d,e,a[g+0],11,-358537222),e=RDR.util.md5.md5_hh(e,f,c,d,a[g+3],16,-722521979),d=RDR.util.md5.md5_hh(d,e,f,c,a[g+6],23,76029189),c=RDR.util.md5.md5_hh(c,d,e,f,a[g+9],4,-640364487),f=RDR.util.md5.md5_hh(f,c,d,e,a[g+12],11,-421815835),e=RDR.util.md5.md5_hh(e,f,c,d,a[g+15],16,530742520),d=RDR.util.md5.md5_hh(d,e,f,c,a[g+2],23,-995338651),c=RDR.util.md5.md5_ii(c,d,e,f,a[g+0],6,-198630844),f=RDR.util.md5.md5_ii(f,c,d,e,a[g+7],10,1126891415),e=RDR.util.md5.md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=RDR.util.md5.md5_ii(d,e,f,c,a[g+5],21,-57434055),c=RDR.util.md5.md5_ii(c,d,e,f,a[g+12],6,1700485571),f=RDR.util.md5.md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=RDR.util.md5.md5_ii(e,f,c,d,a[g+10],15,-1051523),d=RDR.util.md5.md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=RDR.util.md5.md5_ii(c,d,e,f,a[g+8],6,1873313359),f=RDR.util.md5.md5_ii(f,c,d,e,a[g+15],10,-30611744),e=RDR.util.md5.md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=RDR.util.md5.md5_ii(d,e,f,c,a[g+13],21,1309151649),c=RDR.util.md5.md5_ii(c,d,e,f,a[g+4],6,-145523070),f=RDR.util.md5.md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=RDR.util.md5.md5_ii(e,f,c,d,a[g+2],15,718787259),d=RDR.util.md5.md5_ii(d,e,f,c,a[g+9],21,-343485551),c=RDR.util.md5.safe_add(c,h),d=RDR.util.md5.safe_add(d,i),e=RDR.util.md5.safe_add(e,j),f=RDR.util.md5.safe_add(f,k)}return Array(c,d,e,f)},md5_cmn:function(a,b,c,d,e,f){return RDR.util.md5.safe_add(RDR.util.md5.bit_rol(RDR.util.md5.safe_add(RDR.util.md5.safe_add(b,a),RDR.util.md5.safe_add(d,f)),e),c)},md5_ff:function(a,b,c,d,e,f,g){return RDR.util.md5.md5_cmn(b&c|~b&d,a,b,e,f,g)},md5_gg:function(a,b,c,d,e,f,g){return RDR.util.md5.md5_cmn(b&d|c&~d,a,b,e,f,g)},md5_hh:function(a,b,c,d,e,f,g){return RDR.util.md5.md5_cmn(b^c^d,a,b,e,f,g)},md5_ii:function(a,b,c,d,e,f,g){return RDR.util.md5.md5_cmn(c^(b|~d),a,b,e,f,g)},safe_add:function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},bit_rol:function(a,b){return a<<b|a>>>32-b},str2binl:function(a){for(var b=Array(),c=(1<<RDR.util.md5.chrsz)-1,d=0;d<a.length*RDR.util.md5.chrsz;d+=RDR.util.md5.chrsz)b[d>>5]|=(a.charCodeAt(d/RDR.util.md5.chrsz)&c)<<d%32;return b},binl2hex:function(a){for(var b=RDR.util.md5.hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(15&a[d>>2]>>8*(d%4)+4)+b.charAt(15&a[d>>2]>>8*(d%4));return c}},getCleanText:function(a){var c=b(a),d=c.find(".rdr_indicator");if(!d.length){var e=c.html().replace(/< *br *\/?>/gi,"\n"),f=b.trim(b("<div>"+e+"</div>").text().toLowerCase());if(f&&"string"==typeof f&&""!==f){var g=f.replace(/[\n\r\t]+/gi," ").replace().replace(/\s{2,}/g," ");return b.trim(g)}}},trimToLastWord:function(a){var b=/\w+$/.exec(a);return b?a.slice(0,a.length-b[0].length):a},cssSuperImportant:function(a,c,d){var e="";b.each(c,function(a,d){d.replace("!important",""),b.trim(d),d+=" !important",c[a]=d});var f=a.attr("style")||"",g=d?c:b.extend(RDR.util.parseCssAttrToDict(f),c);return b.each(g,function(a,b){e+=a+":"+b+";"}),a.attr("style",e),a},parseCssAttrToDict:function(a){var c={},d=a.split(";");return b.each(d,function(a,d){var e=d.split(":"),f=b.trim(e[0]),g=b.trim(e[1]);f.length&&g.length&&(c[f]=g)}),c},fixBrTags:function(){var a=b(RDR.group.br_replace_scope_selector).find("> br").parent();if(a.length){var c="|rdr|br|/rdr|";a.each(function(){var a=b(this),d=a.clone(),e=b("<p></p>");d.find("> br").each(function(){b(this).replaceWith(c)});for(var f=d.html().split(c),g=0;g<f.length;g++){var h=f[g];e.append('<div class="rdr_br_replaced">'+h+"</div>")}a.addClass("rdr_br_replaced_section").html(e.html())})}},fixBodyBorderOffsetIssue:function(){var a=b("body"),c=parseInt(a.css("border-top-width"),10),d=parseInt(a.css("border-left-width"),10),e=b("#rdr_sandbox");(c||d)&&RDR.util.cssSuperImportant(e,{top:c+"px",left:d+"px"})},throttledUpdateContainerTrackers:function(){return RDR.util._.throttle(RDR.actions.indicators.utils.updateContainerTrackers,100)},userLoginState:function(){if(b("#rdr-user").length||b(".rdr-page-summary").find("div.rdr-summary").prepend('<div id="rdr-user" />'),RDR&&RDR.user&&RDR.user.full_name&&b(".rdr-page-summary.defaultSummaryBar").length){var a="facebook"==RDR.user.user_type?RDR.user.full_name.split(" ")[0]:RDR.user.full_name;b("#rdr-user").html('Hi, <a href="'+RDR_baseUrl+"/user/"+RDR.user.user_id+'" target="_blank">'+a+"</a>")}else b("#rdr-user").html('<a href="javascript:void(0);">Log in to ReadrBoard</a>'),b("#rdr-user").find("a").click(function(){RDR.session.showLoginPanel()})},objLength:function(a){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b},_:{debounce:function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},throttle:function(a,b){var c={};c.debounce=RDR.util._.debounce;var d,e,f,g,h,i=c.debounce(function(){h=g=!1},b);return function(){d=this,e=arguments;var c=function(){f=null,h&&a.apply(d,e),i()};f||(f=setTimeout(c,b)),g?h=!0:a.apply(d,e),i(),g=!0}},once:function(a){var c,b=!1;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}},getQueryParams:function(a){for(var d,b=a||window.location.search,c={},e=/\+/g,f=/([^&=]+)=?([^&]*)/g,g=function(a){return decodeURIComponent(a.replace(e," "))},h=b.substring(1);d=f.exec(h);)c[g(d[1])]=g(d[2]);return c},getQueryStrFromUrl:function(a){var c,d,b=a.indexOf("?");return-1==b?(c=a,d=""):(c=a.slice(0,b),d=a.slice(b)),d}},debug:function(){window.RDR=window.READRBOARDCOM,window.$RDR=$RDR,window.$R=a},toggle:function(){a("body").toggleClass("no-rdr")},session:{alertBar:{make:function(a,c){var d,e,f;if("fromShareLink"==a&&"undefined"!=c.content){var g=unescape(b.evalJSON('"'+c.content+'"'));d=b("<h1>Shared with <span>ReadrBoard</span></h1>"),e=1==b('img[rdr-hash="'+c.container_hash+'"]').length?b('<div><strong class="reactionText">Reaction: <em>'+c.reaction+"</em></strong>"+' <a class="rdr_showSelection" href="javascript:void(0);"><img src="'+c.content+'" style="max-width:100px !important;max-height:70px !important;margin:5px 0 !important;display:block !important;" />'+' <strong class="seeItLinkText rdr_blue">Show it on the page</strong></a></div>'):b('<div><strong class="reactionText">Reaction: <em>'+c.reaction+"</em></strong>"+'<strong>"</strong><em>'+g.substr(0,140)+'...</em><strong>"</strong>'+'<br /><strong class="seeItLinkText"><a class="rdr_showSelection" href="javascript:void(0);">Show it on the page</a></strong></div>'),e.find("a.rdr_showSelection").click(function(){setTimeout(function(){RDR.session.revealSharedContent(c)},200)})}if("showMorePins"==a&&(d=b("<h1>See <span>more reactions</span> on this page.</h1>"),e=b('<div>Readers like you are reacting to, sharing, and discussing content on this page.  <a class="rdr_show_more_pins" href="javascript:void(0);">Click here</a> to see what they\'re saying.<br><br><strong>Tip:</strong> Look for the <img src="'+RDR_staticUrl+'widget/images/blank.png" class="no-rdr rdr_pin" /> icons.</div>'),e.find("a.rdr_show_more_pins").click(function(){RDR.actions.summaries.showLessPopularIndicators(),b(this).closest("div.rdr_alert_box").find("div.rdr_alert_box_x").click()})),"undefined"!=typeof d){f=b('<img src="'+RDR_staticUrl+'widget/images/blank.png" class="no-rdr rdr_pin" />');var h=b('<div class="rdr_alert_box rdr rdr_'+a+'" />');h.append(b('<div class="rdr_alert_box_1" />').append(f).append(d),b('<div class="rdr_alert_box_2" />').append(e),'<div class="rdr rdr_alert_box_x">x</div>'),b("#rdr_sandbox").append(h),b("div.rdr_alert_box.rdr_"+a).find(".rdr_alert_box_x").click(function(){RDR.session.alertBar.close(a)}),b("div.rdr_alert_box.rdr_"+a).animate({top:-5},1e3)}},close:function(a){b("div.rdr_alert_box.rdr_"+a).remove(),b("div.rdr_indicator_for_media").hide(),b.postMessage("close "+a,RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"])}},revealSharedContent:function(a){var c=a.container_hash,d=b('[rdr-hash="'+c+'"]'),e=d.data("kind");if(("img"==e||"media"==e||"med"==e)&&(d.addClass("rdr_shared"),RDR.actions.indicators.utils.updateContainerTracker(c)),a.location&&"None"!=a.location){var f=a.location;b().selog("stack");var h=d.selog("save",{serialRange:f});b().selog("hilite",h,"on"),b("div.rdr_page_summary").remove()}var i=d.offset().top,j=130,k=i-j||0;b("html,body").animate({scrollTop:k},1e3)},getSharedLinkInfo:function(a){if("pag"!=b.cookie("content_type")){var c=a.container_hash,d=!!RDR.containers[c];if(!d)return;return RDR.session.alertBar.make("fromShareLink",a),!0}},getUser:function(a,c){c&&a?RDR.session.receiveMessage(a,c):c&&RDR.session.receiveMessage(!1,c),b.postMessage("getUser",RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"])},handleGetUserFail:function(a,c){var d=a.response;switch(d.message){case"Error getting user!":RDR.session.killUser();break;case"Temporary user interaction limit reached":RDR.session.showLoginPanel(a,c);break;case"Container specified does not exist":break;case"Token was invalid":case"Facebook token expired":case"FB graph error - token invalid":case"Social Auth does not exist for user":case"Data to create token is missing":"undefined"!=typeof RDR.user.user_type&&"readrboard"==RDR.user.user_type?RDR.session.showLoginPanel(a,c):(RDR.session.receiveMessage(a,c),b.postMessage("reauthUser",RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"]))}},createXDMframe:function(){RDR.session.receiveMessage({},function(){RDR.util.userLoginState()});var a=RDR_baseUrl+"/static/xdm.html",c=window.location.href,d=window.location.protocol+"//"+window.location.host,e=RDR.engageScriptParams.bookmarklet?"bookmarklet=true":"",f=b('<iframe id="rdr-xdm-hidden" name="rdr-xdm-hidden" src="'+a+"?parentUrl="+c+"&parentHost="+d+"&group_id="+RDR.group.id+"&group_name="+encodeURIComponent(RDR.group.name)+"&"+e+'" width="1" height="1" style="position:absolute;top:-1000px;left:-1000px;" />');b("#rdr_sandbox").append(f),$RDR.dequeue("initAjax")},receiveMessage:function(a,c){b.receiveMessage(function(d){var e=b.evalJSON(d.data);if(e.status)if("returning_user"==e.status||"got_temp_user"==e.status){for(var f in e.data)RDR.user=RDR.user||{},"user_boards"==f?RDR.user.user_boards=b.evalJSON(e.data[f]):RDR.user[f]=isNaN(e.data[f])?e.data[f]:parseInt(e.data[f],10);c&&a?(!a.kind&&a.rindow&&(a.kind=b(a.rindow).data("kind")),a.user=RDR.user,c(a),c=null):c&&(c(),c=null),RDR.util.userLoginState()}else if("board_created"==e.status)b("div.rdr-board-create-div").remove();else if("board_create_cancel"==e.status)clearInterval(RDR.checkingBoardWindow),b("div.rdr-board-create-div").remove();else if("getUserLoginState"==e.status)RDR.session.getUser(),b("#rdr_loginPanel").remove();else if("fb_user_needs_to_login"==e.status)c&&a?RDR.session.showLoginPanel(a,c):RDR.session.showLoginPanel(a);else if("close login panel"==e.status)RDR.util.userLoginState(),b("#rdr_loginPanel").remove(),b("div.rdr-summary div.rdr_info").html("<em>You're logged in!  Try your last reaction again.");else if("already had user"==e.status)b("#rdr_loginPanel div.rdr_body").html('<div style="padding: 5px 0; margin:0 8px; border-top:1px solid #ccc;"><strong>Welcome!</strong> You\'re logged in.</div>');else if(-1!=e.status.indexOf("sharedLink")){var g=e.status.split("|");g[5]&&(RDR.session.referring_int_id=parseInt(g[5],10)),RDR.session.getSharedLinkInfo({container_hash:g[1],location:g[2],reaction:g[3],content:g[4],page_hash:g[6]})}},RDR_baseUrl)},login:function(){},checkForMaxInteractions:function(){RDR.user=RDR.user||{};var a=!RDR.user.user_type;return a&&RDR.user.num_interactions&&RDR.user.num_interactions>=RDR.group.temp_interact?!0:!1},showLoginPanel:function(a,c){if(b(".rdr_rewritable").removeClass("rdr_rewritable"),b("#rdr_loginPanel").length<1){var d;if(a&&a.rindow){var e=a.rindow;d=e.offset(),d.left=d.left?d.left-34:100,d.top=d.top?d.top-25:100}else d=[],d.left=b(window).width()/2-200,d.top=150+b(window).scrollTop();var f=RDR.rindow.draw({coords:d,id:"rdr_loginPanel",pnls:1,height:175,ignoreWindowEdges:"bt"});RDR.rindow.tagBox.setWidth(f,480),a&&f.data("args",a),c&&f.data("callback",c);var g=RDR_baseUrl+"/static/fb_login.html",h=window.location.href,i=window.location.protocol+"//"+window.location.host,j=a&&a.response&&-1!=a.response.message.indexOf("Temporary user interaction")?"Log In to Continue Reacting":"Log In to ReadrBoard",k=b('<iframe id="rdr-xdm-login" src="'+g+"?parentUrl="+h+"&parentHost="+i+"&group_id="+RDR.group.id+"&group_name="+RDR.group.name+'" width="480" height="140" frameborder="0" style="overflow:hidden; width:480px !important;" />');a&&a.response&&-1!=a.response.message.indexOf("organic")&&(j="Signing in is required for custom reactions");var l=RDR.rindow.makeHeader(j);f.find(".rdr_header").replaceWith(l),RDR.rindow.hideFooter(f),f.find("div.rdr_body_wrap").append('<div class="rdr_body" />').append(k)}},killUser:function(){RDR.user={},b.postMessage("killUser",RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"])},rindowUserMessage:{show:function(a){var c=a.rindow,d=a.interactionInfo;if(c){var e=a.msgType||null,f=null,h=45,j=c.height(),k=300,l=c.find(".rdr_body_wrap"),m=c.find("div.rdr_rindow_message"),n=c.find(".rdr_rindow_message_innerwrap"),o=b("div.rdr_otherTagsWrap"),p=c.find(".rdr_rindow_message_tempUserMsg");switch(m.show(),e){case"tempUser":var q=RDR.group.temp_interact-parseInt(a.num_interactions,10),r=b('<a href="javascript:void(0);">Connect with Facebook</a>.');r.click(function(){RDR.session.showLoginPanel(a)});var s="You can react or comment <strong>"+q+" more times</strong> before you must ";p.empty().append("<span>"+s+"</span>"),p.append(r);break;case"existingInteraction":f="You have already given that reaction for this.";break;case"interactionSuccess":d.remove?(f="The "+d.type+" <em>"+d.body+"</em><br />has been removed.",p.empty()):(f="tag"==d.type?"You have tagged this <em>"+d.body+"</em>.":"comment"==d.type?"You have left your comment.":"",f+=" See your "+d.type+"s on this page, and at <strong><a href='"+RDR_baseUrl+"' target='_blank'>readrboard.com</a></strong>");var t=a;c.find("div.rdr_rindow_message_tempUserMsg").text().length>0&&($inlineTempMsg=b("<div />"),$inlineTempMsg.html('<h4 style="font-size:17px;">You can react '+c.find("div.rdr_rindow_message_tempUserMsg strong").text()+'.</h4><br/><p><a style="font-weight:bold;color:#008be4;" href="javascript:void(0);">Connect with Facebook</a> to react as much as you want &amp; show other readers here what you think.</p><br/><p>Plus, you can share and comment in-line!</p><br/><a href="javascript:void(0);"><img src="'+RDR_staticUrl+'widget/images/fb-login_to_readrboard.png" alt="Connect with Facebook" /></a>'),$inlineTempMsg.find("a").click(function(){RDR.session.showLoginPanel(t)}))}f&&m.find("span.rdr_userMsg").html(f),n.hide(),c.queue("userMessage",function(){m.height()>0?(n.fadeIn(500),b(this).dequeue("userMessage")):(c.animate({height:j+h},k),o.animate({bottom:0},k),l.animate({bottom:h},k),m.animate({height:h},k,function(){n.fadeIn(500),b(this).dequeue("userMessage")}))}),c.dequeue("userMessage")}},hide:function(a){if(a){var c=b("div.rdr_rindow_message");$otherTagsWrap=b("div.rdr_otherTagsWrap");var d=a.find(".rdr_body_wrap"),e=c.height(),f=a.height(),g=300,h=10;a.queue("userMessage",function(){a.animate({height:f-e},g),$otherTagsWrap.animate({bottom:0-h},g),d.animate({bottom:h},g),c.animate({height:0},g,function(){c.hide(),b(this).dequeue("userMessage")})}),a.dequeue("userMessage")}}}},actions:{aboutReadrBoard:function(){},init:function(){var a=this;$RDR=b(RDR),$RDR.queue("initAjax",function(){a.initGroupData(RDR.group.short_name)}),$RDR.queue("initAjax",function(){a.initEnvironment()}),$RDR.queue("initAjax",function(){a.initPageData()}),$RDR.queue("initAjax",function(){RDR.actions.runPostPageInit(),RDR.session.createXDMframe()}),$RDR.queue("initAjax",function(){RDR.util.checkForSelectedTextAndLaunchRindow(),RDR.util.initPublicEvents()}),$RDR.queue("initAjax",function(){RDR.util.initTouchBrowserSettings()}),$RDR.dequeue("initAjax")},initGroupData:function(){b.ajax({url:RDR_baseUrl+"/api/settings/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON({host_name:window.location.hostname})},success:function(a){var e=a.data,f=RDR.groupSettings.getCustomSettings();if(RDR.group=b.extend({},RDR.group.defaults,e,f),RDR.group.hideOnMobile===!0&&isTouchBrowser)return!1;RDR.group.anno_whitelist+=",div.rdr_br_replaced",b(RDR.group.no_readr).each(function(){var a=b(this);a.addClass("no-rdr"),a.find("img").addClass("no-rdr")}),""==RDR.group.active_sections&&(RDR.group.active_sections="body");var g=RDR.group.active_sections.split(","),h="",i=RDR.group.anno_whitelist.split(",");b.each(g,function(a,c){c=b.trim(c),b.each(i,function(a,d){d=b.trim(d),h+=c+" "+d,a!=i.length-1&&(h+=",")}),a!=g.length-1&&(h+=",")}),RDR.group.active_sections_with_anno_whitelist=h,""!==RDR.group.custom_css&&b("head").append(b('<style type="text/css">'+RDR.group.custom_css+"</style>")),$RDR.dequeue("initAjax")},error:function(){}})},initPageData:function(){var a=RDR.util.getQueryStrFromUrl(RDR.engageScriptSrc);RDR.engageScriptParams=RDR.util.getQueryParams(a);var c=RDR.engageScriptParams.bookmarklet&&!b(".rdr-page-summary").length&&!b(RDR.group.summary_widget_selector).length;c&&b('<div id="rdr-page-summary" class="rdr no-rdr rdr-page-summary defaultSummaryBar"/>').appendTo("body");var f,g,h,i,j,d=[],e=[],k={};""!==RDR.group.post_selector&&""!==RDR.group.post_href_selector&&""!==RDR.group.summary_widget_selector&&b(RDR.group.post_selector).each(function(){var a=d.length,c=b(this),g=c.find(RDR.group.post_href_selector),i=c.find(RDR.group.summary_widget_selector);g.attr("href")&&(h=g.attr("href"),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),-1==h.indexOf(window.location.origin)&&(h="/"==h.substr(0,1)?window.location.origin+h:window.location.origin+window.location.pathname+h),e.push(h),f={group_id:parseInt(RDR.group.id,10),url:h,canonical_url:"same",title:g.text()},d.push(f),k[a]=f,c.hasAttr("rdr-page-container")||c.attr("rdr-page-container","true").attr("rdr-page-key",a),i.attr("rdr-page-widget-key",a))});var l=window.location.href.split("#")[0];if((-1==b.inArray(l,e)||0==e.length)&&(i=b('link[rel="canonical"]').length>0?b('link[rel="canonical"]').attr("href"):l,j=b('meta[property="og:title"]').attr("content")?b('meta[property="og:title"]').attr("content"):b("title").text()?b("title").text():"",f={group_id:parseInt(RDR.group.id,10),url:l,canonical_url:l==i?"same":i,title:j},d.push(f),g=d.length-1,k[g]=f,!b("body").hasAttr("rdr-page-container")))if(b("body").attr("rdr-page-container","true").attr("rdr-page-key",g),1==b(".rdr-page-summary").length)b(".rdr-page-summary").attr("rdr-page-widget-key",g);else{var m=b("body").find(RDR.group.summary_widget_selector).eq(0);"0"!=m.attr("rdr-page-widget-key")&&m.attr("rdr-page-widget-key",g)}var n={pages:d};b.ajax({url:RDR_baseUrl+"/api/page/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(n)},success:function(a){b.each(a.data,function(a,b){b.key=a,b.url=k[a].url,RDR.actions.pages.save(b.id,b),RDR.actions.pages.initPageContainer(b.id)}),$RDR.dequeue("initAjax")},error:function(){}})},runPostPageInit:function(){function g(a){var c=b(a),d=c.data("hash");c.removeClass("rdr_live_hover"),b("#rdr_indicator_"+d).hide()}var a=RDR.group.img_blacklist&&""!=RDR.group.img_blacklist?":not("+RDR.group.img_blacklist+")":"";if(isTouchBrowser){if(b(RDR.group.active_sections).find("embed[rdr-node], video[rdr-node], object[rdr-node], iframe[rdr-node], img[rdr-node]").each(function(){RDR.actions.indicators.init(b(this).attr("rdr-hash"))}),!b.cookie("hideDoubleTapMessage")&&!RDR.group.hideDoubleTapMessage){var c=RDR.group.doubleTapMessage?RDR.group.doubleTapMessage:"<strong>Double-tap</strong> any paragraph to respond!<a>Close this</a>",d=RDR.group.doubleTapMessagePosition?"rdr_"+RDR.group.doubleTapMessagePosition:"rdr_bottom",e=b('<div class="rdr rdr_mobile_message">'+c+"</div>"),f=b("#rdr_sandbox");e.addClass(d).on("tap",function(){b.cookie("hideDoubleTapMessage",!0),b(this).remove()}).appendTo(f)}}else b(RDR.group.active_sections).on("mouseenter","embed, video, object, iframe, img"+a,function(){var a=b(this),c=a.data("hash");if(RDR.actions.indicators.utils.updateContainerTrackers(),!a.closest(".no-rdr").length){var d=160;if(a.width()>=d){var e=a.hasAttr("rdr-hashed"),f=a.closest(".rdr, .no-rdr").length;if(a.addClass("rdr_live_hover"),e||f){var c=a.data("hash");a.addClass("rdr_live_hover"),b("#rdr_indicator_details_"+c).hasClass("rdr_engaged")||b("#rdr_indicator_"+c).show(),RDR.actions.content_nodes.init(c,function(){})}else{var c,g=RDR.actions.hashNodes(b(this));if(b.each(g,function(a,b){c=b[0]}),!c)return RDR.safeThrow("There should always be a hash from hashNodes after hover on an unhashed image."),void 0;RDR.actions.sendHashes(g,function(){a.hasClass("rdr_live_hover")&&(b("#rdr_indicator_details_"+c).hasClass("rdr_engaged")||b("#rdr_indicator_"+c).show())})}}}}).on("mouseleave","embed, video, object, iframe, img"+a,function(){var c=b(this);c.parents(RDR.group.img_container_selectors).length||g(c)})},initEnvironment:function(){var a=b('<div id="rdr_sandbox" class="rdr rdr_sandbox"/>').appendTo("body");isTouchBrowser&&b("#rdr_sandbox").addClass("isTouchBrowser"),RDR.util.fixBodyBorderOffsetIssue(),RDR.group.br_replace_scope_selector&&RDR.util.fixBrTags();var c={paddingLeft:-1!=b("body").css("padding-left").indexOf("%")?b(window).width()*(parseInt(b("body").css("padding-left"))/100):parseInt(b("body").css("padding-left")),marginLeft:-1!=b("body").css("margin-left").indexOf("%")?b(window).width()*(parseInt(b("body").css("margin-left"))/100):parseInt(b("body").css("margin-left")),left:-1!=b("body").css("left").indexOf("%")?b(window).width()*(parseInt(b("body").css("left"))/100):parseInt(b("body").css("left")),paddingLeft:-1!=b("body").css("padding-top").indexOf("%")?b(window).width()*(parseInt(b("body").css("padding-top"))/100):parseInt(b("body").css("padding-top")),marginTop:-1!=b("body").css("margin-top").indexOf("%")?b(window).width()*(parseInt(b("body").css("margin-top"))/100):parseInt(b("body").css("margin-top")),top:-1!=b("body").css("top").indexOf("%")?b(window).width()*(parseInt(b("body").css("top"))/100):parseInt(b("body").css("top"))},d=-(c.marginLeft+c.left+c.paddingLeft),e=-(c.marginTop+c.top+c.paddingTop);d=isNaN(d)?0:d,e=isNaN(e)?0:e;var f=parseInt(a.css("top"),10),g=parseInt(a.css("left"),10);RDR.util.cssSuperImportant(a,{left:g+d+"px",top:f+e+"px"},!0),a.append("<style>.rdr_twtooltip { margin-left:"+d+"px !important; margin-top:"+e+"px !important; } </style>"),b('<div id="rdr_container_tracker_wrap" /><div id="rdr_indicator_details_wrapper" /><div id="rdr_event_pixels" />').appendTo(a),b(document).on("mouseup.rdr",function(a){setTimeout(function(){RDR.actions.startSelectFromMouseUp(a)},1)}),b(document).on("mousedown.rdr",function(a){var c=b(a.target);(c.closest(".rdr_inline").length||!c.parents().hasClass("rdr")&&!b("div.rdr-board-create-div").length)&&(RDR.actions.UIClearState(),isTouchBrowser||b("div.rdr_indicator_details_for_media").each(function(){RDR.actions.containers.media.onDisengage(b(this).data("container"))}))}),b(document).on("keyup.rdr",function(a){"27"==a.keyCode&&RDR.actions.UIClearState()}),b(window).resize(RDR.util.throttledUpdateContainerTrackers()),$RDR.dequeue("initAjax")},reInit:function(){RDR.actions.hashCustomDisplayHashes()},UIClearState:function(){b("div.rdr_twtooltip").remove(),RDR.rindow.closeAll(),RDR.actionbar.closeAll(),RDR.actions.containers.media.disengageAll(),b("div.rdr.rdr_tag_details.rdr_sbRollover").remove(),isTouchBrowser||b("div.rdr_indicator_for_media").hide(),b().selog("hilite",!0,"off");var a=b(".rdr_fromShareLink").length;a&&RDR.session.alertBar.close("fromShareLink")},catchRangyErrors:function(a){RDR.safeThrow(a)},hashNodes:function(a){if("undefined"!=typeof a){var d=b(),e=[{kind:"media",$group:null,whiteList:RDR.group.media_selector,filterParam:"embed, video, object, iframe",setupFunc:function(){var a=this.src;b(this).data({body:a})}},{kind:"img",$group:null,whiteList:RDR.group.img_selector,filterParam:"img",setupFunc:function(){var a=this.src;b(this).data({body:a})}},{kind:"text",$group:null,whiteList:RDR.group.active_sections_with_anno_whitelist,filterParam:function(a,c){return b(c).text()!=b(c).parent().text()?!!b(c).text():void 0},setupFunc:function(){var a=RDR.util.getCleanText(this);b(this).data("body",a)}},{kind:"custom",$group:null,whiteList:"",filterParam:function(){var d=b(this);return!!d.hasAttr("rdr-src")},setupFunc:function(){var a=b(this),c=a.attr("rdr-src");a.data({body:c})}}];if(b.each(e,function(c,e){var f=a.filter(e.filterParam);f=f.add(a.find(e.whiteList)),RDR.group.br_replace_scope_selector&&"text"==e.kind&&(f=f.add(a.find(".rdr_br_replaced"))),f=f.not(d),"text"==e.kind&&(f=f.not(RDR.group.media_selector+", "+RDR.group.img_selector)),f=f.not("[rdr-hashed], .no-rdr, #rdr_sandbox"),e.$nodes=f,f.each(function(){e.setupFunc.apply(this),b(this).data("kind",e.kind)}),d=d.add(f);var g=d.filter(RDR.group.inline_selector);g.each(function(){b(this).data("inlineIndicator",!0)})}),!d.data("body"))return!1;var f={};return d.each(function(){var h,i,j,a=b(this),c=a.data("body"),d=a.data("kind"),e=a.get(0).nodeName.toLowerCase(),g=c;if(!a.closest(".no-rdr").length){if("img"!=d&&"media"!=d||!c){if(!c)return;j="rdr-"+d+"-"+c,h=RDR.util.md5.hex_md5(j)}else{j="rdr-"+d+"-"+g,i=RDR.util.md5.hex_md5(j),a.data("oldHash",i);var k=/[-\w]+\.(?:[-\w]+\.xn--[-\w]+|[-\w]{3,}|[-\w]+\.[-\w]{2})$/i,l=g.split("/");l.splice(0,2);var m=l.shift();if(!m)return;var n=m.split(":")[0],o=l.join("/"),p=k.exec(n);if(null==p)return;g=p[0]+"/"+o;var q=["soundcloud.com"];b.each(q,function(a,b){-1!=g.indexOf(b)&&(RDR.group.media_url_ignore_query=!1)}),RDR.group.media_url_ignore_query&&g.indexOf("?")&&(g=g.split("?")[0]),a.hasAttr("rdr-oldhash")?h=a.data("hash"):(j="rdr-"+d+"-"+g,h=RDR.util.md5.hex_md5(j))}if(a.parents('[rdr-hash="'+h+'"]').length){var r=a.parents('[rdr-hash="'+h+'"]');RDR.actions.stripRdrNode(r)}if("img"==a.get(0).nodeName.toLowerCase()&&a.parents("[rdr-hash]").length&&!a.find(RDR.group.anno_whitelist).length){var r=a.parents("[rdr-hash]");RDR.actions.stripRdrNode(r)}RDR.actions.containers.save({body:c,kind:d,hash:h,HTMLkind:e,$this:a}),a.attr("rdr-hash",h).attr("rdr-node","true"),"body"!=e&&a.on("mouseenter",function(){RDR.actions.indicators.init(h),b(this).addClass("rdr_live_hover")}).on("mouseleave",function(){b(this).removeClass("rdr_live_hover")});var t=RDR.actions.summaries.init(h);RDR.actions.summaries.save(t);var u=RDR.util.getPageProperty("id",h);f[u]||(f[u]=[]),f[u].push(h),a.data("hash",h)}}),f}},sendHashes:function(a,c){b.each(a,function(a,d){if(!a||"object"!=typeof d)return RDR.safeThrow("No more messy hashes allowed!!"),void 0;b.each(b("[rdr-custom-display]"),function(a,c){var e=b(c);if("undefined"==typeof e.data("rdr-hashed")){var f=e.attr("rdr-hash");d=b.grep(d,function(a){return a!=f}),d.push(f),RDR.actions.indicators.init(f),e.data("rdr-hashed",!0)
}}),b.each(d,function(a,c){if("string"!=typeof c)return RDR.safeThrow("why is your hash not a string!?"),void 0;var d=b('[rdr-hash="'+c+'"]');1==d.length&&d.attr("rdr-hashed","true")});var e=parseInt(a,10);isNaN(e)&&RDR.safeThrow("why is the pageID NAN ??: "+a+"-->"+e);var f=[];b.each(b('[rdr-crossPageContent="true"]'),function(a,c){var e=b(c).attr("rdr-hash");f.push(e),d=b.grep(d,function(a){return a!=e}),RDR.actions.indicators.init(e)}),RDR.actions.sendHashesForSinglePage({short_name:RDR.group.short_name,pageID:e,hashes:d,crossPageHashes:f},c)})},sendHashesForSinglePage:function(a,c){var d=a.pageID;b.ajax({url:RDR_baseUrl+"/api/summary/containers/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(a)},success:function(a){if("undefined"!=typeof a&&"undefined"!=typeof a.data){"undefined"!=typeof a.data.known&&(RDR.known_hashes=a.data.known),"undefined"!=typeof a.data.crossPageKnown&&("undefined"!=typeof a.data.known&&(RDR.known_hashes=b.extend(RDR.known_hashes,a.data.crossPageKnown)),RDR.crosspage_hashes=a.data.crossPageKnown),b.each(b('[rdr-crossPageContent="true"]'),function(a,c){var d=b(c).attr("rdr-hash"),e={hash:d,counts:{coms:0,tags:0,interactions:0},top_interactions:{coms:[],tags:{}}};"undefined"!=typeof RDR.crosspage_hashes&&(RDR.crosspage_hashes={}),RDR.crosspage_hashes[d]=e});var e={};e[d]=a.data.known,b.each(a.data.unknown,function(a,c){if("string"!=typeof c)return RDR.safeThrow("why would this not be a string?"),void 0;var f,g=b('[rdr-hash="'+c+'"]'),h=g.data("kind");h||RDR.safeThrow("node should always have data: kind"),f=RDR.util.makeEmptySummary(c,h),e[d][c]=f}),b.isEmptyObject(e)||(RDR.actions.containers.setup(e),"undefined"!=typeof c&&c());var f=[];b.each(a.data.crossPageKnown,function(a,b){f.push(b.hash)}),b.each(b("[rdr-custom-display]"),function(a,c){f.push(b(c).data("hash"))}),RDR.actions.containers.initCustomDisplayHashes(f)}}})},hashCustomDisplayHashes:function(){var a={},c=RDR.util.getPageProperty();a[c]=[],b("[rdr-custom-display]").length&&b.each(b("[rdr-custom-display]"),function(d,e){var f=b(e);RDR.actions.hashNodes(f);var g=f.attr("rdr-hash");a[c].push(g),RDR.actions.indicators.init(g)}),RDR.actions.sendHashes(a)},comments:{makeCommentBox:function(a,c){var d=a.content_node,e=a.tag;a.summary,a.hash,a.$rindow,a.selState,c=c||{};var j=c.helpText||"Add comments or #hashtags";c.cta||"Leave a comment";var l=b('<div class="rdr_commentBox rdr_clearfix"></div>'),m=b('<div class="rdr_comment">'),n=b('<textarea class="rdr_default_msg">'+j+"</textarea>"),o=b('<div class="rdr_charCount">'+RDR.group.comment_length+" characters left</div>"),p=b('<button class="rdr_commentSubmit">Comment</button>');return m.append(n,o,p),n.focus(function(){RDR.events.track("start_comment_lg::"+d.id+"|"+e.id),b(this).removeClass("rdr_default_msg"),b(this).val()==j&&b(this).val("")}).blur(function(){var a=b(this).val();(""===a||a===j)&&(b(this).addClass("rdr_default_msg"),b(this).val(j))}).keyup(function(a){var c=n.val();return"27"==a.keyCode?(b(this).blur(),!1):(c.length>RDR.group.comment_length&&(c=c.substr(0,RDR.group.comment_length),n.val(c)),n.siblings("div.rdr_charCount").text(RDR.group.comment_length-c.length+" characters left"),void 0)}),p.click(function(){b.extend(a,{$commentTextarea:n,helpText:j}),RDR.actions.comments.submitComment(a)}),l.append(m),l},submitComment:function(a){var c=a.$commentTextarea,d=a.helpText,e=a.content_node,f=a.summary,g=a.hash,h=a.tag,i=a.$rindow,j=a.selState,k=c.val();if(k.length>RDR.group.comment_length&&(k=k.substr(0,RDR.group.comment_length),c.val(k),c.siblings("div.rdr_charCount").text(RDR.group.comment_length-k.length+" characters left")),k!=d){if(b.isEmptyObject(e)&&"img"==f.kind)e={body:b("img.rdr-"+f.hash).get(0).src,kind:f.kind,hash:f.hash};else{var l=b('[rdr-hash="'+f.hash+'"]'),m=l.attr("rdr-content-type");e.kind=m?"media"==m?"media":"image"==m?"img":"text":"text"}var n={hash:g,content_node_data:e,comment:k,content:e.body,tag:h,rindow:i,selState:j};RDR.actions.interactions.ajax(n,"comment","create")}else c.focus();return!1}},containers:{updateCrossPageHash:function(a){var c=b('[rdr-hash="'+a+'"]').length>0;if(c){RDR.actions.indicators.init(a);var d=b('[rdr-hash="'+a+'"]'),e=d.attr("rdr-custom-display"),f=b('[rdr-grid-for="'+e+'"]');f.length&&RDR.actions.content_nodes.init(a,function(){RDR.actions.indicators.utils.makeTagsListForInline(f,!1),f.jScrollPane({showArrows:!0})})}},initCustomDisplayHashes:function(a){b.each(a,function(a,c){var d=b('[rdr-hash="'+c+'"]');if("undefined"!=typeof c&&"undefined"==typeof d.attr("rdr_summary_loaded")){RDR.actions.indicators.init(c),RDR.summaries[c].crossPage=!0;var e=b('[rdr-hash="'+c+'"]'),f=e.attr("rdr-custom-display"),g=b('[rdr-grid-for="'+f+'"]'),h=g.width(),i=g.height();if(200>i&&(i=200,g.height(i)),RDR.util.cssSuperImportant(g,{height:i+"px"}),g.length){var j=parseInt(h/160);h=160*j,h>960&&(h=960),g.closest(".rdr_grid_wrapper").length||g.wrap('<div class="rdr_grid_wrapper" style="width:'+h+"px;height:"+i+'px;"></div>'),g.data("hash",c).data("container",c).addClass("w"+h).html('<div class="rdr rdr_window rdr_inline w'+h+' rdr_no_clear" style="position:relative !important;"><div class="rdr rdr_header"><div class="rdr_header_arrow"><img src="'+RDR_staticUrl+'widget/images/header_up_arrow.png"></div><div class="rdr_loader"></div><div class="rdr_about"><a href="http://www.readrboard.com/" target="_blank">&nbsp;</a></div><div class="rdr_indicator_stats"><img class="no-rdr rdr_pin" src="'+RDR_staticUrl+'widget/images/blank.png"><span class="rdr_count"></span></div><h1>Reactions</h1></div><div class="rdr rdr_body_wrap rdr_clearfix"></div></div>'),RDR.actions.content_nodes.init(c,function(){RDR.actions.indicators.utils.makeTagsListForInline(g,!1),g.jScrollPane({showArrows:!0})})}else RDR.actions.content_nodes.init(c)}})},media:{onEngage:function(a){return},onDisengage:function(a){return},disengageAll:function(){var a=[];b(".rdr_live_hover").each(function(){var c=b(this).data("hash");a.push(c),RDR.actions.containers.media.onDisengage(c)})}},save:function(a){if(RDR.containers.hasOwnProperty(a.hash))return RDR.containers[a.hash];var b="undefined"==typeof a.id||null===a.id?null:a.id,c={id:b,body:a.body||null,kind:a.kind,hash:a.hash,HTMLkind:a.HTMLkind||null,$this:a.$this||null};return RDR.containers[a.hash]=c,c},setup:function(a){var c={img:function(a,b){var c=RDR.containers[a],d=c.$this,e=d[0].src,f={body:e,kind:b.kind,container:a,hash:a};RDR.content_nodes[a]=f,RDR.rindow.update(a),isTouchBrowser&&(RDR.actions.content_nodes.init(a,function(){}),RDR.actions.indicators.init(a))},media:function(a,b){this.img(a,b)},text:function(){},custom:function(){}},d=[];b.each(a,function(a,e){return!e||b.isArray(e)?(RDR.safeThrow("For godsake no. This should not be an array of hashes and it should not be the bastard cruft of some frankenpage object."),void 0):(b.each(e,function(e,f){f.hash=e;var g=RDR.containers[e];if(g){g.$this;var i={},j=f.top_interactions.coms;b.each(j,function(a,b){"text"==f.kind?i[b.tag_id]=b:(i[b.tag_id]||(i[b.tag_id]=[]),i[b.tag_id].push(b))}),f.top_interactions.coms=i,RDR.actions.summaries.save(f);var k=!1;b.each(RDR.pages[a].containers,function(a,b){b.hash==e&&(k=!0)}),0==k&&RDR.pages[a].containers.push({hash:e,id:f.id});var l=f.kind;"page"!=l&&c[l](e,f),f.counts.tags>0&&d.push(e)}}),void 0)}),RDR.actions.summaries.sortPopularTextContainers(),RDR.actions.summaries.displayPopularIndicators(),b.each(RDR.known_hashes,function(a){var d=b('img[rdr-node="returnedHash"]');d.length&&d.data("oldHash")==a&&d.attr("rdr-hash",a).attr("rdr-oldhash","true").data("hash",a),RDR.actions.indicators.init(a)}),RDR.actions.indicators.show(d)},send:function(a,c){function k(){d={},e=0,f=0}var g,h,d={},e=0,f=0,j=1400;b.each(a,function(a,c){var i=RDR.containers[c],l={HTMLkind:i.HTMLkind,body:"",hash:i.hash,id:i.id,kind:i.kind};h=encodeURIComponent(b.toJSON(l)),g=h.length,g>j?l=!1:(f+=g,f>j&&(RDR.actions.containers._ajaxSend(d),k()),d[c]=l,e+=g)}),b.isEmptyObject(d)||RDR.actions.containers._ajaxSend(d,c)},_ajaxSend:function(a,c){var d=a;b.ajax({url:RDR_baseUrl+"/api/containers/create/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(d)},success:function(a){var d=a.data,e={};b.each(d,function(a,b){if(b){var c=RDR.containers[a];c.id=b,e[a]=RDR.actions.summaries.init(a)}}),RDR.actions.containers.setup(e),"undefined"!=typeof c&&c()}})}},content_nodes:{make:function(a){var c,b=a.hash;if(c=a.location?a.container+"-"+a.location:a.container,RDR.content_nodes.hasOwnProperty(c))return RDR.content_nodes[c];var d={container:a.container,body:a.body,location:a.location,hash:b};return RDR.content_nodes[c]=d,d},quickFixReset:function(a){var b=RDR.summaries[a],c="undefined"!=typeof b?b.id:"";c&&(delete RDR.assetLoaders.content_nodes[c],RDR.actions.content_nodes.init(a))},init:function(a,c){var d=RDR.summaries[a],e="undefined"!=typeof d?d.id:"";if(e){var f=RDR.util.getPageProperty("id",a);d.pageId=f;var g={page_id:f,container_id:e,hash:a,cross_page:d.$container.hasAttr("rdr-crossPageContent")?!0:!1},h=RDR.assetLoaders.content_nodes[e];h||(h=b.ajax({url:RDR_baseUrl+"/api/summary/container/content/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(g)}}),RDR.assetLoaders.content_nodes[e]=h),h.then(function(e){if("success"!==e.status)return!1;var f=e.data;b.each(f,function(c,d){var e=b('[rdr-hash="'+a+'"]');try{d.selState=e.selog("save",{serialRange:d.location})}catch(f){d.selState=void 0}}),RDR.content_nodes[a]=f,d.content_nodes=f,"text"==d.kind||(d.top_interactions.coms={},b.each(f,function(a,c){var e=c.top_interactions.coms;b.each(e,function(a,b){d.top_interactions.coms[b.tag_id]=d.top_interactions.coms[b.tag_id]||[],d.top_interactions.coms[b.tag_id].push(b)})})),b('[rdr-hash="'+a+'"]').attr("rdr_summary_loaded","true"),c&&c(),RDR.contentNodeQueue&&RDR.contentNodeQueue[a]&&RDR.contentNodeQueue[a].length&&b.each(RDR.contentNodeQueue[a],function(){var b=RDR.contentNodeQueue[a].pop();b(a)})})}},utils:{getMediaDims:function(a){var b=a.height(),c=a.width();return b&&c?{height:b,width:c}:{}},makeDictSortedByTag:function(a){var c={};return b.each(a,function(a,d){b.each(d.top_interactions.tags,function(a){c.hasOwnProperty(a)||(c[a]=[]),c[a].push(d)})}),c},initHiliteStates:function(a,c){b.each(c,function(b,c){c.selState&&a.data("selStates").push(c.selState)}),isTouchBrowser||a.hover(function(){var a=b(this).data("selStates"),c=a.length?a[a.length-1]:null;c&&b().selog("hilite",c,"on")},function(){var a=b(this).data("selStates"),c=a.length?a[a.length-1]:null;c&&b().selog("hilite",c,"off")})}}},interactions:{ajax:function(a,c,d){var e=a.hash,f=RDR.summaries[e];if(f?f.kind:"",d||(d="create"),!RDR.actions.interactions.hasOwnProperty(c))return!1;var h={};RDR.actions.interactions[c].preAjax(a,d),RDR.session.getUser(a,function(a){var f=RDR.actions.interactions.defaultSendData(a),g=RDR.actions.interactions[c].customSendData(a),i=b.extend({},f,g,h);a.sendData=i,a.hash=e,a.sendData.hash=e,RDR.actions.interactions.send(a,c,d)})},send:function(a,c,d){var e=b.extend(!0,{},a.sendData);e.rindow&&delete e.rindow,e.settings&&delete e.settings,e.selState&&delete e.selState,e.content_node&&delete e.content_node,e.content_node_data&&e.content_node_data.selState&&delete e.content_node_data.selState,e.content_node_data&&e.content_node_data.counts&&delete e.content_node_data.counts,e.content_node_data&&e.content_node_data.top_interactions&&delete e.content_node_data.top_interactions,e.content_node_data&&e.content_node_data.$container&&delete e.content_node_data.$container,e.content_node_data&&e.content_node_data.$indicator&&delete e.content_node_data.$indicator,e.content_node_data&&e.content_node_data.$indicator_details&&delete e.content_node_data.$indicator_details,e.content_node_data&&e.content_node_data.$rindow_readmode&&delete e.content_node_data.$rindow_readmode,e.node&&delete e.node,e.uiMode&&delete e.uiMode,e.sendData&&delete e.sendData,RDR.summaries[e.hash]&&(e.container_kind=RDR.summaries[e.hash].kind),e.content_node_data&&e.content_node_data.container&&delete e.content_node_data.container;var f="react"==c?"tag":c;"undefined"!=typeof e.tag&&(e.tag.body=e.tag.body?e.tag.body:e.tag.tag_body),"page"==e.kind&&(e.hash="page",e.container_kind="text",e.page_id=e.page_id||RDR.util.getPageProperty("id","page"),delete e.content_node_data.hash);var g=RDR_baseUrl+"/api/"+f+"/"+d+"/",h=RDR.session.checkForMaxInteractions(a);h?RDR.session.showLoginPanel(a,function(){RDR.actions.interactions.ajax(a,c,"create")}):b.ajax({url:g,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(e)},success:function(b){a.response=b,b.data&&b.data.container&&(a.container_id=b.data.container.id,a.hash=b.data.container.hash),b.data&&b.data.num_interactions&&(RDR.user.num_interactions=b.data.num_interactions),"success"==b.status?(a.response.data.interaction||a.response.data.deleted_interaction,a.response.data.deleted_interaction&&(a.deleted_interaction=a.response.data.deleted_interaction),a.scenario=a.response.data.existing?"reactionExists":a.response.data.deleted_interaction?"tagDeleted":"reactionSuccess","undefined"==typeof a.tag.id&&(a.tag.id=b.data.interaction.interaction_node.id),RDR.actions.interactions[c].onSuccess[d](a)):"react"==c?"sign in required for organic reactions"==b.message?RDR.session.showLoginPanel(a):RDR.actions.interactions[c].onFail(a):(-1!=b.message.indexOf("Temporary user interaction limit reached")&&RDR.session.showLoginPanel(a),"existing interaction"==b.message?(a.msgType="existingInteraction",RDR.session.rindowUserMessage.show(a)):RDR.session.handleGetUserFail(a,function(){RDR.actions.interactions.ajax(a,c,"create")})),RDR.util.userLoginState()}})},defaultSendData:function(a){return a.user_id=RDR.user.user_id,a.readr_token=RDR.user.readr_token,a.group_id=RDR.group.id,a.page_id=a.page_id?a.page_id:RDR.util.getPageProperty("id",a.hash),a},comment:{preAjax:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","visible")},customSendData:function(){},onSuccess:{create:function(a){var c=a.rindow,d=a.hash,e=a.response;if(a.tag,c){c.find("div.rdr_loader").css("visibility","hidden"),RDR.actions.content_nodes.quickFixReset(d),c.hasClass("rdr_inline")||c.find(".rdr_inline").length;var h=b('<span class="success_msg" >Thanks for your comment! </span>'),i=b('<a class="rdr_doneButton" href="#">Close</a>').click(function(a){a.preventDefault(),RDR.rindow.safeClose(c)}),j=b(".rdr_subheader").length;j?(b(".rdr_nextActions").remove(),c.find(".rdr_subheader").empty().append(h).append(i)):c.find(".rdr_commentBox").empty().append(h).append(i)}var k=e.data.interaction,l=e.data.content_node?e.data.content_node:e.content_node_data?e.content_node_data:a.content_node_data,m=l&&l.id?l.id:"",n=e.data.num_interactions,o="text"==l.kind||"txt"==l.kind,p=e.data.existing;if(!o&&p){var q=RDR.content_nodes[d];b.each(q,function(a,b){a&&"undefined"!=a&&(l=b,m=l.id)})}var r=parseInt(a.tag.id,10),s={delta:1,num_interactions:n,id:k.id,body:k.interaction_node.body,content_node:l,content_id:m,tag_id:r,user:a.user,social_user:a.social_user,parent_id:null,parent_interaction_node:a.tag},t={coms:{}};t.coms[r]=s,RDR.actions.content_nodes.init(d,function(){RDR.actions.summaries.update(d,t)}),RDR.util.triggerPublicEvent("comment")},remove:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","hidden")}},onFail:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","hidden")}},share:{preAjax:function(){var a=args.rindow;a&&a.find("div.rdr_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","hidden")},onFail:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","hidden")}},boardadd:{preAjax:function(){var a=args.rindow;a&&a.find("div.rdr_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:{create:function(a){var c=a.rindow?a.rindow:b("div.rdr_tag_details.rdr_reacted.rdr_live_hover");c.find("div.rdr_loader").css("visibility","hidden");var d=a.board_name.replace(/\s/g,"_"),f=({board_id:a.board_id,int_id:a.int_id},b('<div class="rdr_success">Success!  See <a target="_blank" href="'+RDR_baseUrl+"/board/"+a.board_id+"/"+d+'" class="rdr_seeit_link">your board.</a> <a href="javascript:void(0);" class="rdr_seeit_link rdr_undo">Undo?</a></div>'));c.find(".rdr_select_user_board").append(f).find("select").hide(),f.find("a.rdr_undo").click(function(){a.rindow=c,RDR.actions.interactions.ajax(a,"boarddelete","create")})}}},boarddelete:{preAjax:function(){var a=args.rindow;a&&a.find("div.rdr_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:{create:function(a){var b=a.rindow;b&&b.find("div.rdr_loader").css("visibility","hidden")}}},react:{preAjax:function(a){var c=a.rindow;c&&c.find("div.rdr_loader").css("visibility","visible")},customSendData:function(a){var e,f,g,c=a.hash,d=RDR.summaries[c],h="page"==c||a.kind&&"page"==a.kind;if(h)e="page",f=a.tag,l={container:c,body:"",kind:e,hash:c},g={tag:f,node:null,content_node_data:l,hash:c,user_id:RDR.user.user_id,readr_token:RDR.user.readr_token,group_id:RDR.group.id,page_id:a.page_id?a.page_id:RDR.util.getPageProperty("id",c)};else{e=d.kind;var i=b('[rdr-hash="'+c+'"]'),j=a.rindow;a.tag,f="function"==typeof a.tag.data?a.tag.data("tag"):a.tag;var l={},m=a.content_node||null;if("custom"==e)l={container:j.data("container"),body:i.attr("rdr-src"),kind:"media",location:i.get(0).nodeName.toLowerCase(),hash:c};else if("img"==e||"media"==e||"med"==e){var n=i[0].src;RDR.group.media_url_ignore_query&&n.indexOf("?")&&(n=n.split("?")[0]),l={container:j.data("container"),body:n,kind:e,hash:c};var o=RDR.actions.content_nodes.utils.getMediaDims(i);b.extend(l,o)}else if(m)l={container:j.data("container"),body:m.body,location:m.location,kind:e,id:m.id};else{var p=j.find("div.rdr_tag_"+f.id).data("content_node_id"),q=p?d.content_nodes[p].selState:j.data("selState");if(!q)return RDR.safeThrow("selState not found:  I cannot figure out why this happens every once in a while"),void 0;l={container:j.data("container"),body:q.text,location:q.serialRange,kind:e}}g={tag:f,node:m,content_node_data:l,hash:l.container,user_id:RDR.user.user_id,readr_token:RDR.user.readr_token,group_id:RDR.group.id,page_id:RDR.util.getPageProperty("id",c),int_id:a.int_id}}return g},onSuccess:{create:function(a){function x(a){var b={kind:"page",page_id:a.page_id,id:a.response.data.interaction.interaction_node.id,parent_id:null,parent_interaction_node:null,content_id:null,body:a.response.data.interaction.interaction_node.body,delta:1,user:a.user,social_user:a.social_user},c={tags:{}};c.tags[b.id]=b,RDR.actions.summaries.update(a.hash,c,!0,a.page_id)}var c=a.rindow,e=(c.data("mode")||"writeMode",a.response),g=(e.interaction,e.data.interaction.interaction_node),h=e.data.container,i=a.sendData,j=i.content_node_data,k="function"==typeof a.tag.data?a.tag.data("tag"):a.tag;if(e.data.interaction.id,b("#rdr_loginPanel").remove(),c&&c.find("div.rdr_loader").css("visibility","hidden"),b('[rdr-hash="'+n+'"]').removeAttr("rdr_summary_loaded"),b(".rdr_twtooltip").remove(),a.kind&&"page"==a.kind){var m=a.response.data.existing;m||x(a),RDR.actions.viewReactionSuccess(a)}else{var n=a.hash,o=RDR.summaries[n];o.kind,a.settings=a.sendData.content_node_data;var q=i.content_node_data;q.hash=q.container,q.kind=i.kind,"undefined"==typeof o.content_nodes&&(o.content_nodes={});var r=RDR.containers[n];r&&h&&h.id&&(r.id=h.id),"undefined"==typeof o.content_nodes[j.id]?o.content_nodes[j.id]={body:j.body,counts:{coms:0,tags:1,interactions:1},id:j.id,kind:j.kind,location:i.content_node_data.location,selState:!1,top_interactions:{coms:{},tags:{}}}:"reactionExists"!=a.scenario&&(o.content_nodes[j.id].counts.tags++,o.content_nodes[j.id].counts.interactions++),"undefined"==typeof o.content_nodes[j.id].top_interactions.tags[k.id]?o.content_nodes[j.id].top_interactions.tags[k.id]={count:1,body:k.body,parent_id:null}:"reactionExists"!=a.scenario&&o.content_nodes[j.id].top_interactions.tags[k.id].count++,q=a.content_node||RDR.actions.content_nodes.make(q),o.id=o.id||a.container_id;var s={id:g.id,parent_id:null,parent_interaction_node:k,content_id:null,body:g.body,delta:1,user:a.user,social_user:a.social_user},t={tags:{}};t.tags[s.id]=s,"reactionExists"!=a.scenario&&RDR.actions.summaries.update(n,t),RDR.actions.viewReactionSuccess(a)}RDR.util.triggerPublicEvent("tag",{body:a.tag.body,hash:a.hash,kind:a.kind})},remove:function(a){var b=a.sendData,c=a.response.data.deleted_interaction.interaction_node,d=a.rindow;a.tag,a.int_id,d&&d.find("div.rdr_loader").css("visibility","hidden");var g=b.hash,h={id:c.id,parent_id:null,content_id:null,body:c.body,delta:-1,user:a.user,social_user:a.social_user},i={tags:{}};i.tags[h.id]=h;var j="page"==a.kind||"page"==g;j?RDR.actions.summaries.update(g,i,j,a.page_id):RDR.actions.summaries.update(g,i);var k={msgType:"interactionSuccess",interactionInfo:{type:"tag",body:c.body,remove:!0},rindow:d};d.queue("userMessage",function(){RDR.session.rindowUserMessage.show(k)}),j?RDR.rindow.updatePageTagMessage(a,"tagDeleted"):RDR.rindow.updateTagMessage({rindow:d,tag:a.tag,scenario:"tagDeleted",args:a})}},onFail:function(a){var b=a.rindow,c=a.response;b&&b.find("div.rdr_loader").css("visibility","hidden"),-1!=c.message.indexOf("Temporary user interaction limit reached")?(RDR.session.receiveMessage(a,function(){RDR.actions.interactions.ajax(a,"react","create")}),RDR.session.showLoginPanel(a)):"existing interaction"==c.message?(a.msgType="existingInteraction",RDR.session.rindowUserMessage.show(a)):RDR.session.handleGetUserFail(a,function(){RDR.actions.interactions.ajax(a,"react","create")})}}},indicators:{show:function(a,c){c=!0;var d=this.fetch(a);1==d.length&&d.removeClass("rdr_dont_show");var e=b.browser.msie?"1":RDR.C.indicatorOpacity;if(!b.browser.msie||b.browser.msie&&parseInt(b.browser.version,10)>8){if(d.not(".rdr_dont_show").css({opacity:"0",visibility:"visible"}),c)return d.not(".rdr_dont_show").css({opacity:e}),void 0;d.filter("div.rdr_indicator_for_text").not(".rdr_dont_show").stop().fadeTo(800,e)}},hide:function(a){var b=this.fetch(a);b.css({opacity:"0",visibility:"hidden"})},fetch:function(a){var c=b();if("string"==typeof a){var d=a;c=b("#rdr_indicator_"+d)}else{var e=a;b.each(e,function(a,d){c=c.add(b("#rdr_indicator_"+d))})}return c},init:function(a){function o(a){return b(a).find(":not(iframe,noscript)").andSelf().contents().filter(function(){return 3==this.nodeType})}function q(){d.$indicator_body=b('<div class="rdr rdr_indicator_body " />').attr("id",h).appendTo(k).append('<img src="'+RDR_staticUrl+'widget/images/blank.png" class="no-rdr rdr_pin" />','<span class="rdr_count" />','<span class="rdr_count_label" />'),k.css("visibility","visible")}function r(){k.on("mouseover.showRindow",function(){s();{k.hasClass("rdr_helper")&&RDR.group.paragraph_helper}})}function s(){if(k.$rindow){if(k.$rindow.data("container")==a)return;k.$rindow.remove()}var b=RDR.rindow.make("readMode",{hash:a}),c=RDR.util.getPageProperty("id",a);b&&(k.$rindow=b,k.data("isZeroCountIndicator")?(t(),RDR.events.trackEventToCloud({category:"engage",action:"rindow_shown_indicatorhelper",opt_label:"kind: text, hash: "+a,container_hash:a,container_kind:"text",page_id:c})):RDR.events.trackEventToCloud({category:"engage",action:"rindow_shown_readmode",opt_label:"kind: text, hash: "+a,container_hash:a,container_kind:"text",page_id:c}))}function t(){var c=k.$rindow,d=RDR.rindow.makeHeader("What do you think?");c.addClass("rdr_helper_rindow"),c.find(".rdr_header").replaceWith(d),d.append('<div class="rdr_header_arrow"><img src="'+RDR_staticUrl+'widget/images/header_up_arrow.png" /></div>'),$rindowBody=b('<div class="rdr_body rdr_visiblePanel" />'),$rindowBody.html(""),c.find("div.rdr_body_wrap").append($rindowBody),RDR.rindow.updateFooter(c,'<span class="rdr_cta_msg">Click to respond</span>'),c.find(".rdr_footer").addClass("rdr_cta").find(".rdr_cta_msg").click(function(){c.remove();var d=b('[rdr-hash="'+a+'"]'),e=d[0];b("document").selog("selectEl",e),c=RDR.rindow.make("writeMode",{hash:a})})}function u(b){k.on("mouseover.contentNodeInit",function(){k.hasAttr("rdr-custom-display")||RDR.actions.content_nodes.init(a,b)})}function v(){k.unbind("mouseover.contentNodeInit"),k.triggerHandler("mouseover.showRindow")}function w(a){a.each(function(){var a=b(this);a.on("mouseover.showRindow",function(){x(a)})})}function x(c){if(k.$rindow){if(k.$rindow.data("container")==a)return;k.$rindow.remove()}var d="write"==c.attr("rdr-mode")?"writeMode":"readMode";if("writeMode"==d){if(f.length)el=f[0];else{var e='[rdr-hash="'+a+'"]';el=b(e)[0]}b("document").selog("selectEl",el)}var g=RDR.rindow.make(d,{hash:a,$custom_cta:c}),h=RDR.util.getPageProperty("id",a);g&&(k.$rindow=g,RDR.events.trackEventToCloud({category:"engage",action:"rindow_shown_"+c.attr("rdr-mode")+"mode",opt_label:"kind: text, hash: "+a,container_hash:a,container_kind:"text",page_id:h}))}var d=RDR.summaries[a];if("undefined"!=typeof d&&d.$container.hasAttr("rdr-node")){var e=d.kind,f=d.$container,g="rdr_indicator_"+a,h="rdr_indicator_body_"+a;if(f.hasAttr("rdr-page-container"))return;if(f.attr("rdr-hasIndicator","true"),f.hasAttr("rdr-custom-display")){var j=f.attr("rdr-custom-display"),k=d.$indicator=f,l=b('[rdr-counter-for="'+j+'"]'),m=b('[rdr-grid-for="'+j+'"]'),n=b('[rdr-cta-for="'+j+'"]');u(),l.length&&l.addClass("rdr_count"),n.length&&(w(n),v()),m.length,RDR.actions.indicators.update(a)}else{b("#rdr_indicator_"+a).remove(),b("#rdr_container_tracker_"+a).remove(),b("#rdr_indicator_details_"+a).remove();var k=d.$indicator=b('<div class="rdr_indicator" />').attr("id",g).data("hash",a);if(q(),!e)return;if(RDR.actions.indicators.utils.kindSpecificSetup[e](a),"text"==e){if(f.find("img").length&&!o(f).length)return RDR.actions.stripRdrNode(f),void 0;f.unbind(".rdr_helper"),isTouchBrowser?"text"==e&&f.on("doubletap",function(){var d=b('[rdr-hash="'+a+'"]'),e=d[0];b("document").selog("selectEl",e),RDR.rindow.make("writeMode",{hash:a})}):(f.bind("mouseenter.rdr_helper",function(){var a=k.hasClass("rdr_helper")&&RDR.group.paragraph_helper;a&&RDR.actions.indicators.helpers.over(k)}),f.bind("mouseleave.rdr_helper",function(){var b=k.hasClass("rdr_helper")&&RDR.group.paragraph_helper;b&&RDR.actions.indicators.helpers.out(k)}));var p=!(d.counts.tags>0);k.data("isZeroCountIndicator",p),p?(k.addClass("rdr_helper"),r()):u(function(){r(),v()})}RDR.actions.indicators.update(a)}}},update:function(a,c){var e=RDR.summaries[a],g=(e.kind,e.$container),h="text"===e.kind;if(g.hasAttr("rdr-custom-display")){var i=g.attr("rdr-custom-display"),j=e.$indicator=g,k=b('[rdr-counter-for="'+i+'"]'),l=b('[rdr-grid-for="'+i+'"]'),m=b('[rdr-cta-for="'+i+'"]');k.length&&(e.counts.tags>0?k.html(RDR.commonUtil.prettyNumber(e.counts.tags)):k.html("0")),m.length,l.length}else{if(c)return h&&g.closest("[rdr-node]").find(".rdr_indicator").remove(),RDR.actions.indicators.init(a),void 0;var j=e.$indicator,n=e.$indicator_body,o=e.$indicator_details,p=n.find(".rdr_count"),q=n.find(".rdr_count_label"),r=o?o.find("div.rdr_header h1"):!1,s=e.counts.tags>0,t=e.counts.tags>1?"Reactions":"Reaction";s?(h?(p.html(RDR.commonUtil.prettyNumber(e.counts.tags)),q.text(t)):p.html(RDR.commonUtil.prettyNumber(e.counts.tags)+" "+t),r&&r.html(RDR.commonUtil.prettyNumber(e.counts.tags)+" Reactions"),RDR.actions.indicators.show(a)):(j.addClass("rdr_no_reactions"),p.html('<span class="rdr_react_label">What do you think?</span>'),h&&(RDR.group.paragraph_helper?(RDR.actions.indicators.show(a),j.addClass("rdr_helper")):RDR.actions.indicators.hide(a)))}},helpers:{over:function(a){var b=a.data("containerHover");b||(RDR.util.cssSuperImportant(a,{display:"inline"}),a.css("opacity",RDR.C.helperIndicators.opacity))},out:function(a){a.data("containerHover",!1);var b=a.data("hoverTimeout");clearTimeout(b),isTouchBrowser||RDR.util.cssSuperImportant(a,{display:"none"})}},utils:{checkTrailingWhiteSpace:function(a){var c=a.children().get().reverse(),d=null,e=!0;return b.each(c,function(){if(e){var c=""==b(this).text();c?d=this:e=!1}}),d},kindSpecificSetup:{img:function(a){function l(){if(b("div.rdr_media_details").not("rdr_loaded").length){var d=c.$indicator_details=b("<div />").attr("id",i).addClass("rdr rdr_indicator_details rdr_widget rdr_widget_bar");b("div.rdr_media_details").html(d),h.addClass("rdr_inline_video"),b("div.rdr_media_details").addClass("rdr_sandbox")}else var d=c.$indicator_details=b("<div />").attr("id",i).addClass("rdr rdr_indicator_details rdr_widget rdr_widget_bar").appendTo("#rdr_indicator_details_wrapper");d.data("container",a),d.data("hash",a),d.data("summary",c),d.addClass("rdr_indicator_details_for_media").click(function(){d.addClass("rdr_live_hover"),RDR.actions.containers.media.onEngage(a)}),e.addClass("rdr_indicator_for_media rdr_indicator_for_media_inline").find(".rdr_indicator_body").append('<div class="rdr_chevron_cta"><i class="rdr_icon-chevron-down"></i></div>'),isTouchBrowser&&e.bind("tap",function(){b(this).toggleClass("rdr_hover")})}var c=RDR.summaries[a],d=c.$container,e=c.$indicator,g=(c.$indicator_body,b("#rdr_container_tracker_wrap")),h=b('<div class="rdr_container_tracker" />'),i="rdr_indicator_details_"+a;if(RDR.util.getPageProperty("id",a),d.width()<160)return RDR.safeThrow("Too small to init."),void 0;if("none"==d.css("display")||"hidden"==d.css("visibility"))return RDR.safeThrow("not visible."),void 0;var k=b("#rdr_container_tracker_"+a);return k.length?(RDR.safeThrow("Images are not expected to get re-inited."),void 0):(h.attr("id","rdr_container_tracker_"+a).appendTo(g),l(),e.appendTo(h),isTouchBrowser?e.bind("tap",function(){0==c.counts.interactions?RDR.rindow.make("writeMode",{hash:a}):RDR.rindow.make("readMode",{hash:a}),b(this).addClass("rdr_live_hover")}):e.on("mouseenter",function(){0==c.counts.interactions?RDR.rindow.make("writeMode",{hash:a}):RDR.rindow.make("readMode",{hash:a}),b(this).addClass("rdr_live_hover")}).on("mouseleave",function(){b(this).removeClass("rdr_live_hover")}),RDR.actions.indicators.utils.updateContainerTracker(a),void 0)},media:function(a){this.img(a)},text:function(a){var c=RDR.summaries[a],d=c.$container,e=c.$indicator;c.$indicator_body,b("rdr_actionbar_"+a),e.addClass("rdr_indicator_for_text").addClass("rdr_dont_show");var h=RDR.actions.indicators.utils.checkTrailingWhiteSpace(d);h?b(h).before(e):e.appendTo(d)}},makeDetailsContent:function(a){var d=RDR.summaries[a],e=d.$container,f=d.$indicator,h=(d.$indicator_body,d.$indicator_details);if(b("rdr_actionbar_"+a),"undefined"!=typeof f){h.find("div.rdr_body_wrap").remove();var j=RDR.rindow.makeDefaultPanelMessage(h),k=RDR.rindow.makeHeader(j),l=b('<div class="rdr rdr_body_wrap rdr_clearfix" />'),m=d.kind,n="img"==m||"image"==m||"imgage"==m||"med"==m||"media"==m;n&&!h.find("div.rdr_view_success").length&&h.data("initialWidth",e.width());var o=h,p=RDR.actions.indicators.utils.makeTagsListForInline(o);l.append(p),h.empty().append(k,l)}},makeTagsListForInline:function(a,c,d){function q(){var a=i.find("div.rdr_box:eq("+o+")");a.addClass("rdr_animated"),o++,o>n&&clearInterval(p)}function r(a){function c(a,b){return b.tag_count-a.tag_count}b.each(a,function(a,b){b.tag_count||(b.tag_count=-101)}),a.sort(c);var d={big:[],medium:[],small:[]},e=a[0].tag_count,f=a[Math.floor(a.length/2)].tag_count,h=(a[a.length-1].tag_count,function(a){var c=0;return b.each(a,function(a,b){c+=b.tag_count}),Math.floor(c/a.length)}(a)),i=f>h?f:h;return b.each(a,function(a,b){return"undefined"!=typeof b.tag_body?b.tag_body:b.body,e>15&&b.tag_count>=Math.floor(.8*e)?(d.big.push(b),void 0):b.tag_count>i?(d.medium.push(b),void 0):(d.small.push(b),void 0)}),d}function s(b){if(b.length){var e=r(b),f=e.big.length+e.medium.length+e.small.length,g=1;for(f>6&&!c?isTouchBrowser?RDR.rindow.tagBox.setWidth(a,320):RDR.rindow.tagBox.setWidth(a,480):"undefined"!=typeof d&&c?RDR.rindow.tagBox.setWidth(a,320):b.length>1&&(e.big.length&&RDR.rindow.tagBox.setWidth(a,320),e.medium.length&&RDR.rindow.tagBox.setWidth(a,320),e.small.length>=3&&RDR.rindow.tagBox.setWidth(a,320));e.big.length||e.medium.length||e.small.length;)if(e.big.length){var h=e.big.shift();
RDR.rindow.tagBox.make({tag:h,boxSize:"big",$rindow:a,isWriteMode:c,colorInt:g}),g++,6==g&&(g=1)}else if(e.medium.length){var h=e.medium.shift();RDR.rindow.tagBox.make({tag:h,boxSize:"medium",$rindow:a,isWriteMode:c,colorInt:g}),g++,6==g&&(g=1)}else if(e.small.length){var h=e.small.shift();RDR.rindow.tagBox.make({tag:h,boxSize:"small",$rindow:a,isWriteMode:c,colorInt:g}),g++,6==g&&(g=1)}}}function t(a){a.isotope({masonry:{columnWidth:160}},function(){function e(){var e=a.find("div.rdr_box:eq("+c+")");e.addClass("rdr_animated"),c++,c>b&&clearInterval(d)}var b=a.find("div.rdr_box").length,c=0,d=setInterval(function(){e()},20)})}function u(a){var c=a.find(".rdr_box"),d=c.eq(-1);if(isTouchBrowser)return 0==c.index(d)%2&&d.addClass("rdr_wide"),void 0;if(d.length){var e=d.position(),f=!1;d.addClass("rdr_clear_transform").css({height:"auto",width:"auto",top:e.top,left:e.left,bottom:0,right:0}),b(c.get().reverse()).each(function(){if(!f){var a=b(this),c=a.position();c.top==e.top;var g=c.top==e.top,h=c.left==e.left;return g||h?(g&&a.addClass("rdr_clear_transform").css({height:"auto",top:c.top,left:c.left,bottom:0}),void 0):(f=!0,void 0)}})}}var e=a.data("hash"),f=!e||"page"==e,g=f?{}:RDR.summaries[e],h=RDR.groupSettings.getBlessedTags(e);Date.now||(Date.now=function(){return(new Date).valueOf()});var i=b('<div class="rdr_body rdr_tags_list" />').data("now",Date.now());b('<div class="rdr_body rdr_tags_list" />').data("now",Date.now());var k=a.find(".rdr_tags_list");if(a.find(".rdr_body_wrap").append(i),k.remove(),"undefined"!=typeof d)if(!c&&d.toptags.length)s(d.toptags),RDR.rindow.updateFooter(a,'<span class="rdr_cta_msg">What do you think?</span>'),a.find(".rdr_footer").addClass("rdr_cta").find("span.rdr_cta_msg").click(function(){a.remove(),a=RDR.rindow.make("writeMode",{hash:"page",page:d,is_page:!0})});else{var l=RDR.rindow.makeHeader("What do you think?"),c=!0;a.find(".rdr_header").replaceWith(l),s(h),RDR.rindow.writeCustomTag(i,a),a.removeClass("rdr_rewritable")}else c?s(h):f||(b.isEmptyObject(g.top_interactions.tags)?RDR.rindow.updateFooter(a,'<span class="rdr_no_reactions_msg rdr_clearfix">No reactions yet!</span>'):(RDR.actions.summaries.sortInteractions(e),s(g.interaction_order),"text"==g.kind?g.crossPage||(RDR.rindow.updateFooter(a,'<span class="rdr_cta_msg">What do you think?</span>'),a.find(".rdr_footer").addClass("rdr_cta").find(".rdr_cta_msg").click(function(){a.remove();var c=b('[rdr-hash="'+e+'"]'),d=c[0];b("document").selog("selectEl",d),a=RDR.rindow.make("writeMode",{hash:e})})):(RDR.rindow.updateFooter(a,'<span class="rdr_cta_msg">What do you think?</span>'),a.find(".rdr_footer").addClass("rdr_cta").find(".rdr_cta_msg").click(function(){a.remove(),a=RDR.rindow.make("writeMode",{hash:e})}))));if("undefined"==typeof d&&c&&(RDR.rindow.writeCustomTag(i,a),a.removeClass("rdr_rewritable")),c||isTouchBrowser||(a.on("mouseleave",function(){var d,c=b(this);d=setTimeout(function(){c.hasClass("rdr_rewritable")&&c.remove()},300),b(this).data("timeoutCloseEvt",d)}).on("mouseenter",function(){var a=b(this).data("timeoutCloseEvt");clearTimeout(a)}),"undefined"==typeof g||"text"!=g.kind||b.isEmptyObject(g.content_nodes)||a.find("div.rdr_box").each(function(){b(this).hover(function(){var c=g.content_nodes[b(this).find("div.rdr_tag").data("content_node_id")].selState,d=!a.data("panelState")||1===a.data("panelState");d&&(b().selog("hilite",c,"on"),a.data("selState",c))},function(){var c=g.content_nodes[b(this).find("div.rdr_tag").data("content_node_id")].selState,d=!a.data("panelState")||1===a.data("panelState");d&&b().selog("hilite",c,"off")})})),"flow"!=a.attr("rdr-grid-type"))t(i),u(i);else var n=i.find("div.rdr_box").length,o=0,p=setInterval(function(){q()},20);return i},updateContainerTrackers:function(){b.each(RDR.containers,function(a,b){!b.kind||"img"!=b.kind&&"media"!=b.kind&&"med"!=b.kind||RDR.actions.indicators.utils.updateContainerTracker(b.hash)})},updateContainerTracker:function(a){var c=RDR.summaries[a],d=c.$container,e=b("#rdr_container_tracker_"+a),f=RDR.containers[a];if(!f.kind||"text"!=f.kind&&"txt"!=f.kind){var g={top:parseInt(d.css("padding-top"),10),right:parseInt(d.css("padding-right"),10),bottom:parseInt(d.css("padding-bottom"),10),left:parseInt(d.css("padding-left"),10)},h=parseInt(d.css("border-top-width"),10)+parseInt(d.css("border-bottom-width"),10)+parseInt(d.css("border-left-width"),10)+parseInt(d.css("border-right-width"),10),i={};i.top=h?0:g.top,i.left=h?0:g.left,RDR.util.cssSuperImportant(e,{top:d.offset().top+i.top+"px",left:d.offset().left+i.left+"px"},!0),this.updateMediaTracker(a)}},updateInlineIndicator:function(a){var b=RDR.summaries[a],c=b.$container,d=b.$indicator_details;d.css({top:c.offset().bottom,left:c.offset().left,width:c.outerWidth()})},updateMediaTracker:function(a){var c=RDR.summaries[a],d=c.$container,e=c.$indicator,f=c.$indicator_body;if(c.$indicator_details,b("#rdr_container_tracker_"+a),f){d.parents(RDR.group.img_container_selectors).length&&(d=d.parents(RDR.group.img_container_selectors).first());var i,j,k=parseInt(d.css("border-top-width"),10)+parseInt(d.css("border-bottom-width"),10)+parseInt(d.css("border-left-width"),10)+parseInt(d.css("border-right-width"),10);k?(i=d.outerWidth(),j=d.outerHeight()):(i=d.width(),j=d.height()),{top:parseInt(d.css("padding-top"),10),right:parseInt(d.css("padding-right"),10),bottom:parseInt(d.css("padding-bottom"),10),left:parseInt(d.css("padding-left"),10)};var o=(f.width(),b.browser.msie&&parseInt(b.browser.version,10)<9?10:0),p="media"==c.kind?d.height()+o+36:d.height()+o+12;e.data("top",p),"media"==c.kind&&e.addClass("rdr_indicator_not_img"),RDR.util.cssSuperImportant(e,{left:"12px",top:p+"px"},!0);var q="text"==c.kind?!1:!0;q&&RDR.actions.indicators.utils.updateInlineIndicator(a)}},borderHilites:{designVersion:2,makeAttempt:0,make:function(a){var e=(b("#rdr_indicator_"+a),b('[rdr-hash="'+a+'"]'),b("#rdr_container_tracker_"+a)),f=e.find(".rdr_media_border_wrap");if(!e.hasClass("rdr_inline_video")){f.length||(f=b('<div class="rdr_media_border_wrap" />').appendTo(e),f.addClass("designVersion_"+RDR.actions.indicators.utils.borderHilites.designVersion)),f.hide();var g={top:{$side:null,css:{}},right:{$side:null,css:{}},bottom:{$side:null,css:{}},left:{$side:null,css:{}}};f.data("borders",g)}},update:function(a){var c=RDR.actions.indicators.utils.borderHilites,e=(b("#rdr_indicator_"+a),b('[rdr-hash="'+a+'"]')),f=b("#rdr_container_tracker_"+a),g=f.find(".rdr_media_border_wrap");if(!g.length){if(this.makeAttempt>1)return;return this.makeAttempt++,RDR.actions.indicators.utils.borderHilites.make(a),void 0}this.makeAttempt=0,g.hide();var j,k,h={top:{$side:null,css:{}},right:{$side:null,css:{}},bottom:{$side:null,css:{}},left:{$side:null,css:{}}},i=1===c.designVersion?2:2===c.designVersion?3:2,l=!1;b.each(h,function(a,c){var d="rdr_mediaHilite_"+a;c.$side=g.find("."+d),c.$side.length||(c.$side=b("<div />").addClass(d).appendTo(g)),parseInt(e.css("border-"+a+"-width"),10)&&(l=!0)}),l?(j=e.outerWidth(),k=e.outerHeight()):(j=e.width(),k=e.height());var m=2*i;h.top.css={width:j+m+"px",height:"0px",top:-i+"px",left:-i+"px"},h.right.css={width:"0px",height:k+"px",top:"0px",left:j+"px"},h.bottom.css={width:j+m+"px",height:"0px",top:k+"px",left:-i+"px"},h.left.css={width:"0px",height:k+"px",top:"0px",left:-i+"px"},b.each(h,function(a,b){RDR.util.cssSuperImportant(b.$side,b.css,!0)})},engage:function(a,c){var d=b("#rdr_container_tracker_"+a),e=d.find(".rdr_media_border_wrap");e.addClass("engaged"),c&&e.addClass("engagedForShareLink")},disengage:function(a){var c=b("#rdr_container_tracker_"+a),d=c.find(".rdr_media_border_wrap");d.removeClass("engaged"),d.removeClass("engagedForShareLink"),b("#rdr_indicator_"+a).hide()},engageAll:function(){$mediaBorderWrap=b(".rdr_media_border_wrap"),$mediaBorderWrap.addClass("engaged")},disengageAll:function(){$mediaBorderWrap=b(".rdr_media_border_wrap"),$mediaBorderWrap.removeClass("engaged"),$mediaBorderWrap.removeClass("engagedForShareLink"),b("div.rdr_indicator_for_media").hide()}}}},summaries:{init:function(a){if("object"==typeof RDR.summaries[a])return RDR.summaries[a];var b=RDR.containers[a],c={hash:a,kind:b.kind,id:b.id,counts:{coms:0,tags:0,interactions:0},top_interactions:{coms:{},tags:{}}};return c},save:function(a){var c=a.hash;RDR.summaries.hasOwnProperty(c),RDR.summaries[c]=a,a.$container=b('[rdr-hash="'+c+'"]')},update:function(a,c,d,e){function g(a){var b=a.hash,c=a.summary,d=a.interaction_node_type,e=a.id,f=a.diffNode,g=c.top_interactions[d],h=g.hasOwnProperty(e)&&"undefined"!=typeof g[e];if(h){var i=g[e];i.count+=f.delta,"tags"==d&&(RDR.actions.summaries.updatePageSummaryTags(b,f),i.count<=0&&delete g[e])}else"tags"==d?(g[e]={count:f.delta,body:f.body,id:e,parent_id:f.parent_id,parent_interaction_node:f.parent_interaction_node},RDR.actions.summaries.updatePageSummaryTags(b,f)):(f.user,g[f.tag_id]={body:f.body,content_node:f.content_node,content_id:f.content_id,id:f.id,social_user:f.social_user,tag_id:f.tag_id,user:f.user,parent_id:f.parent_id,parent_interaction_node:f.parent_interaction_node})}if(d)return b.each(c,function(c,d){b.each(d,function(b,c){c.page_id=e,RDR.actions.summaries.updatePageSummaryTags(a,c)})}),void 0;var f;f=RDR.summaries.hasOwnProperty(a)?RDR.summaries[a]:RDR.actions.summaries.init(a),b.each(c,function(c,d){b.each(d,function(b,d){g({hash:a,summary:f,interaction_node_type:c,id:b,diffNode:d}),f.counts[c]+=d.delta,f.counts.interactions+=d.delta,d.int_type=c,RDR.rindow.update(a,d)})}),RDR.actions.summaries.sortInteractions(a),"pageSummary"==a&&makeSummaryWidget(RDR.page)},updatePageSummaryTags:function(a,c){var h,d=c.id,e=c.page_id||RDR.util.getPageProperty("id",a),f=RDR.pages[e],g=f.toptags;b.each(g,function(){this.id==d&&(f.count+=c.delta,this.tag_count+=c.delta,h=!0)}),h||g.push({body:c.body,id:c.id,tag_count:1});var i=f.summary;b.each(i,function(a,b){"tag"==b.kind&&(b.count=b.count+c.delta)});var j=b('[rdr-page-container="'+e+'"]'),k=j.find("[rdr-page-widget-key]");k.rdrWidgetSummary("update")},sortByTags:function(a){function b(a,b){return b.tag_count-a.tag_count}return a.sort(b)},sortInteractions:function(a){function c(a,b){return b.tag_count-a.tag_count}var d=RDR.summaries[a];d.interaction_order=[];var e="text"==d.kind||"txt"==d.kind;if(e)b.isEmptyObject(d.content_nodes)?b.each(d.top_interactions.tags,function(a,b){d.interaction_order.push({tag_count:b.count,tag_id:a,tag_body:b.body,content_node_id:f,parent_id:b.parent_id})}):b.each(d.content_nodes,function(a,c){b.each(c.top_interactions.tags,function(b,c){d.interaction_order.push({tag_count:c.count,tag_id:b,tag_body:c.body,content_node_id:a,parent_id:c.parent_id})})});else if(!b.isEmptyObject(d.top_interactions)&&!b.isEmptyObject(d.content_nodes)){var f=b.map(d.content_nodes,function(a,b){return b})[0];b.each(d.top_interactions.tags,function(a,b){d.interaction_order.push({tag_count:b.count,tag_id:a,tag_body:b.body,content_node_id:f,parent_id:b.parent_id})})}d.interaction_order.sort(c)},sortPopularTextContainers:function(){function a(a,b){return b.interactions-a.interactions}RDR.text_container_popularity=[],b.each(RDR.summaries,function(a,b){"text"==b.kind&&b.counts.interactions>0&&RDR.text_container_popularity.push({hash:a,interactions:b.counts.interactions})}),RDR.text_container_popularity.sort(a)},displayPopularIndicators:function(){for(var a=0;a<RDR.group.initial_pin_limit;a++)RDR.text_container_popularity[a]&&b("#rdr_indicator_"+RDR.text_container_popularity[a].hash).removeClass("rdr_dont_show")},showLessPopularIndicators:function(){for(var a=[],c=RDR.group.initial_pin_limit;c<RDR.text_container_popularity.length;c++)RDR.text_container_popularity[c]&&RDR.text_container_popularity[c].interactions>0&&(b("#rdr_indicator_"+RDR.text_container_popularity[c].hash).removeClass("rdr_dont_show"),a.push(RDR.text_container_popularity[c].hash));RDR.actions.indicators.show(a)}},insertContainerIcon:function(){},viewReactionSuccess:function(a){var d=(a.tag,a.rindow);a.response.data.interaction,""==a.content_node?a.response.data.content_node:a.content_node,d.removeClass("rdr_rewritable").addClass("rdr_viewing_more").find(".rdr_footer").hide();var g="reactionSuccess"==a.scenario?"Thanks for your reaction!":"You've already reacted to this",h="page"==a.kind;if(h)var i=null,j="page";else var i=a.hash,k=RDR.summaries[i],j=k.kind;var l=RDR.rindow.makeHeader(g,a.response.data.interaction.id);d.find(".rdr_header").replaceWith(l);var m=RDR.rindow.panelCreate(d,"rdr_view_more"),n=d.find("div.rdr_body_wrap");n.append(m),RDR.rindow.updateTagMessage(a),RDR.rindow.panelShow(d,m,function(){if("text"==j&&a.selState){var c=a.selState;b().selog("hilite",c,"on")}var e=RDR.actions.indicators.utils.makeTagsListForInline(d);RDR.actions.containers.updateCrossPageHash(i),e.addClass("rdr_hiddenPanel");var f="rdr_tags_list";RDR.rindow.hideFooter(d),RDR.rindow.panelUpdate(d,f,e);{b('[rdr-hash="'+i+'"]').length>0}})},viewCommentContent:function(a){function s(){var a=b('<div class="rdr_commentBox rdr_innerWrap"></div>').html('<div class="rdr_commentComplete"><div><h4>Leave a comment:</h4></div></div>'),h="Add a comment or #hashtag",i=b('<div class="rdr_comment rdr_clearfix">'),j=b('<textarea class="commentTextArea rdr_default_msg">'+h+"</textarea>"),k=b('<div class="rdr_charCount">'+RDR.group.comment_length+" characters left</div>"),l=b('<button class="rdr_commentSubmit">Comment</button>');return i.append(j,k,l),j.focus(function(){b(this).val()==h&&b(this).val("")}).blur(function(){var a=b(this).val();(""===a||a===h)&&(b(this).addClass("rdr_default_msg"),b(this).val(h))}).keyup(function(a){var c=j.val();return"27"==a.keyCode?(b(this).blur(),!1):(c.length>RDR.group.comment_length&&(c=c.substr(0,RDR.group.comment_length),j.val(c)),j.siblings("div.rdr_charCount").text(RDR.group.comment_length-c.length+" characters left"),void 0)}),l.click(function(){var i=j.val();if(i.length>RDR.group.comment_length&&(i=i.substr(0,RDR.group.comment_length),j.val(i),j.siblings("div.rdr_charCount").text(RDR.group.comment_length-i.length+" characters left")),i!=h){if(b.isEmptyObject(e)&&"img"==g.kind)e={body:b('img[rdr-hash="'+g.hash+'"]').get(0).src,kind:g.kind,hash:g.hash};else{var k=b('[rdr-hash="'+g.hash+'"]'),l=k.attr("rdr-content-type");e.kind=l?"media"==l?"media":"image"==l?"image":"text":"text"}var m=m||null,n={hash:f,content_node_data:e,comment:i,content:e.body,tag:c,rindow:d,selState:m};RDR.actions.interactions.ajax(n,"comment","create")}else j.focus();return!1}),a.append(i),a}function t(){var a=b('<div class="rdr_back">Close X</div>');return a.click(function(){var a=!!d.attr("rdr-grid-for");if(!a)return RDR.rindow.close(d),void 0;var b=RDR.rindow.makeHeader("Reactions");d.find(".rdr_header").replaceWith(b),RDR.rindow.updateTagPanel(d)}),a}function u(){var a,d=c.id?c.id:c.tag_id;a="text"==i?g.content_nodes[e.id].top_interactions.coms:g.top_interactions.coms[d];var f=0;b.isArray(a)||(a=[].push(a)),b.each(a,function(a,b){b.tag_id==d&&f++});var h=!b.isEmptyObject(a);if(h){var j=b('<div class="rdr_otherCommentsBox"></div>'),k=b('<div class="rdr_comment_header rdr_innerWrap"><h4>(<span>'+f+"</span>) Comments:</h4></div>");return j.append(k),b.each(a,function(a,c){if(c.tag_id==d){j.show();var e=b('<div class="rdr_commentSet rdr_innerWrap" />'),f=b('<div class="rdr_commentBy" />'),g=b('<div class="rdr_comment" />');b('<div class="rdr_commentReplies" />'),b('<div class="rdr_commentReply" />'),b('<a href="javascript:void(0);">Reply</a>');var l=c&&c.social_user&&c.social_user.img_url?c.social_user.img_url:RDR_staticUrl+"widget/images/anonymousplode.png",m=c&&c.user&&""!==c.user.first_name?c.user.first_name+" "+c.user.last_name:"Anonymous";f.html('<a href="'+RDR_baseUrl+"/user/"+c.user.id+'" target="_blank"><img src="'+l+'" class="no-rdr" /> '+m+"</a>").click(function(){}),g.html('<div class="rdr_comment_body">'+c.body+"</div>"),e.append(f,g),j.append(e)}}),j.find("div.rdr_commentSet:last-child").addClass("rdr_lastchild"),j}}var c=a.tag,d=a.rindow,e=a.content_node;d.removeClass("rdr_rewritable").addClass("rdr_viewing_more"),RDR.rindow.tagBox.setWidth(d,320),RDR.rindow.hideFooter(d);var f=a.hash,g=RDR.summaries[f],i=(c.tag_body?c.tag_body:c.body,g.kind),j=RDR.rindow.makeHeader(c.tag_body);d.find(".rdr_header").replaceWith(j);var k=RDR.rindow.panelCreate(d,"rdr_view_more"),l=d.find("div.rdr_body_wrap");l.append(k);var m=b('<div class="rdr_commentsWrap"></div>'),n=t(),o=t(),p=u(),q=s();m.append(n,p,q,o),k.append(m),RDR.rindow.panelShow(d,k,function(){if("text"==i){var c=a.selState||g.content_nodes[e.id].selState;b().selog("hilite",c,"on"),d.data("selState",c)}})},share_getLink:function(a){var c=a.hash,d=RDR.summaries[c],e=a.kind?a.kind:d.kind;RDR.session.getUser(a,function(d){var g=(d.rindow,d.tag),h=d.content_node_info?d.content_node_info:d.content_node;h.hash||(h.hash=h.container?h.container:d.hash),h.content||(h.content=h.body);var i={hash:c,body:h.content,location:h.location,kind:e};RDR.actions.content_nodes.make(i),b.postMessage("page_hash|"+window.location.hash,RDR_baseUrl+"/static/xdm.html",window.frames["rdr-xdm-hidden"]),"undefined"==typeof g.body&&(g.body=g.tag_body);var k={tag:g,hash:h.hash,content_node_data:i,user_id:RDR.user.user_id,readr_token:RDR.user.readr_token,group_id:RDR.group.id,page_id:RDR.util.getPageProperty("id",c),referring_int_id:a.referring_int_id,container_kind:"page"==a.kind?"page":RDR.summaries[c].kind};b.ajax({url:RDR_baseUrl+"/api/share/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:b.toJSON(k)},success:function(b){a.response=b,"fail"==b.status?-1!=b.message.indexOf("Temporary user interaction limit reached")?RDR.session.showLoginPanel(a):RDR.session.handleGetUserFail(a,function(){RDR.actions.share_getLink(a)}):RDR.actions.shareContent({sns:d.sns,content_node_info:h,short_url:b.data.short_url,reaction:g.body,container_kind:"page"==c?"page":RDR.summaries[c].kind})},error:function(){}})})},shareContent:function(a){function n(){return RDR.group.name?RDR.group.name:document.domain.replace("www.","")}function o(a,b,c){var d=c?b?"&#124;":"|":b?"&raquo;":"\xbb";return b?a+"&nbsp;"+d+"&nbsp;":a+" "+d}function p(a,b,c){var d="...",e=b-d.length,f=a.length<=b?a:a.substr(0,e)+d;return f=c?'"'+f+'"':f}var b=n(),c=a.content_node_info.content,d="",e="",f=300;switch(a.sns){case"facebook":var g="",h="",i="",j="A ReadrBoard Reaction on "+b;switch(a.container_kind){case"txt":case"text":f=300,e=p(c,f,!0),i=o(a.reaction)+" "+e;break;case"img":case"image":e="[a picture on "+b+"] Check it out: ",RDR_offline&&(c=c.replace("local.readrboard.com:8080","www.readrboard.com"),c=c.replace("localhost:8080","www.readrboard.com")),g="&p[images][0]="+encodeURI(c),i=o(a.reaction)+" "+e;break;case"media":case"med":case"video":e="[a video on "+b+"] Check it out: ",i=o(a.reaction)+" "+e;break;case"page":e="[an article on "+b+"] Check it out: ",i=o(a.reaction)+" "+e}d="http://www.facebook.com/sharer.php?s=100&p[title]="+encodeURI(i)+"&p[url]="+a.short_url+"&p[summary]="+encodeURI(i)+g+h;break;case"twitter":var i="",j="A ReadrBoard Reaction on "+b,k=RDR.group.twitter?"&via="+RDR.group.twitter:"";switch(a.container_kind){case"txt":case"text":f=110-a.reaction.length,e=p(c,f,!0),i=o(a.reaction)+" "+e;break;case"img":case"image":e="[a picture on "+b+"] Check it out: ",i=o(a.reaction)+" "+e;break;case"media":case"med":case"video":e="[a video on "+b+"] Check it out: ",i=o(a.reaction)+" "+e;break;case"page":e="[an article on "+b+"] Check it out: ",i=o(a.reaction)+" "+e}d="http://twitter.com/intent/tweet?url="+a.short_url+k+"&text="+encodeURI(i);break;case"tumblr":var i="";switch(a.container_kind){case"txt":case"text":var j=o(a.reaction,!0)+'&nbsp;[a <a href="'+a.short_url+'">quote</a> on '+b+" via ReadrBoard]";f=300,e=p(c,f),d="http://www.tumblr.com/share/quote?quote="+encodeURIComponent(e)+"&source="+encodeURIComponent(j);break;case"img":case"image":RDR_offline&&(c=c.replace("local.readrboard.com:8080","www.readrboard.com"),c=c.replace("localhost:8080","www.readrboard.com")),i=o(a.reaction,!0);var j='&nbsp;[a <a href="'+a.short_url+'">picture</a> on '+b+" via ReadrBoard]";d="http://www.tumblr.com/share/photo?source="+encodeURIComponent(c)+"&caption="+encodeURIComponent(i+j)+"&click_thru="+encodeURIComponent(a.short_url);break;case"media":case"med":case"video":var l='<iframe src=" '+a.content_node_info.body+' "></iframe>';i=o(a.reaction,!0);var j='&nbsp;[a <a href="'+a.short_url+'">video</a> on '+b+" via ReadrBoard]",m=i+j;d="http://www.tumblr.com/share/video?&embed="+encodeURIComponent(l)+"&caption="+encodeURIComponent(m);break;case"page":var j=o(a.reaction,!0)+'&nbsp;[an <a href="'+a.short_url+'">article</a> on '+b+" via ReadrBoard]";f=300,e=p(c,f),d="http://www.tumblr.com/share/link?url="+encodeURIComponent(a.short_url)+"&description="+encodeURIComponent(j)}break;case"linkedin":}""!==d?RDR.shareWindow&&(RDR.shareWindow.location=d):RDR.shareWindow&&RDR.shareWindow.close()},newUpdateData:function(a){var b=RDR.summaries[a];b.$rindow_readmode,b.$rindow_writemode},startSelect:function(a,c,d){function l(a){var c=null,d=!1;return a.parents().each(function(){if(!d){var a=b(this);o(a)&&(c=b(this),d=!0)}}),c}function m(d){var e=d.data("hash"),f=RDR.summaries[e]||"undefined";if(n(e))return!1;if("undefined"!=f){var h=f.$indicator;RDR.actions.indicators.helpers.out(h)}RDR.rindow.close(b("div.rdr.rdr_window.rdr.rdr_rewritable"));var i=c?{top:parseInt(c.pageY,10),left:parseInt(c.pageX,10)}:{top:a.offset().top,left:a.offset().left};return RDR.actionbar.draw({coords:i,kind:"text",content:g.text,hash:d.data("hash")})}function n(a){var b=RDR.summaries[a]||"undefined";if(!b)return!1;var c=b.$rindow_writemode;return c&&c.filter(":visible").length?c:!1}function o(a){var b=!("block"!=a.css("display")&&"list-item"!=a.css("display")||a.closest(".rdr_indicator").length||a.is("html, body"));return b}if(!a.hasAttr("rdr-custom-display")||!b('[rdr-cta-for="'+a.attr("rdr-custom-display")+'"]').length){RDR.actionbar.closeAll();var e=800;if(!a.closest(".rdr, .no-rdr, #rdr_sandbox").length||a.closest(".rdr_indicator").length){var f=null;if(f=o(a)?a:l(a),null!==f){$rdrParent=f.closest("[rdr-hashed]");var g=f.selog("save");if(g&&g.serialRange&&g.text&&!/^\s*$/g.test(g.text)&&!(g.text.length>e)){var h="text",i=g.text;if($rdrParent.length&&$rdrParent.hasAttr("rdr-hashed")&&!$rdrParent.hasAttr("rdr-page-container")){if(d){var j=$rdrParent.data("hash");return d(j,h,i),void 0}return m($rdrParent)}var k=RDR.actions.hashNodes(f);k&&RDR.actions.sendHashes(k,function(){if(d){var a=f.data("hash");return d(a,h,i),void 0}return m(f)})}}}}},startSelectFromMouseUp:function(a){var c=b(a.target);RDR.actions.startSelect(c,a)},stripRdrNode:function(a){a.removeAttr("rdr-node rdr-hasIndicator rdr-hashed rdr_summary_loaded rdr-hash").find(".rdr_indicator").remove()},pages:{save:function(a,b){RDR.pages[b.id]=b},initPageContainer:function(a){var c=RDR.pages[a],d=c.key,e=1==b(RDR.group.post_selector+'[rdr-page-key="'+d+'"]').length?b(RDR.group.post_selector+'[rdr-page-key="'+d+'"]'):b('body[rdr-page-key="'+d+'"]');if(1===e.length){e.removeAttr("rdr-page-key"),e.attr("rdr-page-container",a);var f=RDR.util.md5.hex_md5(String(c.id));e.get(0).nodeName.toLowerCase(),RDR.actions.containers.save({id:String(c.id),kind:"page",hash:f,HTMLkind:null}),e.data("page_id",String(c.id)),RDR.actions.hashNodes(e);var h={};c.containers.length>0&&(h[c.id]=[],b.each(c.containers,function(a,b){"undefined"!=typeof b.hash&&h[c.id].push(b.hash)})),c&&b("[rdr-custom-display]").length&&(h[c.id]=[],b.each(b("[rdr-custom-display]"),function(a,d){RDR.actions.hashNodes(b(d));var e=b(d).attr("rdr-hash");h[c.id].push(e)})),RDR.actions.sendHashes(h);var i=c;if(i.key=d,1==e.find(RDR.group.summary_widget_selector).length&&e.find(RDR.group.summary_widget_selector+'[rdr-page-widget-key="'+d+'"]'))i.$anchor=e.find(RDR.group.summary_widget_selector);else if(1==b(".rdr-page-summary").length)i.$anchor=b(".rdr-page-summary").eq(0);else{var j="undefined"==typeof RDR.engageScriptParams.bookmarklet?"top:-1000px !important":"";i.$anchor=b('<div id="rdr-page-summary" class="rdr no-rdr rdr-page-summary defaultSummaryBar" style="'+j+'"/>'),i.$anchor.appendTo("body")}b("#rdr_sandbox").append('<div id="rdr_summary_tag_details" />'),(0===b("div.rdr-summary").length||b("div.rdr-summary").length<b(RDR.group.post_selector).length)&&i.$anchor.rdrWidgetSummary(i)}}},users:{save:function(){}}}})}function rdr_loadScript(a,b){var c=document.getElementsByTagName("head")[0];if(c){var d=document.createElement("script");d.setAttribute("src",a.src),d.setAttribute("type","text/javascript"),d.readyState?d.onreadystatechange=function(){("loaded"==d.readyState||"complete"==d.readyState)&&(d.onreadystatechange=null,b())}:d.onload=function(){b()},c.appendChild(d)}}function jquery_onload(a){$R=a.noConflict(!0);var b=$R;return!function(a,b){"use strict";var c,d;if(a.uaMatch=function(a){a=a.toLowerCase();var b=/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(iphone)/.exec(a)||/(android)/.exec(a)||/(windows phone)/.exec(a)||/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||[];return{browser:b[3]||b[1]||"",version:b[2]||"0",platform:c[0]||""}},c=a.uaMatch(b.navigator.userAgent),d={},c.browser&&(d[c.browser]=!0,d.version=c.version,d.versionNumber=parseInt(c.version)),c.platform&&(d[c.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv){var e="msie";c.browser=e,d[e]=!0}if(d.opr){var f="opera";c.browser=f,d[f]=!0}if(d.safari&&d.android){var g="android";c.browser=g,d[g]=!0}d.name=c.browser,d.platform=c.platform,a.browser=d}(b,window),b.browser.msie&&parseInt(b.browser.version,10)<8?!1:(b.browser.msie&&8==parseInt(b.browser.version,10)&&b("body").addClass("rdr_ie"),$RFunctions($R),void 0)}function load_mobileEvents(a){!function(a){function b(){var a=i();a!==j&&(j=a,g.trigger("orientationchange"))}function c(b,c,d,e){var f=d.type;d.type=c,a.event.dispatch.call(b,d,e),d.type=f}a.attrFn=a.attrFn||{};var d=navigator.userAgent.toLowerCase(),e=d.indexOf("chrome")>-1&&(d.indexOf("windows")>-1||d.indexOf("macintosh")>-1||d.indexOf("linux")>-1)&&d.indexOf("chrome")<0,f={swipe_h_threshold:50,swipe_v_threshold:50,taphold_threshold:750,doubletap_int:500,touch_capable:"ontouchstart"in document.documentElement&&!e,orientation_support:"orientation"in window&&"onorientationchange"in window,startevent:"ontouchstart"in document.documentElement&&!e?"touchstart":"mousedown",endevent:"ontouchstart"in document.documentElement&&!e?"touchend":"mouseup",moveevent:"ontouchstart"in document.documentElement&&!e?"touchmove":"mousemove",tapevent:"ontouchstart"in document.documentElement&&!e?"tap":"click",scrollevent:"ontouchstart"in document.documentElement&&!e?"touchmove":"scroll",hold_timer:null,tap_timer:null};a.isTouchCapable=function(){return f.touch_capable},a.getStartEvent=function(){return f.startevent},a.getEndEvent=function(){return f.endevent},a.getMoveEvent=function(){return f.moveevent},a.getTapEvent=function(){return f.tapevent},a.getScrollEvent=function(){return f.scrollevent},a.each(["tapstart","tapend","tap","singletap","doubletap","taphold","swipe","swipeup","swiperight","swipedown","swipeleft","swipeend","scrollstart","scrollend","orientationchange"],function(b,c){a.fn[c]=function(a){return a?this.bind(c,a):this.trigger(c)},a.attrFn[c]=!0}),a.event.special.tapstart={setup:function(){var b=this,d=a(b);d.bind(f.startevent,function(a){if(d.data("callee",arguments.callee),a.which&&1!==a.which)return!1;var e=a.originalEvent,g={position:{x:f.touch_capable?e.touches[0].screenX:a.screenX,y:f.touch_capable?e.touches[0].screenY:a.screenY},offset:{x:f.touch_capable?e.touches[0].pageX-e.touches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?e.touches[0].pageY-e.touches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target};return c(b,"tapstart",a,g),!0})},remove:function(){a(this).unbind(f.startevent,a(this).data.callee)}},a.event.special.tapend={setup:function(){var b=this,d=a(b);d.bind(f.endevent,function(a){d.data("callee",arguments.callee);var e=a.originalEvent,g={position:{x:f.touch_capable?e.changedTouches[0].screenX:a.screenX,y:f.touch_capable?e.changedTouches[0].screenY:a.screenY},offset:{x:f.touch_capable?e.changedTouches[0].pageX-e.changedTouches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?e.changedTouches[0].pageY-e.changedTouches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target};return c(b,"tapend",a,g),!0})},remove:function(){a(this).unbind(f.endevent,a(this).data.callee)}},a.event.special.taphold={setup:function(){var e,b=this,d=a(b),h={x:0,y:0};d.bind(f.startevent,function(a){if(a.which&&1!==a.which)return!1;d.data("tapheld",!1),e=a.target;var g=a.originalEvent,i=(new Date).getTime(),j={x:f.touch_capable?g.touches[0].screenX:a.screenX,y:f.touch_capable?g.touches[0].screenY:a.screenY},k={x:f.touch_capable?g.touches[0].pageX-g.touches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?g.touches[0].pageY-g.touches[0].target.offsetTop:a.offsetY};return h.x=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageX:a.pageX,h.y=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageY:a.pageY,f.hold_timer=window.setTimeout(function(){var l=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageX:a.pageX,m=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageY:a.pageY;if(a.target==e&&h.x==l&&h.y==m){d.data("tapheld",!0);var n=(new Date).getTime(),o={x:f.touch_capable?g.touches[0].screenX:a.screenX,y:f.touch_capable?g.touches[0].screenY:a.screenY},p={x:f.touch_capable?g.touches[0].pageX-g.touches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?g.touches[0].pageY-g.touches[0].target.offsetTop:a.offsetY};duration=n-i;var q={startTime:i,endTime:n,startPosition:j,startOffset:k,endPosition:o,endOffset:p,duration:duration,target:a.target};d.data("callee1",arguments.callee),c(b,"taphold",a,q)}},f.taphold_threshold),!0}).bind(f.endevent,function(){d.data("callee2",arguments.callee),d.data("tapheld",!1),window.clearTimeout(f.hold_timer)})},remove:function(){a(this).unbind(f.startevent,a(this).data.callee1).unbind(f.endevent,a(this).data.callee2)}},a.event.special.doubletap={setup:function(){var e,g,h,i,b=this,d=a(b);d.bind(f.startevent,function(a){return a.which&&1!==a.which?!1:(d.data("doubletapped",!1),e=a.target,d.data("callee1",arguments.callee),i=a.originalEvent,h={position:{x:f.touch_capable?i.touches[0].screenX:a.screenX,y:f.touch_capable?i.touches[0].screenY:a.screenY},offset:{x:f.touch_capable?i.touches[0].pageX-i.touches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?i.touches[0].pageY-i.touches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target},!0)}).bind(f.endevent,function(a){var j=(new Date).getTime(),k=d.data("lastTouch")||j+1,l=j-k;if(window.clearTimeout(g),d.data("callee2",arguments.callee),l<f.doubletap_int&&l>0&&a.target==e&&l>100){d.data("doubletapped",!0),window.clearTimeout(f.tap_timer);var m={position:{x:f.touch_capable?i.touches[0].screenX:a.screenX,y:f.touch_capable?i.touches[0].screenY:a.screenY},offset:{x:f.touch_capable?i.touches[0].pageX-i.touches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?i.touches[0].pageY-i.touches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target},n={firstTap:h,secondTap:m,interval:m.time-h.time};c(b,"doubletap",a,n)}else d.data("lastTouch",j),g=window.setTimeout(function(){window.clearTimeout(g)},f.doubletap_int,[a]);d.data("lastTouch",j)})},remove:function(){a(this).unbind(f.startevent,a(this).data.callee1).unbind(f.endevent,a(this).data.callee2)}},a.event.special.singletap={setup:function(){var b=this,d=a(b),e=null,g=null,h={x:0,y:0};d.bind(f.startevent,function(a){return a.which&&1!==a.which?!1:(g=(new Date).getTime(),e=a.target,d.data("callee1",arguments.callee),h.x=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageX:a.pageX,h.y=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageY:a.pageY,!0)
}).bind(f.endevent,function(a){d.data("callee2",arguments.callee),a.target==e&&(end_pos_x=a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:a.pageX,end_pos_y=a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageY:a.pageY,f.tap_timer=window.setTimeout(function(){if(!d.data("doubletapped")&&!d.data("tapheld")&&h.x==end_pos_x&&h.y==end_pos_y){var e=a.originalEvent,i={position:{x:f.touch_capable?e.changedTouches[0].screenX:a.screenX,y:f.touch_capable?e.changedTouches[0].screenY:a.screenY},offset:{x:f.touch_capable?e.changedTouches[0].pageX-e.changedTouches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?e.changedTouches[0].pageY-e.changedTouches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target};i.time-g<f.taphold_threshold&&c(b,"singletap",a,i)}},f.doubletap_int))})},remove:function(){a(this).unbind(f.startevent,a(this).data.callee1).unbind(f.endevent,a(this).data.callee2)}},a.event.special.tap={setup:function(){var h,b=this,d=a(b),e=!1,g=null,i={x:0,y:0};d.bind(f.startevent,function(a){return d.data("callee1",arguments.callee),a.which&&1!==a.which?!1:(e=!0,i.x=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageX:a.pageX,i.y=a.originalEvent.targetTouches?a.originalEvent.targetTouches[0].pageY:a.pageY,h=(new Date).getTime(),g=a.target,!0)}).bind(f.endevent,function(a){d.data("callee2",arguments.callee);var j=a.originalEvent.targetTouches?a.originalEvent.changedTouches[0].pageX:a.pageX,k=a.originalEvent.targetTouches?a.originalEvent.changedTouches[0].pageY:a.pageY;if(g==a.target&&e&&(new Date).getTime()-h<f.taphold_threshold&&i.x==j&&i.y==k){var l=a.originalEvent,m={position:{x:f.touch_capable?l.changedTouches[0].screenX:a.screenX,y:f.touch_capable?l.changedTouches[0].screenY:a.screenY},offset:{x:f.touch_capable?l.changedTouches[0].pageX-l.changedTouches[0].target.offsetLeft:a.offsetX,y:f.touch_capable?l.changedTouches[0].pageY-l.changedTouches[0].target.offsetTop:a.offsetY},time:(new Date).getTime(),target:a.target};c(b,"tap",a,m)}})},remove:function(){a(this).unbind(f.startevent,a(this).data.callee1).unbind(f.endevent,a(this).data.callee2)}},a.event.special.swipe={setup:function(){function b(b){g=a(b.target),g.data("callee1",arguments.callee),j.x=b.originalEvent.targetTouches?b.originalEvent.targetTouches[0].pageX:b.pageX,j.y=b.originalEvent.targetTouches?b.originalEvent.targetTouches[0].pageY:b.pageY,k.x=j.x,k.y=j.y,h=!0;var c=b.originalEvent;l={position:{x:f.touch_capable?c.touches[0].screenX:b.screenX,y:f.touch_capable?c.touches[0].screenY:b.screenY},offset:{x:f.touch_capable?c.touches[0].pageX-c.touches[0].target.offsetLeft:b.offsetX,y:f.touch_capable?c.touches[0].pageY-c.touches[0].target.offsetTop:b.offsetY},time:(new Date).getTime(),target:b.target};for(var d=new Date;new Date-d<100;);}function c(b){g=a(b.target),g.data("callee2",arguments.callee),k.x=b.originalEvent.targetTouches?b.originalEvent.targetTouches[0].pageX:b.pageX,k.y=b.originalEvent.targetTouches?b.originalEvent.targetTouches[0].pageY:b.pageY,window.clearTimeout(f.hold_timer);var c,d=g.data("xthreshold"),e=g.data("ythreshold"),m="undefined"!=typeof d&&d!==!1&&parseInt(d)?parseInt(d):f.swipe_h_threshold,n="undefined"!=typeof e&&e!==!1&&parseInt(e)?parseInt(e):f.swipe_v_threshold;if(j.y>k.y&&j.y-k.y>n&&(c="swipeup"),j.x<k.x&&k.x-j.x>m&&(c="swiperight"),j.y<k.y&&k.y-j.y>n&&(c="swipedown"),j.x>k.x&&j.x-k.x>m&&(c="swipeleft"),void 0!=c&&h){j.x=0,j.y=0,k.x=0,k.y=0,h=!1;var o=b.originalEvent;endEvnt={position:{x:f.touch_capable?o.touches[0].screenX:b.screenX,y:f.touch_capable?o.touches[0].screenY:b.screenY},offset:{x:f.touch_capable?o.touches[0].pageX-o.touches[0].target.offsetLeft:b.offsetX,y:f.touch_capable?o.touches[0].pageY-o.touches[0].target.offsetTop:b.offsetY},time:(new Date).getTime(),target:b.target};var p=Math.abs(l.position.x-endEvnt.position.x),q=Math.abs(l.position.y-endEvnt.position.y),r={startEvnt:l,endEvnt:endEvnt,direction:c.replace("swipe",""),xAmount:p,yAmount:q,duration:endEvnt.time-l.time};i=!0,g.trigger("swipe",r).trigger(c,r)}}function d(b){g=a(b.target);var c="";if(g.data("callee3",arguments.callee),i){var d=g.data("xthreshold"),e=g.data("ythreshold"),j="undefined"!=typeof d&&d!==!1&&parseInt(d)?parseInt(d):f.swipe_h_threshold,k="undefined"!=typeof e&&e!==!1&&parseInt(e)?parseInt(e):f.swipe_v_threshold,m=b.originalEvent;endEvnt={position:{x:f.touch_capable?m.changedTouches[0].screenX:b.screenX,y:f.touch_capable?m.changedTouches[0].screenY:b.screenY},offset:{x:f.touch_capable?m.changedTouches[0].pageX-m.changedTouches[0].target.offsetLeft:b.offsetX,y:f.touch_capable?m.changedTouches[0].pageY-m.changedTouches[0].target.offsetTop:b.offsetY},time:(new Date).getTime(),target:b.target},l.position.y>endEvnt.position.y&&l.position.y-endEvnt.position.y>k&&(c="swipeup"),l.position.x<endEvnt.position.x&&endEvnt.position.x-l.position.x>j&&(c="swiperight"),l.position.y<endEvnt.position.y&&endEvnt.position.y-l.position.y>k&&(c="swipedown"),l.position.x>endEvnt.position.x&&l.position.x-endEvnt.position.x>j&&(c="swipeleft");var n=Math.abs(l.position.x-endEvnt.position.x),o=Math.abs(l.position.y-endEvnt.position.y),p={startEvnt:l,endEvnt:endEvnt,direction:c.replace("swipe",""),xAmount:n,yAmount:o,duration:endEvnt.time-l.time};g.trigger("swipeend",p)}h=!1,i=!1}var l,e=this,g=a(e),h=!1,i=!1,j={x:0,y:0},k={x:0,y:0};g.bind(f.startevent,b),g.bind(f.moveevent,c),g.bind(f.endevent,d)},remove:function(){a(this).unbind(f.startevent,a(this).data.callee1).unbind(f.moveevent,a(this).data.callee2).unbind(f.endevent,a(this).data.callee3)}},a.event.special.scrollstart={setup:function(){function b(a,b){g=b,c(d,g?"scrollstart":"scrollend",a)}var g,h,d=this,e=a(d);e.bind(f.scrollevent,function(a){e.data("callee",arguments.callee),g||b(a,!0),clearTimeout(h),h=setTimeout(function(){b(a,!1)},50)})},remove:function(){a(this).unbind(f.scrollevent,a(this).data.callee)}};var h,i,j,k,l,g=a(window),m={0:!0,180:!0};if(f.orientation_support){var n=window.innerWidth||a(window).width(),o=window.innerHeight||a(window).height(),p=50;k=n>o&&n-o>p,l=m[window.orientation],(k&&l||!k&&!l)&&(m={"-90":!0,90:!0})}a.event.special.orientationchange=h={setup:function(){return f.orientation_support?!1:(j=i(),g.bind("throttledresize",b),!0)},teardown:function(){return f.orientation_support?!1:(g.unbind("throttledresize",b),!0)},add:function(a){var b=a.handler;a.handler=function(a){return a.orientation=i(),b.apply(this,arguments)}}},a.event.special.orientationchange.orientation=i=function(){var a=!0,b=document.documentElement;return a=f.orientation_support?m[window.orientation]:b&&b.clientWidth/b.clientHeight<1.1,a?"portrait":"landscape"},a.event.special.throttledresize={setup:function(){a(this).bind("resize",r)},teardown:function(){a(this).unbind("resize",r)}};var t,u,v,q=250,r=function(){u=(new Date).getTime(),v=u-s,v>=q?(s=u,a(this).trigger("throttledresize")):(t&&window.clearTimeout(t),t=window.setTimeout(b,q-v))},s=0;a.each({scrollend:"scrollstart",swipeup:"swipe",swiperight:"swipe",swipedown:"swipe",swipeleft:"swipe",swipeend:"swipe"},function(b,c){a.event.special[b]={setup:function(){a(this).bind(c,a.noop)}}})}(a)}function $RFunctions($R){function loadCSS(a){$R.each(a,function(a,b){$R("<link>").attr({href:b,rel:"stylesheet"}).appendTo("body")})}function initCommonUtils(a){a.extend(RDR,{commonUtil:{prettyNumber:function(a){var b=parseInt(a,10);if(isNaN(b)||0>b)return!1;for(var c=["","K","M","B","T"],d=0;d<c.length;d++){var e=Math.pow(10,3*d),f=Math.pow(10,3*(d+1));if(f>b)return""+Math.floor(b/e)+c[d]}}}})}function initPlugins($R){function plugin_jquery_log(a){var b=a;a.clog=function(){window.console&&window.console.log&&window.console.log.apply&&window.console.log.apply(window.console,arguments)},a.fn.clog=function(){var b=arguments||this;return a.clog(b),this},"undefined"==typeof clog&&(clog=function(){a.clog(arguments)}),"undefined"!=typeof b&&(b.clog=a.clog,b.fn.clog=a.fn.clog)}function plugin_jquery_hasAttr(a){a.fn.hasAttr=function(a){return void 0!==this.attr(a)}}function plugin_jquery_json($){$.toJSON=function(a){var b=typeof a;if(null===a)return"null";if("undefined"==b)return void 0;if("number"==b||"boolean"==b)return a+"";if("string"==b)return $.quoteString(a);if("object"==b){if(a.constructor===Date){var c=a.getUTCMonth()+1;10>c&&(c="0"+c);var d=a.getUTCDate();10>d&&(d="0"+d);var e=a.getUTCFullYear(),f=a.getUTCHours();10>f&&(f="0"+f);var g=a.getUTCMinutes();10>g&&(g="0"+g);var h=a.getUTCSeconds();10>h&&(h="0"+h);var i=a.getUTCMilliseconds();return 100>i&&(i="0"+i),10>i&&(i="0"+i),'"'+e+"-"+c+"-"+d+"T"+f+":"+g+":"+h+"."+i+'Z"'}if(a.constructor===Array){for(var j=[],k=0;k<a.length;k++)j.push($.toJSON(a[k])||"null");return"["+j.join(",")+"]"}var l=[];for(var m in a){var n,b=typeof m;if("number"==b)n='"'+m+'"';else{if("string"!=b)continue;n=$.quoteString(m)}if("function"!=typeof a[m]){var o=$.toJSON(a[m]);"undefined"!=typeof o&&l.push(n+":"+o)}}return"{"+l.join(", ")+"}"}},$.evalJSON=function(src){return eval("("+src+")")},$.secureEvalJSON=function(src){var filtered=src;if(filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@"),filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(filtered))return eval("("+src+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(a){return a.match(_escapeable)?'"'+a.replace(_escapeable,function(a){var b=_meta[a];return"string"==typeof b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g,_meta={"\b":"\\b","  ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}}function plugin_jquery_cookie(a){a.cookie=function(b,c,d){if(arguments.length>1&&"[object Object]"!==String(c)){if(d=a.extend({},d),(null===c||void 0===c)&&(d.expires=-1),"number"==typeof d.expires){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g,h=d.raw?function(a){return a}:decodeURIComponent;return(g=new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)").exec(document.cookie))?h(g[1]):null}}function plugin_jquery_postMessage(a){var b,c,e,j,d=1,f=this,g=!1,h="postMessage",i="addEventListener",k=f[h]&&!a.browser.opera;a[h]=function(b,c,e){c&&(b="string"==typeof b?b:a.param(b),e=e||parent,k?e[h](b,c.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):c&&(e.location=c.replace(/#.*$/,"")+"#"+ +new Date+d++ +"&"+b))},a.receiveMessage=j=function(d,h,l){k?(d&&(e&&j(),e=function(b){return"string"==typeof h&&b.origin!==h||a.isFunction(h)&&h(b.origin)===g?g:(d(b),void 0)}),f[i]?f[d?i:"removeEventListener"]("message",e,g):f[d?"attachEvent":"detachEvent"]("onmessage",e)):(b&&clearInterval(b),b=null,d&&(l="number"==typeof h?h:"number"==typeof l?l:100,b=setInterval(function(){var a=document.location.hash,b=/^#?\d+&/;a!==c&&b.test(a)&&(c=a,d({data:a.replace(b,"")}))},l)))}}function plugin_jquery_drags(){$.fn.drags=function(a){a=$.extend({handle:""},a);var b=$(this),c=b;return c.on("mousedown",function(c){if(""===a.handle||$(c.target).closest(".rdr_header").length){b.removeClass("rdr_rewritable");var d=b.outerHeight(),e=b.outerWidth(),f=b.offset(),g=f.top+d-c.pageY,h=f.left+e-c.pageX;$(document).on("mousemove.rdr_drag",function(a){b.offset({top:a.pageY+g-d,left:a.pageX+h-e})}).on("mouseup",function(){$(this).off("mousemove.rdr_drag")}),c.preventDefault()}}),this}}function plugin_jquery_enhancedOffset(a){var b=a.fn.offset;a.fn.offset=function(){var c=b.call(this),d=c?c.top+this.outerHeight():0,e=c?c.left+this.outerWidth():0,f=arguments;return f.length?this.animate({top:f[0].top||f[0],left:f[0].left||f[1]},(f[0].top?f[1]:f[2])||1):a.extend(c,{bottom:d,right:e})}}function plugin_jquery_rdrWidgetSummary(a){function d(b){var c=b,d="rdr-summary-key-"+c.key;a("."+d).remove();var f=a(c.parentContainer),g=a('<div class="rdr rdr-summary rdr-summary-'+c.id+' rdr-border-box" rdr-page-id="'+c.id+'"></div>').addClass(d);"true"==RDR.engageScriptParams.bookmarklet&&g.addClass("rdr_bookmarklet"),g.data({page_id:c.id,page_key:c.key});var h=""!=RDR.group.summary_widget_method?RDR.group.summary_widget_method:"after";f[h](g);var i=f.hasClass("defaultSummaryBar")?"top":"top";g.find("img.rdr_tooltip_this").tooltip({placement:i}),g.append('<div class="rdr_chevron_cta"><i class="rdr_icon-chevron-down"></i></div><a href="'+RDR_baseUrl+'" target="_blank" class="rdr_logo">'+'<span class="no-rdr rdr-logo" title="This is <strong style=\'color:#4d92da;\'>ReadrBoard</strong>. Click to visit our site and learn more!" src="'+RDR_staticUrl+'widget/images/blank.png" ></span>'+"</a>"),g.find(".rdr-logo").click(function(){}),g.find(".rdr-logo").tooltip({});var j=function(){e();var b=a(this).data("page_id");RDR.rindow.make("readMode",{is_page:!0,page:c,tags:c.toptags}),RDR.events.trackEventToCloud({category:"summarybar",action:"rindow_shown_summarybar",opt_label:"page: "+b,page_id:b})};isTouchBrowser?g.bind("tap",function(){j.call(this),a(this).toggleClass("rdr_hover")}):g.hover(j,function(){});var k;b.summary&&a.each(b.summary,function(){"tag"==this.kind&&(k=this.count)});var l=0;k?l=k:a.each(c.toptags,function(a,b){l+=b.tag_count});var m=l>1?l+" Reactions":l>0?l+" Reaction":"Reactions";g.append('<a class="rdr_reactions_label">'+m+"</a>")}function e(){"undefined"==typeof RDR.interaction_data&&(RDR.interaction_data={}),a.each(RDR.summaries,function(b,c){a.each(c.top_interactions.tags,function(a,c){"undefined"!=typeof c&&("undefined"!=typeof RDR.summaries[b].content_nodes?RDR.util.buildInteractionData():RDR.actions.content_nodes.init(b,function(){RDR.util.buildInteractionData()}))})})}a.fn.rdrWidgetSummary=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist."),void 0):c.init.apply(this,arguments)};var b={},c={init:function(c){var f,e=this[0]===document?a(".rdr-summary"):this;return e.each(function(){f=c?a.extend({},b,c):b,f.parentContainer=this,a(this).data("settings",f),d(f)})},update:function(){var b=this[0]===document?a(".rdr-summary"):this;return b.each(function(){var c=a(this).data("settings");c.summary=RDR.pages[c.id].summary,d(c)})}}}function plugin_jquery_selectionographer(a,b){function j(){return b.getSelection()}function k(c){var f,h,e=g,i=c||{},k={styleName:"rdr_hilite",container:document,serialRange:null,range:null},l={idx:e.length,timestamp:a.now(),interactionID:null,hiliter:null,revisionParent:null,text:""},n=a.extend({},k,i,l);if(n.range||n.serialRange)if(n.range){f=n.range;try{h=b.serializeRange(f,!0,n.container)}catch(q){h=!1}}else n.serialRange&&(h=n.serialRange,f=b.deserializeRange(h,n.container));else{var o=j();if(o.isCollapsed)return!1;f=o.getRangeAt(0);try{h=b.serializeRange(f,!0,n.container)}catch(p){h=!1}}return n.serialRange=h,n.range=f.cloneRange(),n.text=n.range.toString(),0===n.text.length?!1:(n.hiliter=m(n),n)}function l(a){if(a===!1)return!1;if("object"==typeof a)return a;var b=g,c="string"==typeof a||"number"==typeof a?a:b.length-1,d=b[c];return d?d:!1}function m(c){if(c.hiliter)return c.hiliter;var f,d=c.range,e=c.styleName,g=e+"_"+c.idx;return f=b.createCssClassApplier(g,!0),f["class"]=g,f.get$start=function(){return a(d.startContainer).closest("."+f["class"])},f.get$end=function(){return a(d.endContainer).closest("."+f["class"])},f.isActive=function(){var a=!1;try{a=f.isAppliedToRange(d)}catch(b){a=null}return a},f}function n(b,c){var e=b.range,f=b.styleName,g=b.hiliter,h=g.isActive();if(null!=h)return h||"on"!==c&&"toggle"!==c?!h||"off"!==c&&"toggle"!==c||(g.get$start().removeClass(f+"_start"),g.get$end().removeClass(f+"_end"),a("."+g["class"]).removeClass(f),g.isAppliedToRange(e)&&g.undoToRange(e)):(g.applyToRange(e),a("."+g["class"]).addClass(f),g.get$start().addClass(f+"_start"),g.get$end().addClass(f+"_end"),d.clear()),b}function o(b,c){var d={start:!0,offset:void 0,relOffset:void 0},e=a.extend({},d,c),f=e.start?b.startOffset:b.endOffset;if("undefined"==typeof e.offset){if("undefined"==typeof e.relOffset)return f;e.offset=f+e.relOffset}try{return e.start?b.setStart(b.startContainer,e.offset):b.setEnd(b.endContainer,e.offset),b}catch(g){return!1}}function p(b,c){var e=h,f={};return"undefined"==typeof c||null===c?a.each(e,function(a){f[a]=[]}):"string"==typeof c?f[c]=[]:a.each(c,function(a,b){if("string"==typeof b)f[b]=[];else{var c=b[0],d=b.length>1?b.slice(1):[];f[c]=d}}),a.each(f,function(a,c){var d=e[a]||function(){};b=d(b,c)}),b}a.fn.selectionographer=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist."),void 0):d.init.apply(this,arguments)},a.fn.selog=a.fn.selectionographer;var c={},d={init:function(b){var d=this;return b=b||{},d.each(function(){e=a.extend(c,b)})},save:function(a){var e,b=this,c=g,d=a||{};return d.container=d.container||b[0]||document,(e=k(d))?(c[e.idx]=e,e):!1},selectEl:function(a){var c=b.createRange();c.selectNodeContents(a);var d=b.getSelection();d.setSingleRange(c)},activate:function(a){var b=l(a);return b?(d.clear(),j().setSingleRange(b.range),b):!1},clear:function(){j().removeAllRanges()},modify:function(a,b){a instanceof Array&&(b=a,a=void 0);var e,f,g,c=l(a);return c?(f=c.range.cloneRange(),f=p(f,b),e={range:f,container:c.container},g=d.save(e)):!1},hilite:function(a,b){var c=b;"string"==typeof a&&isNaN(a)&&(c=a,a=void 0),c=c||"on";var d=l(a);return d?"undefined"!=typeof d.serialRange&&d.serialRange===!1?!1:(n(d,c),d):!1},helpers:function(a){var b=f[a];return b?b.apply(this,Array.prototype.slice.call(arguments,1)):!1},find:function(b){var e,d=this;return b?(RegExp.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},b=RegExp.escape(b),e=new RegExp(b,"gim"),d.each(function(){for(var b=a(this).text(),c=0,d=0,f=[];(c=e.exec(b))&&5>d;)f.push(c.index),d++;return f})):!1},stack:function(){return g},data:function(a){return i[a]}},e={},f={smartHilite:function(){return d.hilite(d.modify(d.save.apply(this)))},activateRange:function(a){var b={};return a?("string"==typeof a?b.serialRange=a:b.range=a,d.activate(d.save(b))):!1}},g=[],h={filterOutRDRIndicator:function(b){var d=b.commonAncestorContainer,e=a(d).find(".rdr_indicator");if(e.length){var f=b.containsNode(e[0],!0);f&&b.setEndBefore(e[0])}return b},stripWhiteSpace:function(a){var b=a.toString(),c={},d={};return c.textnode=a.startContainer,c.offset=a.startOffset,c.regx=/^\s+/,c.result=c.regx.exec(b),d.textnode=a.endContainer,d.offset=a.endOffset,d.regx=/\s+$/,d.result=d.regx.exec(b),c.result&&(c.resultStrLen=c.result[0].length,o(a,{relOffset:c.resultStrLen})),d.result&&(d.resultStrLen=d.result[0].length,o(a,{relOffset:-d.resultStrLen,start:!1})),a},firstWordSnap:function(a){var c=a.startContainer,d=a.startOffset;if(0===d)return a;var f={range:b.createRange()};return f.range.setStart(c,0),f.range.setEnd(c,d),f.str0=f.range.toString(),f.regx1=/\s*\S+$/,f.result1=f.regx1.exec(f.str0),null===f.result1?a:(f.str1=f.result1[0],f.str2=f.str1.replace(/\s*/,""),f.extraWordChars=f.str2.length,o(a,{relOffset:-f.extraWordChars}),a)},lastWordSnap:function(a){var c=a.endContainer,d=a.endOffset;if(0===d)return a;var f={range:b.createRange()};return f.range.setStart(c,d),f.range.setEnd(c,c.length),f.str0=f.range.toString(),f.regx1=/^\S+(?=(\s|$))/,f.result1=f.regx1.exec(f.str0),null===f.result1?a:(f.str1=f.result1[0],f.extraWordChars=f.str1.length,o(a,{relOffset:f.extraWordChars,start:!1}),a)}},i={stack:g};a(document).selog()}function plugin_jquery_mustache(a){var c=void 0;!function(a){!function(a,b){"object"==typeof exports&&exports?module.exports=b:"function"==typeof c&&c.amd?c(b):a.Mustache=b}(this,function(){function a(a,b){return s.call(a,b)}function b(b){return!a(o,b)}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a){return(a+"").replace(/[&<>"'\/]/g,function(a){return v[a]})}function e(a){this.string=a,this.tail=a,this.pos=0}function f(a,b){this.view=a,this.parent=b,this._cache={}}function g(){this.clearCache()}function h(a,b,c,d){for(var e,f,g,i="",j=0,k=a.length;k>j;++j)switch(e=a[j],f=e[1],e[0]){case"#":if(g=c.lookup(f),"object"==typeof g)if(u(g))for(var m=0,n=g.length;n>m;++m)i+=h(e[4],b,c.push(g[m]),d);else g&&(i+=h(e[4],b,c.push(g),d));else if("function"==typeof g){var o=null==d?null:d.slice(e[3],e[5]);g=g.call(c.view,o,function(a){return b.render(a,c)}),null!=g&&(i+=g)}else g&&(i+=h(e[4],b,c,d));break;case"^":g=c.lookup(f),(!g||u(g)&&0===g.length)&&(i+=h(e[4],b,c,d));break;case">":g=b.getPartial(f),"function"==typeof g&&(i+=g(c));break;case"&":g=c.lookup(f),null!=g&&(i+=g);break;case"name":g=c.lookup(f),null!=g&&(i+=l.escape(g));break;case"text":i+=f}return i}function i(a){for(var b,c=[],d=c,e=[],f=0,g=a.length;g>f;++f)switch(b=a[f],b[0]){case"#":case"^":e.push(b),d.push(b),d=b[4]=[];break;case"/":var h=e.pop();h[5]=b[2],d=e.length>0?e[e.length-1][4]:c;break;default:d.push(b)}return c}function j(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(c=b,d.push(b)));return d}function k(a){return[RegExp(c(a[0])+"\\s*"),RegExp("\\s*"+c(a[1]))]}var l={};l.name="mustache.js",l.version="0.7.2",l.tags=["{{","}}"],l.Scanner=e,l.Context=f,l.Writer=g;var m=/\s*/,n=/\s+/,o=/\S/,p=/\s*=/,q=/\s*\}/,r=/#|\^|\/|>|\{|&|=|!/,s=RegExp.prototype.test,t=Object.prototype.toString,u=Array.isArray||function(a){return"[object Array]"===t.call(a)},v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};l.escape=d,e.prototype.eos=function(){return""===this.tail},e.prototype.scan=function(a){var b=this.tail.match(a);return b&&0===b.index?(this.tail=this.tail.substring(b[0].length),this.pos+=b[0].length,b[0]):""},e.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c}return b},f.make=function(a){return a instanceof f?a:new f(a)},f.prototype.push=function(a){return new f(a,this)},f.prototype.lookup=function(a){var b=this._cache[a];if(!b){if("."==a)b=this.view;else for(var c=this;c;){if(a.indexOf(".")>0){b=c.view;for(var d=a.split("."),e=0;b&&d.length>e;)b=b[d[e++]]}else b=c.view[a];if(null!=b)break;c=c.parent}this._cache[a]=b}return"function"==typeof b&&(b=b.call(this.view)),b},g.prototype.clearCache=function(){this._cache={},this._partialCache={}},g.prototype.compile=function(a,b){var c=this._cache[a];if(!c){var d=l.parse(a,b);c=this._cache[a]=this.compileTokens(d,a)}return c},g.prototype.compilePartial=function(a,b,c){var d=this.compile(b,c);return this._partialCache[a]=d,d},g.prototype.getPartial=function(a){return a in this._partialCache||!this._loadPartial||this.compilePartial(a,this._loadPartial(a)),this._partialCache[a]},g.prototype.compileTokens=function(a,b){var c=this;return function(d,e){if(e)if("function"==typeof e)c._loadPartial=e;else for(var g in e)c.compilePartial(g,e[g]);return h(a,c,f.make(d),b)}},g.prototype.render=function(a,b,c){return this.compile(a)(b,c)},l.parse=function(a,d){function f(){if(z&&!A)for(;y.length;)delete x[y.pop()];else y=[];z=!1,A=!1}if(a=a||"",d=d||l.tags,"string"==typeof d&&(d=d.split(n)),2!==d.length)throw Error("Invalid tags: "+d.join(", "));for(var g,h,o,s,t,u=k(d),v=new e(a),w=[],x=[],y=[],z=!1,A=!1;!v.eos();){if(g=v.pos,o=v.scanUntil(u[0]))for(var B=0,C=o.length;C>B;++B)s=o.charAt(B),b(s)?y.push(x.length):A=!0,x.push(["text",s,g,g+1]),g+=1,"\n"==s&&f();if(!v.scan(u[0]))break;if(z=!0,h=v.scan(r)||"name",v.scan(m),"="===h?(o=v.scanUntil(p),v.scan(p),v.scanUntil(u[1])):"{"===h?(o=v.scanUntil(RegExp("\\s*"+c("}"+d[1]))),v.scan(q),v.scanUntil(u[1]),h="&"):o=v.scanUntil(u[1]),!v.scan(u[1]))throw Error("Unclosed tag at "+v.pos);if(t=[h,o,g,v.pos],x.push(t),"#"===h||"^"===h)w.push(t);else if("/"===h){if(0===w.length)throw Error('Unopened section "'+o+'" at '+g);var D=w.pop();if(D[1]!==o)throw Error('Unclosed section "'+D[1]+'" at '+g)}else if("name"===h||"{"===h||"&"===h)A=!0;else if("="===h){if(d=o.split(n),2!==d.length)throw Error("Invalid tags at "+g+": "+d.join(", "));u=k(d)}}var D=w.pop();if(D)throw Error('Unclosed section "'+D[1]+'" at '+v.pos);return x=j(x),i(x)};var w=new g;return l.clearCache=function(){return w.clearCache()},l.compile=function(a,b){return w.compile(a,b)},l.compilePartial=function(a,b,c){return w.compilePartial(a,b,c)},l.compileTokens=function(a,b){return w.compileTokens(a,b)},l.render=function(a,b,c){return w.render(a,b,c)},l.to_html=function(a,b,c,d){var e=l.render(a,b,c);return"function"!=typeof d?e:(d(e),void 0)},l}()),a.mustache=function(a,b,c){return Mustache.render(a,b,c)},a.fn.mustache=function(b,c){return a(this).map(function(d,e){var f=a.trim(a(e).html()),g=a.mustache(f,b,c);return a(g).get()})}}(a)}function plugin_jquery_improvedCSS(a){a.fn.css2=a.fn.css,a.fn.css=function(){if(arguments.length)return a.fn.css2.apply(this,arguments);for(var e,b=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","lineHeight","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","width","height","top","right","bottom","left","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","position","display","visibility","z-index","overflow-x","overflow-y","white-space","clip","float","clear","cursor","list-style-image","list-style-position","list-style-type","marker-offset"],c=b.length,d={},f=0;c>f;f++)e=b[f],d[e]=a.fn.css2.call(this,e),"lineHeight"==e&&(d[e]=a.fn.css2.call(this,"auto")),e="undefined"==typeof e?"auto":e;return d}}function plugin_jquery_mousewheel(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),void 0!==c.wheelDeltaY&&(h=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}function plugin_jquery_isotope(a){!function(a,b){"use strict";var c,d=a.document,e=d.documentElement,f=a.Modernizr,g=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},h="Moz Webkit O Ms".split(" "),i=function(a){var b,c=e.style;if("string"==typeof c[a])return a;a=g(a);for(var d=0,f=h.length;f>d;d++)if(b=h[d]+a,"string"==typeof c[b])return b},j=i("transform"),k=i("transitionProperty"),l={csstransforms:function(){return!!j},csstransforms3d:function(){var a=!!i("perspective");if(a&&"webkitPerspective"in e.style){var c=b("<style>@media (transform-3d),(-webkit-transform-3d){#modernizr{height:3px}}</style>").appendTo("head"),d=b('<div id="modernizr" />').appendTo("html");a=3===d.height(),d.remove(),c.remove()}return a},csstransitions:function(){return!!k}};if(f)for(c in l)f.hasOwnProperty(c)||f.addTest&&f.addTest(c,l[c]);else{f=a.Modernizr={_version:"1.6ish: miniModernizr for Isotope"};var m,n=" ";for(c in l)m=l[c](),f[c]=m,n+=" "+(m?"":"no-")+c;b("html").addClass(n)}if(f.csstransforms){var o=f.csstransforms3d?{translate:function(a){return"translate3d("+a[0]+"px, "+a[1]+"px, 0) "},scale:function(a){return"scale3d("+a+", "+a+", 1) "}}:{translate:function(a){return"translate("+a[0]+"px, "+a[1]+"px) "},scale:function(a){return"scale("+a+") "}},p=function(a,c,d){var e,f,g=b.data(a,"isoTransform")||{},h={},i={};h[c]=d,b.extend(g,h);for(e in g)f=g[e],i[e]=o[e](f);var k=i.translate||"",l=i.scale||"",m=k+l;b.data(a,"isoTransform",g),a.style[j]=m};b.cssNumber.scale=!0,b.cssHooks.scale={set:function(a,b){p(a,"scale",b)},get:function(a){var c=b.data(a,"isoTransform");return c&&c.scale?c.scale:1}},b.fx.step.scale=function(a){b.cssHooks.scale.set(a.elem,a.now+a.unit)},b.cssNumber.translate=!0,b.cssHooks.translate={set:function(a,b){p(a,"translate",b)},get:function(a){var c=b.data(a,"isoTransform");return c&&c.translate?c.translate:[0,0]}}}var q,r;f.csstransitions&&(q={WebkitTransitionProperty:"webkitTransitionEnd",MozTransitionProperty:"transitionend",OTransitionProperty:"oTransitionEnd otransitionend",transitionProperty:"transitionend"}[k],r=i("transitionDuration"));var s,t=b.event,u=b.event.handle?"handle":"dispatch";t.special.smartresize={setup:function(){b(this).bind("resize",t.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",t.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize",s&&clearTimeout(s),s=setTimeout(function(){t[u].apply(c,d)},"execAsap"===b?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Isotope=function(a,c,d){this.element=b(c),this._create(a),this._init(d)};var v=["width","height"],w=b(a);b.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},containerStyle:{position:"relative",overflow:"hidden"},animationEngine:"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!0,itemPositionDataEnabled:!1},b.Isotope.prototype={_create:function(a){this.options=b.extend({},b.Isotope.settings,a),this.styleQueue=[],this.elemCount=0;var c=this.element[0].style;this.originalStyle={};var d=v.slice(0);for(var e in this.options.containerStyle)d.push(e);for(var f=0,g=d.length;g>f;f++)e=d[f],this.originalStyle[e]=c[e]||"";this.element.css(this.options.containerStyle),this._updateAnimationEngine(),this._updateUsingTransforms();var h={"original-order":function(a,b){return b.elemCount++,b.elemCount},random:function(){return Math.random()}};this.options.getSortData=b.extend(this.options.getSortData,h),this.reloadItems(),this.offset={left:parseInt(this.element.css("padding-left")||0,10),top:parseInt(this.element.css("padding-top")||0,10)};var i=this;setTimeout(function(){i.element.addClass(i.options.containerClass)},0),this.options.resizable&&w.bind("smartresize.isotope",function(){i.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(a){var b=this.options.itemSelector,c=b?a.filter(b).add(a.find(b)):a,d={position:"absolute"};return c=c.filter(function(a,b){return 1===b.nodeType}),this.usingTransforms&&(d.left=0,d.top=0),c.css(d).addClass(this.options.itemClass),this.updateSortData(c,!0),c},_init:function(a){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(a)},option:function(a){if(b.isPlainObject(a)){this.options=b.extend(!0,this.options,a);var c;for(var d in a)c="_update"+g(d),this[c]&&this[c]()}},_updateAnimationEngine:function(){var a,b=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"");switch(b){case"css":case"none":a=!1;
break;case"jquery":a=!0;break;default:a=!f.csstransitions}this.isUsingJQueryAnimation=a,this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){var a=this.usingTransforms=this.options.transformsEnabled&&f.csstransforms&&f.csstransitions&&!this.isUsingJQueryAnimation;a||(delete this.options.hiddenStyle.scale,delete this.options.visibleStyle.scale),this.getPositionStyles=a?this._translate:this._positionAbs},_filter:function(a){var b=""===this.options.filter?"*":this.options.filter;if(!b)return a;var c=this.options.hiddenClass,d="."+c,e=a.filter(d),f=e;if("*"!==b){f=e.filter(b);var g=a.not(d).not(b).addClass(c);this.styleQueue.push({$el:g,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:f,style:this.options.visibleStyle}),f.removeClass(c),a.filter(b)},updateSortData:function(a,c){var d,e,f=this,g=this.options.getSortData;a.each(function(){d=b(this),e={};for(var a in g)e[a]=c||"original-order"!==a?g[a](d,f):b.data(this,"isotope-sort-data")[a];b.data(this,"isotope-sort-data",e)})},_sort:function(){var a=this.options.sortBy,b=this._getSorter,c=this.options.sortAscending?1:-1,d=function(d,e){var f=b(d,a),g=b(e,a);return f===g&&"original-order"!==a&&(f=b(d,"original-order"),g=b(e,"original-order")),(f>g?1:g>f?-1:0)*c};this.$filteredAtoms.sort(d)},_getSorter:function(a,c){return b.data(a,"isotope-sort-data")[c]},_translate:function(a,b){return{translate:[a,b]}},_positionAbs:function(a,b){return{left:a,top:b}},_pushPosition:function(a,b,c){b=Math.round(b+this.offset.left),c=Math.round(c+this.offset.top);var d=this.getPositionStyles(b,c);this.styleQueue.push({$el:a,style:d}),this.options.itemPositionDataEnabled&&a.data("isotope-item-position",{x:b,y:c})},layout:function(a,b){var c=this.options.layoutMode;if(this["_"+c+"Layout"](a),this.options.resizesContainer){var d=this["_"+c+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:d})}this._processStyleQueue(a,b),this.isLaidOut=!0},_processStyleQueue:function(a,c){var d,e,g,h,i=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",j=this.options.animationOptions,k=this.options.onLayout;if(e=function(a,b){b.$el[i](b.style,j)},this._isInserting&&this.isUsingJQueryAnimation)e=function(a,b){d=b.$el.hasClass("no-transition")?"css":i,b.$el[d](b.style,j)};else if(c||k||j.complete){var l=!1,m=[c,k,j.complete],n=this;if(g=!0,h=function(){if(!l){for(var b,c=0,d=m.length;d>c;c++)b=m[c],"function"==typeof b&&b.call(n.element,a,n);l=!0}},this.isUsingJQueryAnimation&&"animate"===i)j.complete=h,g=!1;else if(f.csstransitions){for(var o,p=0,s=this.styleQueue[0],t=s&&s.$el;!t||!t.length;){if(o=this.styleQueue[p++],!o)return;t=o.$el}var u=parseFloat(getComputedStyle(t[0])[r]);u>0&&(e=function(a,b){b.$el[i](b.style,j).one(q,h)},g=!1)}}b.each(this.styleQueue,e),g&&h(),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(a){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,a)},addItems:function(a,b){var c=this._getAtoms(a);this.$allAtoms=this.$allAtoms.add(c),b&&b(c)},insert:function(a,b){this.element.append(a);var c=this;this.addItems(a,function(a){var d=c._filter(a);c._addHideAppended(d),c._sort(),c.reLayout(),c._revealAppended(d,b)})},appended:function(a,b){var c=this;this.addItems(a,function(a){c._addHideAppended(a),c.layout(a),c._revealAppended(a,b)})},_addHideAppended:function(a){this.$filteredAtoms=this.$filteredAtoms.add(a),a.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:a,style:this.options.hiddenStyle})},_revealAppended:function(a,b){var c=this;setTimeout(function(){a.removeClass("no-transition"),c.styleQueue.push({$el:a,style:c.options.visibleStyle}),c._isInserting=!1,c._processStyleQueue(a,b)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(a,b){this.$allAtoms=this.$allAtoms.not(a),this.$filteredAtoms=this.$filteredAtoms.not(a);var c=this,d=function(){a.remove(),b&&b.call(c.element)};a.filter(":not(."+this.options.hiddenClass+")").length?(this.styleQueue.push({$el:a,style:this.options.hiddenStyle}),this._sort(),this.reLayout(d)):d()},shuffle:function(a){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout(a)},destroy:function(){var a=this.usingTransforms,b=this.options;this.$allAtoms.removeClass(b.hiddenClass+" "+b.itemClass).each(function(){var b=this.style;b.position="",b.top="",b.left="",b.opacity="",a&&(b[j]="")});var c=this.element[0].style;for(var d in this.originalStyle)c[d]=this.originalStyle[d];this.element.unbind(".isotope").undelegate("."+b.hiddenClass,"click").removeClass(b.containerClass).removeData("isotope"),w.unbind(".isotope")},_getSegments:function(a){var b,c=this.options.layoutMode,d=a?"rowHeight":"columnWidth",e=a?"height":"width",f=a?"rows":"cols",h=this.element[e](),i=this.options[c]&&this.options[c][d]||this.$filteredAtoms["outer"+g(e)](!0)||h;b=Math.floor(h/i),b=Math.max(b,1),this[c][f]=b,this[c][d]=i},_checkIfSegmentsChanged:function(a){var b=this.options.layoutMode,c=a?"rows":"cols",d=this[b][c];return this._getSegments(a),this[b][c]!==d},_masonryReset:function(){this.masonry={},this._getSegments();var a=this.masonry.cols;for(this.masonry.colYs=[];a--;)this.masonry.colYs.push(0)},_masonryLayout:function(a){var c=this,d=c.masonry;a.each(function(){var a=b(this),e=Math.ceil(a.outerWidth(!0)/d.columnWidth);if(e=Math.min(e,d.cols),1===e)c._masonryPlaceBrick(a,d.colYs);else{var f,g,h=d.cols+1-e,i=[];for(g=0;h>g;g++)f=d.colYs.slice(g,g+e),i[g]=Math.max.apply(Math,f);c._masonryPlaceBrick(a,i)}})},_masonryPlaceBrick:function(a,b){for(var c=Math.min.apply(Math,b),d=0,e=0,f=b.length;f>e;e++)if(b[e]===c){d=e;break}var g=this.masonry.columnWidth*d,h=c;this._pushPosition(a,g,h);var i=c+a.outerHeight(!0),j=this.masonry.cols+1-f;for(e=0;j>e;e++)this.masonry.colYs[d+e]=i},_masonryGetContainerSize:function(){var a=Math.max.apply(Math,this.masonry.colYs);return{height:a}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(a){var c=this,d=this.element.width(),e=this.fitRows;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);0!==e.x&&f+e.x>d&&(e.x=0,e.y=e.height),c._pushPosition(a,e.x,e.y),e.height=Math.max(e.y+g,e.height),e.x+=f})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(a){var c=this,d=this.cellsByRow;a.each(function(){var a=b(this),e=d.index%d.cols,f=Math.floor(d.index/d.cols),g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(a){var c=this;a.each(function(){var a=b(this);c._pushPosition(a,0,c.straightDown.y),c.straightDown.y+=a.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var a=this.masonryHorizontal.rows;for(this.masonryHorizontal.rowXs=[];a--;)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(a){var c=this,d=c.masonryHorizontal;a.each(function(){var a=b(this),e=Math.ceil(a.outerHeight(!0)/d.rowHeight);if(e=Math.min(e,d.rows),1===e)c._masonryHorizontalPlaceBrick(a,d.rowXs);else{var f,g,h=d.rows+1-e,i=[];for(g=0;h>g;g++)f=d.rowXs.slice(g,g+e),i[g]=Math.max.apply(Math,f);c._masonryHorizontalPlaceBrick(a,i)}})},_masonryHorizontalPlaceBrick:function(a,b){for(var c=Math.min.apply(Math,b),d=0,e=0,f=b.length;f>e;e++)if(b[e]===c){d=e;break}var g=c,h=this.masonryHorizontal.rowHeight*d;this._pushPosition(a,g,h);var i=c+a.outerWidth(!0),j=this.masonryHorizontal.rows+1-f;for(e=0;j>e;e++)this.masonryHorizontal.rowXs[d+e]=i},_masonryHorizontalGetContainerSize:function(){var a=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:a}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(a){var c=this,d=this.element.height(),e=this.fitColumns;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);0!==e.y&&g+e.y>d&&(e.x=e.width,e.y=0),c._pushPosition(a,e.x,e.y),e.width=Math.max(e.x+f,e.width),e.y+=g})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(a){var c=this,d=this.cellsByColumn;a.each(function(){var a=b(this),e=Math.floor(d.index/d.rows),f=d.index%d.rows,g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(a){var c=this;a.each(function(){var a=b(this);c._pushPosition(a,c.straightAcross.x,0),c.straightAcross.x+=a.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},b.fn.imagesLoaded=function(a){function c(){a.call(e,f)}function d(a){var e=a.target;e.src!==h&&-1===b.inArray(e,i)&&(i.push(e),--g<=0&&(setTimeout(c),f.unbind(".imagesLoaded",d)))}var e=this,f=e.find("img").add(e.filter("img")),g=f.length,h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i=[];return g||c(),f.bind("load.imagesLoaded error.imagesLoaded",d).each(function(){var a=this.src;this.src=h,this.src=a}),e};var x=function(b){a.console&&a.console.error(b)};b.fn.isotope=function(a,c){if("string"==typeof a){var d=Array.prototype.slice.call(arguments,1);this.each(function(){var c=b.data(this,"isotope");return c?b.isFunction(c[a])&&"_"!==a.charAt(0)?void c[a].apply(c,d):void x("no such method '"+a+"' for isotope instance"):void x("cannot call methods on isotope prior to initialization; attempted to call method '"+a+"'")})}else this.each(function(){var d=b.data(this,"isotope");d?(d.option(a),d._init(c)):b.data(this,"isotope",new b.Isotope(a,this,c))});return this}}(window,a)}function plugin_jquery_jScrollPane(a){var b=a,d=void 0;b.fn.jScrollPane=function(a){function c(a,c){function T(c){var f,q,r,t,u,w,x=!1,y=!1;if(e=c,g===d)u=a.scrollTop(),w=a.scrollLeft(),a.css({overflow:"hidden",padding:0}),h=a.innerWidth()+L,i=a.innerHeight(),a.width(h),g=b('<div class="jspPane" />').css("padding",K).append(a.children()),j=b('<div class="jspContainer" />').css({width:h+"px",height:i+"px"}).append(g).appendTo(a);else{if(a.css("width",""),x=e.stickToBottom&&ob(),y=e.stickToRight&&pb(),t=a.innerWidth()+L!=h||a.outerHeight()!=i,t&&(h=a.innerWidth()+L,i=a.innerHeight(),j.css({width:h+"px",height:i+"px"})),!t&&M==k&&g.outerHeight()==l)return a.width(h),void 0;M=k,g.css("width",""),a.width(h),j.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}g.css("overflow","auto"),k=c.contentWidth?c.contentWidth:g[0].scrollWidth,l=g[0].scrollHeight,g.css("overflow",""),m=k/h,n=l/i,o=n>1,p=m>1,p||o?(a.addClass("jspScrollable"),f=e.maintainPosition&&(s||v),f&&(q=mb(),r=nb()),U(),W(),Y(),f&&(kb(y?k-h:q,!1),jb(x?l-i:r,!1)),tb(),qb(),Ab(),e.enableKeyboardNavigation&&vb(),e.clickOnTrack&&ab(),xb(),e.hijackInternalLinks&&zb()):(a.removeClass("jspScrollable"),g.css({top:0,width:j.width()-L}),rb(),ub(),wb(),bb(),yb()),e.autoReinitialise&&!J?J=setInterval(function(){T(e)},e.autoReinitialiseDelay):!e.autoReinitialise&&J&&clearInterval(J),u&&a.scrollTop(0)&&jb(u,!1),w&&a.scrollLeft(0)&&kb(w,!1),a.trigger("jsp-initialised",[p||o])}function U(){o&&(j.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />'))),w=j.find(">.jspVerticalBar"),x=w.find(">.jspTrack"),q=x.find(">.jspDrag"),e.showArrows&&(B=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",$(0,-1)).bind("click.jsp",sb),C=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",$(0,1)).bind("click.jsp",sb),e.arrowScrollOnHover&&(B.bind("mouseover.jsp",$(0,-1,B)),C.bind("mouseover.jsp",$(0,1,C))),Z(x,e.verticalArrowPositions,B,C)),z=i,j.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){z-=b(this).outerHeight()}),q.hover(function(){q.addClass("jspHover")},function(){q.removeClass("jspHover")}).bind("mousedown.jsp",function(a){b("html").bind("dragstart.jsp selectstart.jsp",sb),q.addClass("jspActive");var c=a.pageY-q.position().top;return b("html").bind("mousemove.jsp",function(a){db(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",cb),!1}),V())}function V(){x.height(z+"px"),s=0,y=e.verticalGutter+x.outerWidth(),g.width(h-y-L);try{0===w.position().left&&g.css("margin-left",y+"px")}catch(a){}}function W(){p&&(j.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />'))),D=j.find(">.jspHorizontalBar"),E=D.find(">.jspTrack"),t=E.find(">.jspDrag"),e.showArrows&&(H=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",$(-1,0)).bind("click.jsp",sb),I=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",$(1,0)).bind("click.jsp",sb),e.arrowScrollOnHover&&(H.bind("mouseover.jsp",$(-1,0,H)),I.bind("mouseover.jsp",$(1,0,I))),Z(E,e.horizontalArrowPositions,H,I)),t.hover(function(){t.addClass("jspHover")},function(){t.removeClass("jspHover")}).bind("mousedown.jsp",function(a){b("html").bind("dragstart.jsp selectstart.jsp",sb),t.addClass("jspActive");var c=a.pageX-t.position().left;return b("html").bind("mousemove.jsp",function(a){fb(a.pageX-c,!1)}).bind("mouseup.jsp mouseleave.jsp",cb),!1}),F=j.innerWidth(),X())}function X(){j.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){F-=b(this).outerWidth()}),E.width(F+"px"),v=0}function Y(){if(p&&o){var a=E.outerHeight(),c=x.outerWidth();z-=a,b(D).find(">.jspCap:visible,>.jspArrow").each(function(){F+=b(this).outerWidth()}),F-=c,i-=c,h-=a,E.parent().append(b('<div class="jspCorner" />').css("width",a+"px")),V(),X()}p&&g.width(j.outerWidth()-L+"px"),l=g.outerHeight(),n=l/i,p&&(G=Math.ceil(1/m*F),G>e.horizontalDragMaxWidth?G=e.horizontalDragMaxWidth:G<e.horizontalDragMinWidth&&(G=e.horizontalDragMinWidth),t.width(G+"px"),u=F-G,gb(v)),o&&(A=Math.ceil(1/n*z),A>e.verticalDragMaxHeight?A=e.verticalDragMaxHeight:A<e.verticalDragMinHeight&&(A=e.verticalDragMinHeight),q.height(A+"px"),r=z-A,eb(s))}function Z(a,b,c,d){var g,e="before",f="after";"os"==b&&(b=/Mac/.test(navigator.platform)?"after":"split"),b==e?f=b:b==f&&(e=b,g=c,c=d,d=g),a[e](c)[f](d)}function $(a,b,c){return function(){return _(a,b,this,c),this.blur(),!1}}function _(a,c,d,g){d=b(d).addClass("jspActive");var h,i,j=!0,k=function(){0!==a&&f.scrollByX(a*e.arrowButtonSpeed),0!==c&&f.scrollByY(c*e.arrowButtonSpeed),i=setTimeout(k,j?e.initialDelay:e.arrowRepeatFreq),j=!1};k(),h=g?"mouseout.jsp":"mouseup.jsp",g=g||b("html"),g.bind(h,function(){d.removeClass("jspActive"),i&&clearTimeout(i),i=null,g.unbind(h)})}function ab(){bb(),o&&x.bind("mousedown.jsp",function(a){if(a.originalTarget===d||a.originalTarget==a.currentTarget){var j,c=b(this),g=c.offset(),h=a.pageY-g.top-s,k=!0,m=function(){var b=c.offset(),d=a.pageY-b.top-A/2,g=i*e.scrollPagePercent,o=r*g/(l-i);if(0>h)s-o>d?f.scrollByY(-g):db(d);else{if(!(h>0))return n(),void 0;d>s+o?f.scrollByY(g):db(d)}j=setTimeout(m,k?e.initialDelay:e.trackClickRepeatFreq),k=!1},n=function(){j&&clearTimeout(j),j=null,b(document).unbind("mouseup.jsp",n)};return m(),b(document).bind("mouseup.jsp",n),!1}}),p&&E.bind("mousedown.jsp",function(a){if(a.originalTarget===d||a.originalTarget==a.currentTarget){var j,c=b(this),g=c.offset(),i=a.pageX-g.left-v,l=!0,m=function(){var b=c.offset(),d=a.pageX-b.left-G/2,g=h*e.scrollPagePercent,o=u*g/(k-h);if(0>i)v-o>d?f.scrollByX(-g):fb(d);else{if(!(i>0))return n(),void 0;d>v+o?f.scrollByX(g):fb(d)}j=setTimeout(m,l?e.initialDelay:e.trackClickRepeatFreq),l=!1},n=function(){j&&clearTimeout(j),j=null,b(document).unbind("mouseup.jsp",n)};return m(),b(document).bind("mouseup.jsp",n),!1}})}function bb(){E&&E.unbind("mousedown.jsp"),x&&x.unbind("mousedown.jsp")}function cb(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),q&&q.removeClass("jspActive"),t&&t.removeClass("jspActive")}function db(a,b){o&&(0>a?a=0:a>r&&(a=r),b===d&&(b=e.animateScroll),b?f.animate(q,"top",a,eb):(q.css("top",a),eb(a)))}function eb(b){b===d&&(b=q.position().top),j.scrollTop(0),s=b;var c=0===s,e=s==r,f=b/r,h=-f*(l-i);(N!=c||P!=e)&&(N=c,P=e,a.trigger("jsp-arrow-change",[N,P,O,Q])),hb(c,e),g.css("top",h),a.trigger("jsp-scroll-y",[-h,c,e]).trigger("scroll")}function fb(a,b){p&&(0>a?a=0:a>u&&(a=u),b===d&&(b=e.animateScroll),b?f.animate(t,"left",a,gb):(t.css("left",a),gb(a)))}function gb(b){b===d&&(b=t.position().left),j.scrollTop(0),v=b;var c=0===v,e=v==u,f=b/u,i=-f*(k-h);(O!=c||Q!=e)&&(O=c,Q=e,a.trigger("jsp-arrow-change",[N,P,O,Q])),ib(c,e),g.css("left",i),a.trigger("jsp-scroll-x",[-i,c,e]).trigger("scroll")}function hb(a,b){e.showArrows&&(B[a?"addClass":"removeClass"]("jspDisabled"),C[b?"addClass":"removeClass"]("jspDisabled"))}function ib(a,b){e.showArrows&&(H[a?"addClass":"removeClass"]("jspDisabled"),I[b?"addClass":"removeClass"]("jspDisabled"))}function jb(a,b){var c=a/(l-i);db(c*r,b)}function kb(a,b){var c=a/(k-h);fb(c*u,b)}function lb(a,c,d){var f,g,k,n,o,p,q,r,s,l=0,m=0;try{f=b(a)}catch(t){return}for(g=f.outerHeight(),k=f.outerWidth(),j.scrollTop(0),j.scrollLeft(0);!f.is(".jspPane");)if(l+=f.position().top,m+=f.position().left,f=f.offsetParent(),/^body|html$/i.test(f[0].nodeName))return;n=nb(),p=n+i,n>l||c?r=l-e.verticalGutter:l+g>p&&(r=l-i+g+e.verticalGutter),r&&jb(r,d),o=mb(),q=o+h,o>m||c?s=m-e.horizontalGutter:m+k>q&&(s=m-h+k+e.horizontalGutter),s&&kb(s,d)}function mb(){return-g.position().left}function nb(){return-g.position().top}function ob(){var a=l-i;return a>20&&a-nb()<10}function pb(){var a=k-h;return a>20&&a-mb()<10}function qb(){j.unbind(S).bind(S,function(a,b,c,d){var g=v,h=s;return f.scrollBy(c*e.mouseWheelSpeed,-d*e.mouseWheelSpeed,!1),g==v&&h==s})}function rb(){j.unbind(S)}function sb(){return!1}function tb(){g.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(a){lb(a.target,!1)})}function ub(){g.find(":input,a").unbind("focus.jsp")}function vb(){function k(){var a=v,b=s;switch(c){case 40:f.scrollByY(e.keyboardSpeed,!1);break;case 38:f.scrollByY(-e.keyboardSpeed,!1);break;case 34:case 32:f.scrollByY(i*e.scrollPagePercent,!1);break;case 33:f.scrollByY(-i*e.scrollPagePercent,!1);break;case 39:f.scrollByX(e.keyboardSpeed,!1);break;case 37:f.scrollByX(-e.keyboardSpeed,!1)}return d=a!=v||b!=s}var c,d,h=[];p&&h.push(D[0]),o&&h.push(w[0]),g.focus(function(){a.focus()}),a.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(a){if(a.target===this||h.length&&b(a.target).closest(h).length){var e=v,f=s;switch(a.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:c=a.keyCode,k();break;case 35:jb(l-i),c=null;break;case 36:jb(0),c=null}return d=a.keyCode==c&&e!=v||f!=s,!d}}).bind("keypress.jsp",function(a){return a.keyCode==c&&k(),!d}),e.hideFocus?(a.css("outline","none"),"hideFocus"in j[0]&&a.attr("hideFocus",!0)):(a.css("outline",""),"hideFocus"in j[0]&&a.attr("hideFocus",!1))}function wb(){a.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function xb(){if(location.hash&&location.hash.length>1){var a,c;try{a=b(location.hash)}catch(d){return}a.length&&g.find(location.hash)&&(0===j.scrollTop()?c=setInterval(function(){j.scrollTop()>0&&(lb(location.hash,!0),b(document).scrollTop(j.position().top),clearInterval(c))},50):(lb(location.hash,!0),b(document).scrollTop(j.position().top)))}}function yb(){b("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function zb(){yb(),b("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var b,a=this.href.split("#");return a.length>1&&(b=a[1],b.length>0&&g.find("#"+b).length>0)?(lb("#"+b,!0),!1):void 0})}function Ab(){var a,b,c,d,e,g=!1;j.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(f){var h=f.originalEvent.touches[0];a=mb(),b=nb(),c=h.pageX,d=h.pageY,e=!1,g=!0}).bind("touchmove.jsp",function(h){if(g){var i=h.originalEvent.touches[0],j=v,k=s;return f.scrollTo(a+c-i.pageX,b+d-i.pageY),e=e||Math.abs(c-i.pageX)>5||Math.abs(d-i.pageY)>5,j==v&&k==s}}).bind("touchend.jsp",function(){g=!1}).bind("click.jsp-touchclick",function(){return e?(e=!1,!1):void 0})}function Bb(){var b=nb(),c=mb();a.removeClass("jspScrollable").unbind(".jsp"),a.replaceWith(R.append(g.children())),R.scrollTop(b),R.scrollLeft(c)}var e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,f=this,N=!0,O=!0,P=!1,Q=!1,R=a.clone(!1,!1).empty(),S=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";K=a.css("paddingTop")+" "+a.css("paddingRight")+" "+a.css("paddingBottom")+" "+a.css("paddingLeft"),L=(parseInt(a.css("paddingLeft"),10)||0)+(parseInt(a.css("paddingRight"),10)||0),b.extend(f,{reinitialise:function(a){a=b.extend({},e,a),T(a)},scrollToElement:function(a,b,c){lb(a,b,c)},scrollTo:function(a,b,c){kb(a,c),jb(b,c)},scrollToX:function(a,b){kb(a,b)},scrollToY:function(a,b){jb(a,b)},scrollToPercentX:function(a,b){kb(a*(k-h),b)},scrollToPercentY:function(a,b){jb(a*(l-i),b)},scrollBy:function(a,b,c){f.scrollByX(a,c),f.scrollByY(b,c)},scrollByX:function(a,b){a=a>=0?Math.max(a,1):Math.min(a,-1);var c=mb()+a,d=c/(k-h);fb(d*u,b)},scrollByY:function(a,b){a=a>=0?Math.max(a,1):Math.min(a,-1);var c=nb()+a,d=c/(l-i);db(d*r,b)},positionDragX:function(a,b){fb(a,b)},positionDragY:function(a,b){db(a,b)},animate:function(a,b,c,d){var f={};f[b]=c,a.animate(f,{duration:e.animateDuration,ease:e.animateEase,queue:!1,step:d})},getContentPositionX:function(){return mb()},getContentPositionY:function(){return nb()},getContentWidth:function(){return k},getContentHeight:function(){return l},getPercentScrolledX:function(){return mb()/(k-h)},getPercentScrolledY:function(){return nb()/(l-i)},getIsScrollableH:function(){return p},getIsScrollableV:function(){return o},getContentPane:function(){return g},scrollToBottom:function(a){db(r,a)},hijackInternalLinks:function(){zb()},destroy:function(){Bb()}}),T(c)}return a=b.extend({},b.fn.jScrollPane.defaults,a),b.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){a[this]=a[this]||a.speed}),this.each(function(){var d=b(this),e=d.data("jsp");e?e.reinitialise(a):(e=new c(d,a),d.data("jsp",e))})},b.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:d,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}function plugin_jquery_twitterTip(a){!function(a){"use strict";var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,c,d){var e,f;this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.enabled=!0,"manual"!=this.options.trigger&&(e="hover"==this.options.trigger?"mouseenter":"focus",f="hover"==this.options.trigger?"mouseleave":"blur",this.$element.bind(e,this.options.selector,a.proxy(this.enter,this)),this.$element.bind(f,this.options.selector,a.proxy(this.leave,this))),this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,b,this.$element.data()),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);c.options.delay&&c.options.delay.show?(c.hoverState="in",setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);c.options.delay&&c.options.delay.hide?(c.hoverState="out",setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},show:function(){var a,b,c,d,e,f,g;if(this.hasContent()&&this.enabled){switch(a=this.tip(),this.setContent(),this.options.animation&&a.addClass("rdr_tw_fade"),f="function"==typeof this.options.placement?this.options.placement.call(this,a[0],this.$element[0]):this.options.placement,b=/rdr_tw_in/.test(f),a.remove().css({top:0,left:0,display:"block"}).appendTo(b?this.$element:document.body),c=this.getPosition(b),d=a[0].offsetWidth,e=a[0].offsetHeight,b?f.split(" ")[1]:f){case"bottom":g={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case"top":g={top:c.top-e-5,left:c.left+c.width/2-d/2};break;case"left":g={top:c.top+c.height/2-e/2,left:c.left-d};break;case"right":g={top:c.top+c.height/2-e/2,left:c.left+c.width}}a.css(g).addClass("rdr_tw_"+f).addClass("rdr_tw_in")}},setContent:function(){var a=this.tip();a.find(".rdr_twtooltip-inner").html(this.getTitle()),a.removeClass("rdr_tw_fade rdr_tw_in rdr_tw_top rdr_tw_bottom rdr_tw_left rdr_tw_right")},hide:function(){function d(){var b=setTimeout(function(){c.off(a.support.transition.end).remove()},500);c.one(a.support.transition.end,function(){clearTimeout(b),c.remove()})}var c=this.tip();c.removeClass("rdr_tw_in"),a.support.transition&&this.$tip.hasClass("rdr_tw_fade")?d():c.remove(),a.support.transition&&this.$tip.hasClass("rdr_tw_fade")},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(b){return a.extend({},b?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title),a=(a||"").toString().replace(/(^\s*|\s*$)/,"")},tip:function(){return this.$tip=this.$tip||a(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("rdr_tw_in")?"hide":"show"]()}},a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("tooltip"),f="object"==typeof c&&c;e||d.data("tooltip",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.tooltip.Constructor=b,a.fn.tooltip.defaults={animation:!0,delay:0,selector:!1,placement:"top",trigger:"hover",title:"",template:'<div class="rdr rdr_twtooltip"><div class="rdr_twtooltip-arrow"></div><div class="rdr_twtooltip-inner"></div></div>'}}(a)}function plugin_rangy(){var a="ins",b=function(){function a(a,b){var c=typeof a[b];return"function"==c||!("object"!=c||!a[b])||"unknown"==c}function b(a,b){return!("object"!=typeof a[b]||!a[b])}function c(a,b){return"undefined"!=typeof a[b]}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&m(a,l)&&o(a,k)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a),p.initialized=!0,p.supported=!1}function g(){if(!p.initialized){var c,d=!1,g=!1;for(a(document,"createRange")&&(c=document.createRange(),m(c,j)&&o(c,i)&&(d=!0),c.detach()),(c=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(c,"createTextRange")&&(c=c.createTextRange(),e(c)&&(g=!0)),!d&&!g&&f("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:d,implementsTextRange:g},d=r.concat(q),g=0,c=d.length;c>g;++g)try{d[g](p)}catch(h){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}}function h(a){this.name=a,this.supported=this.initialized=!1}var i=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],j=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],k=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],l=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"],m=d(a),n=d(b),o=d(c),p={version:"1.2beta2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:m,areHostObjects:n,areHostProperties:o,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=f,p.warn=function(a){a="Rangy warning: "+a,p.config.alertOnWarn?window.alert(a):"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(a)},{}.hasOwnProperty?p.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var q=[],r=[];p.init=g,p.addInitListener=function(a){p.initialized?a(p):q.push(a)};var s=[];p.addCreateMissingNativeApiListener=function(a){s.push(a)},p.createMissingNativeApi=function(a){a=a||window,g();for(var b=0,c=s.length;c>b;++b)s[b](a)},h.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+a)},h.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)},h.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)},p.createModule=function(a,b){var c=new h(a);p.modules[a]=c,r.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},p.requireModules=function(a){for(var d,e,b=0,c=a.length;c>b;++b){if(e=a[b],d=p.modules[e],!(d&&d instanceof h))throw Error("Module '"+e+"' not found");if(!d.supported)throw Error("Module '"+e+"' not supported")}};var t=!1;if(n=function(){t||(t=!0,p.initialized||g())},"undefined"==typeof window)f("No window found");else{if("undefined"!=typeof document)return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",n,!1),a(window,"addEventListener")?window.addEventListener("load",n,!1):a(window,"attachEvent")?window.attachEvent("onload",n):f("Window does not have required addEventListener or attachEvent method"),p;f("No document found")}}();return b.createModule("DomUtil",function(a,b){function c(a){for(var b=0;a=a.previousSibling;)b++;
return b}function d(a,b){var d,c=[];for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(o(c,d))return d;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){if(a=c.parentNode,a===b)return c;c=a}return null}function f(a){return a=a.nodeType,3==a||4==a||8==a}function g(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function h(a){if(9==a.nodeType)return a;if("undefined"!=typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return h(a.parentNode);throw Error("getDocument: no document found for node")}function i(a){return a?f(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName:"[No node]"}function j(a){this._next=this.root=a}function k(a,b){this.node=a,this.offset=b}function l(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var m=a.util;m.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),m.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var n=document.createElement("div");m.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation"),n=document.createTextNode("test"),m.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var o=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};j.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b,a=this._current=this._next;if(this._current)if(b=a.firstChild)this._next=b;else{for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},k.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+i(this.node)+":"+this.offset+")]"}},l.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},l.prototype.toString=function(){return this.message},a.dom={arrayContains:o,getNodeIndex:c,getNodeLength:function(a){var b;return f(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:f,insertAfter:g,splitDataNode:function(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),g(c,a),c},getDocument:h,getWindow:function(a){if(a=h(a),"undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(a){return m.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(a,b,f,g){var h;if(a==f)return b===g?0:g>b?-1:1;if(h=e(f,a,!0))return b<=c(h)?-1:1;if(h=e(a,f,!0))return c(h)<g?-1:1;if(b=d(a,f),a=a===b?b:e(a,b,!0),f=f===b?b:e(f,b,!0),a===f)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(b=b.firstChild;b;){if(b===a)return-1;if(b===f)return 1;b=b.nextSibling}throw Error("Should not be here!")},inspectNode:i,createIterator:function(a){return new j(a)},DomPosition:k},a.DOMException=l}),b.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(H.isAncestorOf(a,b.startContainer,!0)||H.isAncestorOf(a,b.endContainer,!0))}function c(a){return H.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var d=0,e=b.length;e>d;++d)b[d].call(a,{target:a,args:c})}function e(a){return new I(a.parentNode,H.getNodeIndex(a))}function f(a){return new I(a.parentNode,H.getNodeIndex(a)+1)}function g(a,b,c){var d=11==a.nodeType?a.firstChild:a;return H.isCharacterDataNode(b)?c==b.length?H.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:H.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function h(a){for(var b,d,e=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(b=a.getSubtreeIterator(),d.appendChild(h(b)),b.detach(!0)),10==d.nodeType)throw new J("HIERARCHY_REQUEST_ERR");e.appendChild(d)}return e}function i(a,b,c){var d,e;for(c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree()){if(b(d)===!1)return c.stop=!0,void 0;if(d=a.getSubtreeIterator(),i(d,b,c),d.detach(!0),c.stop)return}else for(d=H.createIterator(d);e=d.next();)if(b(e)===!1)return c.stop=!0,void 0}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,e,d=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),e=a.getSubtreeIterator(),b.appendChild(k(e)),e.detach(!0)):a.remove(),10==b.nodeType)throw new J("HIERARCHY_REQUEST_ERR");d.appendChild(b)}return d}function l(a,b,c){var e,d=!(!b||!b.length),f=!!c;d&&(e=RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(a){d&&!e.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function m(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+H.inspectNode(a.startContainer)+":"+a.startOffset+", "+H.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&H.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||H.isCharacterDataNode(this.sc)?H.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||H.isCharacterDataNode(this.ec)?H.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a,b,c){this.nodes=l(a,b,c),this._next=this.nodes[0],this._position=0}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,H.arrayContains(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(R(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function s(a){if(!a.startContainer)throw new J("INVALID_STATE_ERR")}function t(a,b){if(!H.arrayContains(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function u(a,b){if(0>b||b>(H.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new J("INDEX_SIZE_ERR")}function v(a,b){if(P(a,!0)!==P(b,!0))throw new J("WRONG_DOCUMENT_ERR")}function w(a){if(Q(a,!0))throw new J("NO_MODIFICATION_ALLOWED_ERR")}function x(a,b){if(!a)throw new J(b)}function y(a){s(a),(H.arrayContains(L,a.startContainer.nodeType)||P(a.startContainer,!0))&&(H.arrayContains(L,a.endContainer.nodeType)||P(a.endContainer,!0))&&a.startOffset<=(H.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(H.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)||RDR.actions.catchRangyErrors("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function z(){}function A(a){a.START_TO_START=T,a.START_TO_END=U,a.END_TO_END=V,a.END_TO_START=W,a.NODE_BEFORE=X,a.NODE_AFTER=Y,a.NODE_BEFORE_AND_AFTER=Z,a.NODE_INSIDE=$}function B(a){A(a),A(a.prototype)}function C(a,b){return function(){y(this);var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,g=new n(this,!0);return c!==e&&(c=H.getClosestAncestorIn(c,e,!0),d=f(c),c=d.node,d=d.offset),i(g,w),g.reset(),e=a(g),g.detach(),b(this,c,d,c,d),e}}function D(c,d,g){function h(a,b){return function(c){s(this),t(c,K),t(O(c),L),c=(a?e:f)(c),(b?i:l)(this,c.node,c.offset)}}function i(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==this.startOffset)&&((O(b)!=O(e)||1==H.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function l(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==this.endOffset)&&((O(b)!=O(e)||-1==H.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}function m(a,b,c){(b!==a.startContainer||c!==this.startOffset||b!==a.endContainer||c!==this.endOffset)&&d(a,b,c,b,c)}c.prototype=new z,a.util.extend(c.prototype,{setStart:function(a,b){s(this),r(a,!0),u(a,b),i(this,a,b)},setEnd:function(a,b){s(this),r(a,!0),u(a,b),l(this,a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){y(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){s(this),r(a,!0),d(this,a,0,a,H.getNodeLength(a))},selectNode:function(a){s(this),r(a,!1),t(a,K);var b=e(a);a=f(a),d(this,b.node,b.offset,a.node,a.offset)},extractContents:C(k,d),deleteContents:C(j,d),canSurroundContents:function(){y(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},detach:function(){g(this)},splitBoundaries:function(){y(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;H.isCharacterDataNode(c)&&e>0&&e<c.length&&H.splitDataNode(c,e),H.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=H.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=H.getNodeIndex(a)&&e++,b=0),d(this,a,b,c,e)},normalizeBoundaries:function(){y(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;b=f.length,d.insertData(0,f.data),f.parentNode.removeChild(f),a==c?(e+=b,c=a):c==d.parentNode&&(f=H.getNodeIndex(d),e==f?(c=d,e=g):e>f&&e--)}},h=!0;H.isCharacterDataNode(c)?c.length==e&&f(c):(e>0&&(h=c.childNodes[e-1])&&H.isCharacterDataNode(h)&&f(h),h=!this.collapsed),h?H.isCharacterDataNode(a)?0==b&&g(a):b<a.childNodes.length&&(f=a.childNodes[b])&&H.isCharacterDataNode(f)&&g(f):(a=c,b=e),d(this,a,b,c,e)},collapseToPoint:function(a,b){y(this),r(a,!0),u(a,b),m(this,a,b)}}),B(c)}function E(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:H.getCommonAncestor(a.startContainer,a.endContainer)}function F(a,b,c,e,f){var g=a.startContainer!==b||a.startOffset!==c,h=a.endContainer!==e||a.endOffset!==f;a.startContainer=b,a.startOffset=c,a.endContainer=e,a.endOffset=f,E(a),d(a,"boundarychange",{startMoved:g,endMoved:h})}function G(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},E(this)}a.requireModules(["DomUtil"]);var H=a.dom,I=H.DomPosition,J=a.DOMException;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,H.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var b,c,a=this._current;!H.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b))},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new G(c(this.range));var b=this._current,d=b,e=0,f=b,g=H.getNodeLength(b);H.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),H.isAncestorOf(b,this.ec,!0)&&(f=this.ec,g=this.eo),F(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var K=[1,3,4,5,7,8,10],L=[2,9,11],M=[1,3,4,5,7,8,10,11],N=[1,3,4,5,7,8],O=H.getRootContainer,P=q([9,11]),Q=q([5,6,10,12]),R=q([6,10,12]),S=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],T=0,U=1,V=2,W=3,X=0,Y=1,Z=2,$=3;z.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){y(this),v(this.startContainer,b.startContainer);var c=a==W||a==T?"start":"end",d=a==U||a==T?"start":"end";return H.comparePoints(this[c+"Container"],this[c+"Offset"],b[d+"Container"],b[d+"Offset"])},insertNode:function(a){if(y(this),t(a,M),w(this.startContainer),H.isAncestorOf(a,this.startContainer,!0))throw new J("HIERARCHY_REQUEST_ERR");this.setStartBefore(g(a,this.startContainer,this.startOffset))},cloneContents:function(){y(this);var a,b;return this.collapsed?c(this).createDocumentFragment():this.startContainer===this.endContainer&&H.isCharacterDataNode(this.startContainer)?(a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b):(b=new n(this,!0),a=h(b),b.detach(),a)},canSurroundContents:function(){y(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(t(a,N),!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){y(this);for(var d,a=new G(c(this)),b=S.length;b--;)d=S[b],a[d]=this[d];return a},toString:function(){y(this);var a=this.startContainer;if(a===this.endContainer&&H.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[];return a=new n(this,!0),i(a,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),a.detach(),b.join("")},compareNode:function(a){y(this);var b=a.parentNode,c=H.getNodeIndex(a);if(!b)throw new J("NOT_FOUND_ERR");return a=this.comparePoint(b,c),b=this.comparePoint(b,c+1),0>a?b>0?Z:X:b>0?Y:$},comparePoint:function(a,b){return y(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),H.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:H.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:function(a){s(this);var b=c(this),d=b.createElement("div");for(d.innerHTML=a,a=b.createDocumentFragment();b=d.firstChild;)a.appendChild(b);return a},toHtml:function(){y(this);var a=c(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(y(this),x(a,"NOT_FOUND_ERR"),H.getDocument(a)!==c(this))return!1;var d=a.parentNode,e=H.getNodeIndex(a);x(d,"NOT_FOUND_ERR");var f=H.comparePoints(d,e,this.endContainer,this.endOffset);return d=H.comparePoints(d,e+1,this.startContainer,this.startOffset),b?0>=f&&d>=0:0>f&&d>0},isPointInRange:function(a,b){return y(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),H.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&H.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(y(this),c(a)!=c(this))throw new J("WRONG_DOCUMENT_ERR");var d=H.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=H.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=d&&e>=0:0>d&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=H.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=H.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return-1==H.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==H.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==$},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,H.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return c.length>0?(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){return y(this),new p(this,a,b)},getNodes:function(a,b){return y(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){s(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){s(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return G.rangesEqual(this,a)},inspect:function(){return m(this)}},D(G,F,function(a){s(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,d(a,"detach",null),a._listeners=null}),a.rangePrototype=z.prototype,G.rangeProperties=S,G.RangeIterator=n,G.copyComparisonConstants=B,G.createPrototypeRange=D,G.inspect=m,G.getRangeDocument=c,G.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=G,a.RangeException=o}),b.createModule("WrappedRange",function(b){function c(b,c,d,e){var h=b.duplicate();h.collapse(d);var i=h.parentElement();if(f.isAncestorOf(c,i,!0)||(i=c),!i.canHaveHTML)return new g(i.parentNode,f.getNodeIndex(i));c=f.getDocument(i).createElement(a);var j,k=d?"StartToStart":"StartToEnd";do i.insertBefore(c,c.previousSibling),h.moveToElementText(c);while((j=h.compareEndPoints(k,b))>0&&c.previousSibling);if(k=c.nextSibling,-1==j&&k&&f.isCharacterDataNode(k)){if(h.setEndPoint(d?"EndToStart":"EndToEnd",b),/[\r\n]/.test(k.data))for(i=h.duplicate(),d=i.text.replace(/\r\n/g,"\r").length,d=i.moveStart("character",d);-1==i.compareEndPoints("StartToEnd",i);)d++,i.moveStart("character",1);else d=h.text.length;i=new g(k,d)}else k=(e||!d)&&c.previousSibling,i=(d=(e||d)&&c.nextSibling)&&f.isCharacterDataNode(d)?new g(d,0):k&&f.isCharacterDataNode(k)?new g(k,k.length):new g(i,f.getNodeIndex(c));return c.parentNode.removeChild(c),i}function d(b,c){var d,e,g=b.offset,h=f.getDocument(b.node),i=h.body.createTextRange(),j=f.isCharacterDataNode(b.node);return j?(d=b.node,e=d.parentNode):(d=b.node.childNodes,d=g<d.length?d[g]:null,e=b.node),h=h.createElement(a),h.innerHTML="&#feff;",d?e.insertBefore(h,d):e.appendChild(h),i.moveToElementText(h),i.collapse(!c),e.removeChild(h),j&&i[c?"moveStart":"moveEnd"]("character",g),i}b.requireModules(["DomUtil","DomRange"]);var e,f=b.dom,g=f.DomPosition,h=b.DomRange;if(!b.features.implementsDomRange||b.features.implementsTextRange&&b.config.preferTextRange){if(b.features.implementsTextRange){e=function(a){this.textRange=a,this.refresh()},e.prototype=new h(document),e.prototype.refresh=function(){var a,b,d=this.textRange;a=d.parentElement();var e=d.duplicate();e.collapse(!0),b=e.parentElement(),e=d.duplicate(),e.collapse(!1),d=e.parentElement(),b=b==d?b:f.getCommonAncestor(b,d),b=b==a?b:f.getCommonAncestor(a,b),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=a=c(this.textRange,b,!0,!0):(a=c(this.textRange,b,!0,!1),b=c(this.textRange,b,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},e.rangeToTextRange=function(a){if(a.collapsed)return d(new g(a.startContainer,a.startOffset),!0);var b=d(new g(a.startContainer,a.startOffset),!0),c=d(new g(a.endContainer,a.endOffset),!1);return a=f.getDocument(a.startContainer).body.createTextRange(),a.setEndPoint("StartToStart",b),a.setEndPoint("EndToEnd",c),a},h.copyComparisonConstants(e);var i=function(){return this}();"undefined"==typeof i.Range&&(i.Range=e),b.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function a(a){for(var d,b=c.length;b--;)d=c[b],a[d]=a.nativeRange[d]}var b,d,g,c=h.rangeProperties;e=function(b){if(!b)throw Error("Range must be specified");this.nativeRange=b,a(this)},h.createPrototypeRange(e,function(a,b,c,d,e){var f=a.endContainer!==d||a.endOffset!=e;(a.startContainer!==b||a.startOffset!=c||f)&&(a.setEnd(d,e),a.setStart(b,c))},function(a){a.nativeRange.detach(),a.detached=!0;for(var d,b=c.length;b--;)d=c[b],a[d]=null}),b=e.prototype,b.selectNode=function(b){this.nativeRange.selectNode(b),a(this)},b.deleteContents=function(){this.nativeRange.deleteContents(),a(this)},b.extractContents=function(){var b=this.nativeRange.extractContents();return a(this),b},b.cloneContents=function(){return this.nativeRange.cloneContents()},b.surroundContents=function(b){this.nativeRange.surroundContents(b),a(this)},b.collapse=function(b){this.nativeRange.collapse(b),a(this)},b.cloneRange=function(){return new e(this.nativeRange.cloneRange())},b.refresh=function(){a(this)},b.toString=function(){return this.nativeRange.toString()};var i=document.createTextNode("test");f.getBody(document).appendChild(i);var j=document.createRange();j.setStart(i,0),j.setEnd(i,0);try{j.setStart(i,1),d=!0,b.setStart=function(b,c){this.nativeRange.setStart(b,c),a(this)},b.setEnd=function(b,c){this.nativeRange.setEnd(b,c),a(this)},g=function(b){return function(c){this.nativeRange[b](c),a(this)}}}catch(k){d=!1,b.setStart=function(b,c){try{this.nativeRange.setStart(b,c)}catch(d){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}a(this)},b.setEnd=function(b,c){try{this.nativeRange.setEnd(b,c)}catch(d){this.nativeRange.setStart(b,c),this.nativeRange.setEnd(b,c)}a(this)},g=function(b,c){return function(d){try{this.nativeRange[b](d)}catch(e){this.nativeRange[c](d),this.nativeRange[b](d)}a(this)}}}b.setStartBefore=g("setStartBefore","setEndBefore"),b.setStartAfter=g("setStartAfter","setEndAfter"),b.setEndBefore=g("setEndBefore","setStartBefore"),b.setEndAfter=g("setEndAfter","setStartAfter"),j.selectNodeContents(i),b.selectNodeContents=j.startContainer==i&&j.endContainer==i&&0==j.startOffset&&j.endOffset==i.length?function(b){this.nativeRange.selectNodeContents(b),a(this)}:function(a){this.setStart(a,0),this.setEnd(a,h.getEndOffset(a))},j.selectNodeContents(i),j.setEnd(i,3),d=document.createRange(),d.selectNodeContents(i),d.setEnd(i,4),d.setStart(i,2),b.compareBoundaryPoints=-1==j.compareBoundaryPoints(j.START_TO_END,d)&1==j.compareBoundaryPoints(j.END_TO_START,d)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},f.getBody(document).removeChild(i),j.detach(),d.detach()}(),b.createNativeRange=function(a){return a=a||document,a.createRange()};e.prototype.getName=function(){return"WrappedRange"},b.WrappedRange=e,b.createRange=function(a){return a=a||document,new e(b.createNativeRange(a))},b.createRangyRange=function(a){return a=a||document,new h(a)},b.createIframeRange=function(a){return b.createRange(f.getIframeDocument(a))},b.createIframeRangyRange=function(a){return b.createRangyRange(f.getIframeDocument(a))},b.addCreateMissingNativeApiListener(function(a){a=a.document,"undefined"==typeof a.createRange&&(a.createRange=function(){return b.createRange(this)}),a=a=null})}),b.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start";c=c?"start":"end",a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[c+"Container"],a.focusOffset=b[c+"Offset"]}function f(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function g(b){var c;return b instanceof r?(c=b._selectionNativeRange,c||(c=a.createNativeRange(p.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof s?c=b.nativeRange:a.features.implementsDomRange&&b instanceof p.getWindow(b.startContainer).Range&&(c=b),c}function h(a){var c,b=a.getNodes();a:if(b.length&&1==b[0].nodeType){c=1;for(var d=b.length;d>c;++c)if(!p.isAncestorOf(b[0],b[c])){c=!1;break a}c=!0}else c=!1;if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function i(a,b){var c=new s(b);a._ranges=[c],e(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function j(b){if(b._ranges.length=0,"None"==b.docSelection.type)f(b);else{var c=b.docSelection.createRange();if(c&&"undefined"!=typeof c.text)i(b,c);else{b.rangeCount=c.length;for(var d,g=p.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(g),d.selectNode(c.item(h)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,e(b,b._ranges[b.rangeCount-1],!1)}}}function k(a,b){var c=a.docSelection.createRange(),d=h(b),e=p.getDocument(c.item(0));e=p.getBody(e).createControlRange();for(var f=0,g=c.length;g>f;++f)e.add(c.item(f));try{e.add(d)}catch(i){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}e.select(),j(a)}function l(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function m(a,b){var c=p.getDocument(b[0].startContainer);c=p.getBody(c).createControlRange();for(var e,d=0;rangeCount>d;++d){e=h(b[d]);try{c.add(e)}catch(f){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}c.select(),j(a)}function n(a,b){if(a.anchorNode&&p.getDocument(a.anchorNode)!==p.getDocument(b))throw new t("WRONG_DOCUMENT_ERR")}function o(a){var b=[],c=new u(a.anchorNode,a.anchorOffset),d=new u(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=r.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var v,w,p=a.dom,q=a.util,r=a.DomRange,s=a.WrappedRange,t=a.DOMException,u=p.DomPosition,x=a.util.isHostMethod(window,"getSelection"),y=a.util.isHostObject(document,"selection"),z=y&&(!x||a.config.preferTextRange);z?(v=d,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||p.getDocument(b.createRange().parentElement())==a}):x?(v=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=v,x=v();var A=a.createNativeRange(document),B=p.getBody(document),C=q.areHostObjects(x,q.areHostProperties(x,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=C;var D=q.isHostMethod(x,"extend");a.features.selectionHasExtend=D;var E="number"==typeof x.rangeCount;a.features.selectionHasRangeCount=E;var F=!1,G=!0;q.areHostMethods(x,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof x.rangeCount&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");B.appendChild(a);var b=p.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=p.getIframeWindow(a).getSelection(),d=b.documentElement.lastChild.firstChild;b=b.createRange(),b.setStart(d,1),b.collapse(!0),c.addRange(b),G=1==c.rangeCount,c.removeAllRanges();var e=b.cloneRange();b.setStart(d,0),e.setEnd(d,2),c.addRange(b),c.addRange(e),F=2==c.rangeCount,b.detach(),e.detach(),B.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=F,a.features.collapsedNonEditableSelectionsSupported=G;var I,H=!1;B&&q.isHostMethod(B,"createControlRange")&&(I=B.createControlRange(),q.areHostProperties(I,["item","add"])&&(H=!0)),a.features.implementsControlRange=H,w=C?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var J;if(q.isHostMethod(x,"getRangeAt")?J=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:C&&(J=function(b){var c=p.getDocument(b.anchorNode);return c=a.createRange(c),c.setStart(b.anchorNode,b.anchorOffset),c.setEnd(b.focusNode,b.focusOffset),c.collapsed!==this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),c.setEnd(b.anchorNode,b.anchorOffset)),c}),a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=v(a),e=y?d(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new l(c,e,a),a._rangySelection=b),b},a.getIframeSelection=function(b){return a.getSelection(p.getIframeWindow(b))},I=l.prototype,!z&&C&&q.areHostMethods(x,["removeAllRanges","addRange"])){I.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),f(this)};var K=function(b,c){var d=r.getRangeDocument(c);d=a.createRange(d),d.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(g(d)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};I.addRange=E?function(b,c){if(H&&y&&"Control"==this.docSelection.type)k(this,b);else if(c&&D)K(this,b);else{var d;F?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(g(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1?(a.config.checkSelectionRanges&&(d=J(this.nativeSelection,this.rangeCount-1))&&!r.rangesEqual(d,b)&&(b=new s(d)),this._ranges[this.rangeCount-1]=b,e(this,b,N(this.nativeSelection)),this.isCollapsed=w(this)):this.refresh()}}:function(a,b){b&&D?K(this,a):(this.nativeSelection.addRange(g(a)),this.refresh())},I.setRanges=function(a){if(H&&a.length>1)m(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(q.isHostMethod(x,"empty")&&q.isHostMethod(A,"select")&&H&&z))return b.fail("No means of selecting a Range or TextRange was found"),!1;I.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=p.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=p.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}f(this)},I.addRange=function(a){"Control"==this.docSelection.type?k(this,a):(s.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))
},I.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?m(this,a):b&&this.addRange(a[0])}}I.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new t("INDEX_SIZE_ERR");return this._ranges[a]};var L;if(z)L=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=p.getBody(b.win.document).createTextRange(),c.collapse(!0)),"Control"==b.docSelection.type?j(b):c&&"undefined"!=typeof c.text?i(b,c):f(b)};else if(q.isHostMethod(x,"getRangeAt")&&"number"==typeof x.rangeCount)L=function(b){if(H&&y&&"Control"==b.docSelection.type)j(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],N(b.nativeSelection)),b.isCollapsed=w(b)}else f(b)};else{if(!C||"boolean"!=typeof x.isCollapsed||"boolean"!=typeof A.collapsed||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;L=function(a){var b;b=a.nativeSelection,b.anchorNode?(b=J(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=w(a)):f(a)}}I.refresh=function(a){var b=a?this._ranges.slice(0):null;if(L(this),a){if(a=b.length,a!=this._ranges.length)return!1;for(;a--;)if(!r.rangesEqual(b[a],this._ranges[a]))return!1;return!0}};var M=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,g=c.length;g>e;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||f(a)};I.removeRange=H?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=h(a);var c=p.getDocument(b.item(0));c=p.getBody(c).createControlRange();for(var d,e=!1,f=0,g=b.length;g>f;++f)d=b.item(f),d!==a||e?c.add(b.item(f)):e=!0;c.select(),j(this)}else M(this,a)}:function(a){M(this,a)};var N;!z&&C&&a.features.implementsDomRange?(N=function(a){var b=!1;return a.anchorNode&&(b=1==p.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},I.isBackwards=function(){return N(this)}):N=I.isBackwards=function(){return!1},I.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},I.collapse=function(b,c){n(this,b);var d=a.createRange(p.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},I.collapseToStart=function(){if(!this.rangeCount)throw new t("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},I.collapseToEnd=function(){if(!this.rangeCount)throw new t("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},I.selectAllChildren=function(b){n(this,b);var c=a.createRange(p.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},I.deleteFromDocument=function(){if(H&&y&&"Control"==this.docSelection.type){for(var b,a=this.docSelection.createRange();a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges(),this.removeAllRanges(),b=0;for(var c=a.length;c>b;++b)a[b].deleteContents();this.addRange(a[c-1])}},I.getAllRanges=function(){return this._ranges.slice(0)},I.setSingleRange=function(a){this.setRanges([a])},I.containsNode=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},I.toHtml=function(){var a="";if(this.rangeCount){a=r.getRangeDocument(this._ranges[0]).createElement("div");for(var b=0,c=this._ranges.length;c>b;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a},I.getName=function(){return"WrappedSelection"},I.inspect=function(){return o(this)},I.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null},l.inspect=o,a.Selection=l,a.selectionPrototype=I,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})}),b.createModule("CssClassApplier",function(b){function c(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function d(a,b){return a.className&&RegExp("(?:^|\\s)"+b+"(?:\\s|$)").test(a.className)}function e(a,b){a.className?d(a,b)||(a.className+=" "+b):a.className=b}function f(a){return a.className.split(/\s+/).sort().join(" ")}function g(a,b){return f(a)==f(b)}function h(a){for(var b=a.parentNode;a.hasChildNodes();)b.insertBefore(a.firstChild,a);b.removeChild(a)}function i(a,b){var c=a.cloneRange();c.selectNodeContents(b);var d=c.intersection(a);return d=d?d.toString():"",c.detach(),""!=d}function j(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var e,f,c=0,d=a.attributes.length;d>c;++c)if(e=a.attributes[c],f=e.name,"class"!=f){if(f=b.attributes.getNamedItem(f),e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}return!0}function k(a){for(var b=0,c=a.attributes.length;c>b;++b)if(a.attributes[b].specified&&"class"!=a.attributes[b].name)return!0;return!1}function l(a,b){return q.isCharacterDataNode(a)?0==b?!!a.previousSibling:b==a.length?!!a.nextSibling:!0:b>0&&b<a.childNodes.length}function m(a,b,c){var d;if(q.isCharacterDataNode(b)&&(0==c?(c=q.getNodeIndex(b),b=b.parentNode):c==b.length?(c=q.getNodeIndex(b)+1,b=b.parentNode):d=q.splitDataNode(b,c)),!d){d=b.cloneNode(!1),d.id&&d.removeAttribute("id");for(var e;e=b.childNodes[c];)d.appendChild(e);q.insertAfter(d,b)}return b==a?d:m(a,d.parentNode,q.getNodeIndex(d))}function n(a,b){var c=3==a.nodeType,d=c?a.parentNode:a,e=b?"nextSibling":"previousSibling";if(c){if((c=a[e])&&3==c.nodeType)return c}else if((c=d[e])&&a.tagName==c.tagName&&g(a,c)&&j(a,c))return c[b?"firstChild":"lastChild"];return null}function o(a){this.firstTextNode=(this.isElementMerge=1==a.nodeType)?a.lastChild:a,this.isElementMerge&&(this.sortedCssClasses=f(a)),this.textNodes=[this.firstTextNode]}function p(a,b,d){if(this.cssClass=a,this.normalize=b,this.applyToAnytagBody=!1,a=typeof d,"string"==a)"*"==d?this.applyToAnytagBody=!0:this.tagNames=c(d.toLowerCase()).split(/\s*,\s*/);else if("object"==a&&"number"==typeof d.length)for(this.tagNames=[],a=0,b=d.length;b>a;++a)"*"==d[a]?this.applyToAnytagBody=!0:this.tagNames.push(d[a].toLowerCase());else this.tagNames=[r]}b.requireModules(["WrappedSelection","WrappedRange"]);var q=b.dom,r=a,s=function(){function a(a,b,c){return b&&c?" ":""}return function(b,c){b.className&&(b.className=b.className.replace(RegExp("(?:^|\\s)"+c+"(?:\\s|$)"),a))}}();o.prototype={doMerge:function(){for(var b,c,a=[],d=0,e=this.textNodes.length;e>d;++d)b=this.textNodes[d],c=b.parentNode,a[d]=b.data,d&&(c.removeChild(b),c.hasChildNodes()||c.parentNode.removeChild(c));return this.firstTextNode.data=a=a.join("")},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;c>b;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}},p.prototype={appliesToElement:function(a){return this.applyToAnytagBody||q.arrayContains(this.tagNames,a.tagName.toLowerCase())},getAncestorWithClass:function(a){for(a=a.parentNode;a;){if(1==a.nodeType&&this.appliesToElement(a)&&d(a,this.cssClass))return a;a=a.parentNode}return!1},postApply:function(a,b){for(var f,k,l,c=a[0],d=a[a.length-1],e=[],g=c,h=d,i=0,j=d.length,m=0,p=a.length;p>m;++m)k=a[m],(l=n(k,!1))?(f||(f=new o(l),e.push(f)),f.textNodes.push(k),k===c&&(g=f.firstTextNode,i=g.length),k===d&&(h=f.firstTextNode,j=f.getLength())):f=null;if((c=n(d,!0))&&(f||(f=new o(d),e.push(f)),f.textNodes.push(c)),e.length){for(m=0,p=e.length;p>m;++m)e[m].doMerge();b.setStart(g,i),b.setEnd(h,j)}},createContainer:function(a){return a=a.createElement(r),a.className=this.cssClass,a},applyToTextNode:function(a){var b=a.parentNode;1==b.childNodes.length&&this.appliesToElement(b)?e(b,this.cssClass):(b=this.createContainer(q.getDocument(a)),a.parentNode.insertBefore(b,a),b.appendChild(a))},isRemovable:function(a){return a.tagName.toLowerCase()==r&&c(a.className)==this.cssClass&&!k(a)},undoToTextNode:function(a,b,c){b.containsNode(c)||(a=b.cloneRange(),a.selectNode(c),a.isPointInRange(b.endContainer,b.endOffset)&&l(b.endContainer,b.endOffset)&&(m(c,b.endContainer,b.endOffset),b.setEndAfter(c)),a.isPointInRange(b.startContainer,b.startOffset)&&l(b.startContainer,b.startOffset)&&(c=m(c,b.startContainer,b.startOffset))),this.isRemovable(c)?h(c):s(c,this.cssClass)},applyToRange:function(a){a.splitBoundaries();var b=a.getNodes([3],function(b){return i(a,b)});if(b.length){for(var c,d=0,e=b.length;e>d;++d)c=b[d],this.getAncestorWithClass(c)||this.applyToTextNode(c);a.setStart(b[0],0),c=b[b.length-1],a.setEnd(c,c.length),this.normalize&&this.postApply(b,a)}},applyToSelection:function(a){a=a||window,a=b.getSelection(a);var c,d=a.getAllRanges();a.removeAllRanges();for(var e=d.length;e--;)c=d[e],this.applyToRange(c),a.addRange(c)},undoToRange:function(a){a.splitBoundaries();var c,d,b=a.getNodes([3]),e=b[b.length-1];if(b.length){for(var f=0,g=b.length;g>f;++f)c=b[f],(d=this.getAncestorWithClass(c))&&this.undoToTextNode(c,a,d),a.setStart(b[0],0),a.setEnd(e,e.length);this.normalize&&this.postApply(b,a)}},undoToSelection:function(a){a=a||window,a=b.getSelection(a);var d,c=a.getAllRanges();a.removeAllRanges();for(var e=0,f=c.length;f>e;++e)d=c[e],this.undoToRange(d),a.addRange(d)},isAppliedToRange:function(a){for(var b=a.getNodes([3]),c=0,d=b.length;d>c;++c)if(i(a,b[c])&&!this.getAncestorWithClass(b[c]))return!1;return!0},isAppliedToSelection:function(a){a=a||window,a=b.getSelection(a).getAllRanges();for(var c=a.length;c--;)if(!this.isAppliedToRange(a[c]))return!1;return!0},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},detach:function(){}},p.util={hasClass:d,addClass:e,removeClass:s,hasSameClasses:g,replaceWithOwnChildren:h,elementsHaveSameNonClassAttributes:j,elementHasNonClassAttributes:k,splitNodeAt:m},b.CssClassApplier=p,b.createCssClassApplier=function(a,b,c){return new p(a,b,c)}}),b.createModule("SaveRestore",function(b,c){function d(b,c){var e,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),f=h.getDocument(b.startContainer),g=b.cloneRange();return g.collapse(c),e=f.createElement(a),e.id=d,e.style.lineHeight="0",e.style.display="none",e.appendChild(f.createTextNode(i)),g.insertNode(e),g.detach(),e}function e(a,b,d,e){(a=(a||document).getElementById(d))?(b[e?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):c.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(a,b){var c=(a||document).getElementById(b);c&&c.parentNode.removeChild(c)}b.requireModules(["DomUtil","DomRange","WrappedRange"]);var h=b.dom,i="\ufeff";b.saveSelection=function(a){a=a||window;var e=a.document;if(b.isSelectionValid(a)){var j,k,g=b.getSelection(a),h=g.getAllRanges(),i=[];h.sort(f);for(var l=0,m=h.length;m>l;++l)j=h[l],j.collapsed?(k=d(j,!1),i.push({markerId:k.id,collapsed:!0})):(k=d(j,!1),j=d(j,!0),i[l]={startMarkerId:j.id,endMarkerId:k.id,collapsed:!1,backwards:1==h.length&&g.isBackwards()});for(l=m-1;l>=0;--l)j=h[l],j.collapsed?j.collapseBefore((e||document).getElementById(i[l].markerId)):(j.setEndBefore((e||document).getElementById(i[l].endMarkerId)),j.setStartAfter((e||document).getElementById(i[l].startMarkerId)));return g.setRanges(h),{win:a,doc:e,rangeInfos:i,restored:!1}}c.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.")},b.restoreSelection=function(a,d){if(!a.restored){for(var k,l,f=a.rangeInfos,g=b.getSelection(a.win),h=[],i=f.length,j=i-1;j>=0;--j){if(k=f[j],l=b.createRange(a.doc),k.collapsed)if(k=(a.doc||document).getElementById(k.markerId)){k.style.display="inline";var m=k.previousSibling;m&&3==m.nodeType?(k.parentNode.removeChild(k),l.collapseToPoint(m,m.length)):(l.collapseBefore(k),k.parentNode.removeChild(k))}else c.warn("Marker element has been removed. Cannot restore selection.");else e(a.doc,l,k.startMarkerId,!0),e(a.doc,l,k.endMarkerId,!1);1==i&&l.normalizeBoundaries(),h[j]=l}1==i&&d&&b.features.selectionHasExtend&&f[0].backwards?(g.removeAllRanges(),g.addRange(h[0],!0)):g.setRanges(h),a.restored=!0}},b.removeMarkerElement=g,b.removeMarkers=function(a){for(var e,b=a.rangeInfos,c=0,d=b.length;d>c;++c)e=b[c],e.collapsed?g(a.doc,e.markerId):(g(a.doc,e.startMarkerId),g(a.doc,e.endMarkerId))}}),b.createModule("Serializer",function(a,c){function d(a,b){b=b||[];var c=a.nodeType,e=a.childNodes,f=e.length,g=[c,a.nodeName,f].join(":"),h="",i="";switch(c){case 3:h=a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");break;case 8:h="<!--"+a.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"-->";break;default:h="<"+g+">",i="</>"}for(h&&b.push(h),c=0;f>c;++c)d(e[c],b);return i&&b.push(i),b}function e(a){return a=d(a).join(""),m(a).toString(16)}function f(a,b,c){var d=[],e=a;for(c=c||n.getDocument(a).documentElement;e&&e!=c;)d.push(n.getNodeIndex(e,!0)),e=e.parentNode;return d.join("/")+":"+b}function g(a,b,d){b?d||n.getDocument(b):(d=d||document,b=d.documentElement),a=a.split(":"),b=b,d=a[0]?a[0].split("/"):[];for(var f,e=d.length;e--;){if(f=parseInt(d[e],10),!(f<b.childNodes.length))throw c.createError("deserializePosition failed: node "+n.inspectNode(b)+" has no child with index "+f+", "+e);b=b.childNodes[parseInt(d[e],10)]}return new n.DomPosition(b,parseInt(a[1],10))}function h(b,c,d){if(d=d||a.DomRange.getRangeDocument(b).documentElement,!n.isAncestorOf(d,b.commonAncestorContainer,!0))throw Error("serializeRange: range is not wholly contained within specified root node");return b=f(b.startContainer,b.startOffset,d)+","+f(b.endContainer,b.endOffset,d),c||(b+="{"+e(d)+"}"),b}function i(b,c,d){c?d=d||n.getDocument(c):(d=d||document,c=d.documentElement),b=/^([^,]+),([^,\{]+)({([^}]+)})?$/.exec(b);var f=b[4],h=e(c);if(f&&f!==e(c))throw Error("deserializeRange: checksums of serialized range root node ("+f+") and target root node ("+h+") do not match");return f=g(b[1],c,d),c=g(b[2],c,d),d=a.createRange(d),d.setStart(f.node,f.offset),d.setEnd(c.node,c.offset),d}function j(a,b,c){return b?c||n.getDocument(b):(c=c||document,b=c.documentElement),a=/^([^,]+),([^,]+)({([^}]+)})?$/.exec(a)[3],!a||a===e(b)}function k(a,c,d){a=a||b.getSelection(),a=a.getAllRanges();for(var e=[],f=0,g=a.length;g>f;++f)e[f]=h(a[f],c,d);return e.join("|")}function l(b,c,d){c?d=d||n.getWindow(c):(d=d||window,c=d.document.documentElement),b=b.split("|");for(var e=a.getSelection(d),f=[],g=0,h=b.length;h>g;++g)f[g]=i(b[g],c,d.document);return e.setRanges(f),e}a.requireModules(["WrappedSelection","WrappedRange"]),("undefined"==typeof encodeURIComponent||"undefined"==typeof decodeURIComponent)&&c.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var m=function(){var a=null;return function(b){for(var f,c=[],d=0,e=b.length;e>d;++d)f=b.charCodeAt(d),128>f?c.push(f):2048>f?c.push(192|f>>6,128|63&f):c.push(224|f>>12,128|63&f>>6,128|63&f);if(b=-1,!a){d=[],e=0;for(var g;256>e;++e){for(g=e,f=8;f--;)1==(1&g)?g=3988292384^g>>>1:g>>>=1;d[e]=g>>>0}a=d}for(d=a,e=0,f=c.length;f>e;++e)g=255&(b^c[e]),b=b>>>8^d[g];return(-1^b)>>>0}}(),n=a.dom;a.serializePosition=f,a.deserializePosition=g,a.serializeRange=h,a.deserializeRange=i,a.canDeserializeRange=j,a.serializeSelection=k,a.deserializeSelection=l,a.canDeserializeSelection=function(a,b,c){var d;b?d=c?c.document:n.getDocument(b):(c=c||window,b=c.document.documentElement),a=a.split("|"),c=0;for(var e=a.length;e>c;++c)if(!j(a[c],b,d))return!1;return!0},a.restoreSelectionFromCookie=function(a){a=a||window;var b;a:{b=a.document.cookie.split(/[;,]/);for(var e,c=0,d=b.length;d>c;++c)if(e=b[c].split("="),"rangySerializedSelection"==e[0].replace(/^\s+/,"")&&(e=e[1])){b=decodeURIComponent(e.replace(/\s+$/,""));break a}b=null}b&&l(b,a.doc)},a.saveSelectionCookie=function(a,c){a=a||window,c="object"==typeof c?c:{};var d=c.expires?";expires="+c.expires.toUTCString():"",e=c.path?";path="+c.path:"",f=c.domain?";domain="+c.domain:"",g=c.secure?";secure":"",h=k(b.getSelection(a));a.document.cookie=encodeURIComponent("rangySerializedSelection")+"="+encodeURIComponent(h)+d+e+f+g},a.getElementChecksum=e}),b}var rangy=plugin_rangy();window.rangy=rangy,rangy.init(),plugin_jquery_log($R),plugin_jquery_hasAttr($R),plugin_jquery_json($R),plugin_jquery_cookie($R),plugin_jquery_postMessage($R),plugin_jquery_mustache($R),plugin_jquery_enhancedOffset($R),plugin_jquery_drags($R),plugin_jquery_mousewheel($R),plugin_jquery_isotope($R),plugin_jquery_jScrollPane($R),plugin_jquery_twitterTip($R),plugin_jquery_rdrWidgetSummary($R),plugin_jquery_selectionographer($R,rangy),$R.expr[":"].parents=function(a,b,c){return $R(a).parents(c[3]).length<1}}var $=$R,css=[];(!$R.browser.msie||$R.browser.msie&&parseInt($R.browser.version,10)>8)&&(css.push(RDR_staticUrl+"css/fonts/helvetica.css"),css.push(RDR_staticUrl+"css/fonts/fontawesome.css")),$R.browser.msie&&(css.push(RDR_staticUrl+"widget/css/ie.css"),css.push(RDR_staticUrl+"widget/css/ie"+parseInt($R.browser.version,10)+".css")),css.push(RDR_widgetCssStaticUrl+"widget/css/widget.css?rv21"),css.push(RDR_staticUrl+"widget/css/jquery.jscrollpane.css"),loadCSS(css),initCommonUtils($R),initPlugins($R),readrBoard($R),RDR.actions.init(),RDR_offline&&RDR.debug()}var RDR={};if(window.READRBOARDCOM&&window.READRBOARDCOM.hasLoaded)return window.READRBOARDCOM.actions.reInit(),void 0;window.READRBOARDCOM=window.readrboard=RDR,RDR.hasLoaded=!0,RDR.C={rindowHeaderPadding:29,rindowWidthForKindIsText:200,rindowAnimationSpeed:333,indicatorOpacity:.4,helperIndicators:{hoverDelay:250,fadeInTime:300,opacity:.6}},RDR.engageScript=document.getElementById("readrboardscript")||findEngageScript(),RDR.engageScriptSrc=RDR.engageScript.src;var $RDR,$R,RDR_scriptPaths={},RDR_offline=!(-1==RDR.engageScriptSrc.indexOf("local.readrboard.com")&&-1==RDR.engageScriptSrc.indexOf("local.readrboard2.com")&&"local.readrboard.com"!=document.domain),RDR_baseUrl=RDR_offline?"http://local.readrboard.com:8080":"http://www.readrboard.com",RDR_staticUrl=RDR_offline?"http://local.readrboard.com:8080/static/":"http://s3.amazonaws.com/readrboard/",RDR_widgetCssStaticUrl=RDR_offline?"http://local.readrboard.com:8080/static/":"http://s3.amazonaws.com/readrboard/",isTouchBrowser="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;RDR.safeThrow=function(a){var b=!0;if(RDR_offline&&b)throw a},RDR.rdr_loadScript=rdr_loadScript,RDR_scriptPaths.jquery=RDR_offline?RDR_staticUrl+"global/js/jquery-1.10.2.min.js":"//cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js",rdr_loadScript({src:RDR_scriptPaths.jquery},function(){isTouchBrowser&&load_mobileEvents(jQuery),jquery_onload(jQuery)})}();