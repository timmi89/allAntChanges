(function(){var ANT={};if(window.ANTENNAIS&&window.ANTENNAIS.hasLoaded){window.ANTENNAIS.actions.reInit();return}window.ANTENNAIS=window.antenna=ANT;ANT.hasLoaded=true;ANT.C={aWindowHeaderPadding:29,aWindowWidthForKindIsText:200,aWindowAnimationSpeed:333,indicatorOpacity:.4,helperIndicators:{hoverDelay:250,fadeInTime:300,opacity:.6}};ANT.engageScript=document.getElementById("antennascript")||findEngageScript();ANT.engageScriptSrc=ANT.engageScript.src;var $ANT,$A,ANT_scriptPaths={},ANT_offline=!!(ANT.engageScriptSrc.indexOf("localhost")!=-1||ANT.engageScriptSrc.indexOf("local.antenna.is")!=-1||ANT.engageScriptSrc.indexOf("local.antenna2.is")!=-1||document.domain=="local.antenna.is"),ANT_baseUrl=ANT_offline?window.location.protocol+"//local.antenna.is:8081":window.location.protocol+"//www.antenna.is",ANT_staticUrl=ANT_offline?window.location.protocol+"//local.antenna.is:8081/static/":window.location.protocol+"//s3.amazonaws.com/readrboard/",ANT_widgetCssStaticUrl=ANT_offline?window.location.protocol+"//local.antenna.is:8081/static/":window.location.protocol+"//s3.amazonaws.com/readrboard/";var isTouchBrowser="ontouchstart"in window||navigator.msMaxTouchPoints;ANT.safeThrow=function(msg){var debugMode=false;if(ANT_offline&&debugMode){console.log(msg)}};function test_antenna_extend(){if(!ANT_offline){return}window.antenna_extend={default_reactions:["Love It","Hate It","Heeeeeey"]};window.antenna_extend_per_container={question1:{default_reactions:["tag1","tag2","tag3"]},question2:{default_reactions:["tag3","tag4","tag5","tag6"]}}}function findEngageScript(){var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var s=scripts[i];var src=s.src;var isAntennaScript=(src.indexOf("antenna")!=-1||src.indexOf("localhost")!=-1||src.indexOf("readrboard")!=-1)&&src.indexOf("engage")!=-1;if(isAntennaScript){return s}}}function antenna($A){var $=$A;$.extend(ANT,{summaries:{},current:{},assetLoaders:{content_nodes:{}},content_nodes:{},containers:{},pages:{},group:{defaults:{premium:false,img_selector:"img",img_container_selectors:"#primary-photo",active_sections:"body",anno_whitelist:"body p",active_sections_with_anno_whitelist:"",media_selector:"embed, video, object, iframe",comment_length:500,no_readr:"",img_blacklist:"",custom_css:"",inline_selector:"img, embed, video, object, iframe",paragraph_helper:true,media_url_ignore_query:true,summary_widget_method:"after",language:"en",ab_test_impact:true,ab_test_sample_percentage:10,img_indicator_show_onload:true,img_indicator_show_side:"left",tag_box_bg_colors:"90,168,214; 200,226,38; 111,197,242; 229,246,98; 28,173,223",tag_box_text_colors:"34,94,129; 128,146,17; 37,117,163; 153,174,26; 34,94,129",tag_box_font_family:"Helvetica,Arial,sans-serif",tag_box_gradient:"",tags_bg_css:"url("+ANT_staticUrl+"images/noise.gif)",br_replace_scope_selector:null}},user:{img_url:"",ant_token:"",user_id:""},known_users:{},errors:{actionbar:{rating:"",commenting:""}},styles:{},events:{focusedSeconds:0,fireScrollEvent:function(milestone){if(milestone.indexOf("more")!=-1){var event_type="scroll_more"}else{var event_type="sc"}ANT.events.trackEventToCloud({event_type:event_type,event_value:milestone})},fireEventQueue:function(){$.each(ANT.events.queue,function(idx,event_params){ANT.events.trackEventToCloud(event_params)})},trackEventToCloud:function(params){ANT.user=ANT.user||{};ANT.events.queue=ANT.events.queue||[];if((ANT.events.recordEvents||params.event_type=="sl")&&typeof params.event_type!=="undefined"&&params.event_value!=="undefined"){var page_id=params.event_type=="sl"?"na":parseInt((typeof params.page_id!="undefined"?params.page_id:ANT.util.getPageProperty("id")).toString());var referrer_url_array=document.referrer.split("/");var referrer_url=referrer_url_array.splice(2).join("/");var HOSTDOMAIN=/[-\w]+\.(?:[-\w]+\.xn--[-\w]+|[-\w]{2,}|[-\w]+\.[-\w]{2})$/i;var referrer_domain=referrer_url.split("/").splice(0,1).join("/").split(":")[0];var referrer_tld=referrer_domain?HOSTDOMAIN.exec(referrer_domain)[0]:"";var trackData={et:params.event_type,ev:params.event_value,gid:ANT.group.id||null,uid:ANT.user.user_id||null,pid:page_id,lts:ANT.user.lts||null,sts:ANT.user.sts||null,ref:referrer_url||null,cid:params.content_id||null,ah:params.event_type=="sl"?"na":parseInt(ANT.group.active_section_milestones[100])||null,ch:params.container_hash||null,ck:params.container_kind||null,r:params.reaction_body||null,pt:ANT.util.getPageProperty("title")||null,cu:ANT.util.getPageProperty("canonical_url")||null,pu:ANT.util.getPageProperty("page_url")||null,ru:referrer_url||null,ca:params.content_attributes||null,cl:params.content_location||null,ptop:ANT.group.topics||null,a:ANT.group.author||null,sec:ANT.group.section||null,it:isTouchBrowser||false,sw:screen.width,sh:screen.height,pd:window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth),ua:navigator.userAgent};var data=$.toJSON(trackData);var trackingUrl=document.domain!="local.antenna.is"?"http://events.readrboard.com/insert":"http://localnode.com:3000/insert";$.ajax({url:trackingUrl,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:data},success:function(response){}})}},emit:function(eventName,eventValue,eventSupplementary){if(ANT.group.premium==true){ANT.events.lastEvent=eventName;ANT.events.lastValue=eventValue;ANT.events.lastSupplementary=eventSupplementary;if(document.createEvent){evt=document.createEvent("Event");evt.initEvent(eventName,true,true);document.dispatchEvent(evt)}else if(document.createEventObject){document.documentElement[eventName]++}}}},groupSettings:{getCustomSettings:function(){var group_extensions=window.antenna_extend||{};if(typeof group_extensions.blessed_tags!="undefined"){group_extensions.default_reactions=group_extensions.blessed_tags.slice();delete group_extensions.blessed_tags}var qs=ANT.util.getQueryParams(),group_qs_extensions={};$.each(qs,function(key,val){if(key.indexOf("ant_")===0){key=key.substr(4);group_qs_extensions[key]=val}});group_extensions=$.extend({},group_extensions,group_qs_extensions);return ANT.groupSettings._translate(group_extensions)},translators:{default_reactions:function(tagsList){return $.map(tagsList,function(val,idx){return{body:val}})}},_translate:function(settings){var ret_settings={};var translators=ANT.groupSettings.translators;$.each(settings,function(key,val){ret_settings[key]=!!translators[key]?translators[key](val):val});return ret_settings},getBlessedTags:function(hash){var perContainerSettings=window.antenna_extend_per_container;if(hash&&perContainerSettings){var name=getCustomANTItems(hash);var perContainerExtentions=perContainerSettings[name];if(perContainerExtentions&&perContainerExtentions.blessed_tags){perContainerExtentions.default_reactions=perContainerExtentions.blessed_tags.slice();delete perContainerExtentions.blessed_tags}if(perContainerExtentions&&perContainerExtentions.default_reactions){var settings=ANT.groupSettings._translate(perContainerExtentions);return settings.default_reactions}}function getCustomANTItems(hash){var $el=$('[ant-hash="'+hash+'"]');var name=$el.attr("ant-item");return name}return ANT.group.default_reactions}},aWindow:{defaults:{coords:{left:100,top:100},animTime:100,defaultHeight:260,minHeight:10,maxHeight:300,minWidth:100,maxWidth:600,forceHeight:false,rewritable:true},makeHeader:function(_headerText,interactionId){var headerText=_headerText||"";var headerTml=$.mustache('<div class="ant ant_header">'+'<div class="ant_loader"></div>'+'<div class="ant_indicator_stats">'+'<span class="ant-antenna-logo"></span>'+'<span class="ant_count"></span>'+"</div>"+"<h1>{{headerText}}</h1>"+"</div>",{ANT_staticUrl:ANT_staticUrl,headerText:headerText});var $header=$(headerTml);if(!interactionId){return $header}var $menuDropdownActions=$('<div class="ant_menuDropDown ant_menu_actions">'+'<span class="ant-chevron-down ant_menuTrigger"></span>'+"</div>");var $menuActions=makeActionList();$menuDropdownActions.append($menuActions);var $menu=$('<div class="ant_aWindowMenu"></div>').append($menuDropdownActions);if(isTouchBrowser){$menu.on("touchend.ant",".ant_menuDropDown",function(){$(this).toggleClass("ant_hover")})}$header.append($menu);function makeActionList(){var $links=$('<div class="ant_linkWrap">'+"<ul>"+'<li class="ant_link">'+'<a target="_blank" href="'+ANT_baseUrl+"/interaction/"+interactionId+'" class="ant_seeit_link">'+ANT.t("view_on_site")+"</a>"+"</li>"+"</ul>"+"</div>");return $links}return $header},makeDefaultPanelMessage:function($aWindow,_kind){var hash=$aWindow.data("hash");var summary=ANT.summaries[hash];var kind=_kind||($aWindow.hasClass("ant_indicator_details")?"media":"text");var headerText;if(kind=="text"){if($aWindow.data("mode")=="writeMode"){headerText=ANT.t("main_cta")}else{if(kind=="text"){headerText=ANT.t("reactions")}else{headerText=summary.counts.tags>0?summary.counts.tags+ANT.t("reactions"):ANT.t("reactions")}}}else{var modForIE=$.browser.msie&&parseInt($.browser.version,10)<9?20:0;headerText=summary.counts.tags>0?summary.counts.tags+" "+ANT.t("reactions"):$aWindow.width()>=175+modForIE?ANT.t("main_cta"):ANT.t("react")+":"}return headerText},updateFooter:function($aWindow,$content){var $footer=$aWindow.find("div.ant_footer");$footer.show(0);if(typeof $content!="undefined")$footer.html($content+'<a class="antenna-logo-link" target="_blank" href="'+window.location.protocol+'//www.antenna.is/"><span class="ant-antenna-text"></span></a>')},hideFooter:function($aWindow){$aWindow.find("div.ant_footer").hide(0)},panelCreate:function($aWindow,className){if(!$aWindow)return;var $ant_body_wrap=$aWindow.find("div.ant_body_wrap"),$ant_bodyFirst=$ant_body_wrap.find("div.ant_body").eq(0);var $existingPanel=$ant_body_wrap.find("div."+className);$existingPanel.remove();var $newPanel=$('<div class="ant_body '+className+'"/>'),column_count=$ant_body_wrap.find("div.ant_body").length+1;return $newPanel},panelUpdate:function($aWindow,className,$newPanel,shouldAppendNotReplace){if(!$aWindow)return;var $ant_body_wrap=$aWindow.find("div.ant_body_wrap"),$panel=$ant_body_wrap.find("div."+className);if(shouldAppendNotReplace){$panel.append($newPanel)}else{$panel.replaceWith($newPanel)}return $newPanel},panelShow:function($aWindow,$showPanel,callback){var $panelWrap=$aWindow.find(".ant_body_wrap");var $hidePanel=$aWindow.find(".ant_visiblePanel");if(!$hidePanel.length){$hidePanel=$aWindow.find(".ant_body").eq(0)}var animWidth=$hidePanel.width();$showPanel.show().addClass("ant-visible").css({position:"relative",top:0,left:animWidth});$aWindow.data("panelState",2);$showPanel.addClass("ant_visiblePanel").removeClass("ant_hiddenPanel");$hidePanel.addClass("ant_hiddenPanel").removeClass("ant_visiblePanel");ANT.aWindow.updateSizes($aWindow);$panelWrap.animate({left:-animWidth},ANT.C.aWindowAnimationSpeed,function(){if(callback)callback();if($aWindow.data("jsp")){var API=$aWindow.data("jsp");API.reinitialise()}else{$aWindow.jScrollPane({showArrows:true})}})},panelHide:function($aWindow,callback){var $panelWrap=$aWindow.find(".ant_body_wrap");var isWriteMode=$aWindow.hasClass("ant_writemode"),$tagsListContainer=ANT.actions.indicators.utils.makeTagsListForInline($aWindow,isWriteMode);var className="ant_tags_list";var $hidePanel=$aWindow.find(".ant_visiblePanel");$hidePanel.removeClass("ant_visiblePanel").addClass("ant_hiddenPanel");$tagsListContainer.addClass("ant_visiblePanel").removeClass("ant_hiddenPanel");var animWidth=$tagsListContainer.width();$hidePanel.css("left",animWidth);$panelWrap.css("left",-animWidth);ANT.aWindow.updateSizes($aWindow);$panelWrap.animate({left:0},ANT.C.aWindowAnimationSpeed,function(){if(callback)callback();$aWindow.data("panelState",1);if($aWindow.data("jsp")){var API=$aWindow.data("jsp");API.reinitialise()}else{$aWindow.jScrollPane({showArrows:true})}})},panelEnsureFloatWidths:function($aWindow){return},updateTagPanel:function($aWindow){var hash=$aWindow.data("hash");ANT.aWindow.panelHide($aWindow);ANT.aWindow.tagBox.setWidth($aWindow,$aWindow.data("initialWidth"));ANT.aWindow.tagBox.setHeight($aWindow,$aWindow.data("initialHeight"))},mediaAWindowShow:function($mediaItem){var hash=$mediaItem.data("hash"),$aWindow=$("#ant_indicator_details_"+hash);ANT.util.cssSuperImportant($aWindow,{display:"block"});if($mediaItem.data("hover")&&!$aWindow.data("hover")&&!$aWindow.is(":animated")&&!$aWindow.closest("div.ant_media_details").length){$aWindow.data("hover",true);ANT.aWindow.updateSizes($aWindow)}$aWindow.addClass("ant_engaged")},mediaAWindowHide:function($mediaItem){var hash=$mediaItem.data("hash"),$aWindow=$("#ant_indicator_details_"+hash);if(!$mediaItem.data("hover")&&!$aWindow.is(":animated")&&!$aWindow.closest("div.ant_media_details").length){$aWindow.data("hover",false).animate({height:"0px"},ANT.C.aWindowAnimationSpeed,function(){ANT.util.cssSuperImportant($aWindow,{display:"none"})})}$aWindow.removeClass("ant_engaged");$("#ant_indicator_"+hash).hide()},updateSizes:function($aWindow,_options){var kind=$aWindow.hasClass("ant_indicator_details")?"media":"text";var options=_options||{};var $elm=$aWindow.find(".ant_visiblePanel");var initialWidth=$aWindow.data("initialWidth"),initialHeight=$aWindow.data("initialHeight");var width,height;var aWindowHeaderHeight=0;var defaults={h:200,w:200,duration:ANT.C.aWindowAnimationSpeed};defaults.w=$elm.width();defaults.h=$elm.height()+32;width=options.setWidth||defaults.w;height=options.setHeight||defaults.h;if(options.noAnimate){$aWindow.css({width:width,height:height})}$aWindow.animate({width:width,height:height},{duration:defaults.duration,queue:false});ANT.aWindow.jspUpdate($aWindow)},updatePageTagMessage:function(args,action){},updateTagMessage:function(args){if(args.scenario&&args.aWindow){if(args.args){$.each(args.args,function(key,copyThisArg){if(typeof copyThisArg=="object"){args[key]=$.extend(true,{},copyThisArg)}else{args[key]=copyThisArg}})}var hash=args.hash,$aWindow=args.aWindow,kind=args.kind,tag=args.tag,summary=ANT.summaries[hash],content_node=args.sendData?args.sendData.content_node_data:{};ANT.aWindow.tagBox.setWidth($aWindow,200);if(args.scenario!="tagDeleted"){if(args.scenario=="reactionSuccess"||args.scenario=="reactionExists"){var $success=$('<div class="ant_view_success"></div>'),$subheader=$('<div class="ant_subheader ant_clearfix"></div>').appendTo($success),tagBody=tag.body?tag.body:tag.tag_body,$h1=$("<h1>"+tagBody+"</h1>").appendTo($subheader),$options=$('<div class="ant_nextActions"></div>').appendTo($success);if(args.kind!="page"){var $sayMore=ANT.actions.comments.makeCommentBox({content_node:content_node,summary:summary,hash:hash,tag:tag,kind:kind,$aWindow:$aWindow,selState:content_node.selState||null}).appendTo($options)}var $backButton=$('<div class="ant_back">'+ANT.t("close")+" X</div>");$success.prepend($backButton);$backButton.click(function(){var doClose=ANT.aWindow.safeClose($aWindow);if(!doClose){return}ANT.aWindow.updateTagPanel($aWindow)});var shouldAppendNotReplace=true;ANT.aWindow.panelUpdate($aWindow,"ant_view_more",$success,shouldAppendNotReplace);ANT.user=ANT.user||{};var onAction=function(event){var args=event.data.args;var newArgs={hash:args.hash,int_id:args.response.data.interaction.id,tag:args.tag,aWindow:$aWindow};ANT.actions.interactions.ajax(newArgs,"react","remove")};if(isTouchBrowser){$aWindow.find("a.ant_undo_link").on("touchend.ant",{args:args},onAction)}else{$aWindow.find("a.ant_undo_link").on("click.ant",{args:args},onAction)}function makeShareLinks(){var $shareLinks=$('<div class="ant_shareLinks"><div class="ant_share_cta">'+ANT.t("share_reaction")+":</div> <ul></ul></div>"),socialNetworks=["facebook","twitter"];$.each(socialNetworks,function(idx,val){var $link=$('<li><a href="http://'+val+'.com" ><i class="ant-social-'+val+'"></i></a></li>');$shareLinks.find("ul").append($link);$link.click(function(){var tag_body=args.tag.tag_body||args.tag.body;if(args.hash.jquery){content_node.hash="page";hash=args.hash="page"}ANT.events.trackEventToCloud({event_type:"sh",event_value:val,container_hash:hash,container_kind:args.kind,page_id:args.page_id,reaction_body:tag_body});var summary=ANT.summaries[hash];var kind=args.kind||summary.kind;ANT.shareWindow=window.open(ANT_staticUrl+"share.html","ant_share","menubar=1,resizable=1,width=626,height=436");ANT.actions.share_getLink({referring_int_id:args.response.data.interaction.id,hash:args.hash,kind:kind,sns:val,aWindow:$aWindow,tag:tag,content_node:content_node});return false})});return $shareLinks}var $shareSocialWrap=$(".ant_nextActions");$shareSocialWrap.append(makeShareLinks())}ANT.actions.containers.media.onEngage(hash)}else{var headerText=ANT.aWindow.makeDefaultPanelMessage($aWindow);var $header=ANT.aWindow.makeHeader(headerText);$aWindow.find(".ant_header").replaceWith($header);$aWindow.removeClass("ant_viewing_more").find("div.ant_indicator_details_body").show();ANT.aWindow.panelHide($aWindow)}ANT.aWindow.updateSizes($aWindow)}},jspUpdate:function($aWindow){if(!$aWindow.closest(".jspContainer").length&&!$aWindow.hasClass("jspScrollable")){$aWindow.find("div.ant_body").each(function(){var $this=$(this);if(!$this.hasClass("jspScrollable")){$(this).jScrollPane({showArrows:true})}else{var API=$(this).data("jsp");API.reinitialise()}})}},tagBox:{setWidth:function($aWindow,width){var aWindowWidth=ANT.group.max_aWindow_width?ANT.group.max_aWindow_width:width;$aWindow.removeClass("w100 w200 w300 w400").addClass("w"+aWindowWidth)},setHeight:function($aWindow,height){$aWindow.find(".ant_body, .jspContainer").height(height)},make:function(params){var tag=params.tag,boxSize=params.boxSize?params.boxSize:"medium",$aWindow=params.$aWindow?params.$aWindow:null,$tagContainer=params.$tagContainer?params.$tagContainer:params.$aWindow?params.$aWindow.find("div.ant_body.ant_tags_list"):null,reactionViewStyle=$aWindow.attr("ant-view-style")||"grid",tagCount=tag.tag_count?tag.tag_count:"",tagPercent=0,tagWidth="",bgColorInt=params.bgColorInt?params.bgColorInt:0,textColorInt=params.textColorInt?params.textColorInt:0,isWriteMode=params.isWriteMode?params.isWriteMode:false,kind=$aWindow.data("kind"),hash=$aWindow.data("hash")?$aWindow.data("hash"):$aWindow.data("container"),summary=ANT.summaries[hash],totalReactions=typeof summary!="undefined"?summary.counts.tags:0,content_node_id=tag.content_node_id?tag.content_node_id:false,content_node=content_node_id?summary.content_nodes[content_node_id]:"",message="";var bgColorRGB=ANT.util.hexToRgb(ANT.group.tag_box_bg_colors[bgColorInt])?ANT.util.hexToRgb(ANT.group.tag_box_bg_colors[bgColorInt]):ANT.group.tag_box_bg_colors[bgColorInt];var textColorRGB=ANT.util.hexToRgb(ANT.group.tag_box_text_colors[textColorInt])?ANT.util.hexToRgb(ANT.group.tag_box_text_colors[textColorInt]):ANT.group.tag_box_text_colors[textColorInt];var renderPercentages=reactionViewStyle=="horizontal_bars"?true:false;if(renderPercentages===true){tagPercent=parseInt(tagCount/totalReactions*100);tagWidth="width:"+Math.round(tagCount/summary.counts.highest_tag_count*75)+"%"}if(content_node_id){content_node.id=content_node_id}var boxSize=boxSize=="big"?"ant_box_big":boxSize=="medium"?"ant_box_medium":"ant_box_small",wideBox="",writeMode=isWriteMode?"ant_writeMode":"",tagBodyRaw=tag.body?tag.body:tag.tag_body,tagBodyCrazyHtml="",tagIsSplitClass="";if(typeof tagBodyRaw=="undefined"){return}if(kind=="page"){message=isWriteMode?"+1 "+tagBodyRaw:""}else if(tagCount==""){message=""}else if(tagCount==-101){message="+1 "+tagBodyRaw}else{var message="+1 "+tagBodyRaw}var charCountText="";if(typeof tagBodyRaw!="undefined"&&tagBodyRaw.length<16||renderPercentages===true){charCountText="ant_charCount"+tagBodyRaw.length;tagBodyCrazyHtml='<div class="ant_tag_body ant_tag_lineone" style="color:rgb('+textColorRGB+");font-family:"+ANT.group.tag_box_font_family+';">'+tagBodyRaw+"</div>"}else{tagIsSplitClass="ant_tag_split";if(tagBodyRaw.indexOf(" ")==-1){charCountText="ant_charCount15";tagBodyCrazyHtml='<div class="ant_tag_body ant_tag_lineone" style="color:rgb('+textColorRGB+");font-family:"+ANT.group.tag_box_font_family+';">'+tagBodyRaw.substr(0,15)+"-<br/>"+tagBodyRaw.substr(15)+"</div>"}else{var tagBody1="",tagBody2="",keepLooping=true;tagBodyRawSplit=tagBodyRaw.split(" ");while(keepLooping){tagBody1+=tagBodyRawSplit.shift()+" ";if(tagBody1.length+tagBodyRawSplit[0].length>=16)keepLooping=false}tagBody2=tagBodyRawSplit.join(" ");charCountText="ant_charCount"+tagBody1.length;tagBodyCrazyHtml='<div class="ant_tag_body ant_tag_lineone" style="color:rgb('+textColorRGB+");font-family:"+ANT.group.tag_box_font_family+';">'+tagBody1+"<br>"+tagBody2+"</div>"}}var tag_id=tag.id;var parent_id=tag.parent_id;var content_node_str=content_node_id?"ant_content_node_"+content_node_id:"";var tagCount=tagCount||0;var tagCountDisplay=renderPercentages===true?tagPercent+"%":tagCount;var plusOneCTA=!isWriteMode&&kind=="page"?"":'<span class="ant_plusOne">+1</span>';var notWriteModeHtml=isWriteMode?"":'<span class="ant_count" style="color:rgb('+textColorRGB+");font-family:"+ANT.group.tag_box_font_family+';">'+tagCountDisplay+"</span>"+'<i class="ant-search ant_tag_read_icon"></i>';var tagBoxHTML='<div class="'+boxSize+" ant_box "+wideBox+" "+writeMode+'" style="background:rgba('+bgColorRGB+",0.85);"+tagWidth+";background-image:"+ANT.group.tag_box_gradient+';">'+"<div "+'class="ant_tag '+tagIsSplitClass+" "+content_node_str+" "+charCountText+'" '+'data-tag_id="'+tag_id+'" '+'data-tag_count="'+tagCount+'" '+'data-parent_id="'+parent_id+'" '+'data-content_node_id="'+content_node_id+'" '+'><div class="ant_tag_wrap"><div class="ant_tag_wrap2">'+tagBodyCrazyHtml+notWriteModeHtml+plusOneCTA+"</div>"+"</div></div></div>";var $tagBox=$(tagBoxHTML);$tagContainer.append($tagBox);function renderReactedContent($reactionsTable,tag){if(!$aWindow.find(".ant_view_more").length||!$aWindow.find(".ant_view_more").hasClass("ant_visiblePanel")){var $newPanel=ANT.aWindow.panelCreate($aWindow,"ant_view_more");var $ant_body_wrap=$aWindow.find("div.ant_body_wrap");$ant_body_wrap.append($newPanel);$newPanel.append($reactionsTable).addClass("ant_page_reactions_summary");ANT.aWindow.tagBox.setWidth($aWindow,200);ANT.aWindow.panelShow($aWindow,$newPanel,function(){ANT.aWindow.hideFooter($aWindow)})}else{$aWindow.find(".ant_body").html($reactionsTable);ANT.aWindow.jspUpdate($aWindow)}var HeaderTxt=tag.tag_count<=0?"no reactions":tag.tag_count==1?"1 "+ANT.t("single_reaction"):tag.tag_count+" "+ANT.t("plural_reaction");var $header=ANT.aWindow.makeHeader(HeaderTxt);$aWindow.find(".ant_header").replaceWith($header)}function _makeBackButton(){var $backButton=$('<div class="ant_back">'+ANT.t("close")+" X</div>");$backButton.on("click.ant, touchend.ant",function(){var isViewForAWindow=!!$aWindow.attr("ant-view-reactions-for");if(!isViewForAWindow){ANT.aWindow.close($aWindow);return}});return $backButton}function createReactedContentTable($this,counts,pageId){$().selog("hilite",true,"off");$(".ant_twtooltip").remove();var $backButton=_makeBackButton(),$reactionsTable=$('<table cellpadding="0" cellspacing="0" border="0" class="reaction_summary_table"></table>').append('<tbody><tr class="ant_page_reactions"></tr></tbody>');if(counts&&counts.page&&counts.page>0){var page_reaction_text=counts.page==1?"1 "+ANT.t("single_reaction"):counts.page+" "+ANT.t("plural_reaction");$reactionsTable.find(".ant_page_reactions").append('<td colspan="2"><strong>'+page_reaction_text+"</strong> "+ANT.t("to_page")+"</td>")}if(counts.img>0||counts.text>0||counts.media>0){$reactionsTable.find(".ant_page_reactions").addClass("has_other_reactions");$.each(ANT.interaction_data[tag.id],function(int_id,data){var hash=data.hash;var summary=ANT.summaries[hash];var $node=$('[ant-hash="'+hash+'"]');var thisPageId=summary.pageId;if(!thisPageId||!pageId||thisPageId!=pageId){return}if(!$reactionsTable.find("tr.ant_int_summary_"+int_id).length){var $tr=$('<tr valign="middle" class="ant_content_reaction ant_int_summary_'+int_id+'"/>'),thing=ANT.interaction_data[tag.id][int_id];if(typeof thing.interaction!="undefined"&&typeof thing.content_node!="undefined"){var reaction_word=thing.interaction.count>1?ANT.t("plural_reaction"):ANT.t("single_reaction");$tr.append('<td class="ant_count"><h4>'+thing.interaction.count+"</h4><h5>"+reaction_word+"</h5></td>").data("count",thing.interaction.count).data("tag",tag).data("int_id",int_id);if(thing.kind=="text"){$tr.append('<td class="ant_content">'+thing.content_node.body+"</td>")}else if(thing.kind=="img"){$tr.append('<td class="ant_content"><img src="'+thing.content_node.body+'" height="50"/></td>')}else if(thing.kind=="media"){$tr.append('<td class="ant_content"><img src="'+ANT_baseUrl+'/static/widget/images/video_icon.png" height="33" style="margin-bottom:-10px;"/> <div style="display:inline-block;margin-left:10px;">Video</div></td>')}$tr.on("click.ant, touchend.ant",function(e){e.preventDefault();var data={container_hash:thing.hash,location:thing.content_node.location};ANT.session.revealSharedContent(data);ANT.events.trackEventToCloud({event_type:"sb",event_value:"vc",page_id:thisPageId})});if(!$reactionsTable.find("tr.ant_content_reaction").length){$reactionsTable.find("tbody").append($tr)}else{var insertIndex=0;$.each($reactionsTable.find("tr.ant_content_reaction"),function(idx,existing_tr){if(parseInt(thing.interaction.count)>parseInt($(existing_tr).data("count"))){insertIndex=idx;return false}});$reactionsTable.find("tr.ant_content_reaction:eq("+insertIndex+")").before($tr)}}}})}return $("<div/>").append($backButton,$reactionsTable)}if(kind=="page"){if(isWriteMode==false){var clickFunc=function(){ANT.aWindow.hideFooter($aWindow);$aWindow.removeClass("ant_rewritable");var page_id=ANT.util.getPageProperty("id",hash),page=ANT.pages[page_id],tag_count=tag.tag_count,counts={img:0,text:0,media:0,page:tag_count=="+"?0:tag_count};ANT.events.trackEventToCloud({event_type:"sb",event_value:"vr",page_id:page_id});$.each(page.containers,function(idx,container){if(ANT.summaries&&ANT.summaries[container.hash]&&ANT.summaries[container.hash].top_interactions){if(ANT.summaries[container.hash].top_interactions.tags&&ANT.summaries[container.hash].top_interactions.tags[tag.id]){counts[ANT.summaries[container.hash].kind]+=ANT.summaries[container.hash].top_interactions.tags[tag.id].count;counts.page-=ANT.summaries[container.hash].top_interactions.tags[tag.id].count}}});var $this=$(this),$reactionsTable=createReactedContentTable($this,counts,page.id);renderReactedContent($reactionsTable,tag);$this.addClass("ant_live_hover")};$tagBox.on("click.ant, touchend.ant",function(){clickFunc()})}else{$tagBox.on("click.ant, touchend.ant",function(){$(this).addClass("ant_tagged");$aWindow.removeClass("ant_rewritable");var hash=$aWindow.data("container");args={tag:tag,hash:hash,uiMode:"writeMode",kind:$aWindow.data("kind"),aWindow:$aWindow,content_node:content_node};ANT.actions.interactions.ajax(args,"react","create")})}}else{if(isTouchBrowser){$tagBox.on("touchend.ant",function(){$(this).addClass("ant_tagged");$aWindow.removeClass("ant_rewritable");var hash=$aWindow.data("container");args={tag:tag,hash:hash,uiMode:"writeMode",kind:$aWindow.data("kind"),aWindow:$aWindow,content_node:content_node};ANT.actions.interactions.ajax(args,"react","create")})}else{$tagBox.click(function(){$(this).addClass("ant_tagged");$aWindow.removeClass("ant_rewritable");var hash=$aWindow.data("container");args={tag:tag,hash:hash,uiMode:"writeMode",kind:$aWindow.data("kind"),aWindow:$aWindow,content_node:content_node};ANT.actions.interactions.ajax(args,"react","create")})}}if(!isTouchBrowser){$tagBox.hover(function(){var $this=$(this);if(!$this.hasClass("ant_tagged")){var $tagCount=$this.find("span.ant_tag_count");$tagCount.width($tagCount.width());$tagCount.text("+")}},function(){var $this=$(this);$this.find("span.ant_tag_count").text($this.find(".ant_tag").data("tag_count"))})}var comments={},num_comments=0;if(!$.isEmptyObject(content_node)&&!$.isEmptyObject(content_node.top_interactions)&&!$.isEmptyObject(content_node.top_interactions.coms)){$.each(content_node.top_interactions.coms,function(idx,comment){if(comment.tag_id==parseInt(tag.tag_id)){num_comments++;if($.isEmptyObject(comments)){comments=content_node.top_interactions.coms}}})}var crazyCheckForDataTieOver=$.isEmptyObject(comments)&&typeof summary!="undefined"&&(summary.kind=="img"||summary.kind=="media"||summary.kind=="med")&&!$.isEmptyObject(summary.top_interactions)&&!$.isEmptyObject(summary.top_interactions.coms);if(!tag.id){tag.id=tag.tag_id}if(crazyCheckForDataTieOver){comments=summary.top_interactions.coms[tag.id];if(!$.isEmptyObject(comments)){num_comments=comments.length}}if(!$.isEmptyObject(comments)&&!isWriteMode){var commentColor=ANT.util.getColorLuma(bgColorRGB)<128?"fff":"333";var $commentHover=$('<span class="ant_comment_hover ant_tooltip_this" style="color:#'+commentColor+';" title="view comments"></span>');$commentHover.append('<i class="ant-comment" style="color:#'+commentColor+';"></i> '+num_comments);if(isTouchBrowser){$commentHover.on("touchend.ant",function(){$(this).tooltip("hide");ANT.actions.viewCommentContent({tag:tag,hash:hash,aWindow:$aWindow,content_node:content_node,selState:content_node.selState});return false})}else{$commentHover.click(function(){$(this).tooltip("hide");ANT.actions.viewCommentContent({tag:tag,hash:hash,aWindow:$aWindow,content_node:content_node,selState:content_node.selState});return false})}$tagBox.append($commentHover);$commentHover.tooltip()}return $tagBox}},writeCustomTag:function($container,$aWindow,actionType){var $container=$aWindow.find(".ant_footer");$container.append('<div class="ant_box"></div><a class="antenna-logo-link" target="_blank" href="'+window.location.protocol+'//www.antenna.is/"><span class="ant-antenna-text"></span></a>');if($container.find("div.ant_custom_tag").not("div.ant_custom_tag.ant_tagged").length==0){var actionType=actionType?actionType:"react",helpText="+ "+ANT.t("add_custom");var $clickOverlay=$('<div class="ant_click_overlay"></div>').appendTo($container);var $custom=$('<div class="ant_tag ant_custom_tag"></div>');var $customInput=$('<input value="'+helpText+'" />').appendTo($custom);var $customSubmit=$('<button class="ant_custom_tag_submit" name="ant_custom_tag_submit">ok</button>').appendTo($custom);$customSubmit.click(function(){submitCustomTag($custom,$customInput)});$clickOverlay.click(function(){$customInput.focus()});$customInput.focus(function(){var $input=$(this);$input.removeClass("ant_default");if($input.val()==helpText){$input.val("")}$clickOverlay.hide();$customSubmit.css("display","inline-block");$aWindow.removeClass("ant_rewritable")}).blur(function(){var $input=$(this);if($input.val()===""){$input.val(helpText);$customSubmit.hide();$clickOverlay.show()}if($input.val()==helpText){$input.addClass("ant_default");$customSubmit.hide();$clickOverlay.show()}$input.closest("div.ant_tag").removeClass("ant_hover")}).keyup(function(event){var $input=$customInput;if(event.keyCode=="13"){submitCustomTag($custom,$customInput)}else if(event.keyCode=="27"){$input.blur();return false}else if($input.val().length>25){var customTag=$input.val();$input.val(customTag.substr(0,25))}});$container.find(".ant_box").append($custom," ");function submitCustomTag($custom,$customInput){var tag={},hash=$aWindow.data("container");var val=$customInput.val();if(val===""){return}tag.body=val;$custom.parent().addClass("ant_tagged");args={tag:tag,hash:hash,uiMode:"writeMode",kind:$aWindow.data("kind"),aWindow:$aWindow};ANT.actions.interactions.ajax(args,actionType,"create");$customInput.blur()}$(document).on("keydown.ant",function(event){keyCodes=[16,81,87,69,82,84,89,85,73,79,80,65,83,68,70,71,72,74,75,76,90,88,67,86,66,78,77,49,50,51,52,53,54,55,56,57,48,189,187,219,221,220,186,222,188,190,191,192];if($.inArray(event.keyCode,keyCodes)!=-1){$container.find("input").focus()}})}},_aWindowTypes:{tagMode:{make:function(settings){if(settings.is_page==true){var page=settings.page,$summary_widget=$(".ant-summary-"+page.id),$summary_widget_icon=$summary_widget.find(".ant_logo"),coords={top:$summary_widget_icon.offset().top-2,left:$summary_widget_icon.offset().left-2};
if($("div.ant_page_key_"+$summary_widget.data("page_key")).length){return}var $aWindow=ANT.aWindow.draw({coords:coords,container:$summary_widget,content:"page",kind:"page",mode:settings.mode})}else{var hash=settings.hash;var page_id=ANT.util.getPageProperty("id",hash);var summary=ANT.summaries[hash],$container=summary.$container,kind=summary.kind,rewritable=settings.rewritable==false?false:true,coords={};var actionType=settings.actionType?settings.actionType:"react";var containerWidth=$container.width();var containerHeight=$container.height();if(settings.mode=="writeMode"){ANT.events.trackEventToCloud({event_type:"rs",event_value:"wr",container_hash:hash,container_kind:kind,page_id:page_id});var newSel;if(kind=="text"){newSel=$container.selog("helpers","smartHilite");if(!newSel)return false;settings.content=newSel.text;coords.left=coords.left+40;coords.top=coords.top+35;if(newSel){var hiliter=newSel.hiliter,$hiliteEnd=hiliter.get$end();if($hiliteEnd){var $helper=$("<span />");$helper.insertAfter($hiliteEnd);var strRight=$helper.offset().right;var strBottom=$helper.offset().bottom;$helper.remove();coords.left=strRight-14;coords.top=strBottom+2}}if(isTouchBrowser){var $container=$('[ant-hash="'+hash+'"]');var coords={top:$container.offset().bottom+5,left:$container.offset().left}}}else{if(typeof settings.coords!="undefined"&&settings.coords.force){var coords=settings.coords}else{var indicatorOffsets=summary.$indicator.offset();var coords={};coords.top=indicatorOffsets.top;coords.left=indicatorOffsets.left}}}else{var selector='[ant-hash="'+hash+'"]';var $indicator=$("#ant_indicator_"+hash),$indicator_body=$("#ant_indicator_body_"+hash),$container=$('[ant-hash="'+hash+'"]');if(kind=="text"){coords={top:$indicator_body.offset().top,left:$indicator_body.offset().left}}else{var indicatorOffsets=summary.$indicator.offset();var coords={};coords.top=indicatorOffsets.top;coords.left=indicatorOffsets.left;ANT.events.trackEventToCloud({event_type:"rs",event_value:typeof summary.counts.highest_tag_count!="undefined"?"rd":"rd-zero",container_hash:hash,container_kind:kind,page_id:page_id})}}if(typeof settings.$custom_cta!="undefined"){var offsets=settings.$custom_cta.offset();if(isTouchBrowser){var coords={top:offsets.bottom+5,left:offsets.left}}else{var ant_offset_x=settings.$custom_cta.attr("ant-offset-x")?parseInt(settings.$custom_cta.attr("ant-offset-x")):0;var ant_offset_y=settings.$custom_cta.attr("ant-offset-y")?parseInt(settings.$custom_cta.attr("ant-offset-y")):0;coords.top=offsets.top+ant_offset_y;coords.left=offsets.left+ant_offset_x}}var $aWindow=ANT.aWindow.draw({coords:coords,container:hash,content:settings.content,kind:kind,selState:newSel,rewritable:rewritable,mode:settings.mode});$aWindow.data("hash",hash);summary["$aWindow_"+settings.mode.toLowerCase()]=$aWindow}$aWindow.addClass("ant_"+settings.mode.toLowerCase());var headerText=ANT.aWindow.makeDefaultPanelMessage($aWindow);var $header=ANT.aWindow.makeHeader(headerText);$aWindow.find(".ant_header").replaceWith($header);$aWindow.addClass("ant_reactions");var $bodyWrap=$aWindow.find("div.ant_body_wrap");var $oldTagList=$aWindow.find("div.ant_body");if($oldTagList.length){$oldTagList.remove()}if(settings.is_page==true){var $tagList=ANT.actions.indicators.utils.makeTagsListForInline($aWindow,settings.mode=="writeMode",page)}else{var $tagList=ANT.actions.indicators.utils.makeTagsListForInline($aWindow,settings.mode=="writeMode")}$bodyWrap.append($tagList);var contentWidth=$bodyWrap.width(),contentHeight=$bodyWrap.height();var newCoords=ANT.util.stayInWindow({coords:coords,width:contentWidth,ignoreWindowEdges:settings.ignoreWindowEdges});$aWindow.css("left",newCoords.left+"px").css("top",newCoords.top+"px");$aWindow.animate({width:contentWidth},333,"swing");$aWindow.data("initialWidth",contentWidth).data("initialHeight",contentHeight);$aWindow.find("div.ant_cell_wrapper div.ant_tag").css({width:"100%"});return $aWindow},customOptions:{},setup:function(){}}},make:function(aWindowType,options){var hash=options.hash,summary=ANT.summaries[hash],kind=options.kind,isPage=options.is_page;if(!isPage&&!summary){var summary=ANT.util.makeEmptySummary(hash);ANT.actions.containers.setup(summary)}if(!aWindowType)aWindowType="readMode";var defaultOptions=ANT.aWindow.defaults,customOptions=ANT.aWindow._aWindowTypes.customOptions,settings=$.extend({},defaultOptions,customOptions,options,{mode:aWindowType});var $aWindow=ANT.aWindow._aWindowTypes.tagMode.make(settings);if(typeof $aWindow!="undefined"){setTimeout(function(){$aWindow.addClass("ant_show")},1);return $aWindow}},draw:function(options){if(!options.purpose||options.purpose!="login"){ANT.aWindow.closeAll()}if(options.selector&&!options.container){options.container=options.selector.substr(5)}var settings=$.extend({},this.defaults,options);var minHeight=settings.minHeight<60?60:settings.minHeight,maxHeight=settings.maxHeight;minWidth=settings.minWidth,maxWidth=settings.maxWidth,ant_for=typeof settings.container=="string"?"ant_for_"+settings.container:"ant_for_page",$new_aWindow=$('<div class="ant ant_window ant_rewritable ant_widget w100 '+ant_for+'"></div>');if(settings.id){$("#"+settings.id).remove();$new_aWindow.attr("id",settings.id)}$("#ant_sandbox").append($new_aWindow);if(settings.kind=="page"){$new_aWindow.addClass("ant_page_key_"+options.container.data("page_key")).addClass("ant_page_summary")}$new_aWindow.data(settings);if($new_aWindow.find("div.ant_header").length===0){$new_aWindow.html("");$new_aWindow.append('<div class="ant ant_header">'+'<div class="ant_loader"></div>'+"</div>"+'<div class="ant ant_body_wrap ant_clearfix"></div>'+'<div class="ant ant_footer"></div>');if(settings.noHeader)$new_aWindow.find("div.ant_header").remove();$new_aWindow.drags({handle:".ant_header"})}var coords=settings.coords;$new_aWindow.css("left",coords.left+"px");$new_aWindow.css("top",coords.top+"px");if(settings.height){$new_aWindow.height(settings.height)}ANT.actionbar.closeAll();$new_aWindow.settings=settings;$new_aWindow.on("resizestop.ant",function(event,ui){var $this=$(this)});return $new_aWindow},safeClose:function($aWindow){var isView=!!$aWindow.attr("ant-view-reactions-for");if(isView){var $header=ANT.aWindow.makeHeader(ANT.t("reactions"));$aWindow.find(".ant_header").replaceWith($header);ANT.aWindow.updateFooter($aWindow);var $panelWrap=$aWindow.find(".ant_body_wrap"),$currentlyVisiblePanel=$panelWrap.find(".ant_visiblePanel"),$currentlyHiddenPanel=$panelWrap.find(".ant_hiddenPanel");$panelWrap.animate({left:0});$currentlyVisiblePanel.removeClass("ant_visiblePanel").addClass("ant_hiddenPanel");$currentlyHiddenPanel.removeClass("ant_hiddenPanel").addClass("ant_visiblePanel");return true}ANT.aWindow.close($aWindow);return true},close:function($aWindows){ANT.aWindow.clearHilites($aWindows);$aWindows.each(function(idx,aWindow){$(aWindow).remove()});$("#ant_indicator_details_wrapper").find(".ant_body_wrap").css({visibility:"visible"})},closeAll:function(){var $allAWindows=$("div.ant.ant_window").not(".ant_no_clear");ANT.aWindow.close($allAWindows);$(".ant_shared").removeClass("ant_shared");$(document).off("keydown.ant")},clearHilites:function($aWindows){var selStates=[];$aWindows.each(function(idx,aWindow){var hash=$(aWindow).data("container");if(typeof hash==="undefined")return;var summary=ANT.summaries[hash];var selState=$(aWindow).data("selState");if(typeof selState!=="undefined"&&selState!==""){selStates.push(selState)}var content_nodes=[];if(summary&&summary.hasOwnProperty("content_nodes")){content_nodes=summary.content_nodes}$.each(content_nodes,function(key,node){var selState=node.selState;if(typeof selState!=="undefined"){selStates.push(selState)}})});$.each(selStates,function(idx,selState){try{$().selog("hilite",selState,"off")}catch(err){}})},update:function(hash,diffNode){var summary=ANT.summaries[hash],$aWindow_readmode=summary.$aWindow_readmode,$aWindow_writemode=summary.$aWindow_writemode;if(diffNode){if(diffNode.int_type=="coms"){if($aWindow_writemode&&$aWindow_writemode.length){$tags=$aWindow_writemode.find(".ant_tags").find(".ant_tag");$tags.addClass("ant_content_node_"+diffNode.content_id);_addComIndicator($aWindow_writemode,diffNode)}if($aWindow_readmode&&$aWindow_readmode.length){_addComIndicator($aWindow_readmode,diffNode)}else{var $aWindow=$("#ant_indicator_details_"+hash);$tags=$aWindow.find(".ant_tags").find(".ant_tag");$tags.addClass("ant_content_node_"+diffNode.content_id);_addComIndicator($aWindow,diffNode)}}}else{var isMedia=summary.kind&&(summary.kind=="img"||summary.kind=="media"||summary.kind=="med");if(!isMedia){return}ANT.actions.indicators.utils.makeDetailsContent(hash)}function _addComIndicator($aWindow,diffNode){var $tags,$tag;$tags=$aWindow.find(".ant_tags");$tag=$tags.find(".ant_tag_"+diffNode.parent_interaction_node.id).filter(function(){return $(this).hasClass("ant_content_node_"+diffNode.content_id)});$tag.addClass("ant_comment_indicator");_tempCopyOfCommentHover(diffNode,$tag,$aWindow);_tempMakeAWindowResizeIfOneColumnWhenAddingFirstComment($aWindow);_addLinkToViewComs(diffNode,$tag,$aWindow)}function _tempMakeAWindowResizeIfOneColumnWhenAddingFirstComment($aWindow){var $tag_table=$aWindow.find("table.ant_tags");if($tag_table.find("tr:eq(0)").find("td").length==1){$tag_table.addClass("ant-one-column");if(!isTouchBrowser){$tag_table.find("td.ant_has_pillHover").on("mouseenter.ant, mousemove.ant",function(){var $this=$(this),$aWindow=$this.closest("div.ant_window");thisWidth=$aWindow.data("initialWidth")}).on("mouseleave.ant",function(){var $this=$(this),$aWindow=$this.closest("div.ant_window");thisWidth=$aWindow.width()})}}}function _tempCopyOfCommentHover(diffNode,$tag,$aWindow){var contentNodes=summary.content_nodes;var contentNodesByContentId=contentNodes[diffNode.content_id];if(contentNodesByContentId){var comsPerContentNodeId=contentNodesByContentId.top_interactions.coms}else{var err=$.mustache('contentNode not found by id: {{id}}.  Figure out why nodeId was saved as "undefined".',{id:diffNode.content_id});ANT.safeThrow(err)}var comsPerContentNodeAndTagId=$.map(comsPerContentNodeId,function(node){return node.tag_id===diffNode.tag_id?node:null});var num_comments=comsPerContentNodeAndTagId.length;var $a=$tag;var tag=diffNode.parent_interaction_node;var content_node=diffNode.content_node;$a.find(".ant_comment_hover").remove();$a.find(".ant_comment_indicator").remove();var $commentHover=$('<span class="ant_comment_hover"/>');$commentHover.append('<span class="ant_icon"></span> '+num_comments);$commentHover.click(function(){ANT.actions.viewCommentContent({tag:tag,hash:hash,aWindow:$aWindow,content_node:content_node,selState:content_node.selState})});$a.append($commentHover);$a.closest("td").addClass("ant_has_pillHover")}function _addLinkToViewComs(diffNode,$tag,$aWindow){var tag=diffNode.parent_interaction_node;var content_node=diffNode.content_node;var $linkToComment=$('<span class="ant_comment_feedback"/>');$linkToComment.append('<span class="linkToComment">'+ANT.t("thanks_for_comment")+' <a href="javascript:void(0);">'+ANT.t("close")+"</a></span> ");$linkToComment.click(function(e){e.preventDefault();ANT.aWindow.safeClose($aWindow)});$aWindow.find("div.ant_commentBox").empty().append($linkToComment).show();$aWindow.find("button.ant_add_comment").hide()}}},actionbar:{draw:function(settings){var hash=settings.hash,coords=settings.coords,kind=settings.kind,content=settings.content,src_with_path=settings.src_with_path||undefined,page_id=ANT.util.getPageProperty("id",hash);var actionbar_id="ant_actionbar_"+hash;var $actionbars=$("div.ant_actionbar");if($("#"+actionbar_id).length>0)return $("#"+actionbar_id);var actionbarOffsets={IE:{top:"add this here",left:"add this here"},img:_getMediaCoords,text:{top:coords.top-40,left:coords.left+3}};coords=kind=="text"?actionbarOffsets.text:actionbarOffsets.img(coords);if(coords.top<0||coords.left<0){return false}if(kind=="text"){coords=ANT.util.stayInWindow({coords:coords,width:45,height:30,paddingY:40,paddingX:40,ignoreWindowEdges:settings.ignoreWindowEdges})}var $new_actionbar=$('<div class="ant ant_actionbar ant_widget ant_widget_bar" id="'+actionbar_id+'" ></div>');$new_actionbar.css({top:coords.top,left:coords.left});if(!hash){ANT.safeThrow("There should always be a hash from hashNodes after hover on an unhashed image.");return}$new_actionbar.data("hash",hash);var clickAction=settings.clickAction?settings.clickAction:function(){ANT.aWindow.make("writeMode",{hash:hash,kind:kind,content:content,src_with_path:src_with_path})};var $action=$('<a href="javascript:void(0);" class="ant_tooltip_this">'+'<span class="ant-antenna-logo"></span>'+'<span class="ant ant_react_label">'+ANT.t("main_cta")+"</span>"+'<div class="ant_clear"></div>'+'</a><div class="ant_down_arrow"></div>');$new_actionbar.append($action);$new_actionbar.on("mouseenter.ant",function(){ANT.util.setFunctionTimer(function(){$new_actionbar.addClass("ant_hover")},500);clearTimeout($new_actionbar.data("ant_actionbarShowTimer"))}).on("mouseleave.ant",function(){ANT.util.clearFunctionTimer();$new_actionbar.removeClass("ant_hover");$new_actionbar.data("ant_actionbarShowTimer",setTimeout(function(){ANT.actionbar.close($new_actionbar)},1e3))}).on("click.ant",clickAction);$("#ant_sandbox").append($new_actionbar);setTimeout(function(){$new_actionbar.addClass("ant_show")},10);if(kind=="img"||kind=="media"||kind=="med"){$new_actionbar.addClass("ant_actionbar_for_media");$new_actionbar.append('<div style="clear:both;" />').removeClass("ant_widget ant_widget_bar")}function _getMediaCoords(coords){var $containerTracker=$("#ant_container_tracker_"+hash),$topHilite=$containerTracker.find(".ant_mediaHilite_top");var newCoords={top:$topHilite.offset().top,left:$topHilite.offset().right};return newCoords}return $new_actionbar},close:function($actionbars,effect){$actionbars.each(function(){var $actionbar=$(this),hash=$actionbar.data("hash"),$containerTracker=$("#ant_container_tracker_"+hash);$actionbar.removeClass("ant_show");setTimeout(function(){cleanup($actionbar,hash)},200)});function cleanup($actionbar,hash){var timeoutCloseEvt=$actionbar.data("timeoutCloseEvt");var timeoutCollapseEvt=$actionbar.data("timeoutCollapseEvt");clearTimeout(timeoutCloseEvt);clearTimeout(timeoutCollapseEvt);var $container=$('[ant-hash="'+hash+'"]'),$indicator=$("#ant_indicator_"+hash);$container.removeClass("ant_engage_media");$actionbar.remove()}},closeSuggest:function(hashes){var $actionbars=$();if(!hashes){$actionbars=$("div.ant_actionbar")}else if(typeof hashes=="string"){var hash=hashes;$actionbars=$("#ant_actionbar_"+hash);$actionbars.data("hash",hash)}else{$.each(hashes,function(idx,hash){$actionbars=$actionbars.add("#ant_actionbar_"+hash);$actionbars.data("hash",hash)})}var scope=this;$actionbars.each(function(){var $this=$(this),hash=$actionbars.data("hash"),$indicator_details=$("#ant_indicator_details_"+hash),$containerImg=$('[ant-hash="'+hash+'"]'),timeoutCloseEvt=$(this).data("timeoutCloseEvt");clearTimeout(timeoutCloseEvt);timeoutCloseEvt=setTimeout(function(){if($this.data("hover")||$containerImg.data("hover")||$indicator_details.data("hover"))return;scope.close($this,"fade")},300);$(this).data("timeoutCloseEvt",timeoutCloseEvt)})},closeAll:function(){var $actionbars=$("div.ant_actionbar");this.close($actionbars)}},t:function(phrase){return typeof ANT.lang[ANT.group.language][phrase]!="undefined"?ANT.lang[ANT.group.language][phrase]:"###"},lang:{en:{main_cta:"What do you think?",your_reaction:"Your Reaction?",react:"React",add_custom:"Add Your Own",reactions:"Reactions",okay:"Okay",single_reaction:"reaction",plural_reaction:"reactions",to_page:"to this <strong>page</strong>",close:"Close",thanks:"Thanks For Your Reaction!",already_done_that:"You've already reacted to this",remove_reaction:"Remove reaction",view_on_site:"View at Antenna",add_comment:"Add comments or #hashtags",characters_left:"NNN characters left",comment:"Comment",comments:"Comments",thanks_for_comment:"Thanks for your comment!",share_reaction:"Share your reaction",bad_language_warning:"This site has blocked that from being a valid reaction.\n\nPlease try something that will be more appropriate for this community."},es:{main_cta:"¿Qué piensas?",your_reaction:"¿Reacción tuyo?",react:"Reaccionar",add_custom:"Añade lo tuyo",reactions:"Reacciones",okay:"Bien",single_reaction:"reacción",plural_reaction:"reacciones",to_page:"a esta <strong>página</strong>",close:"cerrar",thanks:"Gracias por tu reacción",already_done_that:"Ya reaccionaste a esto",remove_reaction:"Remover reacción",view_on_site:"Ver en Antenna",add_comment:"Añade comentarios o #hashtags",characters_left:"Quedan NNN caracteres ",comment:" Comenta",comments:" Comentas",thanks_for_comment:"Gracias por tu comentario",share_reaction:"Comparte tu reacción",bad_language_warning:"Este sitio ha bloqueado una palabra inadecuada de ser una reacción válida.\n\nPor favor intente algo más apropiado para esta comunidad"}},broadcast:{init:function(){var $broadcastSelector=$(ANT.group.recirc_selector).first();if(ANT.util.activeAB()&&ANT.group.show_recirc&&$broadcastSelector.length){var ajaxUrl=ANT_offline?"http://www.antenna.is/analytics/recirc/v1/2352/":ANT_baseUrl+"/analytics/recirc/v1/"+ANT.group.id+"/";$.ajax({url:ajaxUrl,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON({})},success:function(response){var $broadcast=$('<div class="antenna-broadcast no-ant"></div>'),$broadcast_tiles=$('<div class="ant-tiles"></div>'),$broadcast_explanation=$('<div class="ant-explanation"><span class="ant-antenna-logo"></span><span class="ant-antenna-text"></span><p>These tiles have reactions from other readers, telling you why certain content caught their attention.</p><p>Add your voice!  React to text, images, and video on the site and your opinion might show up here, too. Just look for the <span class="ant-antenna-logo ant-inline"></span> logo.</p><p>For more information about Antenna, <a href="http://www.antenna.is/">visit our website</a>.</p><p><a href="javascript:void(0);" class="ant-close">Close this</a></p></div>');if($broadcastSelector.width()<400){$broadcast.addClass("ant-thin")}var broadcastHeadline=ANT.group.recirc_title!=""?ANT.group.recirc_title:"Popular Reactions";$broadcast.append('<div class="ant-broadcast-header"><div class="ant-headline">'+broadcastHeadline+'</div><div class="ant-logo"><span class="ant-antenna-logo"></span></div></div>');var tileCount=0;var tiles=[];while(tiles.length<response.data.length){var randomnumber=Math.ceil(Math.random()*response.data.length);var found=false;for(var i=0;i<tiles.length;i++){if(tiles[i]==randomnumber){found=true;break}}if(!found)tiles[tiles.length]=randomnumber}$.each(tiles,function(idx,tileNum){var item=response.data[tileNum-1];if(tileCount<5){var validTile=false;if(item.content.kind=="pag"){if(item.page.image){validTile=true;content='<img src="'+item.page.image+'" />'}}else{var content=item.content.kind=="img"?'<img src="'+item.content.body+'" />':item.content.kind=="med"?'<iframe class="contentBody" width="300" height="250" frameborder="0" src="'+item.content.body+'"></iframe>':item.content.body.split(" ").length<2?"":item.content.body;var backgroundImage=item.content.kind=="txt"&&item.content.body.length<16?item.page.image:"";validTile=true}if(validTile===true){var itemHTML=""+'<div class="ant-featured ant-featured-'+item.content.kind+'" style="background-image:url('+backgroundImage+')">'+'<div class="ant-featured-container">'+'<a href="//www.antenna.is/r/'+item.reaction.id+'/">'+'<div class="ant-featured-content">'+content+"</div>"+'<div class="ant-featured-overlay"></div>'+'<div class="ant-featured-gradient"></div>'+'<div class="ant-featured-reaction">'+item.reaction.body+"</div>"+'<div class="ant-featured-headline">'+item.page.title+"</div>"+"</a>"+"</div>"+"</div>";$broadcast_tiles.append(itemHTML);tileCount++}}});$broadcast.append($broadcast_tiles,$broadcast_explanation);$broadcast.find(".ant-logo, .ant-close").click(function(){$broadcast.find(".ant-explanation").toggleClass("ant-visible")});var broadcastInsertionMethod=ANT.group.recirc_jquery_method!=""?ANT.group.recirc_jquery_method:"append";$broadcastSelector[broadcastInsertionMethod]($broadcast);ANT.actions.indicators.utils.updateContainerTrackers()}})}},forceDisplay:function(selector){ANT.group.show_recirc=true;if(selector){ANT.group.recirc_selector=selector}ANT.broadcast.init()}},status:{group:false,page:false},util:{cookies:{create:function(name,value,days){if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+value+expires+"; path=/"},read:function(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null},erase:function(name){createCookie(name,"",-1)}},hexToRgb:function(hex){hex=$.trim(hex);if(hex){var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?parseInt(result[1],16)+","+parseInt(result[2],16)+","+parseInt(result[3],16):null}else{return"0,0,0"}},getColorLuma:function(rgb){var r=rgb.split(",")[0],g=rgb.split(",")[1],b=rgb.split(",")[2];return.2126*r+.7152*g+.0722*b},bubblingEvents:{touchend:false,dragging:false},windowBlur:function(){return},windowFocus:function(){return},clearFunctionTimer:function(){clearInterval($.data(this,"ant_functionTimer"))},setFunctionTimer:function(callback,time){ANT.util.clearFunctionTimer();if(!time){time=300}if(typeof callback!="undefined"){$.data(this,"ant_functionTimer",setTimeout(function(){callback()},time))}},clearWindowInterval:function(){},checkForSelectedTextAndLaunchAWindow:function(){var existingSelState=$("document").selog("save");if(!existingSelState)return;var node=existingSelState.range.commonAncestorContainer;var $node=node.nodeType===3?$(node).parent():$(node);var $actionbar=ANT.actions.startSelect($node,null,function(hash,kind,content){ANT.aWindow.make("writeMode",{hash:hash,kind:kind,content:content})})},initTouchBrowserSettings:function(){if(isTouchBrowser&&ANT.util.activeAB()){$("body").addClass("ant_touch_browser");$(window).on("scrollend.ant",function(){ANT.util.mobileHelperToggle()})}$ANT.dequeue("initAjax")},mobileHelperToggle:function(){$(ANT.group.active_sections).find("embed[ant-node], video[ant-node], object[ant-node], iframe[ant-node], img[ant-node]").each(function(){var $this=$(this),hash=$this.data("hash");ANT.actions.indicators.init(hash);$this.addClass("ant_live_hover")})},initPublicEvents:function(){window.antenna.public_events=$("#ant_sandbox");$ANT.dequeue("initAjax")},makeEmptySummary:function(hash,kind){var summary={};summary={};summary.hash=hash;summary.kind=kind;summary.top_interactions={};summary.top_interactions.coms={};summary.top_interactions.tags={};summary.top_interactions.shr={};summary.counts={};summary.counts.tags=0;summary.counts.interactions=0;summary.counts.coms=0;return summary},getPageProperty:function(prop,hashOrObject){if(!prop){prop="id"}if(prop=="id"){var page_id;if(hashOrObject=="page"){page_id=$(".ant_window").data("container").attr("ant-page-id");return parseInt(page_id,10)}if(typeof hashOrObject=="object"){if($(hashOrObject).closest("[ant-page-container]").length){return parseInt($(hashOrObject).closest("[ant-page-container]").attr("ant-page-container"))}}else if(!hashOrObject){return $("[ant-page-container]").eq(0).attr("ant-page-container")}if(typeof hashOrObject=="string"){var hash=hashOrObject;var $objWithHash=$('[ant-hash="'+hash+'"]')}var page_id=$objWithHash.data("page_id")?$objWithHash.data("page_id"):$objWithHash.closest("[ant-page-container]").length?$objWithHash.closest("[ant-page-container]").attr("ant-page-container"):$("body").attr("ant-page-container");if($objWithHash.hasAttr("ant-page-container")&&!$objWithHash.data("page_id")){$objWithHash.data("page_id",page_id)}return parseInt(page_id)}if(prop=="title"){var title=$('meta[property="og:title"]').attr("content")?$('meta[property="og:title"]').attr("content"):$("title").text()?$("title").text():"";return $.trim(title)}var page_url=$.trim(window.location.href.split("#")[0]).toLowerCase();if(prop=="page_url"){return page_url}if(prop=="canonical_url"){var canonical_url=$('link[rel="canonical"]').length>0?$('link[rel="canonical"]').attr("href"):page_url;canonical_url=$.trim(canonical_url.toLowerCase());if(canonical_url==ANT.util.getPageProperty("page_url")){canonical_url="same"}var tld=$.trim(window.location.protocol+"//"+window.location.hostname+"/").toLowerCase();if(canonical_url==tld){if(page_url!=tld){canonical_url=page_url}}return $.trim(canonical_url)}},buildInteractionData:function(){$.each(ANT.summaries,function(hash,summary){$.each(summary.top_interactions.tags,function(tag_id,interaction){if(typeof ANT.summaries[hash].content_nodes!="undefined"){$.each(ANT.summaries[hash].content_nodes,function(node_id,node){if(typeof node.top_interactions.tags!="undefined"&&typeof node.top_interactions.tags[tag_id]!="undefined"){var this_interaction=node.top_interactions.tags[tag_id];if(typeof ANT.interaction_data[tag_id]=="undefined"){ANT.interaction_data[tag_id]={}}if(typeof ANT.interaction_data[tag_id][this_interaction.parent_id]=="undefined"){ANT.interaction_data[tag_id][this_interaction.parent_id]={}}ANT.interaction_data[tag_id][this_interaction.parent_id].hash=hash;ANT.interaction_data[tag_id][this_interaction.parent_id].container_id=summary.id;ANT.interaction_data[tag_id][this_interaction.parent_id].tag={body:this_interaction.body,id:tag_id};ANT.interaction_data[tag_id][this_interaction.parent_id].kind=summary.kind;ANT.interaction_data[tag_id][this_interaction.parent_id].interaction={id:this_interaction.parent_id,count:this_interaction.count,body:this_interaction.body};ANT.interaction_data[tag_id][this_interaction.parent_id].content_node={body:node.body,location:node.location,selState:node.selState}}})}})})},stayInWindow:function(settings){var rWin=$(window),winWidth=rWin.width(),winHeight=rWin.height(),winScroll=rWin.scrollTop(),w=settings.width,h=settings.height,coords=settings.coords,paddingY=settings.paddingY||10,paddingX=settings.paddingX||10,ignoreWindowEdges=settings.ignoreWindowEdges?settings.ignoreWindowEdges:"";if(ignoreWindowEdges.indexOf("r")==-1&&coords.left+w+16>=winWidth-paddingX){coords.left=winWidth-w-paddingX}if(ignoreWindowEdges.indexOf("b")==-1&&coords.top+h>winHeight+winScroll-paddingY){coords.top=winHeight+winScroll-h-paddingY}if(ignoreWindowEdges.indexOf("l")==-1&&coords.left<paddingX){coords.left=paddingX}if(ignoreWindowEdges.indexOf("t")==-1&&coords.top<winScroll+paddingY){coords.top=winScroll+paddingY}return coords},md5:{hexcase:0,b64pad:"",chrsz:8,hex_md5:function(s){return ANT.util.md5.binl2hex(ANT.util.md5.core_md5(ANT.util.md5.str2binl(s),s.length*ANT.util.md5.chrsz))},core_md5:function(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=ANT.util.md5.md5_ff(a,b,c,d,x[i+0],7,-680876936);d=ANT.util.md5.md5_ff(d,a,b,c,x[i+1],12,-389564586);c=ANT.util.md5.md5_ff(c,d,a,b,x[i+2],17,606105819);b=ANT.util.md5.md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=ANT.util.md5.md5_ff(a,b,c,d,x[i+4],7,-176418897);d=ANT.util.md5.md5_ff(d,a,b,c,x[i+5],12,1200080426);c=ANT.util.md5.md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=ANT.util.md5.md5_ff(b,c,d,a,x[i+7],22,-45705983);a=ANT.util.md5.md5_ff(a,b,c,d,x[i+8],7,1770035416);d=ANT.util.md5.md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=ANT.util.md5.md5_ff(c,d,a,b,x[i+10],17,-42063);b=ANT.util.md5.md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=ANT.util.md5.md5_ff(a,b,c,d,x[i+12],7,1804603682);d=ANT.util.md5.md5_ff(d,a,b,c,x[i+13],12,-40341101);c=ANT.util.md5.md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=ANT.util.md5.md5_ff(b,c,d,a,x[i+15],22,1236535329);a=ANT.util.md5.md5_gg(a,b,c,d,x[i+1],5,-165796510);d=ANT.util.md5.md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=ANT.util.md5.md5_gg(c,d,a,b,x[i+11],14,643717713);b=ANT.util.md5.md5_gg(b,c,d,a,x[i+0],20,-373897302);a=ANT.util.md5.md5_gg(a,b,c,d,x[i+5],5,-701558691);d=ANT.util.md5.md5_gg(d,a,b,c,x[i+10],9,38016083);c=ANT.util.md5.md5_gg(c,d,a,b,x[i+15],14,-660478335);b=ANT.util.md5.md5_gg(b,c,d,a,x[i+4],20,-405537848);a=ANT.util.md5.md5_gg(a,b,c,d,x[i+9],5,568446438);d=ANT.util.md5.md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=ANT.util.md5.md5_gg(c,d,a,b,x[i+3],14,-187363961);b=ANT.util.md5.md5_gg(b,c,d,a,x[i+8],20,1163531501);a=ANT.util.md5.md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=ANT.util.md5.md5_gg(d,a,b,c,x[i+2],9,-51403784);c=ANT.util.md5.md5_gg(c,d,a,b,x[i+7],14,1735328473);b=ANT.util.md5.md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=ANT.util.md5.md5_hh(a,b,c,d,x[i+5],4,-378558);d=ANT.util.md5.md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=ANT.util.md5.md5_hh(c,d,a,b,x[i+11],16,1839030562);b=ANT.util.md5.md5_hh(b,c,d,a,x[i+14],23,-35309556);a=ANT.util.md5.md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=ANT.util.md5.md5_hh(d,a,b,c,x[i+4],11,1272893353);c=ANT.util.md5.md5_hh(c,d,a,b,x[i+7],16,-155497632);b=ANT.util.md5.md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=ANT.util.md5.md5_hh(a,b,c,d,x[i+13],4,681279174);d=ANT.util.md5.md5_hh(d,a,b,c,x[i+0],11,-358537222);c=ANT.util.md5.md5_hh(c,d,a,b,x[i+3],16,-722521979);b=ANT.util.md5.md5_hh(b,c,d,a,x[i+6],23,76029189);a=ANT.util.md5.md5_hh(a,b,c,d,x[i+9],4,-640364487);d=ANT.util.md5.md5_hh(d,a,b,c,x[i+12],11,-421815835);c=ANT.util.md5.md5_hh(c,d,a,b,x[i+15],16,530742520);b=ANT.util.md5.md5_hh(b,c,d,a,x[i+2],23,-995338651);a=ANT.util.md5.md5_ii(a,b,c,d,x[i+0],6,-198630844);d=ANT.util.md5.md5_ii(d,a,b,c,x[i+7],10,1126891415);c=ANT.util.md5.md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=ANT.util.md5.md5_ii(b,c,d,a,x[i+5],21,-57434055);a=ANT.util.md5.md5_ii(a,b,c,d,x[i+12],6,1700485571);d=ANT.util.md5.md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=ANT.util.md5.md5_ii(c,d,a,b,x[i+10],15,-1051523);b=ANT.util.md5.md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=ANT.util.md5.md5_ii(a,b,c,d,x[i+8],6,1873313359);d=ANT.util.md5.md5_ii(d,a,b,c,x[i+15],10,-30611744);c=ANT.util.md5.md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=ANT.util.md5.md5_ii(b,c,d,a,x[i+13],21,1309151649);a=ANT.util.md5.md5_ii(a,b,c,d,x[i+4],6,-145523070);d=ANT.util.md5.md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=ANT.util.md5.md5_ii(c,d,a,b,x[i+2],15,718787259);b=ANT.util.md5.md5_ii(b,c,d,a,x[i+9],21,-343485551);a=ANT.util.md5.safe_add(a,olda);b=ANT.util.md5.safe_add(b,oldb);c=ANT.util.md5.safe_add(c,oldc);d=ANT.util.md5.safe_add(d,oldd)}return Array(a,b,c,d)},md5_cmn:function(q,a,b,x,s,t){return ANT.util.md5.safe_add(ANT.util.md5.bit_rol(ANT.util.md5.safe_add(ANT.util.md5.safe_add(a,q),ANT.util.md5.safe_add(x,t)),s),b)},md5_ff:function(a,b,c,d,x,s,t){return ANT.util.md5.md5_cmn(b&c|~b&d,a,b,x,s,t)},md5_gg:function(a,b,c,d,x,s,t){return ANT.util.md5.md5_cmn(b&d|c&~d,a,b,x,s,t)},md5_hh:function(a,b,c,d,x,s,t){return ANT.util.md5.md5_cmn(b^c^d,a,b,x,s,t)},md5_ii:function(a,b,c,d,x,s,t){return ANT.util.md5.md5_cmn(c^(b|~d),a,b,x,s,t)},safe_add:function(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535},bit_rol:function(num,cnt){return num<<cnt|num>>>32-cnt},str2binl:function(str){var bin=Array();var mask=(1<<ANT.util.md5.chrsz)-1;for(var i=0;i<str.length*ANT.util.md5.chrsz;i+=ANT.util.md5.chrsz){bin[i>>5]|=(str.charCodeAt(i/ANT.util.md5.chrsz)&mask)<<i%32}return bin},binl2hex:function(binarray){var hex_tab=ANT.util.md5.hexcase?"0123456789ABCDEF":"0123456789abcdef";var str="";for(var i=0;i<binarray.length*4;i++){str+=hex_tab.charAt(binarray[i>>2]>>i%4*8+4&15)+hex_tab.charAt(binarray[i>>2]>>i%4*8&15)}return str}},getCleanText:function($domNode){var $node=$domNode.clone();$node.find(".ant, .ant-custom-cta-container").remove();var $indicator=$node.find(".ant_indicator");
if($indicator.length){return}var node_text=$.trim($node.html().replace(/< *br *\/?>/gi," "));var body=$.trim($("<div>"+node_text+"</div>").text().toLowerCase());if(body&&typeof body=="string"&&body!==""){var firstpass=body.replace(/[\n\r\t]+/gi," ").replace().replace(/\s{2,}/g," ");return $.trim(firstpass)}},trimToLastWord:function(str){var danglerRE=/\w+$/.exec(str);if(!danglerRE){return str}else{return str.slice(0,str.length-danglerRE[0].length)}},cssSuperImportant:function($domNode,cssDict,shouldReplace){var inlineStyleStr="";$.each(cssDict,function(key,val){val.replace("!important","");$.trim(val);val+=" !important";cssDict[key]=val});var existingStyle=$domNode.attr("style")||"";var newStyleDict=shouldReplace?cssDict:$.extend(ANT.util.parseCssAttrToDict(existingStyle),cssDict);$.each(newStyleDict,function(key,val){inlineStyleStr+=key+":"+val+";"});$domNode.attr("style",inlineStyleStr);return $domNode},parseCssAttrToDict:function(inlineStyleStr){var styleDict={};var attrs=inlineStyleStr.split(";");$.each(attrs,function(idx,attrPair){var attrSplit=attrPair.split(":");var key=$.trim(attrSplit[0]);var val=$.trim(attrSplit[1]);if(key.length&&val.length){styleDict[key]=val}});return styleDict},fixBrTags:function(){var $sections=$(ANT.group.br_replace_scope_selector).find("> br").parent();if(!$sections.length){return}var marker="|ant|br|/ant|";$sections.each(function(){var $this=$(this);var $clone=$this.clone();var $dummySection=$("<p></p>");$clone.find("> br").each(function(){$(this).replaceWith(marker)});var sections=$clone.html().split(marker);for(var i=0;i<sections.length;i++){var innerText=sections[i];$dummySection.append('<div class="ant_br_replaced">'+innerText+"</div>")}$this.addClass("ant_br_replaced_section").html($dummySection.html())})},fixBodyBorderOffsetIssue:function(){var $body=$("body"),borderTop=parseInt($body.css("border-top-width"),10),borderLeft=parseInt($body.css("border-left-width"),10),$sandbox=$("#ant_sandbox");if(!borderTop&&!borderLeft)return;ANT.util.cssSuperImportant($sandbox,{top:borderTop+"px",left:borderLeft+"px"})},throttledUpdateContainerTrackers:function(){return ANT.util._.throttle(ANT.actions.indicators.utils.updateContainerTrackers,100)},userLoginState:function(){if(!$("#ant-user").length){$(".ant-page-summary").find("div.ant-summary").prepend('<div id="ant-user" />')}if(ANT&&ANT.user&&ANT.user.full_name&&$(".ant-page-summary.defaultSummaryBar").length){var name=ANT.user.user_type=="facebook"?ANT.user.full_name.split(" ")[0]:ANT.user.full_name;$("#ant-user").html('Hi, <a href="'+ANT_baseUrl+"/user/"+ANT.user.user_id+'" target="_blank">'+name+"</a>")}else{$("#ant-user").html('<a href="javascript:void(0);">Log in to Antenna</a>');$("#ant-user").find("a").click(function(){ANT.session.showLoginPanel()})}},objLength:function(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key)){size++}}return size},_:{debounce:function(func,wait){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;func.apply(context,args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}},throttle:function(func,wait){var _={};_.debounce=ANT.util._.debounce;var context,args,timeout,throttling,more;var whenDone=_.debounce(function(){more=throttling=false},wait);return function(){context=this;args=arguments;var later=function(){timeout=null;if(more)func.apply(context,args);whenDone()};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true}else{func.apply(context,args)}whenDone();throttling=true}},once:function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo}}},getQueryParams:function(optQueryString){var queryString=optQueryString||window.location.search;var urlParams={};var e,a=/\+/g,r=/([^&=]+)=?([^&]*)/g,d=function(s){return decodeURIComponent(s.replace(a," "))},q=queryString.substring(1);while(e=r.exec(q))urlParams[d(e[1])]=d(e[2]);return urlParams},getQueryStrFromUrl:function(url){var qIndex=url.indexOf("?"),hrefBase,hrefQuery,qParams;if(qIndex==-1){hrefBase=url;hrefQuery=""}else{hrefBase=url.slice(0,qIndex);hrefQuery=url.slice(qIndex)}return hrefQuery},createGuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})},killSessions:function(){localStorage.removeItem("ant_sts");localStorage.removeItem("ant_lts");ANT.user.sts=null;ANT.user.lts=null},activeAB:function(){var isActive=true;var ant_ab=JSON.parse(localStorage.getItem("ant_ab"));if(ANT.group.ab_test_impact===true&&(!ant_ab||(new Date).getTime()>ant_ab.expires)){var p=10*ANT.group.ab_test_sample_percentage;if(Math.floor(Math.random()*1e3)<=p){isActive=false}var ab_session_expiretime=new Date;var days=30;ab_session_expiretime.setTime(ab_session_expiretime.getTime()+days*1440*60*1e3);var new_ant_ab={active:isActive,expires:ab_session_expiretime.getTime()};localStorage.setItem("ant_ab",JSON.stringify(new_ant_ab))}else{isActive=ant_ab.active}return isActive},checkSessions:function(){var ant_sts=JSON.parse(localStorage.getItem("ant_sts"));var ant_lts=localStorage.getItem("ant_lts");if(!ant_sts||(new Date).getTime()>ant_sts.expires){var short_session_guid=ANT.user.sts=ANT.util.createGuid();var short_session_expiretime=new Date;var minutes=15;short_session_expiretime.setTime(short_session_expiretime.getTime()+minutes*60*1e3);var new_ant_sts={guid:short_session_guid,expires:short_session_expiretime.getTime()};localStorage.setItem("ant_sts",JSON.stringify(new_ant_sts))}else{ANT.user.sts=ant_sts.guid;var minutes=10;var short_session_expiretime=new Date;short_session_expiretime.setTime(short_session_expiretime.getTime()+minutes*60*1e3);var new_ant_sts={guid:ANT.user.sts,expires:short_session_expiretime.getTime()};localStorage.setItem("ant_sts",JSON.stringify(new_ant_sts))}if(!ant_lts){var long_session_guid=ANT.user.lts=ANT.util.createGuid();localStorage.setItem("ant_lts",long_session_guid)}else{ANT.user.lts=ant_lts}}},debug:function(){window.ANT=window.ANTENNAIS;window.$ANT=$ANT;window.$A=$A},toggle:function(){$A("body").toggleClass("no-ant")},getLastEvent:function(){if(ANT.group.premium==true){return{event:ANT.events.lastEvent?ANT.events.lastEvent:"",value:ANT.events.lastValue?ANT.events.lastValue:"",supplementary:ANT.events.lastSupplementary?ANT.events.lastSupplementary:{}}}},session:{alertBar:{make:function(whichAlert,data){var $msg1,$msg2,$pinIcon;if(whichAlert=="fromShareLink"&&data.content!="undefined"){var decodedContent=unescape($.evalJSON('"'+data.content+'"'));$msg1=$("<h1>Shared with <span>Antenna</span></h1>");if($('img[ant-hash="'+data.container_hash+'"]').length==1){$msg2=$('<div><strong class="reactionText">'+ANT.t("single_reaction")+": <em>"+data.reaction+"</em></strong>"+' <a class="ant_showSelection" href="javascript:void(0);"><img src="'+data.content+'" style="max-width:100px !important;max-height:70px !important;margin:5px 0 !important;display:block !important;" />'+' <strong class="seeItLinkText ant_blue">Show it on the page</strong></a></div>')}else{$msg2=$('<div><strong class="reactionText">'+ANT.t("single_reaction")+": <em>"+data.reaction+"</em></strong>"+'<strong>"</strong><em>'+decodedContent.substr(0,140)+'...</em><strong>"</strong>'+'<br /><strong class="seeItLinkText"><a class="ant_showSelection" href="javascript:void(0);">Show it on the page</a></strong></div>')}$msg2.find("a.ant_showSelection").click(function(){setTimeout(function(){ANT.session.revealSharedContent(data)},200)})}if(typeof $msg1!="undefined"){$pinIcon=$('<span class="ant-antenna-logo"></span>');var $alertContent=$('<div class="ant_alert_box ant ant_'+whichAlert+'" />');$alertContent.append($('<div class="ant_alert_box_1" />').append($pinIcon).append($msg1),$('<div class="ant_alert_box_2" />').append($msg2),'<div class="ant ant_alert_box_x">x</div>');$("#ant_sandbox").append($alertContent);$("div.ant_alert_box.ant_"+whichAlert).find(".ant_alert_box_x").click(function(){ANT.session.alertBar.close(whichAlert)});$("div.ant_alert_box.ant_"+whichAlert).animate({top:-5},1e3)}},close:function(whichAlert){$("div.ant_alert_box.ant_"+whichAlert).remove();$("div.ant_indicator_for_media").hide();$.postMessage("close "+whichAlert,ANT_baseUrl+"/static/xdm.html",window.frames["ant-xdm-hidden"])}},revealSharedContent:function(data){var hash=data.container_hash,$container=$('[ant-hash="'+hash+'"]');var kind=$container.data("kind");if(kind=="img"||kind=="media"||kind=="med"){$container.addClass("ant_shared");ANT.actions.indicators.utils.updateContainerTracker(hash)}if(data.location&&data.location!="None"){var serialRange=data.location;var selogStack=$().selog("stack");var selState=$container.selog("save",{serialRange:serialRange});$().selog("hilite",selState,"on");$("div.ant_page_summary").remove()}var targetOffset=$container.offset().top,windowPadding=130,scrollTarget=targetOffset-windowPadding||0;$("html,body").animate({scrollTop:scrollTarget},1e3)},getSharedLinkInfo:function(data){if(ANT.util.cookies.read("content_type")!="pag"){var containerHash=data.container_hash;var pageHasContainer=!!ANT.containers[containerHash];if(!pageHasContainer){return}ANT.session.alertBar.make("fromShareLink",data);return true}},getUser:function(args,callback){if(callback&&args){ANT.session.receiveMessage(args,callback)}else if(callback){ANT.session.receiveMessage(false,callback)}$.postMessage("getUser",ANT_baseUrl+"/static/xdm.html",window.frames["ant-xdm-hidden"])},handleGetUserFail:function(args,callback){var response=args.response;switch(response.message){case"Error getting user!":ANT.session.killUser();break;case"Temporary user interaction limit reached":ANT.session.showLoginPanel(args,callback);break;case"Container specified does not exist":break;case"Token was invalid":case"Facebook token expired":case"FB graph error - token invalid":case"Social Auth does not exist for user":case"Data to create token is missing":if(typeof ANT.user.user_type!="undefined"&&ANT.user.user_type=="antenna"){ANT.session.showLoginPanel(args,callback)}else{ANT.user.getUserAttempts=ANT.user.getUserAttempts||1;if(ANT.user.getUserAttempts<2){ANT.session.receiveMessage(args,callback);$.postMessage("reauthUser",ANT_baseUrl+"/static/xdm.html",window.frames["ant-xdm-hidden"])}else{ANT.session.killUser();ANT.session.showLoginPanel(args,callback)}}break}},createXDMframe:function(){ANT.session.receiveMessage({},function(){ANT.util.userLoginState()});var iframeUrl=ANT_baseUrl+"/static/xdm.html",parentUrl=window.location.href,parentHost=window.location.protocol+"//"+window.location.host,bookmarklet=ANT.engageScriptParams.bookmarklet?"bookmarklet=true":"",$xdmIframe=$('<iframe id="ant-xdm-hidden" name="ant-xdm-hidden" src="'+iframeUrl+"?parentUrl="+parentUrl+"&parentHost="+parentHost+"&group_id="+ANT.group.id+"&group_name="+encodeURIComponent(ANT.group.name)+"&"+bookmarklet+'" width="1" height="1" style="position:absolute;top:-1000px;left:-1000px;" />');$("#ant_sandbox").append($xdmIframe);$ANT.dequeue("initAjax")},receiveMessage:function(args,callbackFunction){$.receiveMessage(function(e){var message=$.evalJSON(e.data);if(message.status){if(message.status=="returning_user"||message.status=="got_temp_user"){for(var i in message.data){ANT.user=ANT.user||{};if(i=="user_boards"){ANT.user.user_boards=$.evalJSON(message.data[i])}else{ANT.user[i]=!isNaN(message.data[i])?parseInt(message.data[i],10):message.data[i]}}if(callbackFunction&&args){if(!args.kind&&args.aWindow){args.kind=$(args.aWindow).data("kind")}args.user=ANT.user;callbackFunction(args);callbackFunction=null}else if(callbackFunction){callbackFunction();callbackFunction=null}ANT.util.userLoginState()}else if(message.status=="xdm loaded"){ANT.group.xdmLoaded=true;ANT.events.fireEventQueue()}else if(message.status=="board_created"){$("div.ant-board-create-div").remove()}else if(message.status=="board_create_cancel"){clearInterval(ANT.checkingBoardWindow);$("div.ant-board-create-div").remove()}else if(message.status=="getUserLoginState"){ANT.session.getUser();$("#ant_loginPanel").remove()}else if(message.status=="fb_user_needs_to_login"){if(callbackFunction&&args){ANT.session.showLoginPanel(args,callbackFunction)}else{ANT.session.showLoginPanel(args)}}else if(message.status=="close login panel"){ANT.util.userLoginState();$("#ant_loginPanel").remove();$("div.ant-summary div.ant_info").html("<em>You're logged in!  Try your last reaction again.")}else if(message.status=="already had user"){$("#ant_loginPanel div.ant_body").html('<div style="padding: 5px 0; margin:0 8px; border-top:1px solid #ccc;"><strong>Welcome!</strong> You\'re logged in.</div>')}else if(message.status.indexOf("recircClick")!=-1){var linkData=message.status.split("|");if(linkData[1]){ANT.session.referring_int_id=parseInt(linkData[1],10)}ANT.events.trackEventToCloud({event_type:"rc",event_value:""+ANT.session.referring_int_id,page_id:ANT.util.getPageProperty("id")})}else if(message.status.indexOf("sharedLink")!=-1){var sharedLink=message.status.split("|");if(sharedLink[5]){ANT.session.referring_int_id=parseInt(sharedLink[5],10)}ANT.session.getSharedLinkInfo({container_hash:sharedLink[1],location:sharedLink[2],reaction:sharedLink[3],content:sharedLink[4],page_hash:sharedLink[6],redirect_type:sharedLink[7]})}}},ANT_baseUrl)},login:function(){},checkForMaxInteractions:function(){ANT.user=ANT.user||{};var isTempUser=!ANT.user.user_type;if(isTempUser&&ANT.user.num_interactions&&ANT.user.num_interactions>=ANT.group.temp_interact){return true}return false},showLoginPanel:function(args,callback){$(".ant_rewritable").removeClass("ant_rewritable");if($("#ant_loginPanel").length<1){var coords;if(args&&args.aWindow){var caller=args.aWindow;coords=caller.offset();coords.left=coords.left?coords.left-34:100;coords.top=coords.top?coords.top-25:100}else{coords=[];coords.left=$(window).width()/2-200;coords.top=150+$(window).scrollTop()}var $aWindow=ANT.aWindow.draw({coords:coords,id:"ant_loginPanel",pnls:1,height:175,ignoreWindowEdges:"bt",purpose:"login"});if(args)$aWindow.data("args",args);if(callback)$aWindow.data("callback",callback);var iframeUrl=ANT_baseUrl+"/static/fb_login.html",parentUrl=window.location.href,parentHost=window.location.protocol+"//"+window.location.host,h1_text=args&&args.response&&args.response.message.indexOf("Temporary user interaction")!=-1?"Log In to Continue Reacting":"Log In to Antenna",$loginIframe=$('<iframe id="ant-xdm-login" src="'+iframeUrl+"?parentUrl="+parentUrl+"&parentHost="+parentHost+"&group_id="+ANT.group.id+"&group_name="+ANT.group.name+'" width="400" height="140" frameborder="0" style="overflow:hidden; width:400px !important;" />');if(args&&args.response&&args.response.message.indexOf("organic")!=-1){h1_text="Signing in is required for custom reactions"}var $header=ANT.aWindow.makeHeader(h1_text);$aWindow.find(".ant_header").replaceWith($header);ANT.aWindow.hideFooter($aWindow);$aWindow.find("div.ant_body_wrap").append('<div class="ant_body" />').append($loginIframe)}},killUser:function(){ANT.user={};ANT.util.killSessions();$.postMessage("killUser",ANT_baseUrl+"/static/xdm.html",window.frames["ant-xdm-hidden"])},aWindowUserMessage:{show:function(args){var $aWindow=args.aWindow;var interactionInfo=args.interactionInfo;if($aWindow){var msgType=args.msgType||null,userMsg=null,actionPastTense;var extraHeight=45,bodyWrapHeight=10,aWindowHeight=$aWindow.height(),durr=300;var $bodyWraps=$aWindow.find(".ant_body_wrap");var $aWindowMsgDiv=$aWindow.find("div.ant_aWindow_message"),$aWindowMsgDivInnerwrap=$aWindow.find(".ant_aWindow_message_innerwrap"),$otherTagsWrap=$("div.ant_otherTagsWrap"),$tmpUserMsg=$aWindow.find(".ant_aWindow_message_tempUserMsg");$aWindowMsgDiv.show();switch(msgType){case"tempUser":var num_interactions_left=ANT.group.temp_interact-parseInt(args.num_interactions,10),$loginLink=$('<a href="javascript:void(0);">Connect with Facebook</a>.');$loginLink.click(function(){ANT.session.showLoginPanel(args)});var tmpUserMsg="You can react or comment <strong>"+num_interactions_left+" more times</strong> before you must ";$tmpUserMsg.empty().append("<span>"+tmpUserMsg+"</span>");$tmpUserMsg.append($loginLink);break;case"interactionSuccess":if(interactionInfo.remove){userMsg="The "+interactionInfo.type+" <em>"+interactionInfo.body+"</em><br />has been removed.";$tmpUserMsg.empty()}else{userMsg=interactionInfo.type=="tag"?"You have tagged this <em>"+interactionInfo.body+"</em>.":interactionInfo.type=="comment"?"You have left your comment.":"";userMsg+=" See your "+interactionInfo.type+"s on this page, and at <strong><a href='"+ANT_baseUrl+"' target='_blank'>antenna.is</a></strong>"}var click_args=args;if($aWindow.find("div.ant_aWindow_message_tempUserMsg").text().length>0){$inlineTempMsg=$("<div />");$inlineTempMsg.html('<h4 style="font-size:17px;">You can react '+$aWindow.find("div.ant_aWindow_message_tempUserMsg strong").text()+'.</h4><br/><p><a style="font-weight:bold;color:#008be4;" href="javascript:void(0);">Connect with Facebook</a> to react as much as you want &amp; show other readers here what you think.</p><br/><p>Plus, you can share and comment in-line!</p><br/><a href="javascript:void(0);"><img src="'+ANT_staticUrl+'widget/images/fb-login_to_antenna.png" alt="Connect with Facebook" /></a>');$inlineTempMsg.find("a").click(function(){ANT.session.showLoginPanel(click_args)})}break}if(userMsg){$aWindowMsgDiv.find("span.ant_userMsg").html(userMsg)}$aWindowMsgDivInnerwrap.hide();$aWindow.queue("userMessage",function(){if($aWindowMsgDiv.height()>0){$aWindowMsgDivInnerwrap.fadeIn(500);$(this).dequeue("userMessage")}else{$aWindow.animate({height:aWindowHeight+extraHeight},durr);$otherTagsWrap.animate({bottom:0},durr);$bodyWraps.animate({bottom:extraHeight},durr);$aWindowMsgDiv.animate({height:extraHeight},durr,function(){$aWindowMsgDivInnerwrap.fadeIn(500);$(this).dequeue("userMessage")})}});$aWindow.dequeue("userMessage")}},hide:function($aWindow){if($aWindow){var $aWindowMsgDiv=$("div.ant_aWindow_message");$otherTagsWrap=$("div.ant_otherTagsWrap");var $bodyWraps=$aWindow.find(".ant_body_wrap");var extraHeight=$aWindowMsgDiv.height(),aWindowHeight=$aWindow.height(),durr=300,bodyWrapHeight=10;$aWindow.queue("userMessage",function(){$aWindow.animate({height:aWindowHeight-extraHeight},durr);$otherTagsWrap.animate({bottom:0-bodyWrapHeight},durr);$bodyWraps.animate({bottom:bodyWrapHeight},durr);$aWindowMsgDiv.animate({height:0},durr,function(){$aWindowMsgDiv.hide();$(this).dequeue("userMessage")})});$aWindow.dequeue("userMessage")}}}},actions:{aboutAntenna:function(){},init:function(){var that=this;$ANT=$(ANT);window.antenna_extend_per_container=window.antenna_extend_per_container||{};$ANT.queue("initAjax",function(next){ANT.util.checkSessions();that.initGroupData(ANT.group.short_name)});$ANT.queue("initAjax",function(next){that.initEnvironment()});$ANT.queue("initAjax",function(next){that.handleDeprecated()});$ANT.queue("initAjax",function(next){that.initSeparateCtas()});$ANT.queue("initAjax",function(next){that.initHTMLAttributes()});$ANT.queue("initAjax",function(next){that.initPageData()});$ANT.queue("initAjax",function(next){ANT.actions.runPostPageInit();ANT.session.createXDMframe()});$ANT.queue("initAjax",function(next){ANT.util.checkForSelectedTextAndLaunchAWindow();ANT.util.initPublicEvents()});$ANT.queue("initAjax",function(next){ANT.util.initTouchBrowserSettings()});$ANT.dequeue("initAjax")},initGroupData:function(groupShortName){$.ajax({url:ANT_baseUrl+"/api/settings/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON({host_name:window.location.hostname})},success:function(response,textStatus,XHR){var group_settings=response.data;if(typeof group_settings!="undefined"){if(typeof group_settings.blessed_tags!="undefined"){group_settings.default_reactions=group_settings.blessed_tags.slice();delete group_settings.blessed_tags}if(typeof group_settings.img_indicator_show_side!="undefined"&&!group_settings.img_indicator_show_side){delete group_settings.img_indicator_show_side}if(typeof group_settings.tag_box_bg_colors!="undefined"&&!group_settings.tag_box_bg_colors){delete group_settings.tag_box_bg_colors}if(typeof group_settings.tag_box_text_colors!="undefined"&&!group_settings.tag_box_text_colors){delete group_settings.tag_box_text_colors}if(typeof group_settings.tag_box_font_family!="undefined"&&!group_settings.tag_box_font_family){delete group_settings.tag_box_font_family}if(typeof group_settings.tag_box_gradient!="undefined"&&!group_settings.tag_box_gradient){delete group_settings.tag_box_gradient}if(typeof group_settings.tags_bg_css!="undefined"&&!group_settings.tags_bg_css){delete group_settings.tags_bg_css}}var custom_group_settings=ANT.groupSettings?ANT.groupSettings.getCustomSettings():{};ANT.group=$.extend({},ANT.group.defaults,group_settings,custom_group_settings);ANT.group.tag_box_bg_colors=ANT.group.tag_box_bg_colors.split(";");ANT.group.tag_box_text_colors=ANT.group.tag_box_text_colors.split(";");var a_or_b_or_not="";if(ANT.group.ab_test_impact===true){a_or_b_or_not=ANT.util.activeAB()?"A":"B"}ANT.events.trackEventToCloud({event_type:"sl",event_value:a_or_b_or_not,page_id:ANT.util.getPageProperty("id"),content_attributes:ANT.util.activeAB()&&$(ANT.group.recirc_selector).first().length?"broadcast":null});if(ANT.group.hideOnMobile===true&&isTouchBrowser){return false}ANT.group.anno_whitelist+=",div.ant_br_replaced";$(ANT.group.no_readr).each(function(){var $this=$(this);$this.addClass("no-ant");$this.find("img").addClass("no-ant")});if(ANT.group.active_sections==""){ANT.group.active_sections="body"}var active_sections=ANT.group.active_sections.split(","),active_sections_with_anno_whitelist="",anno_whitelist=ANT.group.anno_whitelist.split(",");$.each(active_sections,function(active_idx,active_selector){active_selector=$.trim(active_selector);$.each(anno_whitelist,function(anno_idx,anno_selector){anno_selector=$.trim(anno_selector);active_sections_with_anno_whitelist+=active_selector+" "+anno_selector;if(anno_idx!=anno_whitelist.length-1){active_sections_with_anno_whitelist+=","}});if(active_idx!=active_sections.length-1){active_sections_with_anno_whitelist+=","}});ANT.group.active_sections_with_anno_whitelist=active_sections_with_anno_whitelist;if(ANT.group.custom_css!==""){$("head").append($('<style type="text/css">'+ANT.group.custom_css+"</style>"))}$ANT.dequeue("initAjax")},error:function(response){}})},initPageData:function(){var queryStr=ANT.util.getQueryStrFromUrl(ANT.engageScriptSrc);ANT.engageScriptParams=ANT.util.getQueryParams(queryStr);ANT.group.useDefaultSummaryBar=ANT.engageScriptParams.bookmarklet&&!$(".ant-page-summary").length&&!$(ANT.group.summary_widget_selector).length;if(ANT.group.useDefaultSummaryBar){$('<div id="ant-page-summary" class="ant no-ant ant-page-summary defaultSummaryBar"/>').appendTo("body")}var pagesArr=[],urlsArr=[],thisPage,key,url,canonical_url,page_image,title;var pageDict={};var num_posts=0;if(ANT.group.post_selector!==""&&ANT.group.post_href_selector!==""&&ANT.group.summary_widget_selector!==""){var $posts=$(ANT.group.post_selector),num_posts=$posts.length;$posts.each(function(){var $post=$(this);var $post_href=$post.find(ANT.group.post_href_selector);if(typeof $post_href=="undefined"||typeof $post_href.attr("href")=="undefined"){url=ANT.util.getPageProperty("canonical_url")=="same"?ANT.util.getPageProperty("page_url"):ANT.util.getPageProperty("canonical_url")}else{url=$post_href.attr("href")}var $summary_widget=$post.find(ANT.group.summary_widget_selector).eq(0);function nearWindow($thisPost){var offsets=$thisPost.offset();var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName("body")[0],x=w.innerWidth||e.clientWidth||g.clientWidth,y=w.innerHeight||e.clientHeight||g.clientHeight,top=d&&d.scrollTop||g&&g.scrollTop||0,almostInView=y+top+300;if(offsets.top<almostInView){return true}else{return false}}if(nearWindow($post)&&!$post.hasAttr("ant-page-checked")){$post.attr("ant-page-checked",true);if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}if(url.indexOf(window.location.origin)==-1){if(url.substr(0,1)=="/"){url=window.location.origin+url}else{url=window.location.origin+window.location.pathname+url}}var urlHash=ANT.util.md5.hex_md5(url);if(!$post.hasAttr("ant-page-container")){$post.attr("ant-page-container","true").attr("ant-page-key",urlHash)}$summary_widget.attr("ant-page-widget-key",urlHash);urlsArr.push(url);if(num_posts==1){page_image=ANT.group.image_selector&&ANT.group.image_attribute?$("html").find(ANT.group.image_selector).first().attr(ANT.group.image_attribute):""}thisPage={group_id:parseInt(ANT.group.id,10),url:url,canonical_url:"same",title:$post_href.text(),image:page_image};pagesArr.push(thisPage);pageDict[key]=thisPage}})}var pageUrl=ANT.util.getPageProperty("page_url");if(num_posts===0&&($.inArray(pageUrl,urlsArr)==-1||urlsArr.length==0)){var $body=$("body");if(!$body.hasAttr("ant-page-checked")){canonical_url=ANT.util.getPageProperty("canonical_url");title=ANT.util.getPageProperty("title");page_image=ANT.group.image_selector&&ANT.group.image_attribute?$("html").find(ANT.group.image_selector).first().attr(ANT.group.image_attribute):"";thisPage={group_id:parseInt(ANT.group.id,10),url:pageUrl,canonical_url:pageUrl==canonical_url?"same":canonical_url,title:title,image:page_image};ANT.group.thisPage=thisPage;pagesArr.push(thisPage);key=pagesArr.length-1;pageDict[key]=thisPage;if(!$body.hasAttr("ant-page-container")){$body.attr("ant-page-key",key).attr("ant-page-checked",true);if($(".ant-page-summary").length==1){$(".ant-page-summary").attr("ant-page-widget-key",key)}else{var $widget_key_last=$body.find(ANT.group.summary_widget_selector).eq(0);if($widget_key_last.attr("ant-page-widget-key")!="0"){$widget_key_last.attr("ant-page-widget-key",key)}}}}}var sendData={pages:pagesArr};if(pagesArr.length){$.ajax({url:ANT_baseUrl+"/api/page/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)},success:function(response){if(response.status!=="success"){return false}else{ANT.status.page=true}var load_event_value="";if(ANT.group.useDefaultSummaryBar){load_event_value="def"}else{if(response.data.length===1){load_event_value="si"}else if(response.data.length>1){load_event_value="mu"}else{load_event_value="unex"}}$.each(response.data,function(idx,page){page.url=pageDict[key].url;page.key=ANT.util.md5.hex_md5(page.url);ANT.actions.pages.save(page.id,page);ANT.actions.pages.initPageContainer(page.id)});var a_or_b_or_not="";if(ANT.group.ab_test_impact===true){a_or_b_or_not=ANT.util.activeAB()?"A":"B"}ANT.events.trackEventToCloud({event_type:"wl",event_value:a_or_b_or_not,page_id:ANT.util.getPageProperty("id"),content_attributes:load_event_value});$ANT.dequeue("initAjax")},error:function(response){}})}},runPostPageInit:function(){ANT.actions.indicators.utils.updateContainerTrackers();$(ANT.group.active_sections).find("embed[ant-node], video[ant-node], object[ant-node], iframe[ant-node], img[ant-node],"+ANT.group.anno_whitelist).each(function(){var hash=$(this).attr("ant-hash");ANT.actions.indicators.init(hash);ANT.actions.content_nodes.init(hash,function(){})});if(isTouchBrowser){$(ANT.group.active_sections_with_anno_whitelist).each(function(idx,node){ANT.actions.indicators.init($(node).attr("ant-hash"))});if(!localStorage.getItem("hideDoubleTapMessage")&&!ANT.group.hideDoubleTapMessage){var double_tap_message=ANT.group.doubleTapMessage?ANT.group.doubleTapMessage:"<strong>Single-tap</strong> any paragraph to respond!<a>"+ANT.t("close")+"</a>",double_tap_message_position=ANT.group.doubleTapMessagePosition?"ant_"+ANT.group.doubleTapMessagePosition:"ant_bottom",$doubleTapMessage=$('<div class="ant ant_mobile_message">'+double_tap_message+"</div>"),$sandbox=$("#ant_sandbox");$doubleTapMessage.addClass(double_tap_message_position).on("touchend.ant",function(){localStorage.setItem("hideDoubleTapMessage",true);$(this).remove()}).appendTo($sandbox)}}else if(ANT.util.activeAB()){$(ANT.group.active_sections).on("mouseenter.ant","embed, video, object, iframe, img",function(){var $this=$(this);var hash=$this.data("hash");ANT.actions.indicators.utils.updateContainerTrackers();if($this.closest(".no-ant").length){return}var minImgWidth=100;if($this.width()>=minImgWidth){var hasBeenHashed=$this.hasAttr("ant-hashed"),isBlacklisted=$this.closest(".ant, .no-ant").length;$this.addClass("ant_live_hover");if(!hasBeenHashed&&!isBlacklisted){var hashListsByPageId=ANT.actions.hashNodes($(this));var hash;$.each(hashListsByPageId,function(page_id,hashArray){hash=hashArray[0]});if(!hash){ANT.safeThrow("There should always be a hash from hashNodes after hover on an unhashed image.");return}ANT.actions.sendHashes(hashListsByPageId,function(){if($this.hasClass("ant_live_hover")){if(!$("#ant_indicator_details_"+hash).hasClass("ant_engaged")){$("#ant_indicator_"+hash).addClass("ant_visible")}}ANT.actions.content_nodes.init(hash,function(){})})}else{var hash=$this.data("hash");$this.addClass("ant_live_hover");if(!$("#ant_indicator_details_"+hash).hasClass("ant_engaged")){$("#ant_indicator_"+hash).addClass("ant_visible")}ANT.actions.content_nodes.init(hash,function(){})}}}).on("mouseleave.ant","embed, video, object, iframe, img",function(event){var $this=$(this),hash=$this.data("hash");if(!$this.parents(ANT.group.img_container_selectors).length){_mediaHoverOff($this)}$("#ant_indicator_"+hash).removeClass("ant_visible")})}if(!ANT.util.activeAB())return;ANT.events.emit("antenna.hashed_nodes","complete",{});function _mediaHoverOff(obj){var $this=$(obj),hash=$this.data("hash");$this.removeClass("ant_live_hover");$("#ant_indicator_"+hash).hide()}},initEnvironment:function(){if(!ANT.util.activeAB()){$(".ant-custom-cta").css("visibility","hidden")}ANT.broadcast.init();var $antSandbox=$('<div id="ant_sandbox" class="ant ant_sandbox"/>').appendTo("body");if(isTouchBrowser){$("#ant_sandbox").addClass("isTouchBrowser")}var page_attributes=["topics","author","section"];$.each(page_attributes,function(idx,trait){if(ANT.group[trait+"_selector"]!="undefined"&&ANT.group[trait+"_attribute"]!="undefined"&&$(ANT.group[trait+"_selector"]).length){ANT.group[trait]="";$(ANT.group[trait+"_selector"]).each(function(){ANT.group[trait]+=$(this).attr(ANT.group[trait+"_attribute"])+","});ANT.group[trait]=ANT.group[trait].substr(0,ANT.group[trait].length-1)}});var active_section_offsets=$(ANT.group.active_sections+":eq(0)").offset();ANT.group.active_section_top=active_section_offsets.top;ANT.group.active_section_bottom=active_section_offsets.bottom;ANT.group.active_section_height=active_section_offsets.bottom-active_section_offsets.top;ANT.group.active_section_milestones={0:ANT.group.active_section_top,20:ANT.group.active_section_height/5+ANT.group.active_section_top,40:ANT.group.active_section_height/5*2+ANT.group.active_section_top,60:ANT.group.active_section_height/5*3+ANT.group.active_section_top,80:ANT.group.active_section_height/5*4+ANT.group.active_section_top,100:ANT.group.active_section_bottom,fired:0};$(window).on("scroll.ant",function(){ANT.actions.initPageData()});$(window).on("scrollstart",function(){ANT.actions.indicators.utils.updateContainerTrackers()});var groupPageSelector=ANT.group.summary_widget_selector?", "+ANT.group.summary_widget_selector:"";ANT.events.recordEvents=$(".ant-page-summary"+groupPageSelector).length;ANT.util.fixBodyBorderOffsetIssue();if(!!ANT.group.br_replace_scope_selector){ANT.util.fixBrTags()}var bodyChanges={paddingLeft:$("body").css("padding-left").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("padding-left"))/100):parseInt($("body").css("padding-left")),marginLeft:$("body").css("margin-left").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("margin-left"))/100):parseInt($("body").css("margin-left")),left:$("body").css("left").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("left"))/100):parseInt($("body").css("left")),paddingLeft:$("body").css("padding-top").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("padding-top"))/100):parseInt($("body").css("padding-top")),marginTop:$("body").css("margin-top").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("margin-top"))/100):parseInt($("body").css("margin-top")),top:$("body").css("top").indexOf("%")!=-1?$(window).width()*(parseInt($("body").css("top"))/100):parseInt($("body").css("top"))},bodyLeft=-(bodyChanges.marginLeft+bodyChanges.left+bodyChanges.paddingLeft),bodyTop=-(bodyChanges.marginTop+bodyChanges.top+bodyChanges.paddingTop);
bodyLeft=isNaN(bodyLeft)?0:bodyLeft;bodyTop=isNaN(bodyTop)?0:bodyTop;var currTop=parseInt($antSandbox.css("top"),10);var currLeft=parseInt($antSandbox.css("left"),10);ANT.util.cssSuperImportant($antSandbox,{left:currLeft+bodyLeft+"px",top:currTop+bodyTop+"px"},true);$antSandbox.append("<style>.ant_twtooltip { margin-left:"+bodyLeft+"px !important; margin-top:"+bodyTop+"px !important;} "+ANT.group.active_sections_with_anno_whitelist+" {-webkit-user-select: all; -khtml-user-select: all; -moz-user-select: all; -ms-user-select: all; user-select: all;} </style>");$('<div id="ant_container_tracker_wrap" /><div id="ant_indicator_details_wrapper" /><div id="ant_event_pixels" />').appendTo($antSandbox);$(document).on("mouseup.ant",function(e){setTimeout(function(){ANT.actions.startSelectFromMouseUp(e)},1)});if(!isTouchBrowser){$(document).on("mousedown.ant",function(event){var $mouse_target=$(event.target);if($mouse_target.closest(".ant_inline").length||!$mouse_target.hasAttr("ant-cta-for")&&!$mouse_target.parents().hasClass("ant")&&!$("div.ant-board-create-div").length){ANT.actions.UIClearState();$("div.ant_indicator_details_for_media").each(function(){ANT.actions.containers.media.onDisengage($(this).data("container"))})}})}else{$(document).on("touchend.ant",function(e){if(ANT.util.bubblingEvents["dragging"]==true){return}if(ANT.util.bubblingEvents["touchend"]==false){var $mouse_target=$(e.target);if($mouse_target.closest(".ant_inline").length||!$mouse_target.hasAttr("ant-cta-for")&&!$mouse_target.parents().hasClass("ant")&&!$("div.ant-board-create-div").length){if(!$mouse_target.hasAttr("ant-node")||$mouse_target.get(0).nodeName.toLowerCase()=="img"){ANT.actions.UIClearState()}}}ANT.util.bubblingEvents["touchend"]=false});$(document).on("touchmove.ant",function(e){ANT.util.bubblingEvents["dragging"]=true});$(document).on("touchend.ant",function(e){ANT.util.bubblingEvents["dragging"]=false})}$(document).on("keyup.ant",function(event){if(event.keyCode=="27"){ANT.actions.UIClearState()}});$(window).resize(ANT.util.throttledUpdateContainerTrackers());$ANT.dequeue("initAjax")},handleDeprecated:function(){if(ANT.util.activeAB()){$("[ant-custom-display]").each(function(){var $this=$(this);$this.attr("ant-item",$this.attr("ant-custom-display"));$this.removeAttr("ant-custom-display")});$("[ant-grid-for]").each(function(){var $this=$(this);$this.attr("ant-view-reactions-for",$this.attr("ant-grid-for"));$this.removeAttr("ant-grid-for")})}$ANT.dequeue("initAjax")},initSeparateCtas:function(){if(ANT.group.separate_cta&&ANT.util.activeAB()){var separateCtaCount=0;$(ANT.group.active_sections).find(ANT.group.separate_cta).each(function(idx,node){var $node=$(node),tagName=node.nodeName.toLowerCase(),crossPage="";if($node.closest(ANT.group.no_readr).length){return}if($node.hasAttr("ant-item")){var antItem=$node.attr("ant-item")}else{var antItem="ant-custom-cta-"+separateCtaCount;$node.attr("ant-item",antItem)}$node.after('<div class="ant-custom-cta-container" ant-tag-type="'+tagName+'"><div class="ant-custom-cta" ant-cta-for="'+antItem+'" ant-mode="read write"><span class="ant-antenna-logo"></span> <span ant-counter-for="'+antItem+'"></span> <span ant-reactions-label-for="'+antItem+'">'+ANT.t("your_reaction")+"</span></div> </div>");separateCtaCount++})}$ANT.dequeue("initAjax")},initHTMLAttributes:function(){if(ANT.util.activeAB()){$("[ant-reactions][ant-item]").each(function(){var $this=$(this),itemName=$this.attr("ant-item"),reactions=$this.attr("ant-reactions");if(reactions&&typeof window.antenna_extend_per_container[itemName]=="undefined"){var itemDefinition={};itemDefinition.default_reactions=[];$.each(reactions.split(";"),function(idx,tag){itemDefinition.default_reactions.push($.trim(tag))});window.antenna_extend_per_container[itemName]=itemDefinition}})}$ANT.dequeue("initAjax")},reInit:function(){ANT.actions.hashCustomDisplayHashes()},UIClearState:function(e){$("div.ant_twtooltip").remove();ANT.aWindow.closeAll();ANT.actionbar.closeAll();ANT.actions.containers.media.disengageAll();$("div.ant.ant_tag_details.ant_sbRollover").remove();if(!isTouchBrowser){$("div.ant_indicator_for_media").hide()}$().selog("hilite",true,"off");var shareBoxExists=$(".ant_fromShareLink").length;if(shareBoxExists){ANT.session.alertBar.close("fromShareLink")}},catchRangyErrors:function(errorMsg){ANT.safeThrow(errorMsg)},hashNodes:function($node,nomedia){if(typeof $node==="undefined"||!ANT.util.activeAB()){return}var $allNodes=$(),nodeGroups=[{kind:"media",$group:null,whiteList:function(){return ANT.group.media_selector+',[ant-item-type="media"]'},filterParam:ANT.group.active_sections+" embed, "+ANT.group.active_sections+" video, "+ANT.group.active_sections+" object, "+ANT.group.active_sections+" iframe",setupFunc:function(){var $this=$(this);var body=typeof this.src!="undefined"?this.src:typeof this.data!="undefined"?this.data:$this.attr("ant-item-content");if(body.indexOf("/")===0){body=window.location.origin+body}if(body.indexOf("http")!==0){body=window.location.origin+window.location.pathname+body}$this.data({body:body})}},{kind:"img",$group:null,whiteList:function(){var whiteListConcat="",whiteListArray=ANT.group.active_sections.split(",");$.each(whiteListArray,function(idx,selector){whiteListConcat+=selector+" img,"});whiteListConcat=whiteListConcat.substring(0,whiteListConcat.length-1);return whiteListConcat},filterParam:'img,[ant-item-type="image"]',setupFunc:function(){var $this=$(this);var body=typeof this.src!="undefined"?this.src:$this.attr("ant-item-content");if(body.indexOf("/")===0){body=window.location.origin+body}if(body.indexOf("http")!==0){body=window.location.origin+window.location.pathname+body}$this.data({body:body})}},{kind:"text",$group:null,whiteList:function(){return ANT.group.active_sections_with_anno_whitelist},filterParam:function(idx,node){var $node=$(node),node_text=$node.text(),node_parent_text=$node.parent().text();if($node.hasAttr("ant-item-content")){if($node.attr("ant-item-content"))return false}if(node_text!=node_parent_text){return!!node_text}},setupFunc:function(){var $this=$(this),body=ANT.util.getCleanText($this);$this.data("body",body)}},{kind:"custom",$group:null,whiteList:function(){return""},filterParam:function(idx,node){var $node=$(this);return!!$node.hasAttr("ant-src")},setupFunc:function(){var $node=$(this),body=$node.attr("ant-src");$node.data({body:body})}}];$.each(nodeGroups,function(idx,group){var $group=$node.filter(group.filterParam);$group=$group.add($node.find(group.whiteList()));if(!!ANT.group.br_replace_scope_selector&&group.kind=="text"){$group=$group.add($node.find(".ant_br_replaced"))}$group=$group.not($allNodes);if(group.kind=="text"){$group=$group.not(ANT.group.media_selector+", "+ANT.group.img_selector)}$group=$group.not("[ant-hashed], .no-ant, #ant_sandbox");group.$nodes=$group;$group.each(function(){group.setupFunc.apply(this);$(this).data("kind",group.kind)});$allNodes=$allNodes.add($group);var $inlineMediaSet=$allNodes.filter(ANT.group.inline_selector);$inlineMediaSet.each(function(){$(this).data("inlineIndicator",true)})});if(!$allNodes.data("body")){return false}var hashList={};var indicatorInitQueue=[];$allNodes.each(function(){var $this=$(this),body=$this.data("body"),kind=$this.data("kind"),HTMLkind=$this.get(0).nodeName.toLowerCase(),hashBody=body,hash,oldHash,hashText;if($this.closest(".no-ant").length){return}if((kind=="img"||kind=="media")&&body){hashText="rdr-"+kind+"-"+hashBody;oldHash=ANT.util.md5.hex_md5(hashText);$this.data("oldHash",oldHash);var HOSTDOMAIN=/[-\w]+\.(?:[-\w]+\.xn--[-\w]+|[-\w]{2,}|[-\w]+\.[-\w]{2})$/i;var srcArray=hashBody.split("/");srcArray.splice(0,2);var domainWithPort=srcArray.shift();if(!domainWithPort){return}var domain=domainWithPort.split(":")[0];var filename=srcArray.join("/");var match=HOSTDOMAIN.exec(domain);if(match==null){return}else{hashBody=match[0]+"/"+filename}var queryStringDomains=["soundcloud.com"];$.each(queryStringDomains,function(idx,domain){if(hashBody.indexOf(domain)!=-1){ANT.group.media_url_ignore_query=false}});if(ANT.group.media_url_ignore_query&&hashBody.indexOf("?")){hashBody=hashBody.split("?")[0]}if($this.hasAttr("ant-oldhash")){hash=$this.data("hash")}else{hashText="rdr-"+kind+"-"+hashBody;hash=ANT.util.md5.hex_md5(hashText)}}else{if(!body){return}hashText="rdr-"+kind+"-"+body;hash=ANT.util.md5.hex_md5(hashText);if(!$this.hasAttr("ant-hash")){var iteration=1;while(typeof ANT.summaries[hash]!="undefined"){hashText="rdr-"+kind+"-"+body+"-"+iteration;hash=ANT.util.md5.hex_md5(hashText);iteration++}}}var $hashParents=$this.parents("[ant-hash]");if($hashParents.length){ANT.actions.stripAntNode($hashParents)}var thisTagName=$this.get(0).nodeName.toLowerCase();if(thisTagName=="img"){if($hashParents.length&&!$this.siblings(ANT.group.anno_whitelist).length){ANT.actions.stripAntNode($hashParents)}}if($this.find(ANT.group.anno_whitelist).length){var dontHash=false;$this.find(ANT.group.anno_whitelist).each(function(idx,childNode){var tagName=childNode.nodeName.toLowerCase(),embedTagsArray=["img","iframe","embed"];if($.inArray(tagName,embedTagsArray)!=-1){var $childNode=$(childNode);if($childNode.siblings(ANT.group.anno_whitelist).length){}}else{dontHash=true}});if(dontHash===true){return}}ANT.actions.containers.save({body:body,kind:kind,hash:hash,HTMLkind:HTMLkind,$this:$this});$this.attr("ant-hash",hash).attr("ant-node","true");if(HTMLkind!="body"&&!isTouchBrowser){$this.on("mouseenter.ant",function(){ANT.actions.indicators.init(hash);$(this).addClass("ant_live_hover")}).on("mouseleave.ant",function(){$(this).removeClass("ant_live_hover")})}var summary=ANT.actions.summaries.init(hash);ANT.actions.summaries.save(summary);var page_id=ANT.util.getPageProperty("id",hash);if(!hashList[page_id])hashList[page_id]=[];hashList[page_id].push(hash);$this.data("hash",hash)});return hashList},sendHashes:function(hashesByPageId,onSuccessCallback){var hashList=[];$.each(hashesByPageId,function(pageId,hashList){if(!pageId||typeof hashList!="object"){ANT.safeThrow("No more messy hashes allowed!!");return}var $pageContainer=$('[ant-page-container="'+pageId+'"]');$.each($pageContainer.find("[ant-item]"),function(idx,node){var $node=$(node);if(typeof $node.data("ant-hashed")=="undefined"){var thisHash=$node.attr("ant-hash");hashList=$.grep(hashList,function(value){return value!=thisHash});if(typeof thisHash!="undefined"){hashList.push(thisHash)}ANT.actions.indicators.init(thisHash);$node.data("ant-hashed",true)}});$.each(hashList,function(idx,hash){if(typeof hash!="string"){ANT.safeThrow("why is your hash not a string!?");return}var $hashable_node=$pageContainer.find('[ant-hash="'+hash+'"]');if($hashable_node.length==1){$hashable_node.attr("ant-hashed",true)}else{var removeIndex=hashList.indexOf(hash);if(removeIndex>-1){hashList.splice(removeIndex,1)}}});var pageIdToInt=parseInt(pageId,10);if(isNaN(pageIdToInt)){ANT.safeThrow("why is the pageID NAN ??: "+pageId+"-->"+pageIdToInt)}var crossPageHashes=[];$.each($('[ant-crossPageContent="true"]'),function(idx,node){var thisHash=$(node).attr("ant-hash");crossPageHashes.push(thisHash);hashList=$.grep(hashList,function(value){return value!=thisHash});ANT.actions.indicators.init(thisHash)});ANT.actions.sendHashesForSinglePage({short_name:ANT.group.short_name,pageID:pageIdToInt,hashes:hashList,crossPageHashes:crossPageHashes},onSuccessCallback)})},sendHashesForSinglePage:function(sendData,onSuccessCallback){if(ANT.status.page===true){var pageId=sendData.pageID;$.ajax({url:ANT_baseUrl+"/api/summary/containers/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)},success:function(response){if(typeof response!="undefined"&&typeof response.data!="undefined"){if(typeof response.data.known!="undefined"){ANT.known_hashes=response.data.known}if(typeof response.data.crossPageKnown!="undefined"){if(typeof response.data.known!="undefined"){ANT.known_hashes=$.extend(ANT.known_hashes,response.data.crossPageKnown)}ANT.crosspage_hashes=response.data.crossPageKnown}$.each($('[ant-crossPageContent="true"]'),function(idx,node){var thisHash=$(node).attr("ant-hash");var dummySummaryObject={hash:thisHash,counts:{coms:0,tags:0,interactions:0},top_interactions:{coms:[],tags:{}}};if(typeof ANT.crosspage_hashes!="undefined"){ANT.crosspage_hashes={}}ANT.crosspage_hashes[thisHash]=dummySummaryObject});var summaries={};summaries[pageId]=response.data.known;$.each(response.data.unknown,function(idx,hash){if(typeof hash!="string"){ANT.safeThrow("why would this not be a string?");return}var unknown_summary;var $node=$('[ant-hash="'+hash+'"]');var kind=$node.data("kind");if(!kind){ANT.safeThrow("node should always have data: kind")}unknown_summary=ANT.util.makeEmptySummary(hash,kind);summaries[pageId][hash]=unknown_summary});if(!$.isEmptyObject(summaries)){ANT.actions.containers.setup(summaries);if(typeof onSuccessCallback!=="undefined"){onSuccessCallback()}}var initSomeHashes=[];$.each(response.data.crossPageKnown,function(idx,hashObject){if(initSomeHashes.indexOf(hashObject.hash)==-1){initSomeHashes.push(hashObject.hash)}});$.each($("[ant-item]"),function(idx,node){if(initSomeHashes.indexOf($(node).data("hash"))==-1){initSomeHashes.push($(node).data("hash"))}});ANT.actions.containers.initCustomDisplayHashes(initSomeHashes)}}})}},hashCustomDisplayHashes:function(){var pageCustomDisplays={},pageId=ANT.util.getPageProperty();pageCustomDisplays[pageId]=[];if($("[ant-item]").length){$.each($("[ant-item]"),function(idx,node){var $node=$(node);ANT.actions.hashNodes($node);var thisHash=$node.attr("ant-hash");pageCustomDisplays[pageId].push(thisHash);ANT.actions.indicators.init(thisHash)})}ANT.actions.sendHashes(pageCustomDisplays)},comments:{makeCommentBox:function(settings,options){var content_node=settings.content_node,tag=settings.tag,summary=settings.summary,hash=settings.hash,kind=settings.kind,$aWindow=settings.$aWindow,selState=settings.selState;options=options||{};var helpText=options.helpText||ANT.t("add_comment");var cta=options.cta||ANT.t("comment");var $commentBox=$('<div class="ant_commentBox ant_clearfix"></div>');var $commentDiv=$('<div class="ant_comment">'),$commentTextarea=$('<textarea class="ant_default_msg">'+helpText+"</textarea>"),$ant_charCount=$('<div class="ant_charCount">'+ANT.t("characters_left").replace("NNN",ANT.group.comment_length)+"</div>"),$submitButton=$('<button class="ant_commentSubmit">'+ANT.t("comment")+"</button>");$commentDiv.append($commentTextarea,$ant_charCount,$submitButton);$commentTextarea.focus(function(){$(this).removeClass("ant_default_msg");if($(this).val()==helpText){$(this).val("")}}).blur(function(){var val=$(this).val();if(val===""||val===helpText){$(this).addClass("ant_default_msg");$(this).val(helpText)}}).keyup(function(event){var commentText=$commentTextarea.val();if(event.keyCode=="27"){$(this).blur();return false}else if(commentText.length>ANT.group.comment_length){commentText=commentText.substr(0,ANT.group.comment_length);$commentTextarea.val(commentText)}$commentTextarea.siblings("div.ant_charCount").text(ANT.t("characters_left").replace("NNN",ANT.group.comment_length-commentText.length))});$submitButton.click(function(e){$.extend(settings,{$commentTextarea:$commentTextarea,helpText:helpText});ANT.actions.comments.submitComment(settings)});$commentBox.append($commentDiv);return $commentBox},submitComment:function(settings){var $commentTextarea=settings.$commentTextarea,helpText=settings.helpText,content_node=settings.content_node,summary=settings.summary,kind=settings.kind,hash=settings.hash,tag=settings.tag,$aWindow=settings.$aWindow,selState=settings.selState;var commentText=$commentTextarea.val();if(commentText.length>ANT.group.comment_length){commentText=commentText.substr(0,ANT.group.comment_length);$commentTextarea.val(commentText);$commentTextarea.siblings("div.ant_charCount").text(ANT.t("characters_left").replace("NNN",ANT.group.comment_length-commentText.length))}if(commentText!=helpText){if($.isEmptyObject(content_node)&&summary.kind=="img"){content_node={body:$("img.ant-"+summary.hash).get(0).src,kind:summary.kind,hash:summary.hash}}var args={hash:hash,content_node_data:content_node,comment:commentText,content:content_node.body,tag:tag,aWindow:$aWindow,selState:selState};ANT.actions.interactions.ajax(args,"comment","create")}else{$commentTextarea.focus()}return false}},containers:{updateCrossPageHash:function(hash){var isCrossPageContainer=$('[ant-hash="'+hash+'"]').length>0;if(!isCrossPageContainer){return}ANT.actions.indicators.init(hash);var $container=$('[ant-hash="'+hash+'"]'),customDisplayName=$container.attr("ant-item"),$grid=$('[ant-view-reactions-for="'+customDisplayName+'"]');if($grid.length){ANT.actions.content_nodes.init(hash,function(){ANT.actions.indicators.utils.makeTagsListForInline($grid,false);$grid.jScrollPane({showArrows:true})})}},initCustomDisplayHashes:function(hashesToInit){$.each(hashesToInit,function(idx,hash){var $node=$('[ant-hash="'+hash+'"]');if(typeof hash!="undefined"&&typeof $node.attr("ant_summary_loaded")=="undefined"){ANT.actions.indicators.init(hash);ANT.summaries[hash].crossPage=true;var $container=$('[ant-hash="'+hash+'"]'),customDisplayName=$container.attr("ant-item"),$reactionView=$('[ant-view-reactions-for="'+customDisplayName+'"]'),reactionViewStyle=$reactionView.attr("ant-view-style")||"grid",reactionViewWidth=$reactionView.width(),reactionViewHeight=$reactionView.height();$reactionView.data("hash",hash).data("container",hash).addClass("no-ant");if(reactionViewStyle=="grid"){if(reactionViewHeight<200){reactionViewHeight=200;$reactionView.height(reactionViewHeight)}ANT.util.cssSuperImportant($reactionView,{height:reactionViewHeight+"px"});if($reactionView.length){var statedWidthDividedBy100=parseInt(reactionViewWidth/100);reactionViewWidth=statedWidthDividedBy100*100;if(reactionViewWidth>600){reactionViewWidth=600}if(!$reactionView.closest(".ant_reactionView_wrapper").length){$reactionView.wrap('<div class="ant_reactionView_wrapper" style="width:'+reactionViewWidth+"px;height:"+reactionViewHeight+'px;"></div>')}$reactionView.addClass("w"+reactionViewWidth).html('<div class="ant ant_window ant_inline w'+reactionViewWidth+' ant_no_clear" style="position:relative !important;"><div class="ant ant_header"><div class="ant_loader"></div><div class="ant_indicator_stats"><span class="ant-antenna-logo"></span><span class="ant_count"></span></div><h1>'+ANT.t("reactions")+'</h1></div><div class="ant ant_body_wrap ant_grid ant_clearfix"></div></div>');ANT.actions.content_nodes.init(hash,function(){ANT.actions.indicators.utils.makeTagsListForInline($reactionView,false);$reactionView.jScrollPane({showArrows:true})})}else{ANT.actions.content_nodes.init(hash)}}else if(reactionViewStyle=="horizontal_bars"){$reactionView.html('<div class="ant ant_inline ant_body_wrap ant_horizontal_bars ant_clearfix"></div>');ANT.actions.content_nodes.init(hash,function(){ANT.actions.indicators.utils.makeTagsListForInline($reactionView,false)})}}})},media:{onEngage:function(hash){return},onDisengage:function(hash){return},disengageAll:function(){var hashes=[];$(".ant_live_hover").each(function(){var hash=$(this).data("hash");hashes.push(hash);ANT.actions.containers.media.onDisengage(hash)})}},save:function(settings){if(ANT.containers.hasOwnProperty(settings.hash))return ANT.containers[settings.hash];var pageId=typeof settings.id==="undefined"||settings.id===null?null:settings.id;var container={id:pageId,body:settings.body||null,kind:settings.kind,hash:settings.hash,HTMLkind:settings.HTMLkind||null,$this:settings.$this||null};ANT.containers[settings.hash]=container;return container},setup:function(summariesPerPage){var _setupFuncs={img:function(hash,summary){var containerInfo=ANT.containers[hash];var $container=containerInfo.$this;var body=$container[0].src;var content_node_data={body:body,kind:summary.kind,container:hash,hash:hash};ANT.content_nodes[hash]=content_node_data;ANT.aWindow.update(hash);if(isTouchBrowser){ANT.actions.content_nodes.init(hash,function(){});ANT.actions.indicators.init(hash)}},media:function(hash,summary){this.img(hash,summary)},text:function(hash,summary){if(isTouchBrowser){ANT.actions.content_nodes.init(hash,function(){});ANT.actions.indicators.init(hash)}},custom:function(hash,summary){}};var hashesToShow=[];$.each(summariesPerPage,function(page_id,summariesByHash){if(!summariesByHash||$.isArray(summariesByHash)){ANT.safeThrow("For godsake no. This should not be an array of hashes and it should not be the bastard cruft of some frankenpage object.");return}$.each(summariesByHash,function(hash,summary){summary.hash=hash;var containerInfo=ANT.containers[hash];if(containerInfo){var $container=containerInfo.$this;var newComs={},coms=summary.top_interactions.coms;$.each(coms,function(arrIdx,com){if(summary.kind=="text"){newComs[com.tag_id]=com}else{if(!newComs[com.tag_id])newComs[com.tag_id]=[];newComs[com.tag_id].push(com)}});summary.top_interactions.coms=newComs;ANT.actions.summaries.save(summary);var pageContainerExists=false;$.each(ANT.pages[page_id].containers,function(idx,definedPageContainer){if(definedPageContainer.hash==hash){pageContainerExists=true}});if(pageContainerExists==false){ANT.pages[page_id].containers.push({hash:hash,id:summary.id})}else{}var kind=summary.kind;if(kind!="page"){_setupFuncs[kind](hash,summary)}if(summary.counts.tags>0){hashesToShow.push(hash)}}})});ANT.actions.summaries.sortPopularTextContainers();$.each(ANT.known_hashes,function(returnedHash,obj){var $hash_is_an_img=$('img[ant-node="returnedHash"]');if($hash_is_an_img.length){if($hash_is_an_img.data("oldHash")==returnedHash){$hash_is_an_img.attr("ant-hash",returnedHash).attr("ant-oldhash","true").data("hash",returnedHash)}}ANT.actions.indicators.init(returnedHash)});ANT.actions.indicators.show(hashesToShow)},send:function(hashList,onSuccessCallback){var containers={},curLen=0,proposedLen=0,thisLen,tempEncode,bodyCharLimit=300,charLimit=1400;$.each(hashList,function(idx,hash){var container=ANT.containers[hash];var sendContainer={HTMLkind:container.HTMLkind,body:"",hash:container.hash,id:container.id,kind:container.kind};tempEncode=encodeURIComponent($.toJSON(sendContainer));thisLen=tempEncode.length;if(thisLen>charLimit){sendContainer=false}else{proposedLen+=thisLen;if(proposedLen>charLimit){ANT.actions.containers._ajaxSend(containers);resetChunks()}containers[hash]=sendContainer;curLen+=thisLen}});if(!$.isEmptyObject(containers)){ANT.actions.containers._ajaxSend(containers,onSuccessCallback)}function resetChunks(){containers={};curLen=0;proposedLen=0}},_ajaxSend:function(containers,onSuccessCallback){var sendData=containers;$.ajax({url:ANT_baseUrl+"/api/containers/create/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)},success:function(response){var savedHashes=response.data;var dummySummaries={};$.each(savedHashes,function(hash,id){if(!id){return}var node=ANT.containers[hash];node.id=id;dummySummaries[hash]=ANT.actions.summaries.init(hash)});ANT.actions.containers.setup(dummySummaries);if(typeof onSuccessCallback!=="undefined"){onSuccessCallback()}}})}},content_nodes:{make:function(settings){var hash=settings.hash;var content_node_key;if(settings.location){content_node_key=settings.container+"-"+settings.location}else{content_node_key=settings.container}if(ANT.content_nodes.hasOwnProperty(content_node_key))return ANT.content_nodes[content_node_key];var content_node={container:settings.container,body:settings.body,location:settings.location,hash:hash};ANT.content_nodes[content_node_key]=content_node;return content_node},quickFixReset:function(hash){var summary=ANT.summaries[hash],container_id=typeof summary!="undefined"?summary.id:"";if(container_id){delete ANT.assetLoaders.content_nodes[container_id];ANT.actions.content_nodes.init(hash)}},init:function(hash,onSuccessCallback){if(ANT.status.page===true){var summary=ANT.summaries[hash],container_id=typeof summary!="undefined"?summary.id:"";if(!container_id){return}var pageId=ANT.util.getPageProperty("id",hash);summary.pageId=pageId;var sendData={page_id:pageId,container_id:container_id,hash:hash,cross_page:summary.$container.hasAttr("ant-crossPageContent")?true:false};var assetLoader=ANT.assetLoaders.content_nodes[container_id];if(!assetLoader){assetLoader=$.ajax({url:ANT_baseUrl+"/api/summary/container/content/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)}});ANT.assetLoaders.content_nodes[container_id]=assetLoader}assetLoader.then(function(response){if(response.status!=="success"){return false}var content_nodes=response.data;$.each(content_nodes,function(key,node){var $container=$('[ant-hash="'+hash+'"]');try{node.selState=$container.selog("save",{serialRange:node.location})}catch(err){node.selState=undefined}});ANT.content_nodes[hash]=content_nodes;summary.content_nodes=content_nodes;if(summary.kind=="text"){}else{summary.top_interactions.coms={};$.each(content_nodes,function(contentNodeId,contentNodeData){var comsArr=contentNodeData.top_interactions.coms;$.each(comsArr,function(idx,com){summary.top_interactions.coms[com.tag_id]=summary.top_interactions.coms[com.tag_id]||[];summary.top_interactions.coms[com.tag_id].push(com)})})}$('[ant-hash="'+hash+'"]').attr("ant_summary_loaded","true");ANT.actions.indicators.update(hash);if(onSuccessCallback){onSuccessCallback()}if(ANT.contentNodeQueue&&ANT.contentNodeQueue[hash]&&ANT.contentNodeQueue[hash].length){$.each(ANT.contentNodeQueue[hash],function(){var func=ANT.contentNodeQueue[hash].pop();func(hash)})}})}},utils:{getMediaDims:function($mediaNode){var h=$mediaNode.height();var w=$mediaNode.width();return!h||!w?{}:{height:h,width:w}},makeDictSortedByTag:function(content_nodes){var invertedDict={};$.each(content_nodes,function(content_node_id,content_node){$.each(content_node.top_interactions.tags,function(tag_node_id,tag_node){if(!invertedDict.hasOwnProperty(tag_node_id)){invertedDict[tag_node_id]=[]}invertedDict[tag_node_id].push(content_node)})});return invertedDict},initHiliteStates:function($tagSpan,content_nodes){$.each(content_nodes,function(arrIdx,content_node){if(content_node.selState){$tagSpan.data("selStates").push(content_node.selState)}});if(!isTouchBrowser){$tagSpan.hover(function(){var selStates=$(this).data("selStates");var lastSelState=selStates.length?selStates[selStates.length-1]:null;if(lastSelState){$().selog("hilite",lastSelState,"on")}},function(){var selStates=$(this).data("selStates");var lastSelState=selStates.length?selStates[selStates.length-1]:null;if(lastSelState){$().selog("hilite",lastSelState,"off")}})}}}},interactions:{ajax:function(args,int_type,action_type){var hash=args.hash,summary=ANT.summaries[hash],kind=summary?summary.kind:"";if(!action_type)action_type="create";if(!ANT.actions.interactions.hasOwnProperty(int_type)){return false}var crossPageSendData={};ANT.actions.interactions[int_type].preAjax(args,action_type);ANT.session.getUser(args,function(newArgs){var defaultSendData=ANT.actions.interactions.defaultSendData(newArgs),customSendData=ANT.actions.interactions[int_type].customSendData(newArgs),sendData=$.extend({},defaultSendData,customSendData,crossPageSendData);newArgs.sendData=sendData;newArgs.hash=hash;newArgs.sendData.hash=hash;if(typeof newArgs.sendData!="undefined"&&typeof newArgs.sendData.sendData!="undefined"){newArgs.sendData=$.extend({},newArgs.sendData,newArgs.sendData.sendData);if(typeof newArgs.sendData.user!="undefined"&&typeof newArgs.sendData.user.ant_token!="undefined"){newArgs.sendData.ant_token=newArgs.sendData.user.ant_token}}ANT.actions.interactions.send(newArgs,int_type,action_type)})},send:function(args,int_type,action_type){var sendData=$.extend(true,{},args.sendData);if(sendData.aWindow)delete sendData.aWindow;if(sendData.settings)delete sendData.settings;if(sendData.selState)delete sendData.selState;if(sendData.content_node)delete sendData.content_node;if(sendData.response)delete sendData.response;if(sendData.content_node_data&&sendData.content_node_data.selState)delete sendData.content_node_data.selState;if(sendData.content_node_data&&sendData.content_node_data.counts)delete sendData.content_node_data.counts;if(sendData.content_node_data&&sendData.content_node_data.top_interactions)delete sendData.content_node_data.top_interactions;if(sendData.content_node_data&&sendData.content_node_data.$container)delete sendData.content_node_data.$container;if(sendData.content_node_data&&sendData.content_node_data.$indicator)delete sendData.content_node_data.$indicator;if(sendData.content_node_data&&sendData.content_node_data.$indicator_details)delete sendData.content_node_data.$indicator_details;if(sendData.content_node_data&&sendData.content_node_data.$aWindow_readmode)delete sendData.content_node_data.$aWindow_readmode;if(sendData.node)delete sendData.node;if(sendData.uiMode)delete sendData.uiMode;if(sendData.sendData)delete sendData.sendData;if(ANT.summaries[sendData.hash])sendData.container_kind=ANT.summaries[sendData.hash].kind;if(sendData.content_node_data&&sendData.content_node_data.container)delete sendData.content_node_data.container;var int_type_for_url=int_type=="react"?"tag":int_type;if(typeof sendData.tag!="undefined"){sendData.tag.body=sendData.tag.body?sendData.tag.body:sendData.tag.tag_body}if(sendData.kind=="page"){sendData.hash="page";sendData.container_kind="text";sendData.page_id=sendData.page_id||ANT.util.getPageProperty("id","page");delete sendData.content_node_data.hash}var url=ANT_baseUrl+"/api/"+int_type_for_url+"/"+action_type+"/";var hitMax=ANT.session.checkForMaxInteractions(args);if(!hitMax){$.ajax({url:url,type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)},success:function(response){args.response=response;if(typeof args.sendData!="undefined"&&typeof args.sendData.sendData!="undefined"){args.content_node_data=args.sendData.sendData.content_node_data}if(response.data&&response.data.container){args.container_id=response.data.container.id;var hash=args.hash=response.data.container.hash}if(response.data&&response.data.num_interactions){ANT.user.num_interactions=response.data.num_interactions}if(response.status=="success"){if(args.response.data.interaction){}else if(args.response.data.deleted_interaction){}if(args.response.data.deleted_interaction){args.deleted_interaction=args.response.data.deleted_interaction}args.scenario=args.response.data.existing?"reactionExists":args.response.data.deleted_interaction?"tagDeleted":"reactionSuccess";if(typeof args.tag.id=="undefined"){args.tag.id=response.data.interaction.interaction_node.id}ANT.actions.interactions[int_type].onSuccess[action_type](args)}else{if(int_type=="react"){if(response.message=="sign in required for organic reactions"){ANT.session.showLoginPanel(args)}else{if(response.message.indexOf("Temporary user interaction limit reached")!=-1){ANT.session.showLoginPanel(args)}else{ANT.actions.interactions[int_type].onFail(args)}}}else{if(response.message.indexOf("Temporary user interaction limit reached")!=-1){ANT.session.showLoginPanel(args)}if(response.message=="existing interaction"){args.msgType="existingInteraction";ANT.session.aWindowUserMessage.show(args)}else{ANT.session.handleGetUserFail(args,function(){ANT.actions.interactions.ajax(args,int_type,"create")})}}}ANT.util.userLoginState()}})}else{ANT.session.showLoginPanel(args,function(){ANT.actions.interactions.ajax(args,int_type,"create")})}},defaultSendData:function(args){args.user_id=ANT.user.user_id;args.ant_token=ANT.user.ant_token;args.group_id=ANT.group.id;args.page_id=args.page_id?args.page_id:ANT.util.getPageProperty("id",args.hash);if(ANT.user.user_id===null||isNaN(ANT.user.user_id)){delete ANT.user.user_id;delete args.user_id}return args},comment:{preAjax:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","visible")},customSendData:function(args){},onSuccess:{create:function(args){var $aWindow=args.aWindow,hash=args.hash,response=args.response,tag=args.tag;
if($aWindow){$aWindow.find("div.ant_loader").css("visibility","hidden");ANT.actions.content_nodes.quickFixReset(hash);var isInlineAWindow=$aWindow.hasClass("ant_inline")||$aWindow.find(".ant_inline").length;var $responseMsg=$('<span class="success_msg" >'+ANT.t("thanks_for_comment")+" </span>");var $doneButton=$('<a class="ant_doneButton" href="#">'+ANT.t("close")+"</a>").click(function(e){e.preventDefault();ANT.aWindow.safeClose($aWindow)});var isPostTagComment=$(".ant_subheader").length;if(isPostTagComment){$(".ant_nextActions").remove();$aWindow.find(".ant_subheader").empty().append($responseMsg).append($doneButton)}else{$aWindow.find(".ant_commentBox").empty().append($responseMsg).append($doneButton)}}var interaction=response.data.interaction,content_node=response.data.content_node?response.data.content_node:response.content_node_data?response.content_node_data:args.content_node_data,content_id=content_node&&content_node.id?content_node.id:"",num_interactions=response.data.num_interactions;var isText=content_node.kind=="text"||content_node.kind=="txt";var isExisting=response.data.existing;if(!isText&&isExisting){var content_nodes=ANT.content_nodes[hash];$.each(content_nodes,function(id,node){if(id&&id!="undefined"){content_node=node;content_id=content_node.id}})}var tagId=parseInt(args.tag.id,10);var intHelper={delta:1,num_interactions:num_interactions,id:interaction.id,body:interaction.interaction_node.body,content_node:content_node,content_id:content_id,tag_id:tagId,user:args.user,social_user:args.social_user,parent_id:null,parent_interaction_node:args.tag};var diff={coms:{}};diff.coms[tagId]=intHelper;ANT.actions.content_nodes.init(hash,function(){ANT.actions.summaries.update(hash,diff)});ANT.events.trackEventToCloud({event_type:"c",event_value:interaction.interaction_node.body,container_hash:hash,container_kind:content_node.kind,page_id:args.page_id,reaction_body:args.tag.tag_body});ANT.events.emit("antenna.isment",interaction.interaction_node.body,{reaction:tag.tag_body,hash:hash,kind:content_node.kind})},remove:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden")}},onFail:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden")}},share:{preAjax:function(){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden")},onFail:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden")}},boardadd:{preAjax:function(){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:{create:function(args){var $aWindow=args.aWindow?args.aWindow:$("div.ant_tag_details.ant_reacted.ant_live_hover");$aWindow.find("div.ant_loader").css("visibility","hidden");var safe_board_name=args.board_name.replace(/\s/g,"_"),newArgs={board_id:args.board_id,int_id:args.int_id},$success=$('<div class="ant_success">Success!  See <a target="_blank" href="'+ANT_baseUrl+"/board/"+args.board_id+"/"+safe_board_name+'" class="ant_seeit_link">your board.</a> <a href="javascript:void(0);" class="ant_seeit_link ant_undo">Undo?</a></div>');$aWindow.find(".ant_select_user_board").append($success).find("select").hide();$success.find("a.ant_undo").click(function(){args.aWindow=$aWindow;ANT.actions.interactions.ajax(args,"boarddelete","create")})}}},boarddelete:{preAjax:function(){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","visible")},customSendData:function(){return{}},onSuccess:{create:function(args){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden")}}},react:{preAjax:function(args,action_type){var $aWindow=args.aWindow;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","visible")},customSendData:function(args){var hash=args.hash,summary=ANT.summaries[hash],$container=$('[ant-hash="'+hash+'"]'),kind,tag,sendData;var isPage=hash=="page"||args.kind&&args.kind=="page";if(isPage){kind="page";tag=args.tag;content_node_data={container:hash,body:"",kind:kind,hash:hash,item_type:"page"};sendData={tag:tag,node:null,content_node_data:content_node_data,hash:hash,user_id:ANT.user.user_id,ant_token:ANT.user.ant_token,group_id:ANT.group.id,page_id:args.page_id?args.page_id:ANT.util.getPageProperty("id",hash)}}else{kind=summary.kind;var $container=$('[ant-hash="'+hash+'"]');var aWindow=args.aWindow,tag_li=args.tag;tag=typeof args.tag.data=="function"?args.tag.data("tag"):args.tag;var content_node_data={};var content_node=args.content_node||null;if(kind=="custom"){content_node_data={container:aWindow.data("container"),body:$container.attr("ant-src"),kind:"media",location:$container.get(0).nodeName.toLowerCase(),hash:hash,item_type:$container.hasAttr("ant-item-type")?$container.attr("ant-item-type"):""}}else if(kind=="img"||kind=="media"||kind=="med"){var hashBody=typeof $container[0].src!="undefined"?$container[0].src:$container.data("body");if(ANT.group.media_url_ignore_query&&hashBody.indexOf("?")){hashBody=hashBody.split("?")[0]}content_node_data={container:aWindow.data("container"),body:hashBody,kind:kind,hash:hash,item_type:$container.hasAttr("ant-item-type")?$container.attr("ant-item-type"):""};var mediaDims=ANT.actions.content_nodes.utils.getMediaDims($container);$.extend(content_node_data,mediaDims)}else{if(content_node){content_node_data={container:aWindow.data("container"),body:content_node.body,location:content_node.location,kind:kind,id:content_node.id,item_type:$container.hasAttr("ant-item-type")?$container.attr("ant-item-type"):""}}else{if($container.hasAttr("ant-item")&&typeof ANT.summaries[hash].content_nodes!="undefined"&&ANT.summaries[hash].content_nodes.length){$.each(ANT.summaries[hash].content_nodes,function(content_node_id,node){if(content_node_id!="undefined"){content_node=node}});content_node_data={container:aWindow.data("container"),body:content_node.body,location:content_node.location,kind:kind,id:content_node.id,item_type:$container.attr("ant-item-type")}}else{var content_node_id=aWindow.find("div.ant_tag_"+tag.id).data("content_node_id"),selState=content_node_id?summary.content_nodes[content_node_id].selState:aWindow.data("selState");if(!selState){ANT.safeThrow("selState not found:  I cannot figure out why this happens every once in a while");return}content_node_data={container:aWindow.data("container"),body:selState.text,location:selState.serialRange,kind:kind,item_type:$container.hasAttr("ant-item-type")?$container.attr("ant-item-type"):""}}}if(content_node_data.location.indexOf("/")!=-1){var newLocationArray=content_node_data.location.split(","),newLocation="";newLocation=newLocationArray[0].split("/")[1]+","+newLocationArray[1].split("/")[1];content_node_data.location=newLocation}}sendData={tag:tag,node:content_node,content_node_data:content_node_data,hash:content_node_data.container,user_id:ANT.user.user_id,ant_token:ANT.user.ant_token,group_id:ANT.group.id,page_id:ANT.util.getPageProperty("id",hash),int_id:args.int_id}}return sendData},onSuccess:{create:function(args){var $aWindow=args.aWindow,uiMode=$aWindow.data("mode")||"writeMode",response=args.response,interaction=response.interaction,interaction_node=response.data.interaction.interaction_node,container=response.data.container,sendData=args.sendData,content_node=sendData.content_node_data,tag=typeof args.tag.data=="function"?args.tag.data("tag"):args.tag,int_id=response.data.interaction.id;var reaction=tag.body?tag.body:tag.tag_body;ANT.events.trackEventToCloud({event_type:"re",event_value:reaction,reaction_body:reaction,container_hash:args.hash,container_kind:args.kind,content_location:content_node.location,content_id:response.data.content_node?response.data.content_node.id:null,page_id:args.page_id});ANT.events.emit("antenna.reaction",reaction);$("#ant_loginPanel").remove();if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden");$('[ant-hash="'+hash+'"]').removeAttr("ant_summary_loaded");$(".ant_twtooltip").remove();if(args.kind&&args.kind=="page"){var existing=args.response.data.existing;if(!existing){_doPageUpdates(args)}else{}ANT.actions.viewReactionSuccess(args)}else{var hash=args.hash,summary=ANT.summaries[hash],kind=summary.kind;args.settings=args.sendData.content_node_data;var content_node_data=sendData.content_node_data;content_node_data.hash=content_node_data.container;content_node_data.kind=sendData.kind;if(typeof summary.content_nodes=="undefined"){summary.content_nodes={}}var savedContainer=ANT.containers[hash];if(savedContainer&&container&&container.id){savedContainer.id=container.id}if(typeof summary.content_nodes[content_node.id]=="undefined"){summary.content_nodes[content_node.id]={body:content_node.body,counts:{coms:0,tags:1,interactions:1},id:content_node.id,kind:content_node.kind,location:sendData.content_node_data.location,selState:false,top_interactions:{coms:{},tags:{}}}}else{if(args.scenario!="reactionExists"){summary.content_nodes[content_node.id].counts.tags++;summary.content_nodes[content_node.id].counts.interactions++}}if(typeof summary.content_nodes[content_node.id].top_interactions.tags[tag.id]=="undefined"){summary.content_nodes[content_node.id].top_interactions.tags[tag.id]={count:1,body:tag.body,parent_id:null}}else{if(args.scenario!="reactionExists"){summary.content_nodes[content_node.id].top_interactions.tags[tag.id].count++}}content_node_data=args.content_node||ANT.actions.content_nodes.make(content_node_data);summary.id=summary.id||args.container_id;var intNodeHelper={id:interaction_node.id,parent_id:null,parent_interaction_node:tag,content_id:null,body:interaction_node.body,delta:1,user:args.user,social_user:args.social_user};var diff={tags:{}};diff.tags[intNodeHelper.id]=intNodeHelper;if(args.scenario!="reactionExists"){ANT.actions.summaries.update(hash,diff)}ANT.actions.viewReactionSuccess(args)}function _makePageReactSuccess(args){}function _makePageReactAlreadyGiven(args){}function _undoPageReaction(args){var newArgs={hash:args.hash,kind:"page",page_id:args.page_id,int_id:args.response.data.interaction.id,tag:args.tag,aWindow:args.aWindow};ANT.actions.interactions.ajax(newArgs,"react","remove")}function _doPageUpdates(args){var intNodeHelper={kind:"page",page_id:args.page_id,id:args.response.data.interaction.interaction_node.id,parent_id:null,parent_interaction_node:null,content_id:null,body:args.response.data.interaction.interaction_node.body,delta:1,user:args.user,social_user:args.social_user};var diff={tags:{}};diff.tags[intNodeHelper.id]=intNodeHelper;ANT.actions.summaries.update(args.hash,diff,true,args.page_id)}function _makeShareIcons(args){var socialNetworks=["facebook","twitter","tumblr"];var shareHash=args.hash;var $shareWrapper=$('<div class="shareWrapper" ></div>');$shareWrapper.append('<strong class="ant_share_it">Share It:</strong>');$.each(socialNetworks,function(idx,val){$shareWrapper.append('<a href="http://'+val+'.com" class="ant_share_link"><img class="no-ant" src="'+ANT_staticUrl+"widget/images/social-icons-loose/social-icon-"+val+'.png" /></a>');$shareWrapper.find("a.ant_share_link:last").click(function(){ANT.events.trackEventToCloud({event_type:"sh",event_value:val,container_kind:args.kind,page_id:args.page_id});ANT.shareWindow=window.open(ANT_staticUrl+"share.html","ant_share","menubar=1,resizable=1,width=626,height=436");var title=$('meta[property="og:title"]').attr("content")?$('meta[property="og:title"]').attr("content"):$("title").text()?$("title").text():"";ANT.actions.share_getLink({hash:shareHash,kind:args.kind,sns:val,aWindow:{},tag:args.tag,content_node:{content:title,kind:"page"}});return false})});return $shareWrapper}},remove:function(args){var sendData=args.sendData;var interaction_node=args.response.data.deleted_interaction.interaction_node;var $aWindow=args.aWindow,tag=args.tag,int_id=args.int_id;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden");var hash=sendData.hash;var intNodeHelper={id:interaction_node.id,parent_id:null,content_id:null,body:interaction_node.body,delta:-1,user:args.user,social_user:args.social_user};var diff={tags:{}};diff.tags[intNodeHelper.id]=intNodeHelper;var isPage=args.kind=="page"||hash=="page";if(isPage){ANT.actions.summaries.update(hash,diff,isPage,args.page_id)}else{ANT.actions.summaries.update(hash,diff)}var usrMsgArgs={msgType:"interactionSuccess",interactionInfo:{type:"tag",body:interaction_node.body,remove:true},aWindow:$aWindow};$aWindow.queue("userMessage",function(){ANT.session.aWindowUserMessage.show(usrMsgArgs)});if(isPage){ANT.aWindow.updatePageTagMessage(args,"tagDeleted")}else{ANT.aWindow.updateTagMessage({aWindow:$aWindow,tag:args.tag,scenario:"tagDeleted",args:args})}}},onFail:function(args){var theseArgs=args;var $aWindow=theseArgs.aWindow,response=theseArgs.response;if($aWindow)$aWindow.find("div.ant_loader").css("visibility","hidden");if(response.message.indexOf("Temporary user interaction limit reached")!=-1){ANT.session.receiveMessage(theseArgs,function(){ANT.actions.interactions.ajax(theseArgs,"react","create")});ANT.session.showLoginPanel(theseArgs)}else if(response.message=="existing interaction"){theseArgs.msgType="existingInteraction";ANT.session.aWindowUserMessage.show(theseArgs)}else if(response.message.indexOf("blocked this tag")!=-1){alert(ANT.t("bad_language_warning"))}else{ANT.session.handleGetUserFail(theseArgs,function(){ANT.actions.interactions.ajax(theseArgs,"react","create")})}}}},indicators:{show:function(hashes){var $indicators=this.fetch(hashes);if($indicators.length==1)$indicators.removeClass("ant_dont_show")},hide:function(hashes){var $indicators=this.fetch(hashes);$indicators.css({opacity:"0",visibility:"hidden"})},fetch:function(hashOrHashes){var $indicators=$();if(typeof hashOrHashes==="string"){var hash=hashOrHashes;$indicators=$("#ant_indicator_"+hash)}else{var hashes=hashOrHashes;$.each(hashes,function(idx,hash){$indicators=$indicators.add($("#ant_indicator_"+hash))})}return $indicators},init:function(hash){var scope=this;var summary=ANT.summaries[hash];if(typeof summary!="undefined"&&summary.$container.hasAttr("ant-node")){var kind=summary.kind,$container=summary.$container,indicatorId="ant_indicator_"+hash,indicatorBodyId="ant_indicator_body_"+hash,indicatorDetailsId="ant_indicator_details_"+hash;if($container.hasAttr("ant-page-container"))return;$container.attr("ant-hasIndicator","true");if($container.hasAttr("ant-item")){var customDisplayName=$container.attr("ant-item"),$indicator=summary.$indicator=$container,$counter=$('[ant-counter-for="'+customDisplayName+'"]'),$grid=$('[ant-view-reactions-for="'+customDisplayName+'"]'),$cta=$('[ant-cta-for="'+customDisplayName+'"]');_setupHoverToFetchContentNodes();if($counter.length){$counter.addClass("ant_count")}if($cta.length){_customDisplaySetupHoverForShowAWindow($cta);_showAWindowAfterLoad()}if($grid.length){}ANT.actions.indicators.update(hash)}else{$("#ant_indicator_"+hash).remove();$("#ant_container_tracker_"+hash).remove();$("#ant_indicator_details_"+hash).remove();if($("#ant_indicator_"+hash).length){return}var $indicator=summary.$indicator=$('<div class="ant_indicator" />').attr("id",indicatorId).data("hash",hash);if(kind!="text"&&ANT.group.img_indicator_show_onload===true){$indicator.addClass("ant_show_on_load")}_setupIndicators();if(!kind){return}ANT.actions.indicators.utils.kindSpecificSetup[kind](hash);if(kind=="text"){function _getTextNodesIn(el){return $(el).find(":not(iframe,noscript)").andSelf().contents().filter(function(){return this.nodeType==3})}if($container.find("img").length&&!_getTextNodesIn($container).length){ANT.actions.stripAntNode($container);return}$container.off(".ant_helper");if(!isTouchBrowser){$container.on("mouseenter.ant_helper",function(){var hasHelper=$indicator.hasClass("ant_helper")&&ANT.group.paragraph_helper;if(hasHelper){ANT.actions.indicators.helpers.over($indicator)}});$container.on("mouseleave.ant_helper",function(e){var hasHelper=$indicator.hasClass("ant_helper")&&ANT.group.paragraph_helper;if(hasHelper){ANT.actions.indicators.helpers.out($indicator)}})}else{$container.off("touchend.ant").on("touchend.ant",function(e){if(ANT.util.bubblingEvents["dragging"]==true){return}if(ANT.util.bubblingEvents["touchend"]==false){if(!$(".ant_window").length){var $this_container=$('[ant-hash="'+hash+'"]');var el=$this_container[0];$("document").selog("selectEl",el);var $aWindow=ANT.aWindow.make("writeMode",{hash:hash})}else{ANT.actions.UIClearState()}}})}var isZeroCountIndicator=!(summary.counts.tags>0);$indicator.data("isZeroCountIndicator",isZeroCountIndicator);if(isZeroCountIndicator){$indicator.addClass("ant_helper");_setupHoverForShowAWindow()}else{_setupHoverToFetchContentNodes(function(){_showAWindowAfterLoad()});_setupHoverForShowAWindow()}}ANT.actions.indicators.update(hash)}}function _setupIndicators(){var $indicator_body=summary.$indicator_body=$('<div class="ant ant_indicator_body " />').attr("id",indicatorBodyId).appendTo($indicator).append('<span class="ant-antenna-logo"></span>','<span class="ant_count" />','<span class="ant_count_label" />');$indicator.css("visibility","visible")}function _setupHoverForShowAWindow(){if(!isTouchBrowser){var isZeroCountIndicator=!(summary.counts.tags>0);$indicator.find(".ant_indicator_body").on("mouseenter.ant",function(){ANT.util.setFunctionTimer(function(){if(isZeroCountIndicator){_updateAWindowForHelperIndicator()}else{_makeAWindow()}},333)}).on("mouseleave.ant",function(){ANT.util.clearFunctionTimer()})}else{$indicator.on("touchend.ant",function(e){if(ANT.util.bubblingEvents["dragging"]==true){return}ANT.util.bubblingEvents["touchend"]=true;_makeAWindow();var hasHelper=$indicator.hasClass("ant_helper")&&ANT.group.paragraph_helper;if(hasHelper){}})}}function _makeAWindow(){if($indicator.$aWindow){if($indicator.$aWindow.data("container")==hash){return}$indicator.$aWindow.remove()}var $aWindow=ANT.aWindow.make("readMode",{hash:hash});var page_id=ANT.util.getPageProperty("id",hash);if(!$aWindow){return}$indicator.$aWindow=$aWindow;ANT.events.trackEventToCloud({event_type:"rs",event_value:typeof summary.counts.highest_tag_count!="undefined"?"rd":"rd-zero",container_hash:hash,container_kind:"text",page_id:page_id})}function _updateAWindowForHelperIndicator(){var actionbarCoords={top:$indicator.offset().top+11,left:$indicator.offset().left-8};var clickAction=function(){var $container=$('[ant-hash="'+hash+'"]');var el=$container[0];$("document").selog("selectEl",el);$aWindow=ANT.aWindow.make("writeMode",{hash:hash})};var $actionbar=ANT.actionbar.draw({coords:actionbarCoords,kind:"text",hash:hash,clickAction:clickAction})}function _setupHoverToFetchContentNodes(callback){if(isTouchBrowser){if(!$indicator.hasAttr("ant-item")){ANT.actions.content_nodes.init(hash,callback)}}else{$indicator.on("mouseover.contentNodeInit",function(){if(!$indicator.hasAttr("ant-item")){ANT.actions.content_nodes.init(hash,callback)}})}}function _showAWindowAfterLoad(){$indicator.off("mouseover.contentNodeInit");if(isTouchBrowser){$indicator.triggerHandler("touchend.showAWindow")}else{$indicator.triggerHandler("mouseover.showAWindow")}}function _customDisplaySetupHoverForShowAWindow($cta){$cta.each(function(){var $thisCTA=$(this);$thisCTA.attr("ant-kind",kind).off("mouseover.showAWindow, touchend.showAWindow").on("mouseover.showAWindow, touchend.showAWindow",function(){_customDisplayMakeAWindow($thisCTA)})})}function _customDisplayMakeAWindow($cta){if($cta.attr("ant-mode").indexOf("write")!=-1&&$cta.attr("ant-mode").indexOf("read")!=-1){var mode=summary.counts.tags>0?"readMode":"writeMode"}else{var mode=$cta.attr("ant-mode")=="write"?"writeMode":"readMode"}if($indicator.$aWindow&&$indicator.$aWindow.hasClass("ant_"+mode.toLowerCase())){if($indicator.$aWindow.data("container")==hash){return}$indicator.$aWindow.remove()}if(mode=="writeMode"){if($container.length){el=$container[0]}else{var selector='[ant-hash="'+hash+'"]';el=$(selector)[0]}$("document").selog("selectEl",el)}var $aWindow=ANT.aWindow.make(mode,{hash:hash,$custom_cta:$cta});$aWindow.addClass("ant_rewritable");var page_id=ANT.util.getPageProperty("id",hash);if(!$aWindow){return}$indicator.$aWindow=$aWindow;var event_value=$cta.attr("ant-mode")=="write"?"wr":"rd"}},update:function(hash,shouldReInit){var scope=this;var summary=ANT.summaries[hash],kind=summary.kind,$container=summary.$container,isText=summary.kind==="text";if(summary.counts.tags===0&&typeof summary.content_nodes!="undefined"){$.each(summary.content_nodes,function(idx,content_node){summary.counts=$.extend(true,{},content_node.counts);summary.top_interactions=$.extend(true,{},content_node.top_interactions)})}if($container.hasAttr("ant-item")){var customDisplayName=$container.attr("ant-item"),$indicator=summary.$indicator=$container,$counter=$('[ant-counter-for="'+customDisplayName+'"]'),$label=$('[ant-reactions-label-for="'+customDisplayName+'"]'),$grid=$('[ant-view-reactions-for="'+customDisplayName+'"]'),$cta=$('[ant-cta-for="'+customDisplayName+'"]');if($counter.length){if(summary.counts.tags>0){if(summary.counts.tags>1){$label.text("Reactions")}else{$label.text("Reaction")}$counter.html(ANT.commonUtil.prettyNumber(summary.counts.tags))}}if($cta.length){}if($grid.length){}}else{if(shouldReInit){if(isText){$container.closest("[ant-node]").find(".ant_indicator").remove()}else{}ANT.actions.indicators.init(hash);return}var $indicator=summary.$indicator,$indicator_body=summary.$indicator_body,$indicator_details=summary.$indicator_details;var $count=$indicator_body.find(".ant_count"),$count_label=$indicator_body.find(".ant_count_label"),$details_header_count=$indicator_details?$indicator_details.find("div.ant_header h1"):false,hasReactions=summary.counts.tags>0;var reactionLabel=summary.counts.tags>1?ANT.t("plural_reaction"):ANT.t("single_reaction");if(hasReactions){if(isText){$count.html(ANT.commonUtil.prettyNumber(summary.counts.tags));$count_label.text(reactionLabel)}else{$count.html(ANT.commonUtil.prettyNumber(summary.counts.tags)+" "+reactionLabel)}if($details_header_count)$details_header_count.html(ANT.commonUtil.prettyNumber(summary.counts.tags)+" "+ANT.t("plural_reaction"));ANT.actions.indicators.show(hash)}else{$indicator.addClass("ant_no_reactions");$count.html('<span class="ant_react_label">'+ANT.t("main_cta")+"</span>");if(isText){if(ANT.group.paragraph_helper){ANT.actions.indicators.show(hash);$indicator.addClass("ant_helper")}else{ANT.actions.indicators.hide(hash)}}}}},helpers:{over:function($indicator){var alreadyHovered=$indicator.data("containerHover");if(alreadyHovered){return}ANT.util.cssSuperImportant($indicator,{display:"inline"});$indicator.css("opacity",ANT.C.helperIndicators.opacity)},out:function($indicator){$indicator.data("containerHover",false);var hoverTimeout=$indicator.data("hoverTimeout");clearTimeout(hoverTimeout);if(isTouchBrowser){}else{}}},utils:{checkTrailingWhiteSpace:function($container){var reversedNodes=$container.children().get().reverse();var startOfTrailingWhiteSpace=null;var isConsecutive=true;$.each(reversedNodes,function(idx){if(!isConsecutive){return}var isWhiteSpace=$(this).text()=="";if(isWhiteSpace){startOfTrailingWhiteSpace=this}else{isConsecutive=false}});return startOfTrailingWhiteSpace},kindSpecificSetup:{img:function(hash){var summary=ANT.summaries[hash],$container=summary.$container,$indicator=summary.$indicator,$indicator_body=summary.$indicator_body,$container_tracker_wrap=$("#ant_container_tracker_wrap"),$container_tracker=$('<div class="ant_container_tracker" />'),indicatorDetailsId="ant_indicator_details_"+hash,page_id=ANT.util.getPageProperty("id",hash);if($container.width()<100){ANT.safeThrow("Too small to init.");return}if($container.css("display")=="none"||$container.css("visibility")=="hidden"){ANT.safeThrow("not visible: ");return}var $existing=$("#ant_container_tracker_"+hash);if($existing.length){ANT.safeThrow("Images are not expected to get re-inited.");return}$container_tracker.attr("id","ant_container_tracker_"+hash).appendTo($container_tracker_wrap);_commonSetup();$indicator.appendTo($container_tracker);if(isTouchBrowser){$indicator.on("touchend.ant",function(){if(summary.counts.interactions==0){var $aWindow=ANT.aWindow.make("writeMode",{hash:hash})}else{var $aWindow=ANT.aWindow.make("readMode",{hash:hash})}$(this).addClass("ant_live_hover")})}else{$indicator.on("mouseenter.ant",function(){$indicator.addClass("ant_visible");ANT.util.setFunctionTimer(function(){if(summary.counts.interactions==0){var $aWindow=ANT.aWindow.make("writeMode",{hash:hash})}else{var $aWindow=ANT.aWindow.make("readMode",{hash:hash})}$(this).addClass("ant_live_hover")},500)}).on("mouseleave.ant",function(){ANT.util.clearFunctionTimer();$(this).removeClass("ant_live_hover ant_visible")})}ANT.actions.indicators.utils.updateContainerTracker(hash);function _commonSetup(){if($("div.ant_media_details").not("ant_loaded").length){var $indicator_details=summary.$indicator_details=$("<div />").attr("id",indicatorDetailsId).addClass("ant ant_indicator_details ant_widget ant_widget_bar");$("div.ant_media_details").html($indicator_details);$container_tracker.addClass("ant_inline_video");$("div.ant_media_details").addClass("ant_sandbox")}else{var $indicator_details=summary.$indicator_details=$("<div />").attr("id",indicatorDetailsId).addClass("ant ant_indicator_details ant_widget ant_widget_bar").appendTo("#ant_indicator_details_wrapper")}$indicator_details.data("container",hash);$indicator_details.data("hash",hash);$indicator_details.data("summary",summary);$indicator_details.addClass("ant_indicator_details_for_media").click(function(){$indicator_details.addClass("ant_live_hover");ANT.actions.containers.media.onEngage(hash)});$indicator.addClass("ant_indicator_for_media ant_indicator_for_media_inline").find(".ant_indicator_body");if(isTouchBrowser){$indicator.on("touchend.ant",function(){$(this).toggleClass("ant_hover")})}}},media:function(hash){this.img(hash)},text:function(hash){var summary=ANT.summaries[hash],$container=summary.$container,$indicator=summary.$indicator,$indicator_body=summary.$indicator_body,$actionbar=$("ant_actionbar_"+hash);$indicator.addClass("ant_indicator_for_text").addClass("ant_dont_show");var startOfTrailingWhiteSpace=ANT.actions.indicators.utils.checkTrailingWhiteSpace($container);if(startOfTrailingWhiteSpace){$(startOfTrailingWhiteSpace).before($indicator)}else{$indicator.appendTo($container)}}},makeDetailsContent:function(hash){var scope=this;var summary=ANT.summaries[hash],$container=summary.$container,$indicator=summary.$indicator,$indicator_body=summary.$indicator_body,$indicator_details=summary.$indicator_details,$actionbar=$("ant_actionbar_"+hash);if(typeof $indicator!="undefined"){$indicator_details.find("div.ant_body_wrap").remove();var headerText=ANT.aWindow.makeDefaultPanelMessage($indicator_details);var $header=ANT.aWindow.makeHeader(headerText);var $bodyWrap=$('<div class="ant ant_body_wrap ant_clearfix" />');var kind=summary.kind;var isMediaContainer=kind=="img"||kind=="image"||kind=="imgage"||kind=="med"||kind=="media";if(isMediaContainer&&!$indicator_details.find("div.ant_view_success").length){$indicator_details.data("initialWidth",$container.width())}var $aWindow=$indicator_details;var $tagsListContainer=ANT.actions.indicators.utils.makeTagsListForInline($aWindow);$bodyWrap.append($tagsListContainer);$indicator_details.empty().append($header,$bodyWrap)}},makeTagsListForInline:function($aWindow,isWriteMode,page){var hash=$aWindow.data("hash")||$aWindow.attr("ant-hash");var isPage=!hash||hash=="page";var summary=!isPage?ANT.summaries[hash]:{};var default_reactions=ANT.groupSettings.getBlessedTags(hash);var reactionViewStyle=$aWindow.attr("ant-view-style")||"grid";if(!Date.now){Date.now=function(){return(new Date).valueOf()}}var $tagsListContainer=$('<div class="ant_body ant_tags_list ant_'+reactionViewStyle+'" style="background:'+ANT.group.tags_bg_css+'" />').data("now",Date.now());var $existingTagslist=$aWindow.find(".ant_tags_list");$aWindow.find(".ant_body_wrap").append($tagsListContainer);$existingTagslist.remove();if(typeof page!="undefined"){if(!isWriteMode&&page.toptags.length){writeTagBoxes(page.toptags);ANT.aWindow.updateFooter($aWindow,'<span class="ant_cta_msg">'+ANT.t("main_cta")+"</span>");$aWindow.find(".ant_footer").addClass("ant_cta").find("span.ant_cta_msg").click(function(){$aWindow.remove();$aWindow=ANT.aWindow.make("writeMode",{hash:"page",page:page,is_page:true})})}else{var $header=ANT.aWindow.makeHeader(ANT.t("main_cta")),isWriteMode=true;$aWindow.find(".ant_header").replaceWith($header);writeTagBoxes(default_reactions);var $custom_tagBox=ANT.aWindow.writeCustomTag($tagsListContainer,$aWindow);$aWindow.removeClass("ant_rewritable")}}else if(isWriteMode){writeTagBoxes(default_reactions)}else if(isPage){}else{if(!$.isEmptyObject(summary.top_interactions.tags)){ANT.actions.summaries.sortInteractions(hash);writeTagBoxes(summary.interaction_order);if(summary.kind=="text"){if(!summary.crossPage){ANT.aWindow.updateFooter($aWindow,'<span class="ant_cta_msg">'+ANT.t("main_cta")+"</span>");$aWindow.find(".ant_footer").addClass("ant_cta").find(".ant_cta_msg").click(function(){$aWindow.remove();var $container=$('[ant-hash="'+hash+'"]');var el=$container[0];$("document").selog("selectEl",el);$aWindow=ANT.aWindow.make("writeMode",{hash:hash})})}}else{ANT.aWindow.updateFooter($aWindow,'<span class="ant_cta_msg">'+ANT.t("main_cta")+"</span>");$aWindow.find(".ant_footer").addClass("ant_cta").find(".ant_cta_msg").click(function(){var offsets=$aWindow.offset();var coords={left:offsets.left,top:offsets.top,force:true};$aWindow.remove();$aWindow=ANT.aWindow.make("writeMode",{hash:hash,coords:coords})})}}else{ANT.aWindow.updateFooter($aWindow,'<span class="ant_no_reactions_msg ant_clearfix">No reactions yet!</span>')}}if(typeof page=="undefined"&&isWriteMode){var $custom_tagBox=ANT.aWindow.writeCustomTag($tagsListContainer,$aWindow);$aWindow.removeClass("ant_rewritable")}if(!isTouchBrowser){$aWindow.on("mouseleave.ant",function(e){var $this=$(this),timeoutCloseEvt;timeoutCloseEvt=setTimeout(function(){if($this.hasClass("ant_rewritable")){$this.remove();if(!$(".ant_writemode").length){$().selog("hilite",true,"off")}}},300);$(this).data("timeoutCloseEvt",timeoutCloseEvt)}).on("mouseenter.ant",function(){var timeoutCloseEvt=$(this).data("timeoutCloseEvt");clearTimeout(timeoutCloseEvt)});if(typeof summary!="undefined"&&summary.kind=="text"&&!$.isEmptyObject(summary.content_nodes)){$aWindow.find("div.ant_box").each(function(){$(this).hover(function(){if(typeof summary.content_nodes[$(this).find("div.ant_tag").data("content_node_id")]!="undefined"){var selState=summary.content_nodes[$(this).find("div.ant_tag").data("content_node_id")].selState;var isPanelState1=!$aWindow.data("panelState")||$aWindow.data("panelState")===1;if(isPanelState1){$().selog("hilite",selState,"on");$aWindow.data("selState",selState)}}},function(){if(typeof summary.content_nodes[$(this).find("div.ant_tag").data("content_node_id")]!="undefined"){var selState=summary.content_nodes[$(this).find("div.ant_tag").data("content_node_id")].selState;var isPanelState1=!$aWindow.data("panelState")||$aWindow.data("panelState")===1;if(isPanelState1){$().selog("hilite",selState,"off")}}})})}}if(isPage){}return $tagsListContainer;function createTagBuckets(tagList){function SortByTagCount(a,b){return b.tag_count-a.tag_count}$.each(tagList,function(idx,tag){if(!tag.tag_count)tag.tag_count=-101});tagList.sort(SortByTagCount);var buckets={big:[],medium:[],small:[]},max=tagList[0].tag_count,median=tagList[Math.floor(tagList.length/2)].tag_count,min=tagList[tagList.length-1].tag_count,avg=function(arr){var total=0;$.each(arr,function(idx,tag){total+=tag.tag_count});return Math.floor(total/arr.length)
}(tagList),midValue=median>avg?median:avg;$.each(tagList,function(idx,tag){var tagBody=typeof tag.tag_body!="undefined"?tag.tag_body:tag.body;if(max>15&&tag.tag_count>=Math.floor(max*.8)){buckets.big.push(tag);return}else if(tag.tag_count>midValue){buckets.medium.push(tag);return}else{buckets.small.push(tag);return}});return buckets}function writeTagBoxes(tagList){if(!tagList.length){return}var buckets=createTagBuckets(tagList),bucketTotal=buckets.big.length+buckets.medium.length+buckets.small.length,bgColorInt=0,textColorInt=0,numBgColors=ANT.group.tag_box_bg_colors.length,numTextColors=ANT.group.tag_box_text_colors.length;if(reactionViewStyle=="grid"){if(bucketTotal>6&&!isWriteMode){if(isTouchBrowser){ANT.aWindow.tagBox.setWidth($aWindow,200)}else{ANT.aWindow.tagBox.setWidth($aWindow,300)}}else if(typeof page!="undefined"&&isWriteMode){ANT.aWindow.tagBox.setWidth($aWindow,200)}else if(tagList.length>1){if(buckets.big.length){ANT.aWindow.tagBox.setWidth($aWindow,200)}if(buckets.medium.length){ANT.aWindow.tagBox.setWidth($aWindow,200)}if(buckets.small.length>=3){ANT.aWindow.tagBox.setWidth($aWindow,200)}}}while(buckets.big.length||buckets.medium.length||buckets.small.length){if(buckets.big.length){var thisTag=buckets.big.shift();ANT.aWindow.tagBox.make({tag:thisTag,boxSize:"big",$aWindow:$aWindow,isWriteMode:isWriteMode,textColorInt:textColorInt,bgColorInt:bgColorInt});bgColorInt++;textColorInt++;if(bgColorInt==numBgColors)bgColorInt=0;if(textColorInt==numTextColors)textColorInt=0}else if(buckets.medium.length){var thisTag=buckets.medium.shift();ANT.aWindow.tagBox.make({tag:thisTag,boxSize:"medium",$aWindow:$aWindow,isWriteMode:isWriteMode,textColorInt:textColorInt,bgColorInt:bgColorInt});bgColorInt++;textColorInt++;if(bgColorInt==numBgColors)bgColorInt=0;if(textColorInt==numTextColors)textColorInt=0}else if(buckets.small.length){var thisTag=buckets.small.shift();ANT.aWindow.tagBox.make({tag:thisTag,boxSize:"small",$aWindow:$aWindow,isWriteMode:isWriteMode,textColorInt:textColorInt,bgColorInt:bgColorInt});bgColorInt++;textColorInt++;if(bgColorInt==numBgColors)bgColorInt=0;if(textColorInt==numTextColors)textColorInt=0}}}},updateContainerTrackers:function(){$.each(ANT.containers,function(idx,container){if(container.kind&&(container.kind=="img"||container.kind=="media"||container.kind=="med")){ANT.actions.indicators.utils.updateContainerTracker(container.hash)}})},updateContainerTracker:function(hash){var summary=ANT.summaries[hash],$container=summary.$container,$container_tracker=$("#ant_container_tracker_"+hash);var container=ANT.containers[hash];if(container.kind&&(container.kind=="text"||container.kind=="txt"))return;var padding={top:parseInt($container.css("padding-top"),10),right:parseInt($container.css("padding-right"),10),bottom:parseInt($container.css("padding-bottom"),10),left:parseInt($container.css("padding-left"),10)};var hasBorder=parseInt($container.css("border-top-width"),10)+parseInt($container.css("border-bottom-width"),10)+parseInt($container.css("border-left-width"),10)+parseInt($container.css("border-right-width"),10);var paddingOffset={};paddingOffset.top=!hasBorder?padding.top:0;paddingOffset.left=!hasBorder?padding.left:0;this.updateMediaTracker(hash)},updateInlineIndicator:function(hash){var summary=ANT.summaries[hash],$container=summary.$container,$indicator_details=summary.$indicator_details;if(typeof $indicator_details!="undefined"){$indicator_details.css({top:$container.offset().bottom,left:$container.offset().left,width:$container.outerWidth()})}},updateMediaTracker:function(hash){var summary=ANT.summaries[hash],$container=summary.$container,$indicator=summary.$indicator,$indicator_body=summary.$indicator_body,$indicator_details=summary.$indicator_details,$container_tracker=$("#ant_container_tracker_"+hash);if($indicator_body){if($container.parents(ANT.group.img_container_selectors).length){$container=$container.parents(ANT.group.img_container_selectors).first()}var containerWidth,containerHeight;var containerOffsets=$container.offset();var hasBorder=parseInt($container.css("border-top-width"),10)+parseInt($container.css("border-bottom-width"),10)+parseInt($container.css("border-left-width"),10)+parseInt($container.css("border-right-width"),10);if(hasBorder){containerWidth=$container.outerWidth();containerHeight=$container.outerHeight()}else{containerWidth=$container.width();containerHeight=$container.height()}var cornerPadding=0,indicatorBodyWidth=$indicator_body.width(),modIEHeight=$.browser.msie&&parseInt($.browser.version,10)<9?10:0,modMediaSide=summary.kind=="media"?12:0;var cssTop=containerOffsets.top+(summary.kind=="media"?containerHeight+modIEHeight-12:containerHeight+modIEHeight-22);var cssSideDistance=ANT.group.img_indicator_show_side=="left"?containerOffsets.left+modMediaSide:$(window).width()-(containerOffsets.left+containerWidth-modMediaSide);var indicatorPosition={};indicatorPosition[ANT.group.img_indicator_show_side]=cssSideDistance+"px";indicatorPosition["top"]=cssTop+"px";ANT.util.cssSuperImportant($indicator,indicatorPosition,true);$indicator.data("top",cssTop);if(summary.kind=="media"){$indicator.addClass("ant_indicator_not_img")}var has_inline_indicator=summary.kind=="text"?false:true;if(has_inline_indicator){ANT.actions.indicators.utils.updateInlineIndicator(hash)}else{}}}}},summaries:{init:function(hash){if(!ANT.util.activeAB())return;if(typeof ANT.summaries[hash]=="object"){return ANT.summaries[hash]}var container=ANT.containers[hash];var summary={hash:hash,kind:container.kind,id:container.id,counts:{coms:0,tags:0,interactions:0},top_interactions:{coms:{},tags:{}}};return summary},save:function(summary){var hash=summary.hash;ANT.summaries[hash]=summary;summary.$container=$('[ant-hash="'+hash+'"]')},update:function(hash,diff,isPage,pageId){if(isPage){$.each(diff,function(interaction_node_type,nodes){$.each(nodes,function(id,diffNode){diffNode.page_id=pageId;ANT.actions.summaries.updatePageSummaryTags(hash,diffNode)})});return}var summary;if(!ANT.summaries.hasOwnProperty(hash)){summary=ANT.actions.summaries.init(hash)}else{summary=ANT.summaries[hash]}$.each(diff,function(interaction_node_type,nodes){$.each(nodes,function(id,diffNode){update_top_interactions_cache({hash:hash,summary:summary,interaction_node_type:interaction_node_type,id:id,diffNode:diffNode});summary.counts[interaction_node_type]+=diffNode.delta;summary.counts.interactions+=diffNode.delta;diffNode.int_type=interaction_node_type;ANT.aWindow.update(hash,diffNode)})});ANT.actions.summaries.sortInteractions(hash);if(hash=="pageSummary"){makeSummaryWidget(ANT.page)}else{}function update_top_interactions_cache(attrs){console.log("update_top_interactions_cache");var hash=attrs.hash;var summary=attrs.summary;var interaction_node_type=attrs.interaction_node_type;var id=attrs.id;var diffNode=attrs.diffNode;var summary_nodes=summary.top_interactions[interaction_node_type];var interactionExists=summary_nodes.hasOwnProperty(id)&&typeof summary_nodes[id]!=="undefined";if(interactionExists){var summary_node=summary_nodes[id];summary_node.count+=diffNode.delta;if(interaction_node_type=="tags"){ANT.actions.summaries.updatePageSummaryTags(hash,diffNode);if(summary_node.count<=0){delete summary_nodes[id]}}}else{if(interaction_node_type=="tags"){summary_nodes[id]={count:diffNode.delta,body:diffNode.body,id:id,parent_id:diffNode.parent_id,parent_interaction_node:diffNode.parent_interaction_node};ANT.actions.summaries.updatePageSummaryTags(hash,diffNode)}else{var user=diffNode.user;summary_nodes[diffNode.tag_id]={body:diffNode.body,content_node:diffNode.content_node,content_id:diffNode.content_id,id:diffNode.id,social_user:diffNode.social_user,tag_id:diffNode.tag_id,user:diffNode.user,parent_id:diffNode.parent_id,parent_interaction_node:diffNode.parent_interaction_node}}}}function update_content_nodes_cache(attrs){console.log("update_content_nodes_cache");return;var hash=attrs.hash;var summary=attrs.summary;var interaction_node_type=attrs.interaction_node_type;var id=attrs.id;var diffNode=attrs.diffNode;var content_nodes=summary.content_nodes;if(!content_nodes){return}$.each(content_nodes,function(id,content_node){if(interaction_node_type=="tags"){if(id===diffNode.content_id){content_node.counts[interaction_node_type]+=diffNode.delta;content_node.counts[interactions]+=diffNode.delta;var tagId=diffNode.id;var tagRecordInContentNode=content_node.top_interactions.tags[tagId];if(tagRecordInContentNode){tagRecordInContentNode.count+=diffNode.delta;if(tagRecordInContentNode.count<=0){delete content_node.top_interactions.tags[tagId]}}}}else if(interaction_node_type=="coms"){if(content_node.id===diffNode.content_id){content_node.counts[interaction_node_type]+=diffNode.delta;content_node.counts[interactions]+=diffNode.delta;var contentNodeComs=content_node.top_interactions.coms;if(diffNode.delta===-1){$.each(contentNodeComs,function(idx,comNode){})}else{}}}})}},updatePageSummaryTags:function(hash,diffNode){var tagId=diffNode.id;var pageId=diffNode.page_id||ANT.util.getPageProperty("id",hash);var page=ANT.pages[pageId];var toptags=page.toptags;var foundIt;$.each(toptags,function(){if(this.id==tagId){page.count+=diffNode.delta;this.tag_count+=diffNode.delta;foundIt=true}});if(!foundIt){toptags.push({body:diffNode.body,id:diffNode.id,tag_count:1})}var summary=page.summary;$.each(summary,function(idx,val){if(val.kind=="tag"){val.count=val.count+diffNode.delta}});var $page=$('[ant-page-container="'+pageId+'"]');var $summaryWidgetAnchorNode=$page.find("[ant-page-widget-key]");$summaryWidgetAnchorNode.antWidgetSummary("update")},sortByTags:function(tags){function SortByTagCount(a,b){return b.tag_count-a.tag_count}return tags.sort(SortByTagCount)},sortInteractions:function(hash){function SortByTagCount(a,b){return b.tag_count-a.tag_count}var summary=ANT.summaries[hash];summary.interaction_order=[];summary.counts.highest_tag_count=0;var isText=summary.kind=="text"||summary.kind=="txt";if(isText){if(!$.isEmptyObject(summary.content_nodes)){$.each(summary.content_nodes,function(node_id,node_data){$.each(node_data.top_interactions.tags,function(tag_id,tag_data){summary.interaction_order.push({tag_count:tag_data.count,tag_id:tag_id,tag_body:tag_data.body,content_node_id:node_id,parent_id:tag_data.parent_id});setHighestTagCount(tag_data.count)})})}else{$.each(summary.top_interactions.tags,function(tag_id,tag_data){summary.interaction_order.push({tag_count:tag_data.count,tag_id:tag_id,tag_body:tag_data.body,content_node_id:node_id,parent_id:tag_data.parent_id});setHighestTagCount(tag_data.count)})}}else if(!$.isEmptyObject(summary.top_interactions)&&!$.isEmptyObject(summary.content_nodes)){var node_id=$.map(summary.content_nodes,function(value,key){return key})[0];$.each(summary.top_interactions.tags,function(tag_id,tag_data){summary.interaction_order.push({tag_count:tag_data.count,tag_id:tag_id,tag_body:tag_data.body,content_node_id:node_id,parent_id:tag_data.parent_id});setHighestTagCount(tag_data.count)})}summary.interaction_order.sort(SortByTagCount);function setHighestTagCount(tag_count){if(tag_count>summary.counts.highest_tag_count){summary.counts.highest_tag_count=tag_count}}},sortPopularTextContainers:function(){function SortByCount(a,b){return b.interactions-a.interactions}ANT.text_container_popularity=[];$.each(ANT.summaries,function(hash,container){if(container.kind=="text"&&container.counts.interactions>0){ANT.text_container_popularity.push({hash:hash,interactions:container.counts.interactions})}});ANT.text_container_popularity.sort(SortByCount)}},insertContainerIcon:function(hash){},viewReactionSuccess:function(args){var tag=args.tag,$aWindow=args.aWindow,interaction=args.response.data.interaction,content_node=args.content_node==""?args.response.data.content_node:args.content_node;$aWindow.removeClass("ant_rewritable").addClass("ant_viewing_more").find(".ant_footer").hide();var headerText=args.scenario=="reactionSuccess"?ANT.t("thanks"):ANT.t("already_done_that");var isPage=args.kind=="page";if(isPage){var hash=null,kind="page"}else{var hash=args.hash,summary=ANT.summaries[hash],kind=summary.kind}var $header=ANT.aWindow.makeHeader(headerText,args.response.data.interaction.id);$aWindow.find(".ant_header").replaceWith($header);var $newPanel=ANT.aWindow.panelCreate($aWindow,"ant_view_more");var $ant_body_wrap=$aWindow.find("div.ant_body_wrap");$ant_body_wrap.append($newPanel);ANT.aWindow.updateTagMessage(args);ANT.aWindow.panelShow($aWindow,$newPanel,function(){if(kind=="text"&&args.selState){var selState=args.selState;$().selog("hilite",selState,"on")}var $tagsListContainer=ANT.actions.indicators.utils.makeTagsListForInline($aWindow);if(args.scenario!="reactionExists"){ANT.actions.containers.updateCrossPageHash(hash)}$tagsListContainer.addClass("ant_hiddenPanel");var className="ant_tags_list";ANT.aWindow.hideFooter($aWindow);ANT.aWindow.panelUpdate($aWindow,className,$tagsListContainer);var isCrossPageContainer=$('[ant-hash="'+hash+'"]').length>0;if(!isCrossPageContainer){}})},viewCommentContent:function(args){var tag=args.tag,$aWindow=args.aWindow,content_node=args.content_node;ANT.events.trackEventToCloud({event_type:"vcom",event_value:"",container_hash:args.hash,container_kind:args.content_node.kind,page_id:ANT.util.getPageProperty("id"),reaction_body:args.tag.tag_body});$aWindow.removeClass("ant_rewritable").addClass("ant_viewing_more");ANT.aWindow.tagBox.setWidth($aWindow,200);ANT.aWindow.hideFooter($aWindow);var hash=args.hash,summary=ANT.summaries[hash],tagBody=tag.tag_body?tag.tag_body:tag.body,kind=summary.kind;var $header=ANT.aWindow.makeHeader(tag.tag_body);$aWindow.find(".ant_header").replaceWith($header);var $newPanel=ANT.aWindow.panelCreate($aWindow,"ant_view_more");var $ant_body_wrap=$aWindow.find("div.ant_body_wrap");$ant_body_wrap.append($newPanel);var $commentsWrap=$('<div class="ant_commentsWrap"></div>');var $backButton=_makeBackButton();var $backButton2=_makeBackButton();var $otherComments=_makeOtherComments();var $commentBox=_makeCommentBox();$commentsWrap.append($backButton,$otherComments,$commentBox,$backButton2);$newPanel.append($commentsWrap);var isMediaContainer=kind=="img"||kind=="imgage"||kind=="med"||kind=="media";ANT.aWindow.panelShow($aWindow,$newPanel,function(){if(kind=="text"){var selState=args.selState||summary.content_nodes[content_node.id].selState;$().selog("hilite",selState,"on");$aWindow.data("selState",selState)}});function _makeCommentBox(){var $commentBox=$('<div class="ant_commentBox ant_innerWrap"></div>').html('<div class="ant_commentComplete"><div><h4>Leave a comment:</h4></div></div>');var helpText="Add a comment or #hashtag",$commentDiv=$('<div class="ant_comment ant_clearfix">'),$commentTextarea=$('<textarea class="commentTextArea ant_default_msg">'+helpText+"</textarea>"),$ant_charCount=$('<div class="ant_charCount">'+ANT.t("characters_left").replace("NNN",ANT.group.comment_length)+"</div>"),$submitButton=$('<button class="ant_commentSubmit">'+ANT.t("comment")+"</button>");$commentDiv.append($commentTextarea,$ant_charCount,$submitButton);$commentTextarea.focus(function(){if($(this).val()==helpText){$(this).val("")}}).blur(function(){var val=$(this).val();if(val===""||val===helpText){$(this).addClass("ant_default_msg");$(this).val(helpText)}}).keyup(function(event){var commentText=$commentTextarea.val();if(event.keyCode=="27"){$(this).blur();return false}else if(commentText.length>ANT.group.comment_length){commentText=commentText.substr(0,ANT.group.comment_length);$commentTextarea.val(commentText)}$commentTextarea.siblings("div.ant_charCount").text(ANT.t("characters_left").replace("NNN",ANT.group.comment_length-commentText.length))});$submitButton.click(function(e){var commentText=$commentTextarea.val();if(commentText.length>ANT.group.comment_length){commentText=commentText.substr(0,ANT.group.comment_length);$commentTextarea.val(commentText);$commentTextarea.siblings("div.ant_charCount").text(ANT.t("characters_left").replace("NNN",ANT.group.comment_length-commentText.length))}if(commentText!=helpText){if($.isEmptyObject(content_node)&&summary.kind=="img"){content_node={body:$('img[ant-hash="'+summary.hash+'"]').get(0).src,kind:summary.kind,hash:summary.hash}}else{var $node=$('[ant-hash="'+summary.hash+'"]'),content_type=$node.attr("ant-content-type");if(content_type){if(content_type=="media"){content_node.kind="media"}else if(content_type=="image"){content_node.kind="image"}else{content_node.kind="text"}}else{content_node.kind="text"}}var selState=selState||null;var args={hash:hash,content_node_data:content_node,comment:commentText,content:content_node.body,tag:tag,aWindow:$aWindow,selState:selState};ANT.actions.interactions.ajax(args,"comment","create")}else{$commentTextarea.focus()}return false});$commentBox.append($commentDiv);return $commentBox}function _makeBackButton(){var $backButton=$('<div class="ant_back">'+ANT.t("close")+" X</div>");$backButton.click(function(){var isViewForAWindow=!!$aWindow.attr("ant-view-reactions-for");if(!isViewForAWindow){ANT.aWindow.close($aWindow);return}var $header=ANT.aWindow.makeHeader(ANT.t("reactions"));$aWindow.find(".ant_header").replaceWith($header);ANT.aWindow.updateTagPanel($aWindow)});return $backButton}function _makeOtherComments(){var comments,tagId=tag.id?tag.id:tag.tag_id;if(kind=="text"){comments=summary.content_nodes[content_node.id].top_interactions.coms}else{comments=summary.top_interactions.coms[tagId]}var node_comments=0;if(!$.isArray(comments)){comments=[].push(comments)}$.each(comments,function(idx,com){if(com.tag_id==tagId){node_comments++}});var hasComments=!$.isEmptyObject(comments);if(!hasComments)return;var $otherComments=$('<div class="ant_otherCommentsBox"></div>');var $header=$('<div class="ant_comment_header ant_innerWrap"><h4>(<span>'+node_comments+"</span>) "+ANT.t("comments")+":</h4></div>");$otherComments.append($header);$.each(comments,function(idx,this_comment){if(this_comment.tag_id!=tagId){return}$otherComments.show();var $commentSet=$('<div class="ant_commentSet ant_innerWrap" />'),$commentBy=$('<div class="ant_commentBy" />'),$comment=$('<div class="ant_comment" />'),$commentReplies=$('<div class="ant_commentReplies" />'),$commentReply=$('<div class="ant_commentReply" />'),$commentReply_link=$('<a href="javascript:void(0);">Reply</a>');var user_image_url=this_comment&&this_comment.social_user&&this_comment.social_user.img_url?this_comment.social_user.img_url:ANT_staticUrl+"widget/images/anonymousplode.png";var user_name=!this_comment||!this_comment.user||this_comment.user.first_name===""?"Anonymous":this_comment.user.first_name+" "+this_comment.user.last_name;$commentBy.html('<a href="'+ANT_baseUrl+"/user/"+this_comment.user.id+'" target="_blank"><img src="'+user_image_url+'" class="no-ant" /> '+user_name+"</a>").click(function(){});$comment.html('<div class="ant_comment_body">'+this_comment.body+"</div>");$commentSet.append($commentBy,$comment);$otherComments.append($commentSet)});$otherComments.find("div.ant_commentSet:last-child").addClass("ant_lastchild");return $otherComments}},share_getLink:function(args){var hash=args.hash,summary=ANT.summaries[hash],kind=args.kind?args.kind:summary.kind;ANT.session.getUser(args,function(params){var aWindow=params.aWindow,tag=params.tag;var content_node_info=params.content_node_info?params.content_node_info:params.content_node;if(!content_node_info.hash)content_node_info.hash=content_node_info.container?content_node_info.container:params.hash;if(!content_node_info.content)content_node_info.content=content_node_info.body;var content_node_data={hash:hash,body:content_node_info.content,location:content_node_info.location,kind:kind};var content_node=ANT.actions.content_nodes.make(content_node_data);$.postMessage("page_hash|"+window.location.hash,ANT_baseUrl+"/static/xdm.html",window.frames["ant-xdm-hidden"]);if(typeof tag.body=="undefined"){tag.body=tag.tag_body}var sendData={tag:tag,hash:content_node_info.hash,content_node_data:content_node_data,user_id:ANT.user.user_id,ant_token:ANT.user.ant_token,group_id:ANT.group.id,page_id:ANT.util.getPageProperty("id",hash),referring_int_id:args.referring_int_id,container_kind:args.kind=="page"?"page":ANT.summaries[hash].kind};$.ajax({url:ANT_baseUrl+"/api/share/",type:"get",contentType:"application/json",dataType:"jsonp",data:{json:$.toJSON(sendData)},success:function(response){args.response=response;if(response.status=="fail"){if(response.message.indexOf("Temporary user interaction limit reached")!=-1){ANT.session.showLoginPanel(args)}else{ANT.session.handleGetUserFail(args,function(){ANT.actions.share_getLink(args)})}}else{ANT.actions.shareContent({sns:params.sns,content_node_info:content_node_info,short_url:response.data.short_url,reaction:tag.body,container_kind:hash=="page"?"page":ANT.summaries[hash].kind})}},error:function(response){}})})},shareContent:function(args){var groupName=_getGroupName();var content=args.content_node_info.content,share_url="",contentStr="",content_length=300;switch(args.sns){case"facebook":var imageQueryP="";var videoQueryP="";var mainShareText="";var footerShareText="Antenna Reaction on "+groupName;switch(args.container_kind){case"txt":case"text":content_length=300;contentStr=_shortenContentIfNeeded(content,content_length,true);mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"img":case"image":contentStr="[a picture on "+groupName+"] Check it out: ";if(ANT_offline){content=content.replace("local.antenna.is:8081","www.antenna.is");content=content.replace("localhost:8081","www.antenna.is")}imageQueryP="&p[images][0]="+encodeURI(content);mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"media":case"med":case"video":contentStr="[a video on "+groupName+"] Check it out: ";mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"page":contentStr="[an article on "+groupName+"] Check it out: ";mainShareText=_wrapTag(args.reaction)+" "+contentStr;break}share_url="http://www.facebook.com/sharer.php?s=100"+"&p[title]="+encodeURI(mainShareText)+"&p[url]="+args.short_url+"&p[summary]="+encodeURI(mainShareText)+imageQueryP+videoQueryP;break;case"twitter":var mainShareText="";var footerShareText="Antenna Reaction on "+groupName;var twitter_acct=ANT.group.twitter?"&via="+ANT.group.twitter:"";switch(args.container_kind){case"txt":case"text":content_length=110-args.reaction.length;contentStr=_shortenContentIfNeeded(content,content_length,true);mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"img":case"image":contentStr="[a picture on "+groupName+"] Check it out: ";mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"media":case"med":case"video":contentStr="[a video on "+groupName+"] Check it out: ";mainShareText=_wrapTag(args.reaction)+" "+contentStr;break;case"page":contentStr="[an article on "+groupName+"] Check it out: ";mainShareText=_wrapTag(args.reaction)+" "+contentStr;break}share_url="http://twitter.com/intent/tweet?"+"url="+args.short_url+twitter_acct+"&text="+encodeURI(mainShareText);break}if(share_url!==""){if(ANT.shareWindow){ANT.shareWindow.location=share_url}}else{if(ANT.shareWindow){ANT.shareWindow.close()}}function _getGroupName(){return ANT.group.name?ANT.group.name:document.domain.replace("www.","")}function _wrapTag(tag,doHTMLEscape,isActionNotContent){var connectorSign=isActionNotContent?doHTMLEscape?"&#124;":"|":doHTMLEscape?"&raquo;":"»";return doHTMLEscape?tag+"&nbsp;"+connectorSign+"&nbsp;":tag+" "+connectorSign}function _shortenContentIfNeeded(content,content_length,addQuotes){var ext="...";var safeLength=content_length-ext.length;var str=content.length<=content_length?content:content.substr(0,safeLength)+ext;str=addQuotes?'"'+str+'"':str;return str}},newUpdateData:function(hash){var summary=ANT.summaries[hash],$aWindow_readmode=summary.$aWindow_readmode,$aWindow_writemode=summary.$aWindow_writemode},startSelect:function($mouse_target,mouseEvent,callback){if($mouse_target.hasAttr("ant-item")&&$('[ant-cta-for="'+$mouse_target.attr("ant-item")+'"]').length){return}ANT.actionbar.closeAll();var maxChars=800;if($mouse_target.closest(".ant, .no-ant, #ant_sandbox").length&&!$mouse_target.closest(".ant_indicator").length)return;var $blockParent=null;if(_isValid($mouse_target)){$blockParent=$mouse_target}else{$blockParent=findNearestValidParent($mouse_target)}if($blockParent===null)return;$antParent=$blockParent.closest("[ant-hashed]");var selected=$blockParent.selog("save");if(!selected||!selected.serialRange||!selected.text||/^\s*$/g.test(selected.text))return;if(selected.text.length>maxChars)return;var kind="text";var content=selected.text;if($antParent.length&&$antParent.hasAttr("ant-hashed")&&!$antParent.hasAttr("ant-page-container")){if(callback){var hash=$antParent.data("hash");callback(hash,kind,content);return}return _drawActionBar($antParent)}else{var hashListForPage=ANT.actions.hashNodes($blockParent);if(hashListForPage){ANT.actions.sendHashes(hashListForPage,function(){if(callback){var hash=$blockParent.data("hash");callback(hash,kind,content);return}return _drawActionBar($blockParent)})}}function findNearestValidParent($mouse_target){var $blockParent=null;var foundClosest=false;$mouse_target.parents().each(function(){if(foundClosest){return}var $thisNode=$(this);if(_isValid($thisNode)){$blockParent=$(this);foundClosest=true}});return $blockParent}function _drawActionBar($blockParent){var hash=$blockParent.data("hash"),summary=ANT.summaries[hash]||"undefined";if(_writeModeOpenForThisContainer(hash))return false;if(summary!="undefined"){var $indicator=summary.$indicator;ANT.actions.indicators.helpers.out($indicator)}ANT.aWindow.close($("div.ant.ant_window.ant.ant_rewritable"));var actionbarCoords=mouseEvent?{top:parseInt(mouseEvent.pageY,10)-7,left:parseInt(mouseEvent.pageX,10)-25}:{top:$mouse_target.offset().top,left:$mouse_target.offset().left};return ANT.actionbar.draw({coords:actionbarCoords,kind:"text",content:selected.text,hash:$blockParent.data("hash")})}function _writeModeOpenForThisContainer(hash){var summary=ANT.summaries[hash]||"undefined";if(!summary)return false;var $aWindow_writemode=summary.$aWindow_writemode;if($aWindow_writemode&&$aWindow_writemode.filter(":visible").length){return $aWindow_writemode}else{return false}}function _isValid($node){var validity=($node.css("display")=="block"||$node.css("display")=="list-item")&&!$node.closest(".ant_indicator").length&&!$node.is("html, body");return validity}},startSelectFromMouseUp:function(e){var $mouse_target=$(e.target);ANT.actions.startSelect($mouse_target,e)},stripAntNode:function($els){$els.removeAttr("ant-node ant-hasIndicator ant-hashed ant_summary_loaded ant-hash").off("mouseenter.ant").find(".ant_indicator").remove()},pages:{save:function(id,page){ANT.pages[page.id]=page},initPageContainer:function(pageId){var page=ANT.pages[pageId],key=page.urlhash;var $container=$(ANT.group.post_selector+'[ant-page-key="'+key+'"]').length==1?$(ANT.group.post_selector+'[ant-page-key="'+key+'"]'):$("body[ant-page-key]");if($container.length!==1)return;$container.removeAttr("ant-page-key");$container.attr("ant-page-container",pageId);var hash=ANT.util.md5.hex_md5(String(page.id));var tagName=$container.get(0).nodeName.toLowerCase();ANT.actions.containers.save({id:String(page.id),kind:"page",hash:hash,HTMLkind:null});$container.data("page_id",String(page.id));if(ANT.group.post_selector&&!$(ANT.group.post_selector).first().find(ANT.group.active_sections).length&&$(ANT.group.active_sections).length){ANT.actions.hashNodes($container.parent())}else{ANT.actions.hashNodes($container)}var hashesByPageId={};if(page.containers.length>0){hashesByPageId[page.id]=[];$.each(page.containers,function(idx,container){if(typeof container.hash!="undefined"){hashesByPageId[page.id].push(container.hash)}})}if(page&&$container.find("[ant-item]").length){hashesByPageId[page.id]=hashesByPageId[page.id]||[];$.each($container.find("[ant-item]"),function(idx,node){ANT.actions.hashNodes($(node));var thisHash=$(node).attr("ant-hash");if(typeof thisHash!="undefined"){hashesByPageId[page.id].push(thisHash)}})}ANT.actions.sendHashes(hashesByPageId);if(!ANT.util.activeAB())return;var widgetSummarySettings=page;widgetSummarySettings.key=key;if($container.find(ANT.group.summary_widget_selector).length>0&&$container.find(ANT.group.summary_widget_selector+'[ant-page-widget-key="'+key+'"]')){widgetSummarySettings.$anchor=$container.find(ANT.group.summary_widget_selector).eq(0)}else if($(".ant-page-summary").length==1){widgetSummarySettings.$anchor=$(".ant-page-summary").eq(0)}else{var displayDefaultBar=typeof ANT.engageScriptParams.bookmarklet=="undefined"?"top:-1000px !important":"";widgetSummarySettings.$anchor=$('<div id="ant-page-summary" class="ant no-ant ant-page-summary defaultSummaryBar" style="'+displayDefaultBar+'"/>');widgetSummarySettings.$anchor.appendTo("body")}$("#ant_sandbox").append('<div id="ant_summary_tag_details" />');if($("div.ant-summary").length===0||$("div.ant-summary").length<$(ANT.group.post_selector).length){widgetSummarySettings.$anchor.antWidgetSummary(widgetSummarySettings)}}},users:{save:function(id,settings){}}}})}function ant_loadScript(attributes,callbackfunction){var oHead=document.getElementsByTagName("head")[0];if(oHead){var oScript=document.createElement("script");oScript.setAttribute("src",attributes.src);oScript.setAttribute("type","text/javascript");if(oScript.readyState){oScript.onreadystatechange=function(){if(oScript.readyState=="loaded"||oScript.readyState=="complete"){oScript.onreadystatechange=null;callbackfunction()}}}else{oScript.onload=function(){callbackfunction()}}oHead.appendChild(oScript)}}ANT.ant_loadScript=ant_loadScript;ANT_scriptPaths.jquery=ANT_offline?ANT_staticUrl+"js/jquery-1.11.1.min.js":"//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js";ant_loadScript({src:ANT_scriptPaths.jquery},function(){if(isTouchBrowser){load_mobileEvents(jQuery)}jquery_onload(jQuery)});function jquery_onload(jQuery){$A=jQuery.noConflict(true);var $=$A;!function(a,b){"use strict";var c,d;if(a.uaMatch=function(a){a=a.toLowerCase();var b=/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(iphone)/.exec(a)||/(android)/.exec(a)||/(windows phone)/.exec(a)||/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||[];return{browser:b[3]||b[1]||"",version:b[2]||"0",platform:c[0]||""}},c=a.uaMatch(b.navigator.userAgent),d={},c.browser&&(d[c.browser]=!0,d.version=c.version,d.versionNumber=parseInt(c.version)),c.platform&&(d[c.platform]=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv){var e="msie";c.browser=e,d[e]=!0}if(d.opr){var f="opera";c.browser=f,d[f]=!0}if(d.safari&&d.android){var g="android";c.browser=g,d[g]=!0}d.name=c.browser,d.platform=c.platform,a.browser=d}($,window);if($.browser.msie&&parseInt($.browser.version,10)<9){return false}if($.browser.msie&&parseInt($.browser.version,10)==8){$("body").addClass("ant_ie")}$AFunctions($A)}function load_mobileEvents(jQuery){(function(e){function d(){var e=o();if(e!==u){u=e;i.trigger("orientationchange")}}function E(t,n,r,i){var s=r.type;r.type=n;e.event.dispatch.call(t,r,i);r.type=s}e.attrFn=e.attrFn||{};var t=navigator.userAgent.toLowerCase(),n=t.indexOf("chrome")>-1&&(t.indexOf("windows")>-1||t.indexOf("macintosh")>-1||t.indexOf("linux")>-1)&&t.indexOf("chrome")<0,r={swipe_h_threshold:50,swipe_v_threshold:50,taphold_threshold:750,doubletap_int:500,touch_capable:"ontouchstart"in document.documentElement&&!n,orientation_support:"orientation"in window&&"onorientationchange"in window,startevent:"ontouchstart"in document.documentElement&&!n?"touchstart":"mousedown",endevent:"ontouchstart"in document.documentElement&&!n?"touchend":"mouseup",moveevent:"ontouchstart"in document.documentElement&&!n?"touchmove":"mousemove",tapevent:"ontouchstart"in document.documentElement&&!n?"tap":"click",scrollevent:"ontouchstart"in document.documentElement&&!n?"touchmove":"scroll",hold_timer:null,tap_timer:null};
e.isTouchCapable=function(){return r.touch_capable};e.getStartEvent=function(){return r.startevent};e.getEndEvent=function(){return r.endevent};e.getMoveEvent=function(){return r.moveevent};e.getTapEvent=function(){return r.tapevent};e.getScrollEvent=function(){return r.scrollevent};e.each(["tapstart","tapend","tap","singletap","doubletap","taphold","swipe","swipeup","swiperight","swipedown","swipeleft","swipeend","scrollstart","scrollend","orientationchange"],function(t,n){e.fn[n]=function(e){return e?this.bind(n,e):this.trigger(n)};e.attrFn[n]=true});e.event.special.tapstart={setup:function(){var t=this,n=e(t);n.bind(r.startevent,function(e){n.data("callee",arguments.callee);if(e.which&&e.which!==1){return false}var i=e.originalEvent,s={position:{x:r.touch_capable?i.touches[0].screenX:e.screenX,y:r.touch_capable?i.touches[0].screenY:e.screenY},offset:{x:r.touch_capable?i.touches[0].pageX-i.touches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?i.touches[0].pageY-i.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};E(t,"tapstart",e,s);return true})},remove:function(){e(this).unbind(r.startevent,e(this).data.callee)}};e.event.special.tapend={setup:function(){var t=this,n=e(t);n.bind(r.endevent,function(e){n.data("callee",arguments.callee);var i=e.originalEvent;var s={position:{x:r.touch_capable?i.changedTouches[0].screenX:e.screenX,y:r.touch_capable?i.changedTouches[0].screenY:e.screenY},offset:{x:r.touch_capable?i.changedTouches[0].pageX-i.changedTouches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?i.changedTouches[0].pageY-i.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};E(t,"tapend",e,s);return true})},remove:function(){e(this).unbind(r.endevent,e(this).data.callee)}};e.event.special.taphold={setup:function(){var t=this,n=e(t),i,s,o={x:0,y:0};n.bind(r.startevent,function(e){if(e.which&&e.which!==1){return false}else{n.data("tapheld",false);i=e.target;var s=e.originalEvent;var u=(new Date).getTime(),a={x:r.touch_capable?s.touches[0].screenX:e.screenX,y:r.touch_capable?s.touches[0].screenY:e.screenY},f={x:r.touch_capable?s.touches[0].pageX-s.touches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?s.touches[0].pageY-s.touches[0].target.offsetTop:e.offsetY};o.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX;o.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY;r.hold_timer=window.setTimeout(function(){var l=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,c=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY;if(e.target==i&&o.x==l&&o.y==c){n.data("tapheld",true);var h=(new Date).getTime(),p={x:r.touch_capable?s.touches[0].screenX:e.screenX,y:r.touch_capable?s.touches[0].screenY:e.screenY},d={x:r.touch_capable?s.touches[0].pageX-s.touches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?s.touches[0].pageY-s.touches[0].target.offsetTop:e.offsetY};duration=h-u;var v={startTime:u,endTime:h,startPosition:a,startOffset:f,endPosition:p,endOffset:d,duration:duration,target:e.target};n.data("callee1",arguments.callee);E(t,"taphold",e,v)}},r.taphold_threshold);return true}}).bind(r.endevent,function(){n.data("callee2",arguments.callee);n.data("tapheld",false);window.clearTimeout(r.hold_timer)})},remove:function(){e(this).unbind(r.startevent,e(this).data.callee1).unbind(r.endevent,e(this).data.callee2)}};e.event.special.doubletap={setup:function(){var t=this,n=e(t),i,s,o,u;n.bind(r.startevent,function(e){if(e.which&&e.which!==1){return false}else{n.data("doubletapped",false);i=e.target;n.data("callee1",arguments.callee);u=e.originalEvent;o={position:{x:r.touch_capable?u.touches[0].screenX:e.screenX,y:r.touch_capable?u.touches[0].screenY:e.screenY},offset:{x:r.touch_capable?u.touches[0].pageX-u.touches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?u.touches[0].pageY-u.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};return true}}).bind(r.endevent,function(e){var a=(new Date).getTime();var f=n.data("lastTouch")||a+1;var l=a-f;window.clearTimeout(s);n.data("callee2",arguments.callee);if(l<r.doubletap_int&&l>0&&e.target==i&&l>100){n.data("doubletapped",true);window.clearTimeout(r.tap_timer);var c={position:{x:r.touch_capable?u.touches[0].screenX:e.screenX,y:r.touch_capable?u.touches[0].screenY:e.screenY},offset:{x:r.touch_capable?u.touches[0].pageX-u.touches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?u.touches[0].pageY-u.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};var h={firstTap:o,secondTap:c,interval:c.time-o.time};E(t,"doubletap",e,h)}else{n.data("lastTouch",a);s=window.setTimeout(function(e){window.clearTimeout(s)},r.doubletap_int,[e])}n.data("lastTouch",a)})},remove:function(){e(this).unbind(r.startevent,e(this).data.callee1).unbind(r.endevent,e(this).data.callee2)}};e.event.special.singletap={setup:function(){var t=this,n=e(t),i=null,s=null,o={x:0,y:0};n.bind(r.startevent,function(e){if(e.which&&e.which!==1){return false}else{s=(new Date).getTime();i=e.target;n.data("callee1",arguments.callee);o.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX;o.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY;return true}}).bind(r.endevent,function(e){n.data("callee2",arguments.callee);if(e.target==i){end_pos_x=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageX:e.pageX;end_pos_y=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageY:e.pageY;r.tap_timer=window.setTimeout(function(){if(!n.data("doubletapped")&&!n.data("tapheld")&&o.x==end_pos_x&&o.y==end_pos_y){var i=e.originalEvent;var u={position:{x:r.touch_capable?i.changedTouches[0].screenX:e.screenX,y:r.touch_capable?i.changedTouches[0].screenY:e.screenY},offset:{x:r.touch_capable?i.changedTouches[0].pageX-i.changedTouches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?i.changedTouches[0].pageY-i.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};if(u.time-s<r.taphold_threshold){E(t,"singletap",e,u)}}},r.doubletap_int)}})},remove:function(){e(this).unbind(r.startevent,e(this).data.callee1).unbind(r.endevent,e(this).data.callee2)}};e.event.special.tap={setup:function(){var t=this,n=e(t),i=false,s=null,o,u={x:0,y:0};n.bind(r.startevent,function(e){n.data("callee1",arguments.callee);if(e.which&&e.which!==1){return false}else{i=true;u.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX;u.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY;o=(new Date).getTime();s=e.target;return true}}).bind(r.endevent,function(e){n.data("callee2",arguments.callee);var a=e.originalEvent.targetTouches?e.originalEvent.changedTouches[0].pageX:e.pageX,f=e.originalEvent.targetTouches?e.originalEvent.changedTouches[0].pageY:e.pageY;if(s==e.target&&i&&(new Date).getTime()-o<r.taphold_threshold&&u.x==a&&u.y==f){var l=e.originalEvent;var c={position:{x:r.touch_capable?l.changedTouches[0].screenX:e.screenX,y:r.touch_capable?l.changedTouches[0].screenY:e.screenY},offset:{x:r.touch_capable?l.changedTouches[0].pageX-l.changedTouches[0].target.offsetLeft:e.offsetX,y:r.touch_capable?l.changedTouches[0].pageY-l.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};E(t,"tap",e,c)}})},remove:function(){e(this).unbind(r.startevent,e(this).data.callee1).unbind(r.endevent,e(this).data.callee2)}};e.event.special.swipe={setup:function(){function f(t){n=e(t.target);n.data("callee1",arguments.callee);o.x=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageX:t.pageX;o.y=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageY:t.pageY;u.x=o.x;u.y=o.y;i=true;var s=t.originalEvent;a={position:{x:r.touch_capable?s.touches[0].screenX:t.screenX,y:r.touch_capable?s.touches[0].screenY:t.screenY},offset:{x:r.touch_capable?s.touches[0].pageX-s.touches[0].target.offsetLeft:t.offsetX,y:r.touch_capable?s.touches[0].pageY-s.touches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target};var f=new Date;while(new Date-f<100){}}function l(t){n=e(t.target);n.data("callee2",arguments.callee);u.x=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageX:t.pageX;u.y=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageY:t.pageY;window.clearTimeout(r.hold_timer);var f;var l=n.data("xthreshold"),c=n.data("ythreshold"),h=typeof l!=="undefined"&&l!==false&&parseInt(l)?parseInt(l):r.swipe_h_threshold,p=typeof c!=="undefined"&&c!==false&&parseInt(c)?parseInt(c):r.swipe_v_threshold;if(o.y>u.y&&o.y-u.y>p){f="swipeup"}if(o.x<u.x&&u.x-o.x>h){f="swiperight"}if(o.y<u.y&&u.y-o.y>p){f="swipedown"}if(o.x>u.x&&o.x-u.x>h){f="swipeleft"}if(f!=undefined&&i){o.x=0;o.y=0;u.x=0;u.y=0;i=false;var d=t.originalEvent;endEvnt={position:{x:r.touch_capable?d.touches[0].screenX:t.screenX,y:r.touch_capable?d.touches[0].screenY:t.screenY},offset:{x:r.touch_capable?d.touches[0].pageX-d.touches[0].target.offsetLeft:t.offsetX,y:r.touch_capable?d.touches[0].pageY-d.touches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target};var v=Math.abs(a.position.x-endEvnt.position.x),m=Math.abs(a.position.y-endEvnt.position.y);var g={startEvnt:a,endEvnt:endEvnt,direction:f.replace("swipe",""),xAmount:v,yAmount:m,duration:endEvnt.time-a.time};s=true;n.trigger("swipe",g).trigger(f,g)}}function c(t){n=e(t.target);var o="";n.data("callee3",arguments.callee);if(s){var u=n.data("xthreshold"),f=n.data("ythreshold"),l=typeof u!=="undefined"&&u!==false&&parseInt(u)?parseInt(u):r.swipe_h_threshold,c=typeof f!=="undefined"&&f!==false&&parseInt(f)?parseInt(f):r.swipe_v_threshold;var h=t.originalEvent;endEvnt={position:{x:r.touch_capable?h.changedTouches[0].screenX:t.screenX,y:r.touch_capable?h.changedTouches[0].screenY:t.screenY},offset:{x:r.touch_capable?h.changedTouches[0].pageX-h.changedTouches[0].target.offsetLeft:t.offsetX,y:r.touch_capable?h.changedTouches[0].pageY-h.changedTouches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target};if(a.position.y>endEvnt.position.y&&a.position.y-endEvnt.position.y>c){o="swipeup"}if(a.position.x<endEvnt.position.x&&endEvnt.position.x-a.position.x>l){o="swiperight"}if(a.position.y<endEvnt.position.y&&endEvnt.position.y-a.position.y>c){o="swipedown"}if(a.position.x>endEvnt.position.x&&a.position.x-endEvnt.position.x>l){o="swipeleft"}var p=Math.abs(a.position.x-endEvnt.position.x),d=Math.abs(a.position.y-endEvnt.position.y);var v={startEvnt:a,endEvnt:endEvnt,direction:o.replace("swipe",""),xAmount:p,yAmount:d,duration:endEvnt.time-a.time};n.trigger("swipeend",v)}i=false;s=false}var t=this,n=e(t),i=false,s=false,o={x:0,y:0},u={x:0,y:0},a;n.bind(r.startevent,f);n.bind(r.moveevent,l);n.bind(r.endevent,c)},remove:function(){e(this).unbind(r.startevent,e(this).data.callee1).unbind(r.moveevent,e(this).data.callee2).unbind(r.endevent,e(this).data.callee3)}};e.event.special.scrollstart={setup:function(){function o(e,n){i=n;E(t,i?"scrollstart":"scrollend",e)}var t=this,n=e(t),i,s;n.bind(r.scrollevent,function(e){n.data("callee",arguments.callee);if(!i){o(e,true)}clearTimeout(s);s=setTimeout(function(){o(e,false)},50)})},remove:function(){e(this).unbind(r.scrollevent,e(this).data.callee)}};var i=e(window),s,o,u,a,f,l={0:true,180:true};if(r.orientation_support){var c=window.innerWidth||e(window).width(),h=window.innerHeight||e(window).height(),p=50;a=c>h&&c-h>p;f=l[window.orientation];if(a&&f||!a&&!f){l={"-90":true,90:true}}}e.event.special.orientationchange=s={setup:function(){if(r.orientation_support){return false}u=o();i.bind("throttledresize",d);return true},teardown:function(){if(r.orientation_support){return false}i.unbind("throttledresize",d);return true},add:function(e){var t=e.handler;e.handler=function(e){e.orientation=o();return t.apply(this,arguments)}}};e.event.special.orientationchange.orientation=o=function(){var e=true,t=document.documentElement;if(r.orientation_support){e=l[window.orientation]}else{e=t&&t.clientWidth/t.clientHeight<1.1}return e?"portrait":"landscape"};e.event.special.throttledresize={setup:function(){e(this).bind("resize",m)},teardown:function(){e(this).unbind("resize",m)}};var v=250,m=function(){b=(new Date).getTime();w=b-g;if(w>=v){g=b;e(this).trigger("throttledresize")}else{if(y){window.clearTimeout(y)}y=window.setTimeout(d,v-w)}},g=0,y,b,w;e.each({scrollend:"scrollstart",swipeup:"swipe",swiperight:"swipe",swipedown:"swipe",swipeleft:"swipe",swipeend:"swipe"},function(t,n,r){e.event.special[t]={setup:function(){e(this).bind(n,e.noop)}}})})(jQuery)}function $AFunctions($A){var $=$A;var css=[];if(!$A.browser.msie||$A.browser.msie&&parseInt($A.browser.version,10)>8){css.push(ANT_staticUrl+"css/antenna-font/antenna-font.css")}if($A.browser.msie){css.push(ANT_staticUrl+"widget/css/ie.css");css.push(ANT_staticUrl+"widget/css/ie"+parseInt($A.browser.version,10)+".css")}var widgetCSS=ANT_offline?ANT_widgetCssStaticUrl+"widget/css/widget.css":ANT_widgetCssStaticUrl+"widget/css/widget.min.css?rv45";css.push(widgetCSS);css.push(ANT_staticUrl+"widget/css/jquery.jscrollpane.css");loadCSS(css);function loadCSS(cssFileList){$A.each(cssFileList,function(i,val){$A("<link>").attr({href:val,rel:"stylesheet"}).appendTo("body")})}initCommonUtils($A);initPlugins($A);antenna($A);ANT.actions.init();function initCommonUtils($){$.extend(ANT,{commonUtil:{prettyNumber:function(anInt){var parsedInt=parseInt(anInt,10);if(isNaN(parsedInt)||parsedInt<0)return false;var abr=["","K","M","B","T"];for(var i=0;i<abr.length;i++){var thisfactor=Math.pow(10,3*i);var nextfactor=Math.pow(10,3*(i+1));if(parsedInt<nextfactor){return""+Math.floor(parsedInt/thisfactor)+abr[i]}}}}})}}})();