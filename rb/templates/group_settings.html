{% extends "base.html" %}
{% load custom_filters %}

{% block title %}{{ form.instance.name }} Settings{%endblock%}

{% block subheaderContent %}
<section role="subheader">
    {% with group=form.instance %}
    {% with "settings" as activeAdminTab %} 
    {% include "admin/nav_tabs.html" %}
    {% endwith %}
    {% endwith %}
</section>
{% endblock %}

{% block wideContent %}
<div class="grid-whole settings">
  <section role="panels" class="content">
  <div class="breadcrumb"><a href="/manage/">&lt;&lt; Back to Group Management</a></div>
{% with group=form.instance %}

    {% block settingsHeader %}    
      <h1>{{group.name}} Settings</h1>
    {% endblock settingsHeader %}    
  
  <form id="groupSettings" action="{% block settingsUrl %}/group/{{ short_name }}/settings/{% endblock settingsUrl %}" enctype="multipart/form-data" method="post" class="big-form">{% csrf_token %}
  {{ form.non_field_errors }}

	<div class="leftColumn column">
        <section class="">
    		<h3>Group Information</h3>
    		<div class="formRow">
    			<label for="id_name"><span class="labelTitle">Name </span></label>
    			{{ form.name }}
    			{{ form.name.errors }}
    		</div>
    		<div id="short_name_row" class="formRow">
    			<label for="id_short_name"><span class="labelTitle">Short Name </span><span>Used in URLs on antenna.is</span></label>
    			{{ form.short_name }}
    			{{ form.short_name.errors }}
    		</div>
    		<div class="formRow">
    			<label for="id_blessed_tags"><span class="labelTitle">Default Reactions </span><span>Default tags for people to react with.  Separate tags with a ";"</span></label>
    			{{ form.blessed_tags }}
                {{ form.blessed_tags.errors }}
    		</div>
    		<!-- <div class="formRow">
    		<label for="id_language"><span class="labelTitle">Language </span><span>For now, only "en" supported</span></label>
    		{{ form.language }}{{ form.language.errors }}
    		</div> -->
    		<div class="formRow">
    			<label for="id_temp_interact"><span class="labelTitle">Anonymous Reaction Limit </span><span>How many times someone can react, comment &amp; share before logging in.</span></label>
    			{{ form.temp_interact }}{{ form.temp_interact.errors }}
    		</div>

    	</section>

        <section class="configurationSection">
            <h3>Where Antenna Interacts</h3>
            <h4>Customize Antenna by defining these <a href="http://api.jquery.com/category/selectors/" target="_blank">jQuery selectors</a>.</h4>
            <div class="formRow">
                <label for="id_active_sections">
                    <span class="labelTitle">Active Sections (jQuery selector)</span>
                    <span>Tell Antenna where the content its allowed to interact with can be found.  For example, if you're using WordPress, you may just want people to interact with your article content -- typically all found inside the <code>.post</code> element.  Multiple elements allowed.</span>
                    <span class="formInputExample">Example: <i>article.post, #slideshow</i></span>
                </label>
                {{ form.active_sections }}{{ form.active_sections.errors }}
            </div>
            <div class="formRow">
                <label for="id_anno_whitelist">
                    <span class="labelTitle">Active Tags (jQuery selector)</span>
                    <span>Defines tags within the Active Sections that Antenna can interact with.</span>
                    <span class="formInputExample">Example: <i>p,img</i></span>
                </label>
                {{ form.anno_whitelist }}{{ form.anno_whitelist.errors }}
            </div>
            <div class="formRow">
                <label for="id_no_readr">
                    <span class="labelTitle">Inactive Sections (jQuery selector)</span>
                    <span>Defines sections that Antenna should always ignore.</span>
                    <span class="formInputExample">Example: <i>.myHeader, .mySidebar, .myFooter</i></span>
                </label>
                {{ form.no_readr }}{{ form.no_rdr.errors }}
            </div>
            <!--
            <div class="formRow">
                <label for="id_img_whitelist">
                    <span class="labelTitle">Active Images (jQuery selector)</span>
                    <span>Defines images Antenna interacts with by default.</span>
                </label>
                {{ form.img_whitelist }}{{ form.img_whitelist.errors }}
            </div>
            <div class="formRow">
                <label for="id_img_blacklist"><span class="labelTitle">Inactive Images (jQuery selector)</span>
                    <span>Defines images that Antenna should always ignore.</span>
                </label>
                {{ form.img_blacklist }}{{ form.img_blacklist.errors }}
            </div>
            -->
            <div class="formRow">
                <label for="id_summary_widget_selector">
                    <span class="labelTitle">Summary Widget Selector (jQuery selector)</span>
                    <span>Looks in each post to find where to append the summary bar widget.</span>
                </label>
                {{ form.summary_widget_selector }}{{ form.summary_widget_selector.errors }}
            </div>
            <div class="formRow">
                <label for="id_summary_widget_method">
                    <span class="labelTitle">Summary Widget Insertion Method</span>
                    <span>Should Antenna insert the Summary Widget before, inside, or after the Summary Widget Selector.  This maps to the jQuery function of the same name (e.g., ".before()");</span>
                </label>
                {{ form.summary_widget_method.as_hidden }}{{ form.summary_widget_method.errors }}
                <select id="summary_widget_method_selector">
                    <option {% if group.summary_widget_method == "append" %}selected="selected"{% endif %} value="append">:append</option>
                    <option {% if group.summary_widget_method == "before" %}selected="selected"{% endif %} value="before">:before</option>
                    <option {% if group.summary_widget_method == "after" %}selected="selected"{% endif %} value="after">:after</option>
                </select>
            </div>
            <div class="formRow wordpressKeepDefaults">
                <label for="id_post_selector">
                    <span class="labelTitle">Post Selector (jQuery selector)</span>
                    <span>Finds the top level dom element of a post.</span>
                </label>
                {{ form.post_selector }}{{ form.post_selector.errors }}
            </div>
            <div class="formRow wordpressKeepDefaults">
                <label for="id_post_href_selector">
                    <span class="labelTitle">Post HREF Selector (jQuery selector)</span>
                    <span>Looks in each post to find an 'a' tag with an href of the post's canonical url.</span>
                </label>
                {{ form.post_href_selector }}{{ form.post_href_selector.errors }}
            </div>
            <div class="formRow">
                <label for="id_separate_cta">
                    <span class="labelTitle">Which tags will have a separate call-to-action? (jQuery selector)</span>
                    <span>Antenna can insert a distinct call-to-action for content on your page.  See <a href="/see/#anotherway" target="_blank">Another way to react" on our demo page</a> to see what we mean.</span>
                    <span class="formInputExample">Example: <i>iframe,video</i></span>
                </label>
                {{ form.separate_cta }}{{ form.separate_cta.errors }}
            </div>
            <!-- this is too confusing still to expose to the user. 
            <div class="formRow">
                <label for="id_br_replace_scope_selector">
                    <span class="labelTitle">BR Tag Replacement (jQuery selector)</span>
                    <span>Some platforms, like Blogspot, separate paragraphs with a BR HTML tag, rather than P tags.  This is a problem, since there is a limit to how long a single piece of content can be for Antenna.  If your CMS does this, Antenna can replace the BR tags and wrap your content inside a tag. <strong>Most websites do not have this problem, so if you are unsure, just leave this empty!</strong></span>
                    <span class="formInputExample">Example: <i>.article</i></span>
                </label>
                {{ form.br_replace_scope_selector }}{{ form.br_replace_scope_selector.errors }}
            </div>
            -->
            
            {% if hostplatform %}
                <input type="hidden" id="id_hostplatform" type="text" name="hostplatform" value="{{ hostplatform }}" maxlength="100" />
            {% endif %}
        </section>
        <section class="configurationSection">
            <h3>Page Attributes</h3>
            <div class="formRow">
                <label for="">
                    <span class="labelTitle">Author(s)</span>
                    <span>Tell Antenna which HTML tags on your page contain the author(s) name(s).  If there is more than one tag, we'll iterate through and generated a comma-separated list of authors. We assume a jQuery selector for the tag, and that the author name is in an attribute.</span>
                    <span class="formInputExample"><i>$('<b>meta[rel="author"]</b>').attr('<b>content</b>');</i></span>
                </label>
                $('{{ form.author_selector|cssClass:'selector' }}').attr('{{ form.author_attribute|cssClass:'attribute' }}');
                {{ form.author_selector.errors }}
                {{ form.author_attribute.errors }}
            </div>
            <div class="formRow">
                <label for="">
                    <span class="labelTitle">Topics</span>
                    <span>Tell Antenna which HTML tags on your page contain topic tags.  If there is more than one tag, we'll iterate through and generated a comma-separated list of topic tags. We assume a jQuery selector for the tag, and that the tag is in an attribute.</span>
                    <span class="formInputExample"><i>$('<b>meta[rel="topic"]</b>').attr('<b>content</b>');</i></span>
                </label>
                $('{{ form.topics_selector|cssClass:'selector' }}').attr('{{ form.topics_attribute|cssClass:'attribute' }}');
                {{ form.topics_selector.errors }}
                {{ form.topics_attribute.errors }}
            </div>
            <div class="formRow">
                <label for="">
                    <span class="labelTitle">Site Section(s)</span>
                    <span>Tell Antenna which HTML tags on your page contain the site section(s) this article is in, such as Politics or News.  If there is more than one tag, we'll iterate through and generated a comma-separated list of sections. We assume a jQuery selector for the tag, and that the section name is in an attribute.</span>
                    <span class="formInputExample"><i>$('<b>meta[rel="section"]</b>').attr('<b>content</b>');</i></span>
                </label>
                $('{{ form.section_selector|cssClass:'selector' }}').attr('{{ form.section_attribute|cssClass:'attribute' }}');
                {{ form.section_selector.errors }}
                {{ form.section_attribute.errors }}
            </div>
        </section>
    </div>
    <div class="rightColumn column">
        <section class="">
            <h3>Moderation</h3>
            <div class="formRow" style="margin: 10px 0;">
                {{ form.requires_approval }}{{ form.requires_approval.errors }}
                <label for="id_requires_approval"><span class="labelTitle">Auto-block all reactions </span><span>If you want comments and reactions to be approved before they are visible for others to see, check this box.</span></label>
            </div>
            <div class="formRow">
                <label for="id_signin_organic_required">
                    {{ form.signin_organic_required}}{{ form.signin_organic_required.errors }}
                    <span class="labelTitle">Require login for custom reactions</span>
                    <span>This will require that a user logs before adding their own reaction instead of clicking your chosen defaults.</span>
                </label>
            </div>
            <div class="formRow word_blacklist_row">

                <label for="id_word_blacklist">
                    <span class="labelTitle">Censored Word List</span>
                    <span>Comma separated list of words that will be automatically <strong>blocked</strong>.  Only exact matches will be blocked.</span>
                </label>
                <div id="toggle_word_blacklist_wrap">
                    <label>
                        <a href="#" id="toggle_word_blacklist">
                            <span class="labelTitle word_blacklist_toggle_node" style="font-size: 12px;">Show and edit the list</span>
                            <span class="labelTitle word_blacklist_toggle_node hidden" style="font-size: 12px;">Good heavens, my eyes!</span>
                        </a>
                        <span class="floatLeft word_blacklist_toggle_node">Warning: Rated R for Raunchy</span>
                        <span class="floatLeft word_blacklist_toggle_node hidden">Hide this list, it will continue to be censored</span>
                    </label>
                </div>
                <div id="word_blacklist_wrap" class="word_blacklist_toggle_node hidden">
                    {{ form.word_blacklist }}{{ form.word_blacklist.errors }}
                </div>
                <input type="text" name="fake_hidden_word_blacklist" id="fake_hidden_word_blacklist" readonly="readonly" value="Dagnabbit, Poppycock ..." style="width:265px; color: #bbb;" class="word_blacklist_toggle_node">

            </div>
            
        </section>
        <section class="">
            <h3>Mobile Settings</h3>
            <div class="formRow" style="margin: 10px 0;">
                {{ form.hideOnMobile }}{{ form.hideOnMobile.errors }}
                <label for="id_hideOnMobile"><span class="labelTitle">Hide Antenna on Mobile? </span><span>Hide Antenna completely on mobile/touchscreen devices.</span></label>
            </div>

            <div class="formRow" style="margin: 10px 0;">    
                {{ form.hideDoubleTapMessage }}{{ form.hideDoubleTapMessage.errors }}
                <label for="id_hideDoubleTapMessage"><span class="labelTitle">Hide the mobile helper message? </span><span>There is a message telling your visitors that they can double-tap a paragraph on mobile to react to it.  They can easily close this message.  Check this box to <strong>hide</strong> this message for them.</span></label>
            </div>
            <div class="formRow" style="margin: 10px 0;">
                <label for="id_doubleTapMessage"><span class="labelTitle">Double Tap Message </span><span>Antenna has a default message telling your visitors that they can double-tap a paragraph to react to it.  You can change it here. <br/><strong>HTML is OK.  Leave blank to use our default message</strong>.</span></label>
                {{ form.doubleTapMessage }}{{ form.doubleTapMessage.errors }}
            </div>

            <div class="formRow" style="margin: 10px 0;">
                <label for="id_doubleTapMessagePosition">
                    <span class="labelTitle">Double-tap Message Position</span>
                    <span>The message telling readers that they can double-tap on mobile is fixed in-place.  Should it be at the top or bottom of the screen?  (Remember, they can close it!)</span>
                </label>
                {{ form.doubleTapMessagePosition.as_hidden }}{{ form.doubleTapMessagePosition.errors }}
                <select id="doubleTapMessagePosition_selector">
                    <option {% if group.doubleTapMessagePosition == "bottom" %}selected="selected"{% endif %} value="bottom">Bottom</option>
                    <option {% if group.doubleTapMessagePosition == "top" %}selected="selected"{% endif %} value="top">Top</option>
                </select>
            </div>
        </section>
        <section class="">
            <h3>Miscellaneous</h3>
            <div class="formRow">
                <label for="id_custom_css"><span class="labelTitle">Custom CSS </span><span>Custom CSS rules to embed on the page.</span></label>
                {{ form.custom_css }}
                <style>

                #fake_hidden_word_blacklist {
                    cursor: pointer;
                }

                textarea {
                    font-family: 'Courier', 'Courier New';
                    font-size: 12px;
                    color: #777;
                }
                #id_custom_css {
                    height:350px;
                }
                </style>
            </div>
            {% if group.premium == True %}
            <div class="formRow">
                <label for="id_send_notifications">
                    {{ form.send_notifications}}{{ form.send_notifications.errors }}
                    <span class="labelTitle">Send Email Notifications?</span>
                    <span>For users with a Antenna account, send them occasional notices when others react on the same pages they do.  (We don't send them every time, just periodically.)</span>
                </label>
            </div>
            {% endif %}
            <div class="formRow">
                <label for="id_paragraph_helper">
                    {{ form.paragraph_helper}}{{ form.paragraph_helper.errors }}
                    <span class="labelTitle">Paragraph Tooltips</span>
                    <span>Paragraphs with no reactions will display an icon when you hover over them.  When you hover over the icon it explains how to select text and react with Antenna.</span>
                </label>
            </div>

            <div class="formRow">
                <label for="id_logo_url_sm"><span class="labelTitle">Small Logo </span><span>URL to a small logo file (max 64x18)</span></label>
                {{ form.logo_url_sm }}{{ form.logo_url_sm.errors }}
            </div>
            <div class="formRow">
                <label for="id_logo_url_med"><span class="labelTitle">Medium Logo </span><span>URL to a medium logo file (max 100x50)</span></label>
                {{ form.logo_url_med }}{{ form.logo_url_med.errors }}
            </div>
            <div class="formRow">
                <label for="id_logo_url_lg"><span class="labelTitle">Large Logo </span><span>URL to a large logo file (max 300x250)</span></label>
                {{ form.logo_url_lg }}{{ form.logo_url_lg.errors }}
            </div>

        </section>
    </div>
{% comment %}
  {{ form.as_p }}
{% endcomment %}

    <div style="clear:both;">
        <button class="btn submit flat" type="submit">Submit</button>
    </div>
    <div class="formFeedback" data-saved="{{saved}}" >
        <p style="display: none;" class="errorMsg">Oops, there were some errors with the form, please see the sections highlighted red above.<p>
        <p style="display: none;" class="successMsg" >Changes saved<p>
    </div> 
  </form>
{% endwith %}
    </section>
</div>
{% endblock wideContent %}
 
    {% block afterWideContent %}
    {% endblock %}

{% block pageJS %}
    <script>
        $(function(){

            var hasErrors = $('.errorlist').length;
            
            if(hasErrors){
                $('.errorMsg').show();
            }else{
                var wasSaved = $('.formFeedback').data('saved');
                if(wasSaved){
                    $('.successMsg').show();
                }
            }

            $('#groupSettings input').bind('keypress', function(){
                $(this).closest('.formRow').removeClass('error');
                $(this).closest('form').find('.errorMsg').hide();
                $(this).closest('form').find('.successMsg').hide();
            });

            $('#toggle_word_blacklist, #fake_hidden_word_blacklist').click(function(){
                $('.word_blacklist_toggle_node').each(function(){
                    $(this).toggleClass('hidden');
                });
                return false;
            });

            $('#summary_widget_method_selector').change( function() {
                $('#id_summary_widget_method').val( $(this).val() );
            });

            $('#doubleTapMessagePosition_selector').change( function() {
                $('#id_doubleTapMessagePosition').val( $(this).val() );
            });

        });
    </script>
{% endblock %}