{% extends "base.html" %}
{% block title %}{{ group.name }} Analytics{%endblock%}


{% block extendedHead %}
<link rel="stylesheet" href="/static/components/morris/morris.css">
<link rel="stylesheet" href="/static/components/pikaday/css/pikaday.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<!-- <script src="/static/components/equalize/equalize.min.js"></script> -->
<script src="/static/components/morris/morris.js"></script>
<script src="/static/components/pikaday/pikaday-with-jquery.min.js"></script>

<!-- <script src="{{ STATIC_URL }}js/jquery.isotope.min.js"></script> -->
<!-- <script src="{{ STATIC_URL }}js/jquery.bigtext.js"></script> -->
<!-- <script src="{{ STATIC_URL }}global/js/jquery-ui-datepicker.custom.min.js"></script> -->
<!-- <script src="{{ STATIC_URL }}site/js/highcharts/highcharts.js"></script> -->
<!-- <link rel="stylesheet" href="{{ STATIC_URL }}global/css/datepicker_css/ui-lightness/jquery-ui-1.8.15.custom.css"> -->
<!--
<style>
    section[role="datepicker"] button {
        position: relative;
        top:-4px;
    }
</style>
-->
{% endblock %}

{% block mastheadContent %}
    {% with "analytics" as activeAdminTab %} 
    {% include "admin/nav_tabs.html" %}
    {% endwith %}
{% endblock %}

{% block wideContent %}
<div class="mostlyWide">
<section role="datepicker" class="datepicker">
	<form>
        <label>Date Range: </label>
    	<input type="text" name="start_date" />
    	<label>to</label>
    	<input type="text" name="end_date" />
    	<button class="btn" type="submit" >Update</button>
    </form>
</section>


<style>
.summary .engagement-rate { }
.summary .engagement-rate h2 { }
.summary .engagement-rate .donut { border-right:1px solid #ccc; width:90%;  }
.summary .other-totals {  }
/* http://css-tricks.com/vertically-center-multi-lined-text/ */
.other-totals .attribute .data { font-size:48px; font-weight:bold; text-align: center;  display: table-cell; vertical-align: middle; text-align: center; height:200px; }
.other-totals label { font-size:16px; font-weight:normal; display:block; text-align: center; }
.section { margin-bottom:80px; clear:both; overflow-y: auto; overflow-x:hidden; position: relative;}
.section h1 { font-size: 21px; }
.section.readrboard-usage { min-height: 150px; }
.section.readrboard-usage h1 {margin-bottom: -32px;}
.column { text-align: center; color:#7f7f7f; font-size:14px; }
.column.left { text-align: left; }
.noteworthy { color:#247292; }
.row { clear:both; overflow:auto; }
.header { font-weight:bold; border-bottom:1px solid #ccc; }
.row.even { background:#f0f0f0; }
.row.header:hover { background:transparent; }
.loading { color:#ccc; font-size:16px; line-height: 35px; height: 35px; width:100%; margin:0 auto; text-align: center; padding:20px; position:absolute; top:33%; box-sizing: border-box; }
.loading div { display: inline-block; }
.template { opacity:0; overflow: auto; z-index: 1; position: relative; background:#fff;}
/*.template.rendered { opacity:1;transition: opacity 5s ease-in-out; -moz-transition: opacity 5s ease-in-out; -webkit-transition: opacity 5s ease-in-out; }*/
</style>
<section id="analyticsReport" role="panels">
    <div class="grid-12 section summary hasLoader">
        <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Querying Engagement Totals...</div></div>
    </div>
    <div class="section readrboard-usage hasLoader">
        <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Analyzing ReadrBoard Usage...</div></div>
        <h1>ReadrBoard Usage</h1>
        <div class="grid-12 row padded header">
            <div class="grid-3 column header">&nbsp;</div>
            <div class="grid-3 column header">Used ReadrBoard in last 30 days</div>
            <div class="grid-3 column header noteworthy">Used ReadrBoard in last 180 days</div>
            <div class="grid-3 column header">No recent usage</div>
        </div>
    </div>
<script>

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

var $temp_readrboardUsage = $('<div><div class="template"></div></div>');

    var readrboardUsageData = {
        rb_last_30:[1431,1.9,29],
        rb_last_180:[10432,1.8,25],
        no_rb:[55012,1.5,15]
    };

    var $sessions_row = $('<div class="grid-12 row padded content">' +
            '<div class="grid-3 column left">Sessions</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.rb_last_30[0]+'</div>' +
            '<div class="grid-3 column noteworthy">'+readrboardUsageData.rb_last_180[0]+'</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.no_rb[0]+'</div>' +
        '</div>');
    var $session_pageviews_row = $('<div class="grid-12 row padded content even">' +
            '<div class="grid-3 column left">Session Pageviews</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.rb_last_30[1]+'</div>' +
            '<div class="grid-3 column noteworthy">'+readrboardUsageData.rb_last_180[1]+'</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.no_rb[1]+'</div>' +
        '</div>');
    var $avg_scrolldepth_row = $('<div class="grid-12 row padded content">' +
            '<div class="grid-3 column left">Avg Scroll Depth</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.rb_last_30[2]+'</div>' +
            '<div class="grid-3 column noteworthy">'+readrboardUsageData.rb_last_180[2]+'</div>' +
            '<div class="grid-3 column">'+readrboardUsageData.no_rb[2]+'</div>' +
        '</div>');

    $temp_readrboardUsage.find('.template').append( $sessions_row, $session_pageviews_row, $avg_scrolldepth_row );

    $('.section.readrboard-usage').append($temp_readrboardUsage).find('.template').animate({'opacity':1},500);


var $temp_summarySection = $('<div class="template"><div class="grid-3 engagement-rate">'+
        '<div class="donut" id="engaged-sessions" style="height:200px;"></div>'+
    '</div>'+
    '<div class="grid-9 other-totals"></div></div>');

    var summaryData = [
        { data:numberWithCommas(1040),label:'Reactions' },
        { data:numberWithCommas(134200),label:'Reaction Views' },
        { data:'52%',label:'Avg Scroll Depth' },
        { data:'0:37',label:'Avg Time Spent on Content' }
    ];
    $.each(summaryData, function(idx, item) {
        var $item = $('<div class="grid-quarter attribute"><div class="data">'+item.data+' <label>'+item.label+'</label></div></div>');
        $temp_summarySection.find('.other-totals').append($item);
    });

    $('.section.summary').append($temp_summarySection).find('.template').animate({'opacity':1},500);


    Morris.Donut({
      element: 'engaged-sessions',
      data: [
        {label: "Engaged Sessions", value: 10.5 },
        {label: "Non-Engaged Sessions", value: 89.5 }
      ],
      formatter: function (y) { return y + "%" }
    }).select(0);
</script>



<style>
a { color:#5ba0bc; }
.reactions-and-topics .hasLoader { min-height:150px; }
.topic-tag { display: inline-block; }
.topic-tag:hover { background:#f0f0f0; }
.topic-tag a { color:#5ba0bc; text-decoration: none;  }
.topic-tag.large { font-size:54px; padding:10px 10px; }
.topic-tag.medium { font-size:34px; padding:10px 10px; }
.topic-tag.small { font-size:21px; padding:10px 10px; }
.reaction-tag { border:4px solid #737373; padding:10px 20px; display:block; text-align:center; margin-right:10px; margin-bottom:10px; white-space: nowrap;}
    .grid-6 .reaction-tag { font-size:42px; }
    .grid-4 .reaction-tag { font-size:24px; padding:10px; }
    .grid-3 .reaction-tag { font-size:14px; padding:10px; }
    .topic-tag .smaller,
    .reaction-tag.smaller { font-size:80%; }
    .topic-tag .smallest,
    .reaction-tag.smallest { font-size:60%; }
.reaction-tag a {  color:#3c3c3c; font-weight:bold; display: inline-block; overflow: hidden; width: 100%;}
.reaction-tag .counter { display:block;font-size:16px; }
.reactions-and-topics .reactions-holder .grid-6 .reaction-tag { height:78px; }
.reactions-and-topics .reactions-holder .grid-4 .reaction-tag { height:53px; }
.reactions-and-topics .reactions-holder .grid-3 .reaction-tag { height:39px; }
.hasLoader {position: relative;}
/*.loading{display:none;}*/
</style>
    <div class="section reactions-and-topics">
        <div class="grid-12 row padded header">
            <div class="grid-6">
                <h1>Most Popular Reactions</h1>
            </div>
            <div class="grid-6">
                <h1>Most Engaged Topics</h1>
            </div>
        </div>
        <div class="grid-12 padded">
            <div class="grid-6 hasLoader">
                <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Counting Reactions...</div></div>
                <div class="reactions-holder">&nbsp;</div>
            </div>
            <div class="grid-6 hasLoader">
                <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Analyzing Topics...</div></div>
                <div class="topics-holder">&nbsp;</div>
            </div>
        </div>
<script>
var $temp_popularReactions = $('<div><div class="template"></div></div>');
var popularReactions = [
    { body:'Awesome', count:1460 },
    { body:'Ugh', count:1150 },
    { body:'Why Not', count:40 },
    { body:'And how is that right', count:30 },
    { body:'10 10 10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 1', count:20 },
    { body:'ww ww ww w w1ww', count:20 }
];
var itemNumber = 1;
$.each(popularReactions, function(idx, reaction) {
    var gridNum = (itemNumber<3) ? '6' : (itemNumber < 9) ? '4' : '3';
    var charCountModifier = (reaction.body.length>14) ? 'smaller':(reaction.body.length>20) ? 'smallest':''
    $temp_popularReactions.find('.template').append('<div class="grid-'+gridNum+'"><span class="reaction-tag '+charCountModifier+'"><a href="#">'+reaction.body+' <span class="counter">'+numberWithCommas(reaction.count)+'</span></a></span></div>'); 
    itemNumber++;
});

$('.section.reactions-and-topics').find('.reactions-holder').html($temp_popularReactions).find('.template').animate({'opacity':1},500);


var $temp_popularTopics = $('<div><div class="template"></div></div>');
var popularTopics = [
    { body:'broncos', count:60 },
    { body:'gun control', count:50 },
    { body:'politics', count:40 },
    { body:'weather', count:30 },
    { body:'10 10 10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 10 1', count:20 },
    { body:'10 10 10 10 1', count:20 },
    { body:'ww ww ww w w1ww', count:20 }
];
var itemNumber = 1;
$.each(popularTopics, function(idx, topic) {
    var size = (itemNumber<3) ? 'large' : (itemNumber < 9) ? 'medium' : 'small';
    var charCountModifier = (topic.body.length>14) ? 'smaller':(topic.body.length>20) ? 'smallest':'large'
    // $temp_popularTopics.find('.template').append('<div class="grid-'+gridNum+'"><span class="topic-tag '+charCountModifier+'"><a href="#">'+topic.body+' <span class="counter">'+topic.count+'</span></a></span></div>'); 
    $temp_popularTopics.find('.template').append('<span class="topic-tag '+size+'"><a href="#" class="'+charCountModifier+'">'+topic.body+'</a></span>'); 
    itemNumber++;
});

$('.section.reactions-and-topics').find('.topics-holder').html($temp_popularTopics).find('.template').animate({'opacity':1},500);

</script>
    </div>
<style>
.page_card { background:#f9f9f9; border:1px solid #ccc; clear:both; overflow:auto; }
.page_card:hover { background:#ddeefa; }
.page_card h1 { font-size:18px; }
.page_card .attribute { font-size:16px; font-weight:bold; }
.page_card .attribute label { font-size:12px; font-weight:normal; display:block; }
.page_card .reactions { font-size:11px; font-weight:bold; } 
</style>
    <div class="section engaged-pages">
        <div class="grid-12 row padded header">
            <h1>Most Engaged Pages</h1>
        </div>
        <div class="grid-12 row padded hasLoader">
            <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Analyzing Page Engagement...</div></div>
        </div>
<script>
var $temp_engagedPages = $('<div><div class="template"></div></div>');
var engagedPages = [
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { title:'headline goes here', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' }
];

$.each(engagedPages, function(idx, page) {
    var $page = $('<div class="grid-3 center padded">' +
        '<section class="page_card">' +
            '<h1><a href="#">'+page.title+'</a></h1>' +
            '<div class="grid-6 attribute padded">'+ page.engagement_rate +' <label>Engagement</label></div>' +
            '<div class="grid-6 attribute padded">'+ page.avg_scroll +' <label>Avg Scroll</label></div>' +
            '<div class="grid-6 attribute padded">'+ page.avg_time +' <label>Engagement</label></div>' +
            '<div class="grid-6 attribute padded">'+ page.pvs_session +' <label>Avg Scroll</label></div>' +
            '<div class="grid-12 reactions padded">'+ page.reactions +'</div>' +
        '</section>' +
    '</div>');

    $temp_engagedPages.find('.template').append( $page );
});

$('.section.engaged-pages .hasLoader').html($temp_engagedPages).find('.template').animate({'opacity':1},500);
</script>
    </div>
<style>
.content-item a { font-weight:normal; font-size:18px; color:#3c3c3c; }
.content-item .reactions { margin-top:10px;}
.content-item .reaction-tag { font-weight:normal; font-size:12px; padding:5px; display:inline-block; border-width:2px;}
.via { padding:10px 0; color:#999; font-size:12px; }
.via a { font-size:12px; color:#5ba0bc; }
.engaged-content {
    /* until we have a simple iframe that can load the content... */
    /* <iframe src="readrboard.com/content/ID"></iframe> */
    display:none;
}
</style>
    <div class="section engaged-content">
        <div class="grid-12 row padded header">
            <h1>Most Engaged Content</h1>
        </div>
        <div class="grid-12 row padded">
            <div class="grid-4 padded">
                <section class="content-item">
                    <h1><a href="#">All three of us, Ludo, Silvia and myself, are from three different countries. So there all three of us were, speaking different languages, and having fun reading GIFs aloud and comparing in our native tongues, along with different customs and perceptions,” Petrovici says.</a></h1>
                    <div class="grid-12 via">
                        <em>via <a href="#">SomeArticle Name</a></em>
                    </div>
                    <div class="grid-12">
                        <div class="reaction-tag">Amazing (29)</div>
                        <div class="reaction-tag">Crazy (17)</div>
                    </div>
                </section>
            </div>
            <div class="grid-4 padded">
                <section class="content-item">
                    <h1><a href="#"><img src="http://www.vancouverdesi.com/wp-content/uploads/2014/04/9737239-300x186.jpg"/></a></h1>
                    <div class="grid-12 via">
                        <em>via <a href="#">SomeArticle Name</a></em>
                    </div>
                    <div class="grid-12 reactions">
                        <div class="reaction-tag">Sad (12)</div>
                        <div class="reaction-tag">Shocking (10)</div>
                    </div>
                </section>
            </div>
            <div class="grid-4 padded">
                <section class="content-item">
                    <h1><a href="#"><iframe class="contentBody" width="300" height="250" frameborder="0" src="http://www.youtube.com/embed/kzcs5EQOLwo"></iframe></a></h1>
                    <div class="grid-12 via">
                        <em>via <a href="#">SomeArticle Name</a></em>
                    </div>
                    <div class="grid-12">
                        <div class="reaction-tag">LOVE IT (9)</div>
                        <div class="reaction-tag">Legit (8)</div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <div class="section engaged-referrers">
        <div class="grid-12 row padded header">
            <h1>Most Engaged Referrers</h1>
        </div>
        <div class="grid-12 row padded hasLoader">
            <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Analyzing Referrer Engagement...</div></div>
        </div>
    </div>
<script>
var $temp_engagedReferrers = $('<div><div class="template"></div></div>');
var engagedReferrers = [
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' },
    { tld:'somedomain.com', engagement_rate:'11.2', avg_scroll:'26', avg_time:'0:47', pvs_session:'1.2', reactions:'amazing,cant wait...' }
];

$.each(engagedReferrers, function(idx, referrer) {
    var $referrer = $('<div class="grid-3 center padded">' +
        '<section class="page_card">' +
            '<h1><a href="#">'+referrer.tld+'</a></h1>' +
            '<div class="grid-6 attribute padded">'+ referrer.engagement_rate +' <label>Engagement</label></div>' +
            '<div class="grid-6 attribute padded">'+ referrer.avg_scroll +' <label>Avg Scroll</label></div>' +
            '<div class="grid-6 attribute padded">'+ referrer.avg_time +' <label>Engagement</label></div>' +
            '<div class="grid-6 attribute padded">'+ referrer.pvs_session +' <label>Avg Scroll</label></div>' +
            // '<div class="grid-12 reactions padded">'+ referrer.reactions +'</div>' +
        '</section>' +
    '</div>');

    $temp_engagedReferrers.find('.template').append( $referrer );
});

$('.section.engaged-referrers .hasLoader').html($temp_engagedReferrers).find('.template').animate({'opacity':1},500);
</script>

<style>
.session_summaries { overflow:hidden; min-height: 200px;}
.engagement-over-time { overflow:hidden; }
.engagement-over-time .hasLoader { min-height: 200px;}
</style>

    <div class="grid-12 section session_summaries hasLoader">
        <div class="grid-12 row padded header">
            <div class="grid-9">
                <h1>Engaged Sessions / Last 30 Days</h1>
            </div>
            <div class="grid-3">
                <h1>Time Spent / Last 30 Days</h1>
            </div>
        </div>
        <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Analyzing Sessions...</div></div>
        <!-- <div class="grid-3 engagement-rate">
            <div class="donut" id="session-actions" style="height:200px;"></div>
        </div>
        <div class="grid-6 other-totals">
            <div class="grid-third attribute"><div class="data">140 <label>Reacted</label></div></div>
            <div class="grid-third attribute"><div class="data">1,200 <label>Viewed Reactions</label></div></div>
            <div class="grid-third attribute"><div class="data">8,041 <label>Scrolled Down</label></div></div>
        </div>
        <div class="grid-3 engagement-rate">
            <div class="donut" id="session-time" style="height:200px;"></div>
        </div> -->
    </div>
    <div class="section engagement-over-time">
        <div class="grid-12 row padded header">
            <h1>Engagement Over Time</h1>
        </div>
        <div class="grid-12 row padded hasLoader">
            <div class="loading"><div><img src="/static/site/images/reaction_preloader.gif"/> Gathering recent daily activity...</div></div>
        </div>
    </div>
<script>
var session_totals = {
    reacted:140,
    viewed:1200,
    scrolled:8041
};
var $temp_sessionInfo = $('<div><div class="template">' +
    '<div class="grid-3 engagement-rate">' +
            '<div class="donut" id="session-actions" style="height:200px;"></div>' +
        '</div>' +
        '<div class="grid-6 other-totals">' +
            '<div class="grid-third attribute"><div class="data">' + numberWithCommas(session_totals.reacted) + ' <label>Reacted</label></div></div>' +
            '<div class="grid-third attribute"><div class="data">' + numberWithCommas(session_totals.viewed) + ' <label>Viewed Reactions</label></div></div>' +
            '<div class="grid-third attribute"><div class="data">' + numberWithCommas(session_totals.scrolled) + ' <label>Scrolled Down</label></div></div>' +
        '</div>' +
        '<div class="grid-3 engagement-rate">' +
            '<div class="donut" id="session-time" style="height:200px;"></div>' +
        '</div>' +
    '</div></div>');

    $('.section.session_summaries.hasLoader').append($temp_sessionInfo).find('.template').animate({'opacity':1},500);

    Morris.Donut({
      element: 'session-actions',
      data: [
        {label: "Took Action", value: 14000 },
        {label: "Reacted", value: 140 },
        {label: "Viewed Reactions", value: 1200 },
        {label: "Scrolled", value: 8041 }
      ]
    }).select(0);

    Morris.Donut({
      element: 'session-time',
      data: [
        {label: "sessions over 0:15", value: 14000 },
        {label: "sessions over 0:30", value: 10000 },
        {label: "sessions over 0:45", value: 6000 },
        {label: "sessions over 1:00", value: 1000 },
        {label: "sessions over 1:30", value: 800 },
        {label: "sessions over 2:00", value: 300 },
      ]
    }).select(0);

</script>

<script>
// ENGAGEMENT OVER TIME
$('.section.engagement-over-time .hasLoader').append('<div id="engagement-over-time-graph"></div>').find('.template').animate({'opacity':1},500);
Morris.Area({
  element: 'engagement-over-time-graph',
  data: [
    { date: '2014-4-10', Reactions: 50,  ReactionViews: 50, Scrolls: 50,   TimeSpent: 50 },
    { date: '2014-4-11', Reactions: 75,  ReactionViews: 65, Scrolls: 175,  TimeSpent: 165 },
    { date: '2014-4-12', Reactions: 50,  ReactionViews: 40, Scrolls: 150,  TimeSpent: 140 },
    { date: '2014-4-13', Reactions: 75,  ReactionViews: 65, Scrolls: 175,  TimeSpent: 165 },
    { date: '2014-4-14', Reactions: 50,  ReactionViews: 40, Scrolls: 150,  TimeSpent: 140 },
    { date: '2014-4-15', Reactions: 75,  ReactionViews: 65, Scrolls: 175,  TimeSpent: 165 },
    { date: '2014-4-16', Reactions: 100, ReactionViews: 90, Scrolls: 100,  TimeSpent: 190 }
  ],
  lineColors: ['#7cc1db','#bf9fb8','#c1d1b6','#c4c4c4'],
  xkey: 'date',
  ykeys: ['Reactions', 'ReactionViews', 'Scrolls', 'TimeSpent'],
  labels: ['Reactions', 'Reaction Views', 'Scrolls', 'Time Spent']
});
</script>

</section>
</div>

<script>

(function(){

        // put in external file...
        RB.analytics = {
            queryHost: '//localnode.com:3000',
            initAnalytics: function() {
                $.ajax({
                url: RB.analytics.queryHost + '/initAnalytics',
                type: "get",
                data: {
                    json: $.toJSON( { sn:'{{group.short_name}}',gid:RB.group.id } )
                },
                success: function(response) {
                    console.log('success');
                    console.log(response);
                    }
                });
            },
        	updateAll: function() {
                console.log('group_id: {{ group.id }}');
        	},
            setDates: function(){

                var nowDate = moment().format("MM/DD/YY");
                RB.analytics.startDate = RB.util.getHashValue('start') || nowDate;
                RB.analytics.endDate = RB.util.getHashValue('end') || moment().add('days',1).format("MM/DD/YY");

                RB.analytics.jsStartDate = RB.analytics.startDate ? new Date(RB.analytics.startDate) : new Date();
                RB.analytics.jsEndDate = RB.analytics.endDate ? new Date(RB.analytics.endDate) : new Date();

                console.log('RB.analytics.startDate');
                console.log(RB.analytics.jsStartDate);
                console.log( moment(RB.analytics.jsStartDate).unix() );

                console.log('RB.analytics.endDate');
                console.log(RB.analytics.jsendDate);
                console.log( moment(RB.analytics.jsendtDate).unix() );

    //Oh - another thing - createdAt and updatedAt are now stored in their own columns also - thus you can do time-based queries. 
    // The complication is that they are stored as standard bigint values, being the number of milliseconds since 1970
    //             So for example to get everything in events for the past 1 hour you can do
    // in your javascript
    //     var hourAgo = new Date().getTime() - (60 * 60 * 1000);
    // sql = “select count(*) from events where createdAt >= “ + hourAgo;
            }

        };


        // defined in template
        RB.group.short_name = "{{ group.short_name }}";
        RB.group.full_name = "{{ group.name }}";
        // RB.group.id = "{{ group.id }}";
        RB.group.id = 1167;
        
        $(function(){
            RB.group.id = 1167;

            RB.analytics.setDates();

            //init this once so that the destroy function doesn't error when it refreshes this.
            // $('section[role="tag cloud grid"]').isotope();
            
            // $('section[role="datepicker"] input' ).datepicker({ dateFormat: 'mm/dd/y' });

            var start_date = new Pikaday({ field: $('input[name="start_date"]')[0], format: 'MM/DD/YY' });
            var end_date = new Pikaday({ field: $('input[name="end_date"]')[0], format: 'MM/DD/YY' });

            $('input[name="start_date"]').val( RB.analytics.startDate );
            $('input[name="end_date"]').val( RB.analytics.endDate );

            
            // ***** DATE PICKER: re-enable
            // $('section[role="datepicker"] form').submit( function() {

            //     var startDate = $('input[name="start_date"]').val();
            //     var endDate = $('input[name="end_date"]').val();
                
            //     RB.util.setHashValue('start', startDate );
            //     RB.util.setHashValue('end', endDate );

            //     RB.analytics.updateAll();
            //     return false;
            // });

            RB.analytics.initAnalytics();

        });


})();

</script>
{% endblock wideContent %}
