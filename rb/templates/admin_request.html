{% extends "base.html" %}

{% block sidebarContent %}
<div id="sidebar">
<h2>{{ group.name }}</h2>
<img src="{{ group.logo_url_lg }}" />
</div>
{% endblock sidebarContent %}

{% block mainContent %}
  <h1>Request Administrative Access</h1>

  <div id="fb-logged-in" style="display:none;">
	<button>Request Administrative Access for {{ group.name }}</button>
  </div>

  <div id="fb-logged-out" style="display:none;">
	<div id="fb-login-button">
		<a href="javascript:void(0);" onclick="doFBLogin();"><img src="/static/widget/images/fb-login_to_readrboard.png" /></a>
	</div>
  </div>


{% endblock mainContent %}

{% block pageJS %}
<script type="text/javascript">

function checkFBStatus() {
	FB.getLoginStatus(function(response) {
		console.dir(response);

			if ( response.session && response.status && response.status == "connected" ) {
				//user is logged in
				$('#fb-logged-in').show();
				$('#fb-logged-in button').click( function() {
					requestAccess( response );
				});
				$('#fb-logged-out').hide();
			} else {
				$('#fb-logged-in').hide();
				$('#fb-logged-out').show();
			}	
	});
}

function requestAccess(fb_response) {
	if ( fb_response ) {
        var fb_session = (fb_response.session) ? fb_response.session:fb_response
		var sendData = {
			fb: fb_session,
			group_id: {{ group.id }}
		};

		$.ajax({
			url: "/api/admin_request/",
			type: "get",
			contentType: "application/json",
			dataType: "jsonp",
			data: {
				json: JSON.stringify( sendData )
			},
			success: function(response){
				console.log('requested admin access');
				console.dir(response);
				
			},
			error: function(response) {
				console.log('woops');
			}
		});
	}
}

function doFBLogin() {
	FB.login( function(response) {
		checkFBStatus();
	}, {perms:'email'});
}

checkFBStatus();

</script>
{% endblock %}

{% block sidebarJS %}
<script type="text/javascript">

</script>
{% endblock %}