{% extends "popup_form.html" %}

{% block mainContent %}
<!-- ported from fb login file -->
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script> -->
	<script>
	var RDR_offline = ( window.location.href.indexOf('local.readrboard.com') != -1 ) ? true:false,
	RDR_baseUrl = ( RDR_offline ) ? "//local.readrboard.com:8080":"//www.readrboard.com";
	RDR_staticUrl = ( RDR_offline ) ? httpProtocol+"//local.readrboard.com:8080/static/":httpProtocol+"//s3.amazonaws.com/readrboard/";
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.ba-postmessage.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.json-2.2.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.cookie.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="/static/widget/js/readr_user.js" type="text/javascript"%3E%3C/script%3E' ) );
	</script>

  <h1>Log In</h1>
  {% csrf_token %}
  <div class="container">
    <div id="errorMsgWrap"></div>
    <div id="direct_registration" class="formBody clearfix">
  		<div class='formBodySection'>
  			<label>User Name</label>
			<input type="text" name="username" tabindex="1" />
			<a class="alternateAction" href="javascript:void(0);" onclick="RDRAuth.openRbCreateNewAccountWindow({widow:window});" style="font-size:11px;font-style:italic;">Create New Account &raquo;</a>
		</div>
		<div class='formBodySection'>
	  		<label>Password</label>
			<input type="password" name="password" tabindex="2" />
			<a class="alternateAction" href="javascript:void(0);" onclick="RDRAuth.openRbForgotPasswordWindow({widow:window});" style="font-size:11px;font-style:italic;">Forgot Password? &raquo;</a>
		</div>
	</div>
	<button class="btn" onclick="direct_registration();" tabindex="3" id="submit_login">Log In</button>
	<script type="text/javascript">

        $(document).ready(function(){

            RDRAuth.events.track('show_login_form');
            $('input[name="username"]').focus();
            $('#groupname').text( decodeURI(qs_args.group_name) );

            $('#direct_registration input').keyup( function(event) {
                if (event.keyCode == '13') { //enter.  
                    $('#submit_login').click();
                }
            });
            window.opener.RDRAuth.checkRBLoginWindow();
        });

		function direct_registration() {
			var sendData = "username="+$('#direct_registration').find('input[name="username"]').val()+
						   "&password="+$('#direct_registration').find('input[name="password"]').val();

			$.ajax({
				beforeSend: function( xhr ) {
					xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken') );
				},
				url: "/api/rb/",
				type: "post",
				contentType: "application/x-www-form-urlencoded",
				dataType: "json",
				data: sendData,
				success: function(response) {
					if ( response.data ) {
						if ( response.data.status == "fail" ) {
							$('#errorMsgWrap').html('<div class="error">'+response.data.message+'</div>')
                                .hide()
                                .fadeIn();
						} else {
							RDRAuth.setUser(response);
							RDRAuth.events.track('login_success');
							window.location.href=RDR_baseUrl+'/rb_login_success/';
						}
					}
				}
			});
		}

	</script>
  </div>
{% endblock mainContent %}