<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xmlns:x2="http://www.w3.org/2002/06/xhtml2" xmlns:fb="http://www.facebook.com/2008/fbml">
   <head>
     <title>Log In to ReadrBoard</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
	<script src="/static/js/jquery.ba-postmessage.min.js" type="text/javascript"></script>
	<style type="text/css">
	img		{ border:0; }
	</style>
   </head>
   <body>
     <div id="fb-root"></div>
	<div id="fb-login-button" style="display:none;">
		<a href="javascript:void(0);" onclick="doFBLogin();"><img src="/static/images/fb-login_to_readrboard.png" /></a>
	</div>
	<div id="fb-logged-in" style="display:none;">
		<a href="javascript:void(0);" onclick="FB.logout( doFBlogout );">Log out</a>
		<br/><br/>
		<a href="javascript:void(0);" onclick="sendFBData();">Send Facebook Response again</a>
	</div>
	<a href="javascript:void(0);" onclick="postMessageTest()">test postMessage</a>
     <script src="http://connect.facebook.net/en_US/all.js"></script>
     <script>
		var parentUrl;
		var qs = window.location.search.substr(1).split('&');
		var qs_args = [];
		for ( var i in qs ) {
			var this_arg = qs[i].split('=');
			qs_args[this_arg[0]] = this_arg[1];
		}
		function postMessage(message) {
			$.postMessage(
				message,
				'http://localhost:8080/static/ui-prototype/dailycandy.html',
				parent
			);	
		}
		
        FB.init({ 
           appId:'{{ fb_client_id }}', cookie:true, 
           status:true, xfbml:true 
        });
     </script>
	 <script>
		FB.getLoginStatus(function(response) {
	  		if (response.session) {
				//user is logged in
				$('#fb-logged-in').show();
				$('#fb-login-button').hide();
				console.dir(response);
				
	  		} else {
				$('#fb-logged-in').hide();
				$('#fb-login-button').show();
	  		}
		});
		
		function sendFBData() {
			$.ajax({
				url: "/api/fb/",
				type: "get",
				contentType: "application/json",
				dataType: "jsonp",
				data: {
					json: JSON.stringify(fb_response)
				},
				success: function(response){
					console.dir( response );
				}
			});
		}
		
		var fb_response = {};
		function doFBLogin() {
			FB.login( function(response) {
				if (response.session) {
					//user is logged in
					$('#fb-logged-in').show();
					$('#fb-login-button').hide();
					fb_response = response;
					sendFBData();
					
				} else {
					// user is not logged in
					console.log('USER NOT LOGGED IN');
 				}
			}, {perms:'email'});
		}
		
		function doFBlogout() {
			window.location.reload();
		}
	</script>
   </body>
</html>