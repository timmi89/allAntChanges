<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xmlns:x2="http://www.w3.org/2002/06/xhtml2" xmlns:fb="http://www.facebook.com/2008/fbml">
   <head>
	<script src="/static/global/js/jquery-1.6.js" type="text/javascript"></script>
	<script src="/static/widget/js/jquery.ba-postmessage.min.js" type="text/javascript"></script>
	<script src="/static/widget/js/jquery.json-2.2.min.js" type="text/javascript"></script>
	<script src="/static/widget/js/jquery.cookie.js" type="text/javascript"></script>
   </head>
   <body style="padding:0;margin:0;color:#fff;background:transparent;">
	<div id="fb-root"></div>
     <script src="http://connect.facebook.net/en_US/all.js" type="text/javascript"></script>
     <script type="text/javascript">
		FB.init({ 
			appId:'{{ fb_client_id }}', cookie:true, 
			status:true, xfbml:true 
		});

		var date = new Date();
		// TODO use the following line.  it creates a cachebuster that represents the current day/week/month
		// var cachebuster = String( parseInt( date.getDate() / 7 )+1 )+String(date.getMonth()) + String(date.getYear());
		var cachebuster = date.getTime();
		document.write(
			unescape( '%3Cscript src="/static/widget/js/readr_user_auth.js?' + cachebuster + '" type="text/javascript"%3E%3C/script%3E' )
		);

		$(document).ready( function() {
			RDRAuth.FBLoginResponse = function(response) {
				if (response.session) {
					//user is logged in
					RDRAuth.getReadrToken({response:response});
				} else {
					// user is not logged in
					// TODO do something.  post to parent that there was a bug logging in to FB
				}	
			}
			
			
			if ( $.cookie('location') && $.cookie('container_hash') ) {
				RDRAuth.notifyParent({message:false}, "sharedLink|" + $.cookie('container_hash') + "|" + RDRAuth.decodeDjangoCookie( $.cookie('location') ) + "|" + RDRAuth.decodeDjangoCookie( $.cookie('reaction') ) + "|" + RDRAuth.decodeDjangoCookie( $.cookie('content') ) + "|" + $.cookie('referring_int_id') );
				$.cookie('container_hash', null, { path: '/' });
				$.cookie('location', null, { path: '/' });
				$.cookie('content', null, { path: '/' });
				$.cookie('reaction', null, { path: '/' });
				$.cookie('referring_int_id', null, { path: '/' });
			} else if ( !$.cookie('educatedUser') ) {
				RDRAuth.notifyParent({message:false}, "educate user");
			}
		});
	</script>

	<script type="text/javascript">
	var _sf_async_config={uid:26845,domain:"readrboard.com"};
	(function(){
	  function loadChartbeat() {
	    window._sf_endpt=(new Date()).getTime();
	    var e = document.createElement('script');
	    e.setAttribute('language', 'javascript');
	    e.setAttribute('type', 'text/javascript');
	    e.setAttribute('src',
	       (("https:" == document.location.protocol) ? "https://a248.e.akamai.net/chartbeat.download.akamai.com/102508/" : "http://static.chartbeat.com/") +
	       "js/chartbeat.js");
	    document.body.appendChild(e);
	  }
	  var oldonload = window.onload;
	  window.onload = (typeof window.onload != 'function') ?
			loadChartbeat : function() { oldonload(); loadChartbeat(); pSUPERFLY.virtualPage("/widget", "Widget");  };
	})();

	</script>
   </body>
</html>