<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">

  <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <script>window.html5 || document.write('<script src="js/vendor/html5shiv.js"><\/script>')</script>
      <script src="js/vendor/respond.min.js"></script>
  <![endif]-->

  <title>{% block title %}ReadrBoard{% endblock %}</title>
  <meta name="description" content="How the web reacts">

  {% block css %}
  <link rel="stylesheet" href="{{ STATIC_URL }}css/fonts/helvetica.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}site/css/esrg_grid.css">
  <link rel="stylesheet" href="{{ STATIC_URL }}site/css/site.css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ STATIC_URL }}css/jscrollpane.css">
  {% endblock %}

  {% block topjavascript %}
  <script>httpProtocol = window.location.protocol;</script>
  <!-- Pulled from http://code.google.com/p/html5shiv/ -->
  <!--[if lt IE 9]>
  <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="{{ STATIC_URL }}js/jquery-1.9.0.min.js"></script>
  <!-- <script src="{{ STATIC_URL }}js/jquery.mustache.min.js"></script> -->
  <!-- <script src="{{ STATIC_URL }}js/jquery.isotope.min.js"></script> -->
  <script src="{{ STATIC_URL }}js/waypoints.min.js"></script>
  <script src="{{ STATIC_URL }}js/waypoints-sticky.min.js"></script>
  <script src="{{ STATIC_URL }}js/jquery.jscrollpane.min.js"></script>
  <script src="{{ STATIC_URL }}js/jquery.browser_detect.js"></script>
  <script src="{{ STATIC_URL }}js/jquery.mousewheel.js"></script>
  <script src="{{ STATIC_URL }}js/readr_site_scripts.js?v=2"></script>
  <script src="{{ STATIC_URL }}js/bootstrap-tooltip.js"></script>
  <script src="{{ STATIC_URL }}js/moment.js"></script>
  <script src="{{ STATIC_URL }}widget/js/jquery.json-2.2.min.js" type="text/javascript"></script>
  <script src="{{ STATIC_URL }}widget/js/jquery.cookie.js" type="text/javascript"></script>

  <!--[if (lt IE 9) & (!IEMobile)]>
  <script src="{{ STATIC_URL }}js/selectivizr-min.js.js"></script>
  <![endif]-->

  <!-- FancyBox -->
  <link rel="stylesheet" href="{{ STATIC_URL }}js/fancybox/jquery.fancybox.css?v=2.1.4" type="text/css" media="screen" />
  <script type="text/javascript" src="{{ STATIC_URL }}js/fancybox/jquery.fancybox.pack.js?v=2.1.4"></script>
  {% endblock %}

  <!-- For favicon -->
  <link rel=”shortcut icon” href=”{{ STATIC_URL }}site/images/favicon.ico” type=”image/x-icon”>
  <link rel=”icon” href=”{{ STATIC_URL }}site/images/favicon.ico” type=”image/x-icon”>

  <!-- extendedHeader -->
  {% block extendedHead %}
  {% endblock %}

</head>

<body class="{% block bodyClass %}{% endblock %} {% if not profile_user and not group and not board and not page %}{% if not query_string and not singleton %}homepage{% endif %}{% endif %}">    
    <div id="fb-root"></div>
    <script>

        window.fb_loader = $.Deferred();
        window.fbAsyncInit = function() {

            FB.init({
              appId      : '163759626987948', // App ID
              channelUrl : window.RDR_staticUrl+'fb_channel.html', // Channel File
              status     : true, // check login status
              cookie     : true, // enable cookies to allow the server to access the session
              xfbml      : true  // parse XFBML
            });

            // Code here runs on FB init
            window.fb_loader.resolve();
            
        };

        // Load the SDK Asynchronously
        (function(d){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "//connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}widget/js/readr_user.js"></script>

  <div id="page_container">
    {% block header %}
    <header role="global" class="no-rdr clearfix">
      <section class="content">
        <div id="user_and_search">
          <div id="user">
            {% block userStatus %}
            <div id="logged-in" {% if not cookie_user.social_user %}style="display:none;"{% endif %}>
              <i class="fa fa-bars"></i>
              <a href="/user/{{ cookie_user.id }}"><img src="{{ cookie_user.social_user.img_url }}?type=square"/></a>
              <div id="log-out-link">
                <div class="who_for">
                  <a href="/learn/">For Publishers</a>
                  <a href="/ecommerce/">For Retailers</a>
                </div>
                Welcome, <strong>{{ cookie_user.social_user.full_name }}</strong>
                <a href="/user/{{ cookie_user.id }}">My Activity</a>
                <a href="/follows/{{ cookie_user.id }}">Activity I Follow</a>
                <a href="javascript:void(0);" onclick="RDRAuth.logout();">Log Out</a>
                
                <div class="userSettingsMenu">
                    {% if cookie_user %}
                        <h5 id="user_settings">Settings</h5>
                        <label for="private_profile">
                          <input type="checkbox" id="private_profile" {% if cookie_user.social_user.private_profile %}checked="checked"{% endif %} /> 
                          Profile is private
                        </label>
                        <label for="follow_email">
                          <input type="checkbox" id="follow_email" {% if cookie_user.social_user.follow_email_option %}checked="checked"{% endif %} /> 
                          Send me email when someone follows my activity.
                        </label>
                        <label for="activity_notifications">
                          <input type="checkbox" id="activity_notifications" {% if cookie_user.social_user.notification_email_option %}checked="checked"{% endif %} /> 
                          Send me activity notifications.
                        </label>
                        
                        {% if cookie_user.social_user.provider == "Readrboard" %}
                            <hr/>
                            <a href="javascript:void(0);" onclick="RDRAuth.openRbAvatarUploadWindow();">Upload Profile Picture</a>
                        {% endif %}
                    {% endif %}
                </div>

                <div class="group_settings_menu">
                {% include "group_nav.html" %}
                </div>

              </div>
            </div>
            <div id="logged-out" {% if cookie_user.social_user %}style="display:none;"{% endif %}>
              <a href="javascript:void(0);" style="margin-left:5px;" onclick="RDRAuth.openRbLoginWindow();">Log In / Sign Up</a>
              <i class="fa fa-sign-in"></i>
              <div id="login-options" style="overflow:auto;">
                <div style="margin-bottom:10px;">
                  <div id="fb-login-button">
                    <a href="javascript:void(0);" onclick="$(this).addClass('logging-in'); RDRAuth.doFBLogin();"><img src="/static/widget/images/fb-login_to_readrboard.png" style="margin-top:3px;" /></a>
                  </div>
                </div>
                <div style="float:left;padding-left:6px;">
                  <a href="javascript:void(0);" onclick="RDRAuth.openRbLoginWindow();"><img src="/static/widget/images/rb-login_to_readrboard.png" /></a>
                </div>
              </div>    
            </div>
            {% endblock %}
          </div>

          {% block siteSearch %}
          <div id="site_search">
            <i class="fa fa-search"></i>
            <form method="get" id="searchform" action="">
              <fieldset>
                <input type="text" value="{% if query_string %}{{ query_string }}{% endif %}" name="s" id="s" />
                <button class="btn"><i class="fa fa-arrow-circle-o-right"></i></button>
              </fieldset>
            </form>
          </div>
          <script>
          $('#site_search')
              .on('mouseenter', function() { $(this).addClass('rdr_hover').find('input').focus() })//chain
              .on('mouseleave', function() {
                if ( !$(this).find('input').val().length ) {
                  $(this).removeClass('rdr_hover').find('input').blur();
                }
              })
              .find('form').on('submit', function(e) {
                  var validPaths = /^\/(stream|group|user|site|page).*$/;
                  var defaultPath = "/stream/";
                  var curPath = window.location.pathname;
                  var isValidPath = validPaths.test(curPath);
                  var action = isValidPath ? curPath : defaultPath;
                
                  $(e.target).attr('action', action);
              })
          </script>
          {% endblock siteSearch %}        
        </div>

        <a href="/" class="logo"><h1>ReadrBoard</h1></a>
        <div class="who_for">
          <a href="/learn/">Publishers</a>
          <a href="/ecommerce/">Retailers</a>
        </div>
      </section>

      {% block headerDisplay %}
      {% endblock headerDisplay %}

      </header>

      <!--
      <section role="subheader">
        <div class="content">
        </div>
      </section>
      -->

    {% endblock header %}
    
    <section role="content" class="clearfix">
      <section role="wide section">
        {% block wideContent %}
        {% endblock %}
      </section>
      
      {% block afterWideContent %}
          <section role="after wide section">
            {% if not board %}
            
            {% block complementarySection %}
                {% block sidebarContent %}
                {% endblock %}
            {% endblock %}

            {% endif %}

            <section role="main">
            {% block mainContent %}
            {% endblock mainContent %}
            </section>
          </section>
      {% endblock %}
    </section>

    
    {% block footer %}
    <footer role="contentinfo" class="{% block hasFixedBar %}withFixedBar{% endblock %} clearfix no-rdr">
        <div class="footerLinks">
            <ul class="footerLinksLeft">
                <li>
                    <a href="/"><strong>Home</strong></a>
                </li>
                <!-- 
                <li>
                    <a href="/learn/"><strong>About ReadrBoard</strong></a>
                </li> 
                -->
                <li>
                    <a href="/stream/"><strong>Live Stream</strong></a>
                </li>
                <li>
                    <a href="/privacy/"><strong>Privacy</strong></a>
                </li>
                <li>
                    <a href="/terms/"><strong>Terms</strong></a>
                </li>
                <li>
                    <a href="https://twitter.com/ReadrBoard" class="twitter-follow-button" data-show-count="false">Follow @ReadrBoard</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    
                </li>
            </ul>
            <div class="clearDiv"></div>
        </div>
    </footer>
    {% endblock footer %}

  </div> <!-- // page_container -->

<script type="text/javascript">

var _sf_async_config={uid:26845,domain:"readrboard.com"};
var chartbeat_script = (("https:" == document.location.protocol) ? "https://a248.e.akamai.net/chartbeat.download.akamai.com/102508/" : "http://static.chartbeat.com/") + "js/chartbeat.js";

if(!RB.RDR_offline){
    RB.util.loadScript( {src:chartbeat_script}, function() {
    });
}

{% if group %}
if ( !RB.group) {
  RB.group = {
    id:{{ group.id }}
  };
} else {
  RB.group.id = {{ group.id }};
}
{% endif %}
{% if profile_user %}
RB.profile_user = {
  id:{{ profile_user.id }}
};
{% endif %}
</script>

{% block pageJS %}
{% endblock %}

{% block sidebarJS %}
{% endblock %}
<script type="text/javascript">
      $('#private_profile').click( function() {
        $('label[for="private_profile"] span').remove();
        var sendData = {
          user_id:RDRAuth.rdr_user.user_id, 
          readr_token:RDRAuth.rdr_user.readr_token,
          group_id:1
        };
        $.ajax({
            url: "/api/privacy/toggle/",
            type: "get",
            data: {
                  json: JSON.stringify(sendData)
                },
            success: function(response) {
                $('label[for="private_profile"]').append('<strong style="display:inline-block;float:none;margin:0;color:#FF6600;">Saved</strong>');
            }
        });
      });
      $('#follow_email').click( function() {
        $('label[for="follow_email"] span').remove();
        var sendData = {
            user_id:RDRAuth.rdr_user.user_id, 
            readr_token:RDRAuth.rdr_user.readr_token,
            group_id:1
        };
        $.ajax({
            url: "/api/followemail/toggle/",
            type: "get",
            data: {
                json: JSON.stringify(sendData)
              },
            success: function(response) {
                $('label[for="follow_email"]').append('<strong style="display:inline-block;float:none;margin:0;color:#FF6600;">Saved</strong>');
            }
        });
      });

      $('#activity_notifications').click( function() {
        $('label[for="activity_notifications"] span').remove();
        var sendData = {
            user_id:RDRAuth.rdr_user.user_id, 
            readr_token:RDRAuth.rdr_user.readr_token,
            group_id:1
        };
        $.ajax({
            url: "/api/notificationemail/toggle/",
            type: "get",
            data: {
                json: JSON.stringify(sendData)
              },
            success: function(response) {
                $('label[for="activity_notifications"]').append('<strong style="display:inline-block;float:none;margin:0;color:#FF6600;">Saved</strong>');
            }
        });
      });
    </script>

<script type="text/javascript">
if(!RDR_offline){
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24372992-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
}else{
    //just a dummy array for testing
    _gaq = _gaq || [];
}
</script>
<!-- Parse JS SDK -->
<script src="//www.parsecdn.com/js/parse-1.1.15.min.js"></script>
<script type="text/javascript">
    //don't depend on Parse
    if(typeof Parse !== "undefined"){
        Parse.initialize("XVdaSK4bXLAR1N7afWx9HMxQUVXRkwI4cyUKGyWe", "MDsu5IiLRKVgBvPvEwRRSWMxfibi3f1SElmofE22");
    }
</script>
</body>
</html>
