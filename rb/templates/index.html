{% extends "base.html" %}

{% block title %}ReadrBoard{%endblock%}
{% block extendedHead %}
<link rel="canonical" href="{% if debug %}http://local.readrboard.com:8080/{% else %}http://www.readrboard.com/{% endif %}">
<meta name="google-site-verification" content="pWVfDSLL5X9Fs9agM5UiL2BHDDcxJtN46MgM2YkJXyg" />
{%endblock%}

{% block sidebarContent %}
<div id="sidebar">
    {% if not profile_user and not group and not board %}
    {% if not query_string and not singleton %}
    <!-- homepage sidebar -->
    {% include "homepage_sidebar.html" %}
    {% endif %}
    {% endif %}
    
    {% include "sidebar.html" %}
</div>
{% endblock sidebarContent %}

{% block mainContent %}

{% if not profile_user and not group and not board %}
{% if not query_string and not singleton %}
<style>
.box { text-align:center; font-family:Helvetica,'HelveticaBold',Arial; font-weight:bold; box-sizing: border-box;}
.box:hover { background:#fff; cursor:pointer; color:#008be4 !important;}
.box div.tag { position:relative; height:100%;}
/*.box .count { bottom:25%;position:absolute; font-size:14px !important; width:100%;}*/
/*.box3 .count { bottom:20%;}*/
.box1 { width:210px; height:210px; padding:90px 20px 0;}
.box .count { font-size:20px !important; }
.box3 .count { font-size:11px !important; }
.box2 { width:210px; height:140px; padding:50px 20px 0;}
.box3 { width:105px; height:70px; padding:20px 5px 0;}
.color1 { background:#84b8ef; color:#354c65;}
.color2 { background:#419bac; color:#454545;}
.color3 { background:#d7f360; color:#454545;}
.color4 { background:#9dd55e; color:#454545;}
.color5 { background:#495564; color:#ccc;}
</style>
<div class="tag_cloud_container">
<section role="tag cloud grid">
    <div class="color1 box2 box"><div class="tag">lol<br><span class="count">101</span></div></div>
    <div class="color2 box3 box"><div class="tag">craisins<br/><span class="count">14</span></div></div>
    <div class="color3 box3 box"><div class="tag">hilarious<br/><span class="count">59</span></div></div>
    <div class="color4 box1 box"><div class="tag">amazeballs<br/><span class="count">133</span></div></div>
    <div class="color5 box2 box"><div class="tag">uh<br/><span class="count">311</span></div></div>
    <div class="color1 box3 box"><div class="tag">omg that is amazing<br/><span class="count">11</span></div></div>
    <div class="color2 box3 box"><div class="tag">uh, no<br/><span class="count">100</span></div></div>
    <div class="color3 box1 box"><div class="tag">wild<br/><span class="count">67</span></div></div>
    <div class="color4 box2 box"><div class="tag">cosign<br/><span class="count">10</span></div></div>
    <div class="color5 box3 box"><div class="tag">problematic<br/><span class="count">101</span></div></div>
    <div class="color1 box3 box"><div class="tag">provocative<br/><span class="count">45</span></div></div>
    <div class="color2 box1 box"><div class="tag">awesomesauce<br/><span class="count">23</span></div></div>
    <div class="color3 box2 box"><div class="tag">killer<br/><span class="count">959</span></div></div>
    <div class="color4 box3 box"><div class="tag">dislike<br/><span class="count">38</span></div></div>
    <div class="color5 box3 box"><div class="tag">meh<br/><span class="count">5</span></div></div>
    <div class="color1 box1 box"><div class="tag">unicorns<br/><span class="count">275</span></div></div>
</section>
</div>
<script>
// logic to pull the tags from the results array:  middle, last, last, first
// then get count of colors, and iterate through

$('section[role="tag cloud grid"]').isotope({
  layoutMode: 'masonryHorizontal',
  masonryHorizontal: {
    rowHeight: 70
  }
});
$('.box').bigtext().click( function() { window.location.href += 's='+$(this).data('tag'); });;
</script>
{% endif %}
{% endif %}

{% if board %}
<div id="board_header">
    <h1>{{ board.title }}</h1>
    {% if board.description %}<h2>{{ board.description }}</h2>{% endif %}
    <div class="board_meta">
        <button id="board_follow_button">Follow this board</button>
        <span id="board_follower_count" style="display:block;float:right;margin:9px 8px 0 0;font-size:12px;"></span>
        {% if board.owner.first_name %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.first_name }} {{ board.owner.last_name }}</a></h3>
        {% else %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.username }}</a></h3>
        {% endif %}
    </div>
</div>

{% endif %}

{% if not profile_user and not group and not board and not query_string %}
<div id="more_content">
    <div class="section_content">
{% endif %}

    {% block cards %}
    <div id="cards">
      {% include "interactions.html" %}
    </div>
    {% endblock cards %}    

{% if not profile_user and not group and not board and not query_string %}
    </div>
</div>
{% endif %}

{% endblock mainContent %}

{% block pageJS %}
<script>
    {% if board %}
    $('#board_follow_button').click( function() {
        RB.follow.add({{ board.id }},'brd');
    });
    RB.follow.followers({{ board.id }},'brd')
    {% endif %}

    {% if not profile_user and not group and not board and not query_string %}
    var chart;
    $(function () {
        $.ajax({
            beforeSend: function( xhr ) {
                xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken') );
            },
            url: "/api/global/activity/",
            type: "get",
            success: function(response) {

                function SortByTagCount(a,b) { return b.count - a.count; }
                var interaction_order = [];

                $.each( response.data.nodes, function(reaction_body, reaction_data) {
                    interaction_order.push( { body:reaction_body, count:reaction_data.count } );
                    // $.each( node_data.top_interactions.tags, function( tag_id, tag_data ) {
                    // });
                });

                interaction_order.sort( SortByTagCount ); // each as a .body and a .count

                // do tag cloud logic
                
                // people
                $.each( response.data.users, function(user_id, user_data) {
                    var $active_people = $('div.people ul');
                        $active_people.append('<li><a href="/user/'+user_id+'"><img src="'+user_data.user.social_user.img_url+'" border="0" />'+user_data.user.social_user.full_name+'</a></li>');
                });

                // groups
                $.each( response.data.groups, function(group_name, group_data) {
                    var $active_people = $('div.active_sites ul');
                        $active_people.append('<li><a href="/group/'+group_data.group.short_name+'">'+group_name+'</a></li>');
                });

                // pages
                $.each( response.data.pages, function(page_url, page_data) {
                    var $active_people = $('div.active_pages ul');
                        $active_people.append('<li><a href="'+page_url+'" target="_blank">'+page_data.page.title+'</a></li>');
                });
            }
        });
    });
    {% endif %}

</script>
{% endblock %}
