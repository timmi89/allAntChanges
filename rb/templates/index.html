{% extends "base.html" %}

{% block title %}ReadrBoard{%endblock%}
{% block extendedHead %}
<link rel="canonical" href="{% if debug %}http://local.readrboard.com:8080/{% else %}http://www.readrboard.com/{% endif %}">
<meta name="google-site-verification" content="pWVfDSLL5X9Fs9agM5UiL2BHDDcxJtN46MgM2YkJXyg" />
{%endblock%}

{% block wideContent %}
{% if not profile_user and not group and not board %}
{% if not query_string and not singleton %}
<div style="width:1138px;height:420px;">
    <div id="tag_cloud_container" style="position:fixed;z-index:0;overflow:hidden;width:1138px;left:50%;margin-left:-569px">
        <section role="tag cloud grid">
            <!-- this will get dynamically populated -->
        </section>
    </div>
    <div class="image_container">
        <img src="{{ STATIC_URL }}site/images/homepage_masthead_lines.png" style="position:absolute;top:0;" />
        <a href="/about/"><img src="{{ STATIC_URL }}site/images/homepage_masthead.png" style="position:absolute;left:210px;top:100px;border:0;" /></a>
    </div>
</div>
{% endif %}
{% endif %}

{% endblock %}


{% block sidebarContent %}
<div id="sidebar">
    {% if not profile_user and not group and not board %}
    {% if not query_string and not singleton %}
    <!-- homepage sidebar -->
    {% include "homepage_sidebar.html" %}
    {% endif %}
    {% endif %}
    
    {% include "sidebar.html" %}
</div>
{% endblock sidebarContent %}

{% block mainContent %}

{% if board %}
<div id="board_header">
    <h1>{{ board.title }}</h1>
    {% if board.description %}<h2>{{ board.description }}</h2>{% endif %}
    <div class="board_meta">
        <button id="board_follow_button" class="btn">Follow this board</button>
        <span id="board_follower_count" style="display:block;float:right;margin:9px 8px 0 0;font-size:12px;"></span>
        {% if board.owner.first_name %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.first_name }} {{ board.owner.last_name }}</a></h3>
        {% else %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.username }}</a></h3>
        {% endif %}
    </div>
</div>

{% endif %}

{% if not profile_user and not group and not board and not query_string %}
<div id="more_content">
    <div class="section_content">
{% endif %}

    {% block cards %}
    <div id="cards">
        <style>
        .card   { width:688px; margin-bottom:20px; padding-bottom:20px;  border-bottom:1px solid #aaa; position:relative;}
        .card .main { overflow:auto; display:table; }
        .card .main .reactionBox { width:210px; text-align:center; padding:20px; display:table-cell; vertical-align:top; }
        .card .main .reactionBox h1 { margin:20px 0 50px; }
        .card .main .reactionBox h1 a { display:block; background:none !important;}
        .card .main .reactionBox h1 a div { width:180px; }
        .card .main .reactionBox .via { font-style:italic; font-size:12px; line-height:10px; }
        .card .main .reactionBox .groupName { font-weight:bold; font-size:18px;  }
        .card .main .reactionBox .links { margin-top:20px; }
        .card .main .reactionBox .links a   { font-size:12px; font-weight:normal; display:block; line-height:12px; background:none; margin-bottom:10px;}
        .card .main .contentBox { display:table-cell; vertical-align:middle; padding-left:15px; }
        .card .main .contentBox iframe,
        .card .main .contentBox img { width:463px; }
        .card .main .contentBox.media a { max-height:500px; overflow:hidden; display:block; }
        .card .main .contentBox blockquote { border:0; margin:0; padding:20px 10px 20px 0; font-size:24px; line-height:28px; color:#868686; font-family:'RDR_HelveticaBold',Helvetica,Arial,sans-serif; }
        .card .main .contentBox blockquote.large { font-size:60px; line-height:64px; }
        .card .main .contentBox blockquote.medium { font-size:36px; line-height:40px; }

        .card .meta { margin-bottom:10px; width:100%; display:table;}
        .card .meta a { color:#989898;}
        .card .meta a:hover { color:#008be4;}
        .card .meta .avatar { display:table-cell; vertical-align:middle; font-size:12px; color:#989898;}
        .card .meta .avatar img { width:32px; }
        .card .meta .date { display:table-cell; width:155px; vertical-align:middle; font-size:12px; color:#989898; text-align:right;}

        .reactionBox.color1 { box-shadow:0px 0px 55px #457aac inset; }
        .reactionBox.color1 a.external { color:#c4e2ff;}

        .reactionBox.color2 { box-shadow:0px 0px 55px #3b7d8c inset; }
        .reactionBox.color2 a.external { color:#9bdfef;}

        .reactionBox.color3 { box-shadow:0px 0px 55px #cbdd7d inset; }
        .reactionBox.color3 a.external { color:#94af1f;}

        .reactionBox.color4 { box-shadow:0px 0px 55px #8ec352 inset; }
        .reactionBox.color4 a.external { color:#d9fdb0;}

        .reactionBox.color5 { box-shadow:0px 0px 55px #3d5370 inset; }
        .reactionBox.color5 a.external { color:#c8d6e9;}

        section[role="main"] div.card div.content .comments{
            padding: 10px;
            text-align:left;
        }

        .card div.comments    { background:#fff; border-top:1px dotted #d3d4d4; padding:10px; clear:both; margin:15px 0 5px; display:none; }
        .card div.comments h2 { 
            font-size:12px; 
            border-bottom: 1px solid #CCC;
            padding-bottom: 5px;
            margin-bottom: 3px;
        }
        .card div.comment_container { position:relative; border-bottom:1px solid #eee;}
        .card div.comment_container .block_content   { position:absolute; right:5px; bottom: 3px; font-size:11px; color:red; }
        .card div.comment_container .header   {overflow:hidden; color:#666; clear:both; padding-top:3px;}
        .card div.comment_container .header .when       {float:right; font:normal 11px Arial; color:#aaa;}
        .card div.comment_container .header .when span  {font-size:8px; text-transform:uppercase; }
        .card div.comment_container .header .avatar     {float:left; height:20px; width:20px;}
        .card div.comment_container .header .avatar img {height:20px; width:20px; max-width:155px; }
        .card div.comment_container .header .who        {float:left; margin-left:5px; padding-top:4px; height:16px; font:italic bold 12px Arial; color:#999; }
        .card div.comment_container .comment   {overflow:hidden; color:#666; clear:both; position:relative; padding:6px 26px; font:normal 24px 'RDR_Helvetica',Helvetica, 'HelveticaRegular';}
        .card div.comment_container .comment .count  {font:normal 12px Arial; }
        .card div.comment_container .comment .comment_body  { font-size:12px; }

        .card .buttons { display:none;padding:5px;position:absolute;top:86px;width:33px;left:-33px;background:#eee;border:1px solid #aaa; border-right:0; text-align:center; box-shadow:0px 0px 8px #aaa;}
        .card:hover .buttons { display:block;}
        .card .buttons a { display:block; font-size:14px; color:#787878;}
        .card .buttons a.new_reaction { width:20px; height:20px; background:url("/static/site/images/readr_icons.png") no-repeat -176px 2px; }
        .card .buttons i { color:#787878; }
        .card .buttons a:hover { text-decoration:none;}

        .card .me_too_outcome { position: relative; background: #efe; padding: 5px 10px; margin-bottom: 10px; color:#9a9;}
        .card .me_too_outcome div.close { position:absolute; right:12px; top:5px; }
        </style>
        <section class="card">
            <div class="buttons">
                <a rel="tooltip" title="+1 this reactions" href="#">+1</a>
                <a rel="tooltip" title="Undo this reaction" href="#">-1</a>
                <a rel="tooltip" title="Add new reaction" class="new_reaction"></a>
                <a rel="tooltip" title="Add a comment" href="#"><i class="icon-comment"></i></a>
                <a rel="tooltip" title="Save to board" href="#"><i class="icon-bookmark"></i></a>
                <a rel="tooltip" title="Block this" href="#"><i class="icon-remove-sign"></i></a>
            </div>
            <div class="meta">
                <div class="avatar">
                    <a href="#">
                        <img src="http://graph.facebook.com/613765056/picture"/>
                        Porter Bayne
                    </a> and <a href="#">102 others</a>
                </div>
                <div class="date">
                    April 7, 2013
                </div>
            </div>
            <div class="me_too_outcome">
                Success!!  You've like totes added it.
                <div class="close"><i class="icon-remove"></i></div>
            </div>
            <div class="main">
                <div class="reactionBox color5">
                    <h1><a href="#"><div>Love It</div></a></h1>
                    <div class="via">via</div>
                    <div class="groupName"><a href="#">contently.com</a></div>
                    <div class="links">
                        <a href="#">The name of the article goes here</a>
                        <a href="#" class="external" target="_blank">Visit site <i class="icon-external-link"></i></a>
                    </div>
                </div>
                <div class="contentBox">
                    <a href="#"><img src="http://contently.com/blog/wp-content/uploads/2012/02/Social-Business-ROI.jpg" /></a>
                    <div class="comments" style="display: block;"><h2>Comments</h2><div class="comment_container clearfix"><div class="header"><div class="when">Apr 06 6:36p.m.</div><a href="/user/14269"><div class="avatar"><img src=""></div><div class="who">anonymous</div></a></div><div class="comment"><div class="comment_body">Theology is the study of religion - since when was religion synonymous with Christianity? Are the influences of other religions completely arbitrary or irrelevant?</div></div></div></div>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="buttons">
                <a rel="tooltip" title="+1 this reactions" href="#">+1</a>
                <a rel="tooltip" title="Undo this reaction" href="#">-1</a>
                <a rel="tooltip" title="Add new reaction" class="new_reaction"></a>
                <a rel="tooltip" title="Add a comment" href="#"><i class="icon-comment"></i></a>
                <a rel="tooltip" title="Save to board" href="#"><i class="icon-bookmark"></i></a>
                <a rel="tooltip" title="Block this" href="#"><i class="icon-remove-sign"></i></a>
            </div>
            <div class="meta">
                <div class="avatar">
                    <a href="#">
                        <img src="http://graph.facebook.com/613765056/picture"/>
                        Porter Bayne
                    </a> and <a href="#">102 others</a>
                </div>
                <div class="date">
                    April 7, 2013
                </div>
            </div>
            <div class="main">
                <div class="reactionBox color1">
                    <h1><a href="#"><div>Love It</div></a></h1>
                    <div class="via">via</div>
                    <div class="groupName"><a href="#">contently.com</a></div>
                    <div class="links">
                        <a href="#">The name of the article goes here</a>
                        <a href="#" class="external" target="_blank">Visit site <i class="icon-external-link"></i></a>
                    </div>
                </div>
                <div class="contentBox media">
                    <a href="#"><img src="http://contently.com/blog/wp-content/uploads/2013/03/font-perfect-guide-to-professional-typography-usage_515064d489105_w587.jpg" /></a>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="buttons">
                <a rel="tooltip" title="+1 this reactions" href="#">+1</a>
                <a rel="tooltip" title="Undo this reaction" href="#">-1</a>
                <a rel="tooltip" title="Add new reaction" class="new_reaction"></a>
                <a rel="tooltip" title="Add a comment" href="#"><i class="icon-comment"></i></a>
                <a rel="tooltip" title="Save to board" href="#"><i class="icon-bookmark"></i></a>
                <a rel="tooltip" title="Block this" href="#"><i class="icon-remove-sign"></i></a>
            </div>
            <div class="meta">
                <div class="avatar">
                    <a href="#">
                        <img src="http://graph.facebook.com/613765056/picture"/>
                        Porter Bayne
                    </a> and <a href="#">102 others</a>
                </div>
                <div class="date">
                    April 7, 2013
                </div>
            </div>
            <div class="main">
                <div class="reactionBox color2">
                    <h1><a href="#"><div>this is a really</div><div>long one</div></a></h1>
                    <div class="via">via</div>
                    <div class="groupName"><a href="#">contently.com</a></div>
                    <div class="links">
                        <a href="#">The name of the article goes here</a>
                        <a href="#" class="external" target="_blank">Visit site <i class="icon-external-link"></i></a>
                    </div>
                </div>
                <div class="contentBox">
                    <blockquote class="medium">Mr. Perry, none of us “deserve” HIV.  HIV is not punishment for our supposed sins.</blockquote>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="buttons">
                <a rel="tooltip" title="+1 this reactions" href="#">+1</a>
                <a rel="tooltip" title="Undo this reaction" href="#">-1</a>
                <a rel="tooltip" title="Add new reaction" class="new_reaction"></a>
                <a rel="tooltip" title="Add a comment" href="#"><i class="icon-comment"></i></a>
                <a rel="tooltip" title="Save to board" href="#"><i class="icon-bookmark"></i></a>
                <a rel="tooltip" title="Block this" href="#"><i class="icon-remove-sign"></i></a>
            </div>
            <div class="meta">
                <div class="avatar">
                    <a href="#">
                        <img src="http://graph.facebook.com/613765056/picture"/>
                        Porter Bayne
                    </a> and <a href="#">102 others</a>
                </div>
                <div class="date">
                    April 7, 2013
                </div>
            </div>
            <div class="main">
                <div class="reactionBox color3">
                    <h1><a href="#"><div>wow</div></a></h1>
                    <div class="via">via</div>
                    <div class="groupName"><a href="#">contently.com</a></div>
                    <div class="links">
                        <a href="#">The name of the article goes here</a>
                        <a href="#" class="external" target="_blank">Visit site <i class="icon-external-link"></i></a>
                    </div>
                </div>
                <div class="contentBox">
                    <blockquote class="large">surprising</blockquote>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="buttons">
                <a rel="tooltip" title="+1 this reactions" href="#">+1</a>
                <a rel="tooltip" title="Undo this reaction" href="#">-1</a>
                <a rel="tooltip" title="Add new reaction" class="new_reaction"></a>
                <a rel="tooltip" title="Add a comment" href="#"><i class="icon-comment"></i></a>
                <a rel="tooltip" title="Save to board" href="#"><i class="icon-bookmark"></i></a>
                <a rel="tooltip" title="Block this" href="#"><i class="icon-remove-sign"></i></a>
            </div>
            <div class="meta">
                <div class="avatar">
                    <a href="#">
                        <img src="http://graph.facebook.com/613765056/picture"/>
                        Porter Bayne
                    </a> and <a href="#">102 others</a>
                </div>
                <div class="date">
                    April 7, 2013
                </div>
            </div>
            <div class="main">
                <div class="reactionBox color4">
                    <h1><a href="#"><div>Provocative</div></a></h1>
                    <div class="via">via</div>
                    <div class="groupName"><a href="#">contently.com</a></div>
                    <div class="links">
                        <a href="#">The name of the article goes here</a>
                        <a href="#" class="external" target="_blank">Visit site <i class="icon-external-link"></i></a>
                    </div>
                </div>
                <div class="contentBox">
                    <blockquote>Anything in particular get your attention? Hover over some images or select some text and let the other readers know about it. After all, this is the new era of publishing and we readers are in it together. Even if we've never met, we're in a community just because, in reading, we've digested the same content. We think this is pretty fantastic.</blockquote>
                </div>
            </div>
        </section>
        <script>
        $('.card h1 a').bigtext();

          $('a[rel="tooltip"]').tooltip({
            placement:"left"
          });
        </script>
        {% comment %}
      {% include "interactions.html" %}
      {% endcomment %}
    </div>
    {% endblock cards %}    

{% if not profile_user and not group and not board and not query_string %}
    </div>
</div>
{% endif %}

{% endblock mainContent %}

{% block pageJS %}
<script>
    {% if board %}
    $('#board_follow_button').click( function() {
        RB.follow.add({{ board.id }},'brd');
    });
    RB.follow.followers({{ board.id }},'brd')
    {% endif %}

    {% if not profile_user and not group and not board and not query_string %}
    var chart;
    $(function () {
        $.ajax({
            beforeSend: function( xhr ) {
                xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken') );
            },
            url: "/api/global/activity/",
            type: "get",
            success: function(response) {

                function SortByTagCount(a,b) { return b.count - a.count; }
                var sorted_interactions = [];

                $.each( response.data.nodes, function(reaction_body, reaction_data) {
                    sorted_interactions.push( { body:reaction_body, count:reaction_data.count } );
                });

                sorted_interactions.sort( SortByTagCount ); // each as a .body and a .count

                // do tag cloud logic
                // render the tag cloud
                // medium, small, small, big
                var boxSizes = [ "medium", "small", "small", "big" ],
                    currentBoxSize = 0,
                    colorInt = 1,
                    $tagCloud = $('section[role="tag cloud grid"]');
                while ( sorted_interactions.length ) {
                    if ( boxSizes[ currentBoxSize ] == "medium" ) {
                        var median = Math.floor(sorted_interactions.length/2);
                        var $thisBox = $( '<a href="/?s='+sorted_interactions[ median ].body+'"><div class="color'+colorInt+' box2 box"><div class="tag">'+sorted_interactions[ median ].body+'<br/><span class="count">'+sorted_interactions[ median ].count+'</span></div></div></a>' );
                        $tagCloud.append( $thisBox );
                        sorted_interactions.splice( median, 1 );
                    } else if ( boxSizes[ currentBoxSize ] == "small" ) {
                        var thisTag = sorted_interactions.pop(),
                            $thisBox = $( '<a href="/?s='+thisTag.body+'"><div class="color'+colorInt+' box3 box"><div class="tag">'+thisTag.body+'<br/><span class="count">'+thisTag.count+'</span></div></div></a>' );
                        $tagCloud.append( $thisBox );
                    } else if ( boxSizes[ currentBoxSize ] == "big" ) {
                        var thisTag = sorted_interactions.shift(),
                            $thisBox = $( '<a href="/?s='+thisTag.body+'"><div class="color'+colorInt+' box1 box"><div class="tag">'+thisTag.body+'<br/><span class="count">'+thisTag.count+'</span></div></div></a>' );
                        $tagCloud.append( $thisBox );
                    }
                    
                    // set next color and box size
                    colorInt++;
                    currentBoxSize++;
                    if ( colorInt == 6 ) colorInt = 1;
                    if ( currentBoxSize == 4 ) currentBoxSize = 0;
                }

                // isotope and bigtext the cloud
                $('section[role="tag cloud grid"]').isotope({
                  layoutMode: 'masonryHorizontal',
                  masonryHorizontal: {
                    rowHeight: 70
                  }
                }, function() {
                    $('.box').bigtext();
                    var tagBoxesCount = $('section[role="tag cloud grid"] a').length,
                        currentTagBoxAnimating = 0;
                    var animationQueue = setInterval( animateNextBox, 100 );

                    function animateNextBox() {
                        var $thisBox = $('section[role="tag cloud grid"] a:eq('+currentTagBoxAnimating+') .box');
                        if ( $thisBox.hasClass('box1') ) {
                            $thisBox.find('div.tag').animate( {bottom:'0%'}, { queue:false, duration: 333 } );
                        } else {
                            $thisBox.find('div.tag').animate( {top:'0%'}, { queue:false, duration: 333 } );
                        }
                        currentTagBoxAnimating++;
                        if ( currentTagBoxAnimating > tagBoxesCount ) {
                            clearInterval( animationQueue );
                        }
                    }
                });

                
                // people
                $.each( response.data.users, function(user_id, user_data) {
                    var $active_people = $('div.people ul');
                        $active_people.append('<li><a href="/user/'+user_id+'"><img src="'+user_data.user.social_user.img_url+'" border="0" />'+user_data.user.social_user.full_name+'</a></li>');
                });

                // groups
                $.each( response.data.groups, function(group_name, group_data) {
                    var $active_people = $('div.active_sites ul');
                        $active_people.append('<li><a href="/group/'+group_data.group.short_name+'">'+group_name+'</a></li>');
                });

                // pages
                $.each( response.data.pages, function(page_url, page_data) {
                    var $active_people = $('div.active_pages ul');
                        $active_people.append('<li><a href="'+page_url+'" target="_blank">'+page_data.page.title+'</a></li>');
                });
            }
        });
    });
    {% endif %}

</script>
{% endblock %}
