{% extends "base.html" %}

{% block title %}ReadrBoard{%endblock%}
{% block extendedHead %}
<link rel="canonical" href="{% if debug %}http://local.readrboard.com:8080/{% else %}http://www.readrboard.com/{% endif %}">
<meta name="google-site-verification" content="pWVfDSLL5X9Fs9agM5UiL2BHDDcxJtN46MgM2YkJXyg" />
{%endblock%}

{% block sidebarContent %}
<div id="sidebar">
  {% include "sidebar.html" %}
</div>
{% endblock sidebarContent %}

{% block mainContent %}

{% if not profile_user and not group and not board %}
<style>
section[role="content"] {background:#f3f3f3;}
section[role="main"] {margin-top: 0;}
section[role="complementary"] {display:none;}
header[role="banner"] { box-shadow:none !important; border-bottom:1px solid #d9d9d9; }
#how_the_web_feels, #more_content {
    background:#fff;
    width:100%;
    box-shadow:0 0 6px #bbb;
    text-align:center;
}
#how_the_web_feels { min-height:400px; }
#more_content { padding-top:15px; }
#how_the_web_feels h1 { font-weight:bold; color:#8e8e8e; font-size:64px;padding:20px;}
#more_info {
    padding:15px 0 5px;
}
div.section_content {
    margin:0 auto;
    width:920px;
}
div.section_content #cards {
    margin:0;
    padding:0;
    width:616px;
}
#how_the_web_feels div.section_content h1.sectionHeader,
div.section_content h1.sectionHeader {
    text-align:left;
    background:none;
    font-size:18px;
    color:#000;
    padding:0 0 0 5px;
    margin-bottom:10px;
}
#how_the_web_feels div.section_content h1.sectionHeader {
    margin-top:0px;
    position:relative;
    z-index:2;
}
#how_the_web_feels section[role="most popular tags"] ol { margin-left:5px; }
</style>
{% if not query_string and not singleton %}
<script src="{{ STATIC_URL }}site/js/highcharts/highcharts.js"></script>
<div id="how_the_web_feels">
    <h1>How the web feels today.</h1>
    <div class="section_content">
        <div class="reactions">
            <div class="other_reactions">
                <section role="most popular tags">
                    <h1 class="sectionHeader">Other Reactions</h1>
                    <ol></ol>
                </section>
            </div>
            <div class="most_popular">
                <h1 class="sectionHeader">Most Popular Reactions</h1>
                <div id="pie_chart_labels">
                    <ol></ol>
                </div>
                <div id="pie_chart_container">
                    <div id="pie_chart"></div>
                    <div id="pie_chart_credit">
                        <span>Highcharts.com</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="more_info">
    <div class="section_content">
        <div class="whatIsReadrBoard">
            <div class="whatIsReadrBoardWrap">
                <h2>What is ReadrBoard?</h2>
                ReadrBoard makes it easy to react to any phrase, 
                image, video, or article on the web -- with the click of a button.
                <div><a href="/publishers/">Add to your website</a> &nbsp;|&nbsp;<a href="/react/">Add to your browser</a></div>
            </div>
        </div>
        <div class="featureQuoteWrap">
            <div class="featureQuoteWrapInner">
                <a href="http://www.readrboard.com/user/1662/" target="_blank">
                    <img src="{{ STATIC_URL }}site/images/alexis-portrait.jpg" />
                </a>
                <h3>
                    <em>"If you're like me, you've been doing varieties of this in haphazard ways for years -- ReadrBoard wins the day.</em>
                    <span class="alexis">- <a href="http://www.readrboard.com/user/1662/" target="_blank">Alexis Ohanian</a></span>
                    <span class="cofounder">Co-Founder, Reddit</span>
                </h3>
            </div>
        </div>
        <div class="asSeenOnWrap">
            <a class="a1" href="http://dailycandy.com/everywhere/article/129857/Online-finds-fashion-and-fodder" target="_blank">
                <img src="{{ STATIC_URL }}site/images/as-seen-on/dailycandy.png" />
            </a>
            <a class="a2" href="http://contently.com/blog/readrboard-getting-past-like/" target="_blank">
                <img src="{{ STATIC_URL }}site/images/as-seen-on/content-strategist.png" />
            </a>

            <a class="a3" href="http://netted.net/2012/08/15/now-thats-remarkable/" target="_blank">
                <img src="{{ STATIC_URL }}site/images/as-seen-on/netted.png" />
            </a>

            <a class="a4" href="http://journalists.org/2012/01/06/how-they-did-it-readrboard/" target="_blank">
                <img src="{{ STATIC_URL }}site/images/as-seen-on/ona.png" />
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endif %}

{% if board %}
<style>
#board_header { margin:0 auto; padding:10px; text-align:center; margin-top:-30px; }
#board_header h1 { font-size:32px; font-weight:bold; text-shadow:1px 1px 2px #aaa;}
#board_header .board_meta       { padding:10px 20px; background:none repeat scroll 0 0 rgba(0, 0, 0, 0.05); margin:20px auto; overflow:auto; box-shadow:0px 0px 3px #bbb inset; }
#board_header h2    { font-size:18px; font-style:italic; }
#board_header .board_meta h3        { font-size:16px; float:left; line-height:30px; font-weight:bold;}
#board_header .board_meta button    { float:right; line-height:26px; }
</style>
<div id="board_header">
    <h1>{{ board.title }}</h1>
    {% if board.description %}<h2>{{ board.description }}</h2>{% endif %}
    <div class="board_meta">
        <button id="board_follow_button">Follow this board</button>
        <span id="board_follower_count" style="display:block;float:right;margin:9px 8px 0 0;font-size:12px;"></span>
        {% if board.owner.first_name %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.first_name }} {{ board.owner.last_name }}</a></h3>
        {% else %}
        <h3><a href="/user/{{ board.owner.id }}">{{ board.owner.username }}</a></h3>
        {% endif %}
    </div>
</div>

{% endif %}

{% if not profile_user and not group and not board and not query_string %}
<div id="more_content">
    <div class="section_content">
        <style>
        div.otherContent {
            width:280px;
            float:right;
        }
        div.component { margin-bottom:20px; }
        div.component ul { list-style-type:none; padding:0;margin:0 0 0 5px;text-align:left;}
        div.component ul li { margin-bottom:5px;}
        div.component.active_pages ul li { margin-bottom:20px;font-size:12px;line-height:14px;}
        div.component ul li a { font-weight:bold;color:#6598ca;text-decoration:none;}
        div.component ul li a img { width:30px; display:inline-block; margin:0 5px -7px 0;}
        </style>
        <div class="otherContent">
            <div class="component active_sites">
                <h1 class="sectionHeader">Active Sites</h1>
                <ul></ul>
            </div>
            <div class="component people">
                <h1 class="sectionHeader">Active People</h1>
                <ul></ul>
            </div>
            <div class="component active_pages">
                <h1 class="sectionHeader">Active Pages</h1>
                <ul></ul>
            </div>
        </div>
{% endif %}

    {% block cards %}
    <div id="cards">
      {% include "interactions.html" %}
    </div>
    {% endblock cards %}    

{% if not profile_user and not group and not board and not query_string %}
    </div>
</div>
{% endif %}

{% endblock mainContent %}

{% block pageJS %}
<script>
    {% if board %}
    $('#board_follow_button').click( function() {
        RB.follow.add({{ board.id }},'brd');
    });
    RB.follow.followers({{ board.id }},'brd')
    {% endif %}

    {% if not profile_user and not group and not board and not query_string %}
    var chart;
    $(function () {
        $.ajax({
            beforeSend: function( xhr ) {
                xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken') );
            },
            url: "/api/global/activity/",
            type: "get",
            success: function(response) {

                function SortByTagCount(a,b) { return b.count - a.count; }
                var interaction_order = [];

                $.each( response.data.nodes, function(reaction_body, reaction_data) {
                    interaction_order.push( { body:reaction_body, count:reaction_data.count } );
                    // $.each( node_data.top_interactions.tags, function( tag_id, tag_data ) {
                    // });
                });

                interaction_order.sort( SortByTagCount );

                // reactions
                var chart_data = [],
                    index = 0;

                $.each( interaction_order, function(idx, reaction) {
                    var $pie_chart_labels = $('#pie_chart_labels ol'),
                        $other_reactions = $('section[role="most popular tags"] ol');
                    if (index<8) {
                        $pie_chart_labels.append('<li><a href="/?s='+reaction.body+'">'+reaction.body+' <span>('+reaction.count+')</span></a></li>');
                        chart_data.push( [reaction.body, reaction.count] );
                    } else {
                        $other_reactions.append('<li class="medium"><a href="/?s='+reaction.body+'">'+reaction.body+' <span>('+reaction.count+')</span></a></li>');
                    }
                    index++;
                });

                // people
                $.each( response.data.users, function(user_id, user_data) {
                    var $active_people = $('div.people ul');
                        $active_people.append('<li><a href="/user/'+user_id+'"><img src="'+user_data.user.social_user.img_url+'" border="0" />'+user_data.user.social_user.full_name+'</a></li>');
                });

                // groups
                $.each( response.data.groups, function(group_name, group_data) {
                    var $active_people = $('div.active_sites ul');
                        $active_people.append('<li><a href="/group/'+group_data.group.short_name+'">'+group_name+'</a></li>');
                });

                // pages
                $.each( response.data.pages, function(page_url, page_data) {
                    var $active_people = $('div.active_pages ul');
                        $active_people.append('<li><a href="'+page_url+'" target="_blank">'+page_data.page.title+'</a></li>');
                });
                
                
                // Radialize the colors
                Highcharts.getOptions().colors = $.map(Highcharts.getOptions().colors, function(color) {
                    return {
                        radialGradient: { cx: 0.5, cy: 0.3, r: 0.7 },
                        stops: [
                            [0, color],
                            [1, Highcharts.Color(color).brighten(-0.3).get('rgb')] // darken
                        ]
                    };
                });
                
                // Build the chart
                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'pie_chart',
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        // pointFormat: '{series.name}',
                        enabled:false
                    },
                    plotOptions: {
                        series: {
                            point: {
                        events: {
                            mouseOver: function() {
                                var nthChild = this.x+1;
                                $('#pie_chart_labels ol li:nth-child('+nthChild+')').addClass('active');
                            },
                            mouseOut: function() {
                                var nthChild = this.x+1;
                                $('#pie_chart_labels ol li:nth-child('+nthChild+')').removeClass('active');
                            }
                        }
                    },
                        },
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: false
                            }
                        }
                    },
                    series: [{
                        type: 'pie',
                        name: 'Reactions',
                        data: chart_data
                    }]
                });
            }
        });
    });
    {% endif %}

</script>
{% endblock %}
