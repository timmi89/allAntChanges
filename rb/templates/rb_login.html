{% extends "base.html" %}

{% block bodyClass %}wide noFooter{% endblock %}

{% block userStatus %}
<!-- don't show log in link-->
{% endblock userStatus %}

{% block mainContent %}
<!-- ported from fb login file -->
<!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script> -->
	<script>
	var RDR_offline = ( window.location.href.indexOf('local.readrboard.com') != -1 ) ? true:false,
	RDR_baseUrl = ( RDR_offline ) ? "//local.readrboard.com:8080":"//www.readrboard.com";
	RDR_staticUrl = ( RDR_offline ) ? httpProtocol+"//local.readrboard.com:8080/static/":httpProtocol+"//s3.amazonaws.com/readrboard/";
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.ba-postmessage.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.json-2.2.min.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="'+RDR_staticUrl+'widget/js/jquery.cookie.js" type="text/javascript"%3E%3C/script%3E' ) );
	document.write( unescape( '%3Cscript src="/static/widget/js/readr_user.js" type="text/javascript"%3E%3C/script%3E' ) );
	</script>

  <h1>Log In</h1>
  {% csrf_token %}
  <div class="container">
  	<div id="direct_registration" style="overflow:auto;">
  		<div style="float:left;width:150px;margin-right:20px;">
  			<label>User Name</label>
			<input type="text" name="username" tabindex="1" />
			<a href="javascript:void(0);" onclick="createNewAccount();" style="font-size:11px;font-style:italic;">Create New Account &raquo;</a>
		</div>
		<div style="float:left;width:150px;">
	  		<label>Password</label>
			<input type="password" name="password" tabindex="2" />
			<a href="javascript:void(0);" onclick="forgotPassword();" style="font-size:11px;font-style:italic;">Forgot Password? &raquo;</a>
		</div>
	</div>
	<button onclick="direct_registration();" tabindex="3" id="submit_login">Log In</button>
	<script type="text/javascript">

		RDRAuth.events.track('show_login_form');
		$('input[name="username"]').focus();
		$('#groupname').text( decodeURI(qs_args.group_name) );

		$('#direct_registration input').keyup( function(event) {
            if (event.keyCode == '13') { //enter.  
            	$('#submit_login').click();
            }
        });
		
		window.opener.RDRAuth.checkRBLoginWindow();

		function direct_registration() {
			var sendData = "username="+$('#direct_registration').find('input[name="username"]').val()+
						   "&password="+$('#direct_registration').find('input[name="password"]').val();

			$.ajax({
				beforeSend: function( xhr ) {
					xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken') );
				},
				url: "/api/rb/",
				type: "post",
				contentType: "application/x-www-form-urlencoded",
				dataType: "json",
				data: sendData,
				success: function(response) {
					if ( response.data ) {
						if ( response.data.status == "fail" ) {
							$('#direct_registration').prepend('<div class="error">'+response.data.message+'</div>');
						} else {
							RDRAuth.setUser(response);
							RDRAuth.events.track('login_success');
							window.location.href=RDR_baseUrl+'/rb_login_success/';
						}
					}
				}
			});
		}

        function createNewAccount(){
            var w = 535;
            var h = 300;
            var l = (window.screen.width/2)-(w/2);
            var t = (window.screen.height/2)-(h/2);

            var properties = 'menubar=1,resizable=1,width='+w+',height='+h+',top='+t+',left='+l;

            window.close();
            window.open(
                RDR_baseUrl+'/user_create/',
                'readr_create_user',
                properties
            );
            return false;
        }
        
        function forgotPassword () {
            var w = 535;
            var h = 300;
            var l = (window.screen.width/2)-(w/2);
            var t = (window.screen.height/2)-(h/2);

            var properties = 'menubar=1,resizable=1,width='+w+',height='+h+',top='+t+',left='+l;


            window.close();
            window.open(
                RDR_baseUrl+'/request_password/',
                'readr_forgot_pw',
                properties
            );
            return false;
        }

	</script>
  </div>
{% endblock mainContent %}

{% block pageJS %}
{% endblock %}

