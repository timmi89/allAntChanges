{% extends "group_create.html" %}

{% block extendedHead %}
<script>

    (function($){

        function plugin_jquery_postMessage($){
            /*
             * jQuery postMessage - v0.5 - 9/11/2009
             * http://benalman.com/projects/jquery-postmessage-plugin/
             *
             * Copyright (c) 2009 "Cowboy" Ben Alman
             * Dual licensed under the MIT and GPL licenses.
             * http://benalman.com/about/license/
             */
            var g,d,j=1,a,b=this,f=!1,h="postMessage",e="addEventListener",c,i=b[h]&&!$.browser.opera;$[h]=function(k,l,m){if(!l){return}k=typeof k==="string"?k:$.param(k);m=m||parent;if(i){m[h](k,l.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(l){m.location=l.replace(/#.*$/,"")+"#"+(+new Date)+(j++)+"&"+k}}};$.receiveMessage=c=function(l,m,k){if(i){if(l){a&&c();a=function(n){if((typeof m==="string"&&n.origin!==m)||($.isFunction(m)&&m(n.origin)===f)){return f}l(n)}}if(b[e]){b[l?e:"removeEventListener"]("message",a,f)}else{b[l?"attachEvent":"detachEvent"]("onmessage",a)}}else{g&&clearInterval(g);g=null;if(l){k=typeof m==="number"?m:typeof k==="number"?k:100;g=setInterval(function(){var o=document.location.hash,n=/^#?\d+&/;if(o!==d&&n.test(o)){d=o;l({data:o.replace(n,"")})}},k)}}}
        }

        //todo: pull these from utils for real
        var utils = {
            getQueryParams: function(optQueryString) {
                //RDR.util.getQueryParams:

                //thanks: http://stackoverflow.com/a/2880929/1289255
                //I haven't verfied that this is 100% perfect for every url case, but it's solid.
                
                //this function is also in readr_scripts
                var queryString = optQueryString || window.location.search;

                var urlParams = {};
                var e,
                a = /\+/g,  // Regex for replacing addition symbol with a space
                r = /([^&=]+)=?([^&]*)/g,
                d = function (s) { return decodeURIComponent(s.replace(a, " ")); },
                q = queryString.substring(1);

                while (e = r.exec(q))
                    urlParams[d(e[1])] = d(e[2]);

                return urlParams;
            },
            getQueryStrFromUrl: function(url){
                var qIndex = url.indexOf('?'),
                    hrefBase,
                    hrefQuery,
                    qParams;

                 //if qIndex == -1, there was no ?
                if(qIndex == -1 ) {
                    hrefBase = url;
                    hrefQuery = "";
                }else{
                    hrefBase = url.slice(0, qIndex);
                    hrefQuery = url.slice(qIndex);
                }
                return hrefQuery;
            }
        };

        var params = utils.getQueryParams();
        
        $(function(){

            plugin_jquery_postMessage($);

            $('input#id_name').val( params.company_name );
            $('input#id_short_name').val( params.hostdomain );
            $('input#id_domain').val( params.hostdomain ).attr('readonly', 'readonly');

            // var data = $.toJSON({
            //     company_name: params.company_name,
            //     hostdomain: params.hostdomain
            // });
            // var urlPrefix = "http://";
            // var hostPath = urlPrefix+params.hostdomain;
            // $.postMessage(
            //     $.toJSON(data),
            //     hostPath,
            //     parent
            // );
        });
    })(jQuery);
</script>

    <style>
        html{
            background: none;
        }
        section[role="content"]{
            margin: 0 !important;
            padding: 0 !important;
        }

        section[role="group panel header"]{
            display: none;
        }

        #id_domain{
            color: #999;
        }

    </style>
{% endblock %}

{% block header %}
{% endblock header %}

{% block hostPlatformHeader %}
    <div class="hostPlatformHeader">
        Step 2: Register
    </div>
{% endblock hostPlatformHeader %}

{% block headerText %}
    <h1 class="headerText">Register this site</h1>
{% endblock headerText %}

{% block alreadyRequested %}
    <style>
        .headerText{
            display: none;
        }
        .quickWrap{
            margin: 0 20px;
        }
    </style>
    <div class="quickWrap">
        <h3>Thanks, your site is registered!</h3>
        <div style="clear:both; margin-top: 50px;">
          <span><a class="btn" href="#" onclick="reloadPageAfterLogin();">click here to continue</a> after registering.</span>
        </div>
    </div>

    <script>
        var wordpressEditUrl = '/wordpress_edit/';
        var query = window.location.search || "?";
        query += "&refresh=true";
        var wordpressRefreshUrl = wordpressEditUrl + query;

        function reloadPageAfterLogin(){
            window.location = wordpressRefreshUrl;
            return false;
        }
    </script>
{% endblock alreadyRequested %}

{% block fixedBar %}
{% endblock fixedBar %}

{% block footer %}
<style>
    /*undo the css from nofooter*/
    #uvTab{
        display: block !important;
        top: 130px !important;
    }
</style>

{% endblock footer %}